

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.other.detectfuncs &mdash; ibeis 1.8.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="ibeis 1.8.1 documentation" href="../../../index.html"/>
        <link rel="up" title="ibeis.other" href="../other.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> ibeis
          

          
          </a>

          
            
            
              <div class="version">
                1.8.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ibeis.html">ibeis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ibeis</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ibeis.html">ibeis</a> &raquo;</li>
        
          <li><a href="../other.html">ibeis.other</a> &raquo;</li>
        
      <li>ibeis.other.detectfuncs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ibeis.other.detectfuncs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Developer convenience functions for ibs (detections).</span>

<span class="sd">TODO: need to split up into sub modules:</span>
<span class="sd">    consistency_checks</span>
<span class="sd">    feasibility_fixes</span>
<span class="sd">    move the export stuff to dbio</span>

<span class="sd">    then there are also convineience functions that need to be ordered at least</span>
<span class="sd">    within this file</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">expanduser</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">abspath</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="k">import</span> <span class="n">controller_inject</span>

<span class="c1"># Inject utool functions</span>
<span class="p">(</span><span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;[other.detectfuncs]&#39;</span><span class="p">)</span>

<span class="n">SAMPLES</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">AP_SAMPLE_POINTS</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">SAMPLES</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SAMPLES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

<span class="c1"># Must import class before injection</span>
<span class="n">CLASS_INJECT_KEY</span><span class="p">,</span> <span class="n">register_ibs_method</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">controller_inject</span><span class="o">.</span><span class="n">make_ibs_register_decorator</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">t_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t_height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RESIZING WITH t_width = </span><span class="si">%r</span><span class="s1"> and t_height = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t_width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="k">elif</span> <span class="n">t_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">t_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_height</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">t_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_width</span><span class="p">)</span>
    <span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_width</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_height</span><span class="p">)</span>
    <span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">t_width</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">t_height</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">t_width</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;target size too small&#39;</span>
    <span class="k">assert</span> <span class="n">t_width</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="o">&lt;=</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;target size too large (capped at 1000%)&#39;</span>
    <span class="c1"># interpolation = cv2.INTER_LANCZOS4</span>
    <span class="n">interpolation</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>


<div class="viewcode-block" id="simple_code"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.simple_code">[docs]</a><span class="k">def</span> <span class="nf">simple_code</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;IGNORE&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;lion&#39;</span><span class="p">,</span>                <span class="s1">&#39;LN&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span>        <span class="s1">&#39;PZ&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;hippopotamus&#39;</span><span class="p">,</span>        <span class="s1">&#39;HIPPO&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;antelope&#39;</span><span class="p">,</span>            <span class="s1">&#39;ANTEL&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;elephant_savannah&#39;</span><span class="p">,</span>   <span class="s1">&#39;ELEPH&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span>              <span class="s1">&#39;PERSON&#39;</span><span class="p">)</span>
    <span class="c1"># label = label.replace(&#39;giraffe_reticulated&#39;, &#39;GIR&#39;)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;giraffe_reticulated&#39;</span><span class="p">,</span> <span class="s1">&#39;RG&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;zebra_grevys&#39;</span><span class="p">,</span>        <span class="s1">&#39;GZ&#39;</span><span class="p">)</span>
    <span class="c1"># label = label.replace(&#39;giraffe_masai&#39;,       &#39;GIRM&#39;)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;giraffe_masai&#39;</span><span class="p">,</span>       <span class="s1">&#39;MG&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;unspecified_animal&#39;</span><span class="p">,</span>  <span class="s1">&#39;UNSPEC&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">,</span>                 <span class="s1">&#39;CAR&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bird&#39;</span><span class="p">,</span>                <span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;whale_shark&#39;</span><span class="p">,</span>         <span class="s1">&#39;WS&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;whale_fluke&#39;</span><span class="p">,</span>         <span class="s1">&#39;WF&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;lionfish&#39;</span><span class="p">,</span>            <span class="s1">&#39;LF&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;turtle_sea&#39;</span><span class="p">,</span>          <span class="s1">&#39;ST&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;dog_wild&#39;</span><span class="p">,</span>            <span class="s1">&#39;WD&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;cow_domestic&#39;</span><span class="p">,</span>        <span class="s1">&#39;DOMW&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sheep_domestic&#39;</span><span class="p">,</span>      <span class="s1">&#39;DOMS&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;dog_domestic&#39;</span><span class="p">,</span>        <span class="s1">&#39;DOMD&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bicycle&#39;</span><span class="p">,</span>             <span class="s1">&#39;CYCLE&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;motorcycle&#39;</span><span class="p">,</span>          <span class="s1">&#39;MCYCLE&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bus&#39;</span><span class="p">,</span>                 <span class="s1">&#39;BUS&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;truck&#39;</span><span class="p">,</span>               <span class="s1">&#39;TRUCK&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;horse_domestic&#39;</span><span class="p">,</span>      <span class="s1">&#39;DOMH&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;boat&#39;</span><span class="p">,</span>                <span class="s1">&#39;BOAT&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span>               <span class="s1">&#39;TRAIN&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;cat_domestic&#39;</span><span class="p">,</span>        <span class="s1">&#39;DOCM&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;airplane&#39;</span><span class="p">,</span>            <span class="s1">&#39;PLANE&#39;</span><span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;frontleft&#39;</span><span class="p">,</span>           <span class="s1">&#39;FL&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;frontright&#39;</span><span class="p">,</span>          <span class="s1">&#39;FR&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;backleft&#39;</span><span class="p">,</span>            <span class="s1">&#39;BL&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;backright&#39;</span><span class="p">,</span>           <span class="s1">&#39;BR&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">,</span>               <span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;back&#39;</span><span class="p">,</span>                <span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>                <span class="s1">&#39;L&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>               <span class="s1">&#39;R&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span>                  <span class="s1">&#39;U&#39;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span>                <span class="s1">&#39;D&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span></div>


<span class="c1">##########################################################################################</span>


<div class="viewcode-block" id="general_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">general_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">conf</span> <span class="o">&lt;=</span> <span class="n">confidence</span><span class="p">:</span>
                    <span class="n">tp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fn</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">conf</span> <span class="o">&lt;=</span> <span class="n">confidence</span><span class="p">:</span>
                    <span class="n">fp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tn</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span>

    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">))</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">conf_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">conf_list</span><span class="p">:</span>
        <span class="n">conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>

    <span class="n">conf_list_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">tpr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">fpr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="c1"># conf_list_ = []</span>
    <span class="c1"># pr_list = []</span>
    <span class="c1"># re_list = []</span>
    <span class="c1"># tpr_list = []</span>
    <span class="c1"># fpr_list = []</span>
    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="n">conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">error_list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">re</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">tpr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">fpr</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span>
            <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
            <span class="n">pr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
            <span class="n">re_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
            <span class="n">tpr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
            <span class="n">fpr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Zero division error (</span><span class="si">%r</span><span class="s1">) - tp: </span><span class="si">%r</span><span class="s1"> tn: </span><span class="si">%r</span><span class="s1"> fp: </span><span class="si">%r</span><span class="s1"> fn: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span></div>


<div class="viewcode-block" id="general_interpolate_precision_recall"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_interpolate_precision_recall">[docs]</a><span class="k">def</span> <span class="nf">general_interpolate_precision_recall</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">):</span>
    <span class="n">conf_list_</span><span class="p">,</span> <span class="n">re_list_</span><span class="p">,</span> <span class="n">pr_list_</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">re_list</span><span class="p">,</span> <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">)</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">max_pr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">re</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">pr</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_pr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pr</span> <span class="o">&gt;</span> <span class="n">max_pr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">max_pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">re_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
                <span class="n">pr_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_pr</span><span class="p">)</span>
            <span class="n">max_pr</span> <span class="o">=</span> <span class="n">pr</span>
        <span class="k">if</span> <span class="n">pr</span> <span class="o">&lt;</span> <span class="n">max_pr</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">max_pr</span>
        <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">re_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
        <span class="n">pr_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">re_list_</span><span class="p">,</span> <span class="n">pr_list_</span></div>


<div class="viewcode-block" id="general_identify_operating_point"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_identify_operating_point">[docs]</a><span class="k">def</span> <span class="nf">general_identify_operating_point</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
    <span class="n">best_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_conf_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_x_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_y_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">)):</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">y_</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_</span> <span class="o">-</span> <span class="n">tx</span><span class="p">)</span>
        <span class="n">y_</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_</span> <span class="o">-</span> <span class="n">ty</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_</span> <span class="o">*</span> <span class="n">x_</span> <span class="o">+</span> <span class="n">y_</span> <span class="o">*</span> <span class="n">y_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">best_length</span><span class="p">:</span>
            <span class="n">best_length</span> <span class="o">=</span> <span class="n">length</span>
            <span class="n">best_conf_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">conf</span><span class="p">]</span>
            <span class="n">best_x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">best_y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="n">best_length</span><span class="p">:</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">best_conf</span> <span class="o">-</span> <span class="n">conf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span>
                <span class="k">for</span> <span class="n">best_conf</span> <span class="ow">in</span> <span class="n">best_conf_list</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">flag_list</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">best_conf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
            <span class="n">best_x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">best_y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">best_conf_list</span><span class="p">,</span> <span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span><span class="p">,</span> <span class="n">best_length</span></div>


<div class="viewcode-block" id="general_area_best_conf"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_area_best_conf">[docs]</a><span class="k">def</span> <span class="nf">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">plot_point</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">target</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">target_recall</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">conf_list</span><span class="p">)))</span>
    <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">]</span>
    <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
        <span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">general_interpolate_precision_recall</span><span class="p">(</span>
            <span class="n">conf_list</span><span class="p">,</span>
            <span class="n">x_list</span><span class="p">,</span>
            <span class="n">y_list</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
        <span class="n">ap_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">AP_POINT</span> <span class="ow">in</span> <span class="n">AP_SAMPLE_POINTS</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">re</span><span class="p">,</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">AP_POINT</span> <span class="o">&lt;=</span> <span class="n">re</span><span class="p">:</span>
                    <span class="n">ap_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ap_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ap_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y_list</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_list</span><span class="p">)</span>

    <span class="n">tup1</span> <span class="o">=</span> <span class="n">general_identify_operating_point</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
    <span class="n">best_conf_list</span><span class="p">,</span> <span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span><span class="p">,</span> <span class="n">best_length</span> <span class="o">=</span> <span class="n">tup1</span>

    <span class="n">tup2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">target_recall</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">conf_list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">target_recall</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
                <span class="n">tup2</span> <span class="o">=</span> <span class="p">[</span><span class="n">conf</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="kc">None</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_conf_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Multiple best operating points found </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf_list</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_conf_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="n">best_conf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
        <span class="c1"># label = &#39;%s [AP = %0.02f, OP = %0.02f]&#39; % (label, ap * 100.0, best_conf)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [AP = </span><span class="si">%0.02f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ap</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [AUC = </span><span class="si">%0.02f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ap</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">)</span>

    <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span> <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line_dotted&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_point</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ap</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="n">tup1</span><span class="p">,</span> <span class="n">tup2</span></div>


<div class="viewcode-block" id="general_confusion_matrix_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_confusion_matrix_algo">[docs]</a><span class="k">def</span> <span class="nf">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_correct_list</span><span class="p">,</span> <span class="n">label_predict_list</span><span class="p">,</span>
                                  <span class="n">category_list</span><span class="p">,</span> <span class="n">category_mapping</span><span class="p">,</span>
                                  <span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="p">,</span> <span class="n">fuzzy_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">conf_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># import matplotlib.colors as colors</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">suppressed_label</span> <span class="o">=</span> <span class="s1">&#39;SUP&#39;</span>
    <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">conf_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">category_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suppressed_label</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">category_mapping</span><span class="p">[</span><span class="n">suppressed_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">fuzzy_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">category_mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">category_mapping</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">]</span>
        <span class="n">zipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">index_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">)))</span>
        <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">]</span>

    <span class="c1"># Get the number of categories</span>
    <span class="n">num_categories</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span>

    <span class="c1"># Build the confusion matrix</span>
    <span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_categories</span><span class="p">,</span> <span class="n">num_categories</span><span class="p">))</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">label_correct_list</span><span class="p">,</span> <span class="n">label_predict_list</span><span class="p">)</span>
    <span class="n">suppressed</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">suppressed_correct</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">suppressed_fuzzy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">label_correct</span><span class="p">,</span> <span class="n">label_predict</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conf_</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">conf_</span> <span class="o">&lt;</span> <span class="n">conf</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label_correct</span> <span class="o">!=</span> <span class="n">label_predict</span><span class="p">:</span>
                    <span class="n">suppressed_correct</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">fuzzy_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_correct</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_predict</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">y</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
                        <span class="n">suppressed_fuzzy</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">label_predict</span> <span class="o">=</span> <span class="n">suppressed_label</span>
                <span class="n">suppressed</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Perform any mapping that needs to be done</span>
        <span class="n">correct_</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_correct</span><span class="p">]</span>
        <span class="n">predict_</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_predict</span><span class="p">]</span>
        <span class="c1"># Add to the confidence matrix</span>
        <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">correct_</span><span class="p">][</span><span class="n">predict_</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Normalize the confusion matrix using the rows</span>
    <span class="n">row_normalizer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">confusion_normalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">confusion_matrix</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">row_normalizer</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># Draw the confusion matrix</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">axes_</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_normalized</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="n">suppressed_correct</span>
    <span class="n">fuzzy</span> <span class="o">=</span> <span class="n">suppressed_fuzzy</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_categories</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_categories</span><span class="p">):</span>
            <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">correct</span> <span class="o">+=</span> <span class="n">number</span>
            <span class="k">if</span> <span class="n">fuzzy_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
                <span class="n">fuzzy</span> <span class="o">+=</span> <span class="n">number</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">number</span>
            <span class="n">axes_</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">fig_</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># NOQA</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_categories</span><span class="p">),</span> <span class="n">category_list</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_categories</span><span class="p">),</span> <span class="n">category_list</span><span class="p">)</span>
    <span class="n">margin_small</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">margin_large</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">margin_small</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="n">margin_large</span><span class="p">,</span>
        <span class="n">bottom</span><span class="o">=</span><span class="n">margin_small</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="n">margin_large</span>
    <span class="p">)</span>

    <span class="n">correct_rate</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">fuzzy_rate</span> <span class="o">=</span> <span class="n">fuzzy</span> <span class="o">/</span> <span class="n">total</span>
    <span class="k">return</span> <span class="n">correct_rate</span><span class="p">,</span> <span class="n">fuzzy_rate</span></div>


<div class="viewcode-block" id="general_intersection_over_union"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_intersection_over_union">[docs]</a><span class="k">def</span> <span class="nf">general_intersection_over_union</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">):</span>
    <span class="n">intersection_xtl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;xtl&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;xtl&#39;</span><span class="p">])</span>
    <span class="n">intersection_ytl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;ytl&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;ytl&#39;</span><span class="p">])</span>
    <span class="n">intersection_xbr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;xbr&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;xbr&#39;</span><span class="p">])</span>
    <span class="n">intersection_ybr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;ybr&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;ybr&#39;</span><span class="p">])</span>

    <span class="n">intersection_w</span> <span class="o">=</span> <span class="n">intersection_xbr</span> <span class="o">-</span> <span class="n">intersection_xtl</span>
    <span class="n">intersection_h</span> <span class="o">=</span> <span class="n">intersection_ybr</span> <span class="o">-</span> <span class="n">intersection_ytl</span>

    <span class="k">if</span> <span class="n">intersection_w</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">intersection_h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">intersection</span> <span class="o">=</span> <span class="n">intersection_w</span> <span class="o">*</span> <span class="n">intersection_h</span>
    <span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">intersection</span>

    <span class="k">return</span> <span class="n">intersection</span> <span class="o">/</span> <span class="n">union</span></div>


<div class="viewcode-block" id="general_overlap"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_overlap">[docs]</a><span class="k">def</span> <span class="nf">general_overlap</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred_list</span><span class="p">):</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">gt_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gt_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_list</span><span class="p">):</span>
            <span class="n">overlap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">general_intersection_over_union</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">overlap</span></div>


<div class="viewcode-block" id="general_tp_fp_fn"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_tp_fp_fn">[docs]</a><span class="k">def</span> <span class="nf">general_tp_fp_fn</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred_list</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">general_overlap</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred_list</span><span class="p">)</span>
        <span class="n">num_gt</span><span class="p">,</span> <span class="n">num_pred</span> <span class="o">=</span> <span class="n">overlap</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">num_gt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">num_pred</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">num_pred</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">num_gt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pred_index_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pred</span><span class="p">)</span>
            <span class="n">gt_index_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">max_overlap_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">pred</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_list</span>
            <span class="p">]</span>
            <span class="k">assert</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">confidence_list</span>
            <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">confidence_list</span><span class="p">,</span>
                <span class="n">max_overlap_list</span><span class="p">,</span>
                <span class="n">pred_index_list</span><span class="p">,</span>
                <span class="n">gt_index_list</span>
            <span class="p">)</span>
            <span class="n">pred_conf_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">confidence</span><span class="p">,</span>
                    <span class="n">max_overlap</span><span class="p">,</span>
                    <span class="n">pred_index</span><span class="p">,</span>
                    <span class="n">gt_index</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">confidence</span><span class="p">,</span> <span class="n">max_overlap</span><span class="p">,</span> <span class="n">pred_index</span><span class="p">,</span> <span class="n">gt_index</span> <span class="ow">in</span> <span class="n">zipped</span>
            <span class="p">]</span>
            <span class="n">pred_conf_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pred_conf_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">assignment_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">pred_conf</span><span class="p">,</span> <span class="n">max_overlap</span><span class="p">,</span> <span class="n">pred_index</span><span class="p">,</span> <span class="n">gt_index</span> <span class="ow">in</span> <span class="n">pred_conf_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">max_overlap</span> <span class="o">&gt;</span> <span class="n">min_overlap</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">gt_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">assignment_dict</span><span class="p">:</span>
                        <span class="n">assignment_dict</span><span class="p">[</span><span class="n">gt_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_index</span>

            <span class="n">tp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignment_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">num_pred</span> <span class="o">-</span> <span class="n">tp</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">num_gt</span> <span class="o">-</span> <span class="n">tp</span>
            <span class="k">assert</span> <span class="n">tp</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">fp</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">fn</span> <span class="o">&gt;=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span></div>


<div class="viewcode-block" id="general_get_imageset_gids"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_get_imageset_gids">[docs]</a><span class="k">def</span> <span class="nf">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">imageset_text</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">imageset_id</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="n">imageset_text</span><span class="p">)</span>
    <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">imageset_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">test_gid_list</span></div>


<div class="viewcode-block" id="general_parse_gt_annots"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_parse_gt_annots">[docs]</a><span class="k">def</span> <span class="nf">general_parse_gt_annots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">include_parts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">species_mapping</span><span class="o">=</span><span class="p">{},</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>

    <span class="n">species_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="n">gt_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">aid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_thetas</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>

        <span class="c1"># Transformation matrix</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">rotation_around_bbox_mat3x3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
        <span class="c1"># Get verticies of the annotation polygon</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">verts_from_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Rotate and transform vertices</span>
        <span class="n">xyz_pts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">add_homogenous_coordinate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">trans_pts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">remove_homogenous_coordinate</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz_pts</span><span class="p">))</span>
        <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trans_pts</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">x_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">new_verts</span><span class="p">]</span>
        <span class="n">y_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">new_verts</span><span class="p">]</span>
        <span class="n">xtl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_points</span><span class="p">))</span>
        <span class="n">xbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x_points</span><span class="p">))</span>
        <span class="n">ytl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_points</span><span class="p">))</span>
        <span class="n">ybr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_points</span><span class="p">))</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">xbr</span> <span class="o">-</span> <span class="n">xtl</span><span class="p">,</span> <span class="n">ybr</span> <span class="o">-</span> <span class="n">ytl</span><span class="p">)</span>

        <span class="n">species</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">viewpoint</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_viewpoints</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">interest</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_interest</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;gid&#39;</span>        <span class="p">:</span> <span class="n">gid</span><span class="p">,</span>
            <span class="s1">&#39;aid&#39;</span>        <span class="p">:</span> <span class="n">aid</span><span class="p">,</span>
            <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
            <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
            <span class="s1">&#39;xbr&#39;</span>        <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
            <span class="s1">&#39;ybr&#39;</span>        <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span>      <span class="p">:</span> <span class="n">species_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">),</span>
            <span class="s1">&#39;viewpoint&#39;</span>  <span class="p">:</span> <span class="n">viewpoint</span><span class="p">,</span>
            <span class="s1">&#39;interest&#39;</span>   <span class="p">:</span> <span class="n">interest</span><span class="p">,</span>
            <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">species_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">])</span>
        <span class="n">gt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

        <span class="n">part_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_part_rowids</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_parts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">part_rowid</span> <span class="ow">in</span> <span class="n">part_rowid_list</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_part_bboxes</span><span class="p">(</span><span class="n">part_rowid</span><span class="p">)</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_part_thetas</span><span class="p">(</span><span class="n">part_rowid</span><span class="p">)</span>

                <span class="c1"># Transformation matrix</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">rotation_around_bbox_mat3x3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
                <span class="c1"># Get verticies of the annotation polygon</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">verts_from_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># Rotate and transform vertices</span>
                <span class="n">xyz_pts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">add_homogenous_coordinate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="n">trans_pts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">remove_homogenous_coordinate</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz_pts</span><span class="p">))</span>
                <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trans_pts</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">x_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">new_verts</span><span class="p">]</span>
                <span class="n">y_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">new_verts</span><span class="p">]</span>
                <span class="n">xtl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_points</span><span class="p">))</span>
                <span class="n">xbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x_points</span><span class="p">))</span>
                <span class="n">ytl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_points</span><span class="p">))</span>
                <span class="n">ybr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_points</span><span class="p">))</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">xbr</span> <span class="o">-</span> <span class="n">xtl</span><span class="p">,</span> <span class="n">ybr</span> <span class="o">-</span> <span class="n">ytl</span><span class="p">)</span>

                <span class="n">tag</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_part_tag_text</span><span class="p">(</span><span class="n">part_rowid</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">species</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">+</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">)</span>

                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;gid&#39;</span>        <span class="p">:</span> <span class="n">gid</span><span class="p">,</span>
                    <span class="s1">&#39;aid&#39;</span>        <span class="p">:</span> <span class="n">aid</span><span class="p">,</span>
                    <span class="s1">&#39;part_id&#39;</span>    <span class="p">:</span> <span class="n">part_rowid</span><span class="p">,</span>
                    <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                    <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                    <span class="s1">&#39;xbr&#39;</span>        <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                    <span class="s1">&#39;ybr&#39;</span>        <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                    <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                    <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                    <span class="s1">&#39;class&#39;</span>      <span class="p">:</span> <span class="n">tag</span><span class="p">,</span>
                    <span class="s1">&#39;viewpoint&#39;</span>  <span class="p">:</span> <span class="n">viewpoint</span><span class="p">,</span>
                    <span class="s1">&#39;interest&#39;</span>   <span class="p">:</span> <span class="n">interest</span><span class="p">,</span>
                    <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">species_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">])</span>
                <span class="n">gt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gt_list</span><span class="p">,</span> <span class="n">species_set</span></div>


<div class="viewcode-block" id="general_parse_gt"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_parse_gt">[docs]</a><span class="k">def</span> <span class="nf">general_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">)</span>

    <span class="n">species_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">):</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">gt_list</span><span class="p">,</span> <span class="n">species_set</span> <span class="o">=</span> <span class="n">general_parse_gt_annots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">species_set</span> <span class="o">=</span> <span class="n">species_set</span> <span class="o">|</span> <span class="n">species_set</span>
        <span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt_list</span>

    <span class="c1"># print(&#39;General Parse GT species_set = %r&#39; % (species_set, ))</span>
    <span class="k">return</span> <span class="n">gt_dict</span></div>


<span class="c1">##########################################################################################</span>


<div class="viewcode-block" id="localizer_parse_pred"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_parse_pred">[docs]</a><span class="k">def</span> <span class="nf">localizer_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">species_mapping</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>

    <span class="k">if</span> <span class="s1">&#39;feature2_algo&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;feature2_algo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;resnet&#39;</span>

    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>

    <span class="n">size_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>
    <span class="c1"># Unsure, but we need to call this multiple times?  Lazy loading bug?</span>
    <span class="n">bboxes_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;bboxes&#39;</span><span class="p">,</span>  <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Get actual data</span>
    <span class="n">bboxes_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;bboxes&#39;</span><span class="p">,</span>  <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">thetas_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;thetas&#39;</span><span class="p">,</span>  <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confss_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;confs&#39;</span><span class="p">,</span>   <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">classs_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;classes&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">length_list</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">bbox_list</span> <span class="ow">in</span> <span class="n">bboxes_list</span> <span class="p">]</span>

    <span class="c1"># Establish primitives</span>
    <span class="n">test_gids_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">test_gid</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">test_gid</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="n">length_list</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">sizes_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">size_list</span><span class="p">,</span> <span class="n">length_list</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">keeps_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">length_list</span> <span class="p">]</span>
    <span class="n">features_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">length_list</span> <span class="p">]</span>
    <span class="n">features_lazy_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">length_list</span> <span class="p">]</span>
    <span class="n">viewpoints_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">length_list</span> <span class="p">]</span>
    <span class="n">interests_list</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">length_list</span> <span class="p">]</span>

    <span class="c1"># Get features</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">features_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations_features&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span>
                                          <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;features_lazy&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>

        <span class="k">def</span> <span class="nf">features_lazy_func</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
            <span class="n">vector_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations_features&#39;</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span>
                                            <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="n">vector_list</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">vector</span>

        <span class="n">features_lazy_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">features_lazy_func</span><span class="p">,</span> <span class="n">test_gid</span><span class="p">,</span> <span class="n">test_offset</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">test_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">test_gid</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="n">length_list</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="c1"># Get species and viewpoints labels</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">classs_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations_labeler&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span>
                                        <span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">viewpoints_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations_labeler&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span>
                                            <span class="s1">&#39;viewpoint&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Get updated confidences for boxes</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;classify&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using alternate classifications&#39;</span><span class="p">)</span>
        <span class="c1"># depc.delete_property(&#39;localizations_classifier&#39;, test_gid_list, config=kwargs)</span>
        <span class="n">confss_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations_classifier&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span>
                                        <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Get updated confidences for boxes</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interest&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using alternate AoI interest flags&#39;</span><span class="p">)</span>
        <span class="n">interests_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations_classifier&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span>
                                           <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Reformat results for json</span>
    <span class="n">zipped_list_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">keeps_list</span><span class="p">,</span>
        <span class="n">test_gids_list</span><span class="p">,</span>
        <span class="n">sizes_list</span><span class="p">,</span>
        <span class="n">bboxes_list</span><span class="p">,</span>
        <span class="n">thetas_list</span><span class="p">,</span>
        <span class="n">confss_list</span><span class="p">,</span>
        <span class="n">classs_list</span><span class="p">,</span>
        <span class="n">viewpoints_list</span><span class="p">,</span>
        <span class="n">interests_list</span><span class="p">,</span>
        <span class="n">features_list</span><span class="p">,</span>
        <span class="n">features_lazy_list</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;gid&#39;</span>          <span class="p">:</span> <span class="n">test_gid</span><span class="p">,</span>
                <span class="s1">&#39;xtl&#39;</span>          <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ytl&#39;</span>          <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;xbr&#39;</span>          <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ybr&#39;</span>          <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span>       <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;theta&#39;</span>        <span class="p">:</span> <span class="n">theta</span><span class="p">,</span>
                <span class="s1">&#39;confidence&#39;</span>   <span class="p">:</span> <span class="n">conf</span><span class="p">,</span>
                <span class="s1">&#39;class&#39;</span>        <span class="p">:</span> <span class="n">species_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="n">class_</span><span class="p">),</span>
                <span class="s1">&#39;viewpoint&#39;</span>    <span class="p">:</span> <span class="n">viewpoint</span><span class="p">,</span>
                <span class="s1">&#39;interest&#39;</span>     <span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">interest</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">interest</span> <span class="o">&gt;=</span> <span class="mf">0.84</span><span class="p">,</span>
                <span class="s1">&#39;feature&#39;</span>      <span class="p">:</span> <span class="n">feature</span><span class="p">,</span>
                <span class="s1">&#39;feature_lazy&#39;</span> <span class="p">:</span> <span class="n">feature_lazy</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">keep_</span><span class="p">,</span> <span class="n">test_gid</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">class_</span><span class="p">,</span> <span class="n">viewpoint</span><span class="p">,</span> <span class="n">interest</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">feature_lazy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">zipped_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">keep_</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">zipped_list</span> <span class="ow">in</span> <span class="n">zipped_list_list</span>
    <span class="p">]</span>

    <span class="n">pred_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">uuid_</span> <span class="p">:</span> <span class="n">result_list</span>
        <span class="k">for</span> <span class="n">uuid_</span><span class="p">,</span> <span class="n">result_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">results_list</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">pred_dict</span></div>


<div class="viewcode-block" id="localizer_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">SAMPLES</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">test_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="n">general_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Predictions&#39;</span><span class="p">)</span>
    <span class="n">pred_dict</span> <span class="o">=</span> <span class="n">localizer_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">species_set</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;species_set&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">species_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># filter out any prefix ! to denote interest only</span>
        <span class="n">species_set_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span> <span class="n">species</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_set</span> <span class="p">])</span>

        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">gt_dict</span><span class="p">,</span> <span class="s1">&#39;Ground-Truth&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pred_dict</span><span class="p">,</span> <span class="s1">&#39;Predictions&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">dict_tag</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">image_uuid</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>
                <span class="n">dict_</span><span class="p">[</span><span class="n">image_uuid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">val</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">[</span><span class="n">image_uuid</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">species_set_</span>
                <span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">localizer_tp_fp</span><span class="p">(</span><span class="n">test_uuid_list</span><span class="p">,</span> <span class="n">gt_dict</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">tp_list</span><span class="p">,</span> <span class="n">fp_list</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="n">values</span>

    <span class="n">conf_list_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">tp_list</span><span class="p">,</span> <span class="n">fp_list</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">re</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="n">total</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">pr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span></div>


<div class="viewcode-block" id="localizer_assign"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_assign">[docs]</a><span class="k">def</span> <span class="nf">localizer_assign</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">):</span>
    <span class="n">best_overlap</span> <span class="o">=</span> <span class="n">min_overlap</span>
    <span class="n">best_index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">gt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gt_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gt</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pred</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]:</span>
            <span class="k">continue</span>

        <span class="n">overlap</span> <span class="o">=</span> <span class="n">general_intersection_over_union</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="o">&lt;</span> <span class="n">best_overlap</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">best_overlap</span> <span class="o">=</span> <span class="n">overlap</span>
        <span class="n">best_index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">if</span> <span class="n">best_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">best_overlap</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">best_index</span><span class="p">,</span> <span class="n">best_overlap</span></div>


<div class="viewcode-block" id="localizer_assignments"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_assignments">[docs]</a><span class="k">def</span> <span class="nf">localizer_assignments</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">gt_list</span><span class="p">,</span> <span class="n">gt_list_</span><span class="o">=</span><span class="p">[],</span> <span class="n">min_overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">pred_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pred</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">match_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_list</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">match_index</span><span class="p">,</span>  <span class="n">best_overlap</span>  <span class="o">=</span> <span class="n">localizer_assign</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span>  <span class="n">pred</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">)</span>
        <span class="n">match_index_</span><span class="p">,</span> <span class="n">best_overlap_</span> <span class="o">=</span> <span class="n">localizer_assign</span><span class="p">(</span><span class="n">gt_list_</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">match_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">del</span> <span class="n">gt_list</span><span class="p">[</span><span class="n">match_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">match_index_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">match_list</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="n">match_index</span><span class="p">,</span> <span class="n">best_overlap</span><span class="p">)</span>
            <span class="p">]</span>

    <span class="k">return</span> <span class="n">match_list</span></div>


<div class="viewcode-block" id="localizer_tp_fp"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_tp_fp">[docs]</a><span class="k">def</span> <span class="nf">localizer_tp_fp</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">gt_dict</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">interest_species_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="n">species_set</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;species_set&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">species_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">species</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">):</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span>
                <span class="n">interest_species_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>

    <span class="n">match_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">image_uuid</span> <span class="ow">in</span> <span class="n">uuid_list</span><span class="p">:</span>
        <span class="n">gt_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gt_list_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pred_list</span> <span class="o">=</span> <span class="n">pred_dict</span><span class="p">[</span><span class="n">image_uuid</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">gt</span> <span class="ow">in</span> <span class="n">gt_dict</span><span class="p">[</span><span class="n">image_uuid</span><span class="p">]:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>
            <span class="n">interest</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="s1">&#39;interest&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">interest_species_set</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">interest</span><span class="p">:</span>
                <span class="n">gt_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt_list</span><span class="p">)</span>

        <span class="c1"># Match predictions</span>
        <span class="n">match_list_</span> <span class="o">=</span> <span class="n">localizer_assignments</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">gt_list</span><span class="p">,</span> <span class="n">gt_list_</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">match_</span> <span class="ow">in</span> <span class="n">match_list_</span><span class="p">:</span>
            <span class="n">match_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match_</span><span class="p">)</span>

    <span class="c1"># sort matches by confidence from high to low</span>
    <span class="n">match_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">match_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tp_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fp_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">tp_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fp_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">match_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="n">tp_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">conf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">tp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tp_counter</span><span class="p">)</span>
        <span class="n">fp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fp_counter</span><span class="p">)</span>

    <span class="c1"># print(&#39;\t tps  [:10]     : %r&#39; % (tp_list[:10], ))</span>
    <span class="c1"># print(&#39;\t fps  [:10]     : %r&#39; % (fp_list[:10], ))</span>
    <span class="c1"># print(&#39;\t con  [:10]     : %r&#39; % (conf_list[:10], ))</span>
    <span class="c1"># print(&#39;\t tps [-10:]     : %r&#39; % (tp_list[-10:], ))</span>
    <span class="c1"># print(&#39;\t fps [-10:]     : %r&#39; % (fp_list[-10:], ))</span>
    <span class="c1"># print(&#39;\t con [-10:]     : %r&#39; % (conf_list[-10:], ))</span>
    <span class="c1"># print(&#39;\t num_annotations: %r&#39; % (total, ))</span>

    <span class="k">return</span> <span class="n">conf_list</span><span class="p">,</span> <span class="n">tp_list</span><span class="p">,</span> <span class="n">fp_list</span><span class="p">,</span> <span class="n">total</span></div>


<div class="viewcode-block" id="localizer_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span> <span class="o">=</span> <span class="n">localizer_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="localizer_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">localizer_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">test_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="n">general_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Predictions&#39;</span><span class="p">)</span>
    <span class="n">pred_dict</span> <span class="o">=</span> <span class="n">localizer_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">species_set</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;species_set&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">species_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># filter out any prefix ! to denote interest only</span>
        <span class="n">species_set_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span> <span class="n">species</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_set</span> <span class="p">])</span>

        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">gt_dict</span><span class="p">,</span> <span class="s1">&#39;Ground-Truth&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pred_dict</span><span class="p">,</span> <span class="s1">&#39;Predictions&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">dict_tag</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">image_uuid</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>
                <span class="n">dict_</span><span class="p">[</span><span class="n">image_uuid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">val</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">[</span><span class="n">image_uuid</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">species_set_</span>
                <span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">localizer_tp_fp</span><span class="p">(</span><span class="n">test_uuid_list</span><span class="p">,</span> <span class="n">gt_dict</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">tp_list</span><span class="p">,</span> <span class="n">fp_list</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="n">values</span>

    <span class="n">best_conf</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_accuracy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_args</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">tp_list</span><span class="p">,</span> <span class="n">fp_list</span><span class="p">)):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">tp</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target_conf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">best_accuracy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
                <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf</span>
                <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
                <span class="n">best_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_conf</span> <span class="o">&lt;=</span> <span class="n">conf</span><span class="p">:</span>
                <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf</span>
                <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
                <span class="n">best_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">best_conf</span><span class="p">,</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="n">best_args</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1"> (Conf = </span><span class="si">%0.02f</span><span class="s1">, Accuracy = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">best_args</span>

    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tp</span><span class="p">)):</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
        <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fp</span><span class="p">)):</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">)</span>
        <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fn</span><span class="p">)):</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
        <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">)</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">]</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                           <span class="n">category_mapping</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_conf</span><span class="p">,</span> <span class="n">values</span></div>


<div class="viewcode-block" id="localizer_precision_recall"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall">[docs]</a><span class="nd">@register_ibs_method</span>
<span class="k">def</span> <span class="nf">localizer_precision_recall</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using </span><span class="si">%d</span><span class="s1"> test gids&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">),</span> <span class="p">))</span>

    <span class="n">species_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;giraffe_masai&#39;</span>       <span class="p">:</span> <span class="s1">&#39;giraffe&#39;</span><span class="p">,</span>
        <span class="s1">&#39;giraffe_reticulated&#39;</span> <span class="p">:</span> <span class="s1">&#39;giraffe&#39;</span><span class="p">,</span>
        <span class="s1">&#39;zebra_grevys&#39;</span>        <span class="p">:</span> <span class="s1">&#39;zebra&#39;</span><span class="p">,</span>
        <span class="s1">&#39;zebra_plains&#39;</span>        <span class="p">:</span> <span class="s1">&#39;zebra&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">config_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># &#39;seaturtle&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Sea Turtle&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;turtle_green&#39;, &#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Sea Turtle Heads&#39;,  &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;turtle_green+head&#39;, &#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Green&#39;,             &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;turtle_green&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Green Heads&#39;,       &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;turtle_green+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Heads&#39;,   &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {&#39;BEST_INDEX&#39;: 0},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;!seaturtle&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;! Sea Turtle&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;!turtle_green&#39;, &#39;!turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;! Sea Turtle Heads&#39;,  &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;!turtle_green+head&#39;, &#39;!turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;! Green&#39;,             &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;!turtle_green&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;! Green Heads&#39;,       &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;!turtle_green+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;! Hawksbill&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;!turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;! Hawksbill Heads&#39;,   &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.2, &#39;species_set&#39; : set([&#39;!turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {&#39;BEST_INDEX&#39;: 0},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;hawksbills&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;species_set&#39; : set([&#39;turtle_hawksbill&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;hawsbills+heads&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hawksbill Head NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;seaturtle&#39;, &#39;weight_filepath&#39; : &#39;seaturtle&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;species_set&#39; : set([&#39;turtle_hawksbill+head&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;hammerhead&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 0%&#39;,            &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 10%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 20%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 30%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 40%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 50%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 60%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 70%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 80%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 90%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 100%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;!hammerhead&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead NMS 40%&#39;,           &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;species_set&#39; : set([&#39;shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Hammerhead ! NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;hammerhead&#39;, &#39;weight_filepath&#39; : &#39;hammerhead&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;species_set&#39; : set([&#39;!shark_hammerhead&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {&#39;offset_color&#39;: 1},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-giraffe-lightnet&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-zebra-lightnet&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-!giraffe-lightnet&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-!zebra-lightnet&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;lightnet&#39;, &#39;config_filepath&#39; : &#39;ggr2&#39;, &#39;weight_filepath&#39; : &#39;ggr2&#39;, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-giraffe-azure&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;giraffe&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-zebra-azure&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;zebra&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-!giraffe-azure&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Giraffe ! NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!giraffe&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="c1"># &#39;ggr2-!zebra-azure&#39;: (</span>
        <span class="c1">#     [</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 0%&#39;,          &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 10%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.10, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 20%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.20, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 30%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.30, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 40%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.40, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 50%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.50, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 60%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.60, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 70%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.70, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 80%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.80, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 90%&#39;,         &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 0.90, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#         {&#39;label&#39;: &#39;Zebra ! NMS 100%&#39;,        &#39;grid&#39; : False, &#39;algo&#39;: &#39;azure&#39;, &#39;config_filepath&#39; : None, &#39;weight_filepath&#39; : None, &#39;nms&#39;: True, &#39;nms_thresh&#39;: 1.00, &#39;test_gid_list&#39;: test_gid_list, &#39;species_mapping&#39;: species_mapping, &#39;species_set&#39;: set([&#39;!zebra&#39;])},</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     {},</span>
        <span class="c1"># ),</span>

        <span class="s1">&#39;lynx&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 0%&#39;</span><span class="p">,</span>            <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 10%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 20%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 30%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 40%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 50%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 60%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 70%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.70</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 80%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 90%&#39;</span><span class="p">,</span>           <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Lynx NMS 100%&#39;</span><span class="p">,</span>          <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;algo&#39;</span><span class="p">:</span> <span class="s1">&#39;lightnet&#39;</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;nms&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;nms_thresh&#39;</span><span class="p">:</span> <span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;species_set&#39;</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;lynx&#39;</span><span class="p">])},</span>
            <span class="p">],</span>
            <span class="p">{},</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">config_key</span> <span class="ow">in</span> <span class="n">config_dict</span><span class="p">:</span>
        <span class="n">config_list</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="n">config_dict</span><span class="p">[</span><span class="n">config_key</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="n">ibs</span><span class="o">.</span><span class="n">localizer_precision_recall_algo_display</span><span class="p">(</span><span class="n">config_list</span><span class="p">,</span> <span class="n">config_tag</span><span class="o">=</span><span class="n">config_key</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span></div>


<div class="viewcode-block" id="localizer_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_display">[docs]</a><span class="nd">@register_ibs_method</span>
<span class="k">def</span> <span class="nf">localizer_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_list</span><span class="p">,</span> <span class="n">config_tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
                                            <span class="n">target_recall</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">BEST_INDEX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset_color</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                            <span class="n">write_images</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_point</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall (Ground-Truth IOU &gt;= </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>

    <span class="n">color_list_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset_color</span><span class="p">):</span>
        <span class="n">color_list_</span> <span class="o">+=</span> <span class="p">[(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)]</span>

    <span class="n">color_list</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">config_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list_</span><span class="p">),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">color_list_</span> <span class="o">+</span> <span class="n">color_list</span>

    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span>
                                             <span class="n">plot_point</span><span class="o">=</span><span class="n">plot_point</span><span class="p">,</span>
                                             <span class="n">target_recall</span><span class="o">=</span><span class="n">target_recall</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">tup2_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>

    <span class="n">best_index</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">BEST_INDEX</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">BEST_INDEX</span>  <span class="c1"># Match formatting of below, this is a silly conditional</span>

    <span class="n">best_y</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_index_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">valid_best_index</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">tup2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tup2_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tup2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">tup2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">best_y</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="n">valid_best_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">best_index_</span> <span class="o">=</span> <span class="n">index</span>
            <span class="n">best_y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># If user defined best_index is invalid, don&#39;t use it</span>
    <span class="k">if</span> <span class="n">best_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">best_index</span> <span class="o">=</span> <span class="n">best_index_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">best_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_best_index</span><span class="p">:</span>
            <span class="n">best_index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">best_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">best_conf_list</span><span class="p">,</span> <span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span><span class="p">,</span> <span class="n">best_length</span> <span class="o">=</span> <span class="n">tup2_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;xkcd:gold&#39;</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curves&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1">######################################################################################</span>
    <span class="k">if</span> <span class="n">best_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">target_conf</span> <span class="o">=</span> <span class="n">best_conf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">best_config</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
        <span class="n">best_label</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="n">best_area</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">localizer_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span>
                                                      <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span>
                                                      <span class="n">target_conf</span><span class="o">=</span><span class="n">target_conf</span><span class="p">,</span>
                                                      <span class="o">**</span><span class="n">best_config</span><span class="p">)</span>
        <span class="n">best_conf</span><span class="p">,</span> <span class="p">(</span><span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">values</span>

        <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_recall</span><span class="p">,</span> <span class="n">best_label</span><span class="p">,</span> <span class="n">best_area</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix for Recall &gt;= </span><span class="si">%0.02f</span><span class="se">\n</span><span class="s1">(Algo: </span><span class="si">%s</span><span class="s1">, mAP = </span><span class="si">%0.02f</span><span class="s1">, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.26</span><span class="p">)</span>

    <span class="c1">######################################################################################</span>
    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">best_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">BEST_INDEX</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">BEST_INDEX</span>

    <span class="n">best_config</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
    <span class="n">best_label</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">best_area</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">localizer_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span>
                                                  <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span>
                                                  <span class="o">**</span><span class="n">best_config</span><span class="p">)</span>
    <span class="n">best_conf</span><span class="p">,</span> <span class="p">(</span><span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">values</span>

    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">best_label</span><span class="p">,</span> <span class="n">best_area</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix</span><span class="se">\n</span><span class="s1">(Algo: </span><span class="si">%s</span><span class="s1">, mAP = </span><span class="si">%0.02f</span><span class="s1">, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.26</span><span class="p">)</span>

    <span class="c1">######################################################################################</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_tag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">config_tag</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_tag</span><span class="p">,</span> <span class="p">)</span>

    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">localizer-precision-recall-</span><span class="si">%0.2f</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_tag</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="localizer_precision_recall_algo_display_animate"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_display_animate">[docs]</a><span class="nd">@register_ibs_method</span>
<span class="k">def</span> <span class="nf">localizer_precision_recall_algo_display_animate</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">min_overlap</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">localizer_precision_recall_algo_display</span><span class="p">(</span><span class="n">config_list</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># def localizer_classification_tp_tn_fp_fn(gt_list, pred_list, conf, min_overlap,</span>
<span class="c1">#                                          check_species=False,</span>
<span class="c1">#                                          check_viewpoint=False, **kwargs):</span>
<span class="c1">#     overlap = general_overlap(gt_list, pred_list)</span>
<span class="c1">#     num_gt, num_pred = overlap.shape</span>

<span class="c1">#     # Get confidences</span>
<span class="c1">#     conf_list = [pred[&#39;confidence&#39;] for pred in pred_list]</span>
<span class="c1">#     pred_flag_list = [conf &lt;= conf_ for conf_ in conf_list]</span>

<span class="c1">#     if num_gt == 0:</span>
<span class="c1">#         tp_list = [False] * len(pred_list)</span>
<span class="c1">#         tn_list = [not pred_flag for pred_flag in pred_flag_list]</span>
<span class="c1">#         fp_list = [    pred_flag for pred_flag in pred_flag_list]</span>
<span class="c1">#         fn_list = [False] * len(pred_list)</span>
<span class="c1">#     elif num_pred == 0:</span>
<span class="c1">#         tp_list = []</span>
<span class="c1">#         tn_list = []</span>
<span class="c1">#         fp_list = []</span>
<span class="c1">#         fn_list = []</span>
<span class="c1">#     else:</span>
<span class="c1">#         max_overlap = np.max(overlap, axis=0)</span>
<span class="c1">#         gt_flag_list = min_overlap &lt; max_overlap</span>

<span class="c1">#         status_list = []</span>
<span class="c1">#         for gt_flag, pred_flag in zip(gt_flag_list, pred_flag_list):</span>
<span class="c1">#             if gt_flag and pred_flag:</span>
<span class="c1">#                 status_list.append(&#39;tp&#39;)</span>
<span class="c1">#             elif gt_flag and not pred_flag:</span>
<span class="c1">#                 status_list.append(&#39;fn&#39;)</span>
<span class="c1">#             elif not gt_flag and pred_flag:</span>
<span class="c1">#                 status_list.append(&#39;fp&#39;)</span>
<span class="c1">#             elif not gt_flag and not pred_flag:</span>
<span class="c1">#                 status_list.append(&#39;tn&#39;)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 raise ValueError</span>

<span class="c1">#         tp_list = [status == &#39;tp&#39; for status in status_list]</span>
<span class="c1">#         tn_list = [status == &#39;tn&#39; for status in status_list]</span>
<span class="c1">#         fp_list = [status == &#39;fp&#39; for status in status_list]</span>
<span class="c1">#         fn_list = [status == &#39;fn&#39; for status in status_list]</span>

<span class="c1">#     return tp_list, tn_list, fp_list, fn_list</span>


<span class="c1"># def localizer_classification_confusion_matrix_algo_plot(ibs, color, conf,</span>
<span class="c1">#                                                         label=None,</span>
<span class="c1">#                                                         min_overlap=0.25,</span>
<span class="c1">#                                                         write_images=False,</span>
<span class="c1">#                                                         **kwargs):</span>
<span class="c1">#     print(&#39;Processing Confusion Matrix for: %r (Conf = %0.02f)&#39; % (label, conf, ))</span>

<span class="c1">#     test_gid_list = general_get_imageset_gids(ibs, &#39;TEST_SET&#39;, **kwargs)</span>
<span class="c1">#     test_uuid_list = ibs.get_image_uuids(test_gid_list)</span>

<span class="c1">#     print(&#39;\tGather Ground-Truth&#39;)</span>
<span class="c1">#     gt_dict = general_parse_gt(ibs, test_gid_list=test_gid_list, **kwargs)</span>

<span class="c1">#     print(&#39;\tGather Predictions&#39;)</span>
<span class="c1">#     pred_dict = localizer_parse_pred(ibs, test_gid_list=test_gid_list, **kwargs)</span>

<span class="c1">#     if write_images:</span>
<span class="c1">#         output_folder = &#39;localizer-classification-confusion-matrix-%0.2f-%0.2f-images&#39; % (min_overlap, conf, )</span>
<span class="c1">#         output_path = abspath(expanduser(join(&#39;~&#39;, &#39;Desktop&#39;, output_folder)))</span>
<span class="c1">#         ut.ensuredir(output_path)</span>

<span class="c1">#     label_list = []</span>
<span class="c1">#     prediction_list = []</span>
<span class="c1">#     for index, (test_gid, test_uuid) in enumerate(zip(test_gid_list, test_uuid_list)):</span>
<span class="c1">#         if test_uuid in pred_dict:</span>
<span class="c1">#             gt_list = gt_dict[test_uuid]</span>
<span class="c1">#             pred_list = pred_dict[test_uuid]</span>
<span class="c1">#             values = localizer_classification_tp_tn_fp_fn(gt_list, pred_list, conf,</span>
<span class="c1">#                                                           min_overlap=min_overlap,</span>
<span class="c1">#                                                           **kwargs)</span>
<span class="c1">#             tp_list, tn_list, fp_list, fn_list = values</span>
<span class="c1">#             tp = tp_list.count(True)</span>
<span class="c1">#             tn = tn_list.count(True)</span>
<span class="c1">#             fp = fp_list.count(True)</span>
<span class="c1">#             fn = fn_list.count(True)</span>

<span class="c1">#             for _ in range(int(tp)):</span>
<span class="c1">#                 label_list.append(&#39;positive&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;positive&#39;)</span>
<span class="c1">#             for _ in range(int(tn)):</span>
<span class="c1">#                 label_list.append(&#39;negative&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;negative&#39;)</span>
<span class="c1">#             for _ in range(int(fp)):</span>
<span class="c1">#                 label_list.append(&#39;negative&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;positive&#39;)</span>
<span class="c1">#             for _ in range(int(fn)):</span>
<span class="c1">#                 label_list.append(&#39;positive&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;negative&#39;)</span>

<span class="c1">#             if write_images:</span>
<span class="c1">#                 test_image = ibs.get_images(test_gid)</span>
<span class="c1">#                 test_image = _resize(test_image, t_width=600, verbose=False)</span>
<span class="c1">#                 height_, width_, channels_ = test_image.shape</span>

<span class="c1">#                 for gt in gt_list:</span>
<span class="c1">#                     xtl = int(gt[&#39;xtl&#39;] * width_)</span>
<span class="c1">#                     ytl = int(gt[&#39;ytl&#39;] * height_)</span>
<span class="c1">#                     xbr = int(gt[&#39;xbr&#39;] * width_)</span>
<span class="c1">#                     ybr = int(gt[&#39;ybr&#39;] * height_)</span>
<span class="c1">#                     cv2.rectangle(test_image, (xtl, ytl), (xbr, ybr), (0, 0, 255))</span>

<span class="c1">#                 zipped = zip(pred_list, tp_list, tn_list, fp_list, fn_list)</span>
<span class="c1">#                 for pred, tp_, tn_, fp_, fn_ in zipped:</span>
<span class="c1">#                     if tp_:</span>
<span class="c1">#                         color = (0, 255, 0)</span>
<span class="c1">#                     elif fp_:</span>
<span class="c1">#                         continue</span>
<span class="c1">#                         # color = (255, 0, 0)</span>
<span class="c1">#                     elif fn_:</span>
<span class="c1">#                         color = (255, 0, 0)</span>
<span class="c1">#                     elif tn_:</span>
<span class="c1">#                         continue</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         continue</span>

<span class="c1">#                     xtl = int(pred[&#39;xtl&#39;] * width_)</span>
<span class="c1">#                     ytl = int(pred[&#39;ytl&#39;] * height_)</span>
<span class="c1">#                     xbr = int(pred[&#39;xbr&#39;] * width_)</span>
<span class="c1">#                     ybr = int(pred[&#39;ybr&#39;] * height_)</span>
<span class="c1">#                     cv2.rectangle(test_image, (xtl, ytl), (xbr, ybr), color)</span>

<span class="c1">#                 status_str = &#39;success&#39; if (fp + fn) == 0 else &#39;failure&#39;</span>
<span class="c1">#                 status_val = tp - fp - fn</span>
<span class="c1">#                 args = (status_str, status_val, test_gid, tp, fp, fn, )</span>
<span class="c1">#                 output_filename = &#39;test_%s_%d_gid_%d_tp_%d_fp_%d_fn_%d.png&#39; % args</span>
<span class="c1">#                 output_filepath = join(output_path, output_filename)</span>
<span class="c1">#                 cv2.imwrite(output_filepath, test_image)</span>

<span class="c1">#     category_list = [&#39;positive&#39;, &#39;negative&#39;]</span>
<span class="c1">#     category_mapping = {</span>
<span class="c1">#         &#39;positive&#39;: 0,</span>
<span class="c1">#         &#39;negative&#39;: 1,</span>
<span class="c1">#     }</span>
<span class="c1">#     return general_confusion_matrix_algo(label_list, prediction_list, category_list,</span>
<span class="c1">#                                          category_mapping, size=20, **kwargs)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def localizer_classifications_confusion_matrix_algo_display(ibs, conf,</span>
<span class="c1">#                                                             min_overlap=0.25,</span>
<span class="c1">#                                                             figsize=(24, 7),</span>
<span class="c1">#                                                             write_images=False,</span>
<span class="c1">#                                                             target_recall=0.9,</span>
<span class="c1">#                                                             plot_point=True,</span>
<span class="c1">#                                                             masking=False,</span>
<span class="c1">#                                                             **kwargs):</span>
<span class="c1">#     import matplotlib.pyplot as plt</span>

<span class="c1">#     fig_ = plt.figure(figsize=figsize)</span>

<span class="c1">#     config = {</span>
<span class="c1">#         &#39;label&#39;        : &#39;WIC&#39;,</span>
<span class="c1">#         &#39;algo&#39;         : &#39;_COMBINED&#39;,</span>
<span class="c1">#         &#39;species_set&#39;  : set([&#39;zebra&#39;]),</span>
<span class="c1">#         &#39;classify&#39;     : True,</span>
<span class="c1">#         &#39;classifier_algo&#39;: &#39;svm&#39;,</span>
<span class="c1">#         &#39;classifier_masking&#39;: masking,</span>
<span class="c1">#         &#39;classifier_weight_filepath&#39;: &#39;/home/jason/code/ibeis/models-bootstrap/classifier.svm.image.zebra.pkl&#39;,</span>
<span class="c1">#     }</span>

<span class="c1">#     axes_ = plt.subplot(111)</span>
<span class="c1">#     axes_.set_aspect(1)</span>
<span class="c1">#     gca_ = plt.gca()</span>
<span class="c1">#     gca_.grid(False)</span>

<span class="c1">#     correct_rate, _ = localizer_classification_confusion_matrix_algo_plot(ibs, None, conf,</span>
<span class="c1">#                                                                           min_overlap=min_overlap,</span>
<span class="c1">#                                                                           write_images=write_images,</span>
<span class="c1">#                                                                           fig_=fig_, axes_=axes_,</span>
<span class="c1">#                                                                           **config)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Predicted (Correct = %0.02f%%)&#39; % (correct_rate * 100.0, ))</span>
<span class="c1">#     axes_.set_ylabel(&#39;Ground-Truth&#39;)</span>
<span class="c1">#     args = (min_overlap, conf, )</span>
<span class="c1">#     plt.title(&#39;Confusion Matrix (IoU %0.02f, Conf %0.02f)&#39; % args, y=1.13)</span>

<span class="c1">#     # plt.show()</span>
<span class="c1">#     args = (min_overlap, conf, )</span>
<span class="c1">#     fig_filename = &#39;localizer-classification-confusion-matrix-%0.2f-%0.2f.png&#39; % args</span>
<span class="c1">#     fig_path = abspath(expanduser(join(&#39;~&#39;, &#39;Desktop&#39;, fig_filename)))</span>
<span class="c1">#     plt.savefig(fig_path, bbox_inches=&#39;tight&#39;)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def localizer_classifications_confusion_matrix_algo_display_animate(ibs, total=10, **kwargs):</span>
<span class="c1">#     for index in range(0, total + 1):</span>
<span class="c1">#         conf = index / total</span>
<span class="c1">#         ibs.localizer_classifications_confusion_matrix_algo_display(conf, **kwargs)</span>


<div class="viewcode-block" id="classifier_cameratrap_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_cameratrap_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">classifier_cameratrap_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">positive_imageset_id</span><span class="p">,</span> <span class="n">negative_imageset_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>
    <span class="n">test_gid_set_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
    <span class="n">test_gid_set_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_gid_set_</span><span class="p">)</span>

    <span class="n">positive_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">positive_imageset_id</span><span class="p">))</span>
    <span class="n">negative_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">negative_imageset_id</span><span class="p">))</span>

    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">test_gid_set_</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">positive_gid_set</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span>
        <span class="k">elif</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">negative_gid_set</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;negative&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># label = &#39;unknown&#39;</span>
            <span class="k">continue</span>
        <span class="n">test_gid_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="n">prediction_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">confidence</span> <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">confidence</span>
        <span class="k">for</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prediction_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">general_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier_cameratrap_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_cameratrap_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier_cameratrap_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">classifier_cameratrap_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier_cameratrap_roc_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_cameratrap_roc_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier_cameratrap_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing ROC for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">classifier_cameratrap_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">fpr_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">target</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier_cameratrap_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_cameratrap_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier_cameratrap_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">positive_imageset_id</span><span class="p">,</span> <span class="n">negative_imageset_id</span><span class="p">,</span> <span class="n">output_cases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1"> (Conf = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>
    <span class="n">test_gid_set_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
    <span class="n">test_gid_set_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_gid_set_</span><span class="p">)</span>

    <span class="n">positive_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">positive_imageset_id</span><span class="p">))</span>
    <span class="n">negative_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">negative_imageset_id</span><span class="p">))</span>

    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">test_gid_set_</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">positive_gid_set</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span>
        <span class="k">elif</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">negative_gid_set</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;negative&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># label = &#39;unknown&#39;</span>
            <span class="k">continue</span>
        <span class="n">test_gid_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="n">prediction_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">confidence</span> <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">confidence</span>
        <span class="k">for</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prediction_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="n">conf</span> <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
        <span class="k">for</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="n">confidence_list</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">output_cases</span><span class="p">:</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;cameratrap-confusion-incorrect&#39;</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)))</span>
        <span class="n">positive_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;positive&#39;</span><span class="p">)</span>
        <span class="n">negative_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">positive_path</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">negative_path</span><span class="p">)</span>

        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LANCZOS4</span>
        <span class="n">warpkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="n">prediction</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span> <span class="o">**</span><span class="n">warpkw</span><span class="p">)</span>
            <span class="c1"># Get path</span>
            <span class="n">image_path</span> <span class="o">=</span> <span class="n">positive_path</span> <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="n">negative_path</span>
            <span class="n">image_filename</span> <span class="o">=</span> <span class="s1">&#39;hardidx_</span><span class="si">%d</span><span class="s1">_pred_</span><span class="si">%s</span><span class="s1">_case_fail.jpg&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">image_filepath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">image_filename</span><span class="p">)</span>
            <span class="c1"># Save path</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">image_filepath</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">]</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                         <span class="n">category_mapping</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier_cameratrap_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_cameratrap_precision_recall_algo_display">[docs]</a><span class="nd">@register_ibs_method</span>
<span class="k">def</span> <span class="nf">classifier_cameratrap_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">positive_imageset_id</span><span class="p">,</span> <span class="n">negative_imageset_id</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="n">config_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Initial Model   (0%)&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;megan2.1&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Retrained Model (1%)&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;megan2.2&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Retrained Model (2%)&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;megan2.3&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Retrained Model (3%)&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;megan2.4&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Retrained Model (4%)&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;megan2.5&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Retrained Model (5%)&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;megan2.6&#39;</span><span class="p">},</span>

        <span class="c1"># {&#39;label&#39;: &#39;Initial Model   (0%)&#39;, &#39;classifier_weight_filepath&#39;: &#39;megan1.1&#39;},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Retrained Model (1%)&#39;, &#39;classifier_weight_filepath&#39;: &#39;megan1.2&#39;},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Retrained Model (2%)&#39;, &#39;classifier_weight_filepath&#39;: &#39;megan1.3&#39;},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Retrained Model (3%)&#39;, &#39;classifier_weight_filepath&#39;: &#39;megan1.4&#39;},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Retrained Model (3.5%)&#39;, &#39;classifier_weight_filepath&#39;: &#39;megan1.5&#39;},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Retrained Model (5%)&#39;, &#39;classifier_weight_filepath&#39;: &#39;megan1.6&#39;},</span>
    <span class="p">]</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">config_list</span><span class="p">),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">classifier_cameratrap_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                                         <span class="n">positive_imageset_id</span><span class="o">=</span><span class="n">positive_imageset_id</span><span class="p">,</span>
                                                         <span class="n">negative_imageset_id</span><span class="o">=</span><span class="n">negative_imageset_id</span><span class="p">,</span>
                                                         <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
    <span class="c1"># index = 0</span>
    <span class="n">best_label1</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">best_config1</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_color1</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_area1</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_conf1</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve (Best: </span><span class="si">%s</span><span class="s1">, AP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label1</span><span class="p">,</span> <span class="n">best_area1</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">classifier_cameratrap_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                            <span class="n">positive_imageset_id</span><span class="o">=</span><span class="n">positive_imageset_id</span><span class="p">,</span>
                                            <span class="n">negative_imageset_id</span><span class="o">=</span><span class="n">negative_imageset_id</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
    <span class="c1"># index = 0</span>
    <span class="n">best_label2</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">best_config2</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_color2</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_area2</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_conf2</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve (Best: </span><span class="si">%s</span><span class="s1">, AP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label2</span><span class="p">,</span> <span class="n">best_area2</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classifier_cameratrap_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">best_color1</span><span class="p">,</span>
                                                                       <span class="n">conf</span><span class="o">=</span><span class="n">best_conf1</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span>
                                                                       <span class="n">positive_imageset_id</span><span class="o">=</span><span class="n">positive_imageset_id</span><span class="p">,</span>
                                                                       <span class="n">negative_imageset_id</span><span class="o">=</span><span class="n">negative_imageset_id</span><span class="p">,</span>
                                                                       <span class="n">output_cases</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">best_config1</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf1</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.12</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classifier_cameratrap_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">best_color2</span><span class="p">,</span>
                                                                       <span class="n">conf</span><span class="o">=</span><span class="n">best_conf2</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span>
                                                                       <span class="n">positive_imageset_id</span><span class="o">=</span><span class="n">positive_imageset_id</span><span class="p">,</span>
                                                                       <span class="n">negative_imageset_id</span><span class="o">=</span><span class="n">negative_imageset_id</span><span class="p">,</span>
                                                                       <span class="o">**</span><span class="n">best_config2</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Confusion Matrix (OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf2</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.12</span><span class="p">)</span>

    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;classifier-cameratrap-precision-recall-roc.png&#39;</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<span class="c1"># def classifier_binary_precision_recall_algo(ibs, category_set, **kwargs):</span>
<span class="c1">#     depc = ibs.depc_image</span>
<span class="c1">#     test_gid_set = set(general_get_imageset_gids(ibs, &#39;TEST_SET&#39;))</span>
<span class="c1">#     test_gid_set = list(test_gid_set)</span>
<span class="c1">#     aids_list = ibs.get_image_aids(test_gid_set)</span>
<span class="c1">#     species_set_list = [</span>
<span class="c1">#         set(ibs.get_annot_species_texts(aid_list))</span>
<span class="c1">#         for aid_list in aids_list</span>
<span class="c1">#     ]</span>
<span class="c1">#     label_list = [</span>
<span class="c1">#         &#39;negative&#39; if len(species_set &amp; category_set) == 0 else &#39;positive&#39;</span>
<span class="c1">#         for species_set in species_set_list</span>
<span class="c1">#     ]</span>
<span class="c1">#     prediction_list = depc.get_property(&#39;classifier&#39;, test_gid_set, &#39;class&#39;, config=kwargs)</span>
<span class="c1">#     confidence_list = depc.get_property(&#39;classifier&#39;, test_gid_set, &#39;score&#39;, config=kwargs)</span>
<span class="c1">#     confidence_list = [</span>
<span class="c1">#         confidence if prediction == &#39;positive&#39; else 1.0 - confidence</span>
<span class="c1">#         for prediction, confidence  in zip(prediction_list, confidence_list)</span>
<span class="c1">#     ]</span>
<span class="c1">#     return general_precision_recall_algo(ibs, label_list, confidence_list)</span>


<span class="c1"># def classifier_binary_precision_recall_algo_plot(ibs, **kwargs):</span>
<span class="c1">#     label = kwargs[&#39;label&#39;]</span>
<span class="c1">#     print(&#39;Processing Precision-Recall for: %r&#39; % (label, ))</span>
<span class="c1">#     conf_list, pr_list, re_list, tpr_list, fpr_list = classifier_binary_precision_recall_algo(ibs, **kwargs)</span>
<span class="c1">#     return general_area_best_conf(conf_list, re_list, pr_list, **kwargs)</span>


<span class="c1"># def classifier_binary_roc_algo_plot(ibs, **kwargs):</span>
<span class="c1">#     label = kwargs[&#39;label&#39;]</span>
<span class="c1">#     print(&#39;Processing ROC for: %r&#39; % (label, ))</span>
<span class="c1">#     conf_list, pr_list, re_list, tpr_list, fpr_list = classifier_binary_precision_recall_algo(ibs, **kwargs)</span>
<span class="c1">#     return general_area_best_conf(conf_list, fpr_list, tpr_list, interpolate=False,</span>
<span class="c1">#                                   target=(0.0, 1.0), **kwargs)</span>


<span class="c1"># def classifier_binary_confusion_matrix_algo_plot(ibs, label, color, conf, category_set, **kwargs):</span>
<span class="c1">#     print(&#39;Processing Confusion Matrix for: %r (Conf = %0.02f)&#39; % (label, conf, ))</span>
<span class="c1">#     depc = ibs.depc_image</span>
<span class="c1">#     test_gid_set = set(general_get_imageset_gids(ibs, &#39;TEST_SET&#39;))</span>
<span class="c1">#     test_gid_set = list(test_gid_set)</span>
<span class="c1">#     aids_list = ibs.get_image_aids(test_gid_set)</span>
<span class="c1">#     species_set_list = [</span>
<span class="c1">#         set(ibs.get_annot_species_texts(aid_list))</span>
<span class="c1">#         for aid_list in aids_list</span>
<span class="c1">#     ]</span>
<span class="c1">#     label_list = [</span>
<span class="c1">#         &#39;negative&#39; if len(species_set &amp; category_set) == 0 else &#39;positive&#39;</span>
<span class="c1">#         for species_set in species_set_list</span>
<span class="c1">#     ]</span>
<span class="c1">#     prediction_list = depc.get_property(&#39;classifier&#39;, test_gid_set, &#39;class&#39;, config=kwargs)</span>
<span class="c1">#     confidence_list = depc.get_property(&#39;classifier&#39;, test_gid_set, &#39;score&#39;, config=kwargs)</span>
<span class="c1">#     confidence_list = [</span>
<span class="c1">#         confidence if prediction == &#39;positive&#39; else 1.0 - confidence</span>
<span class="c1">#         for prediction, confidence  in zip(prediction_list, confidence_list)</span>
<span class="c1">#     ]</span>
<span class="c1">#     prediction_list = [</span>
<span class="c1">#         &#39;positive&#39; if confidence &gt;= conf else &#39;negative&#39;</span>
<span class="c1">#         for confidence in confidence_list</span>
<span class="c1">#     ]</span>

<span class="c1">#     category_list = [&#39;positive&#39;, &#39;negative&#39;]</span>
<span class="c1">#     category_mapping = {</span>
<span class="c1">#         &#39;positive&#39;: 0,</span>
<span class="c1">#         &#39;negative&#39;: 1,</span>
<span class="c1">#     }</span>
<span class="c1">#     return general_confusion_matrix_algo(label_list, prediction_list, category_list,</span>
<span class="c1">#                                          category_mapping, **kwargs)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def classifier_binary_precision_recall_algo_display(ibs, figsize=(16, 16), **kwargs):</span>
<span class="c1">#     import matplotlib.pyplot as plt</span>

<span class="c1">#     fig_ = plt.figure(figsize=figsize)</span>

<span class="c1">#     # label = &#39;V1&#39;</span>
<span class="c1">#     # species_list = [&#39;zebra&#39;]</span>
<span class="c1">#     # kwargs[&#39;classifier_weight_filepath&#39;] = &#39;coco_zebra&#39;</span>

<span class="c1">#     label = &#39;V3&#39;</span>
<span class="c1">#     species_list = [&#39;zebra_plains&#39;, &#39;zebra_grevys&#39;]</span>
<span class="c1">#     kwargs[&#39;classifier_weight_filepath&#39;] = &#39;v3_zebra&#39;</span>

<span class="c1">#     category_set = set(species_list)</span>

<span class="c1">#     axes_ = plt.subplot(221)</span>
<span class="c1">#     axes_.set_autoscalex_on(False)</span>
<span class="c1">#     axes_.set_autoscaley_on(False)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Recall&#39;)</span>
<span class="c1">#     axes_.set_ylabel(&#39;Precision&#39;)</span>
<span class="c1">#     axes_.set_xlim([0.0, 1.01])</span>
<span class="c1">#     axes_.set_ylim([0.0, 1.01])</span>
<span class="c1">#     area, best_conf1, _ = classifier_binary_precision_recall_algo_plot(ibs, label=label, color=&#39;r&#39;, category_set=category_set, **kwargs)</span>
<span class="c1">#     plt.title(&#39;Precision-Recall Curve (AP = %0.02f)&#39; % (area, ), y=1.10)</span>
<span class="c1">#     plt.legend(bbox_to_anchor=(0.0, 1.02, 1.0, .102), loc=3, ncol=2, mode=&quot;expand&quot;,</span>
<span class="c1">#                borderaxespad=0.0)</span>

<span class="c1">#     axes_ = plt.subplot(222)</span>
<span class="c1">#     axes_.set_autoscalex_on(False)</span>
<span class="c1">#     axes_.set_autoscaley_on(False)</span>
<span class="c1">#     axes_.set_xlabel(&#39;False-Positive Rate&#39;)</span>
<span class="c1">#     axes_.set_ylabel(&#39;True-Positive Rate&#39;)</span>
<span class="c1">#     axes_.set_xlim([0.0, 1.01])</span>
<span class="c1">#     axes_.set_ylim([0.0, 1.01])</span>
<span class="c1">#     area, best_conf2, _ = classifier_binary_roc_algo_plot(ibs, label=label, color=&#39;r&#39;, category_set=category_set, **kwargs)</span>
<span class="c1">#     plt.title(&#39;ROC Curve (AP = %0.02f)&#39; % (area, ), y=1.10)</span>
<span class="c1">#     plt.legend(bbox_to_anchor=(0.0, 1.02, 1.0, .102), loc=3, ncol=2, mode=&quot;expand&quot;,</span>
<span class="c1">#                borderaxespad=0.0)</span>

<span class="c1">#     axes_ = plt.subplot(223)</span>
<span class="c1">#     axes_.set_aspect(1)</span>
<span class="c1">#     gca_ = plt.gca()</span>
<span class="c1">#     gca_.grid(False)</span>
<span class="c1">#     correct_rate, _ = classifier_binary_confusion_matrix_algo_plot(ibs, label, &#39;r&#39;, conf=best_conf1, fig_=fig_, axes_=axes_, category_set=category_set, **kwargs)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Predicted (Correct = %0.02f%%)&#39; % (correct_rate * 100.0, ))</span>
<span class="c1">#     axes_.set_ylabel(&#39;Ground-Truth&#39;)</span>
<span class="c1">#     plt.title(&#39;P-R Confusion Matrix (OP = %0.02f)&#39; % (best_conf1, ), y=1.12)</span>

<span class="c1">#     axes_ = plt.subplot(224)</span>
<span class="c1">#     axes_.set_aspect(1)</span>
<span class="c1">#     gca_ = plt.gca()</span>
<span class="c1">#     gca_.grid(False)</span>
<span class="c1">#     correct_rate, _ = classifier_binary_confusion_matrix_algo_plot(ibs, label, &#39;r&#39;, conf=best_conf2, fig_=fig_, axes_=axes_, category_set=category_set, **kwargs)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Predicted (Correct = %0.02f%%)&#39; % (correct_rate * 100.0, ))</span>
<span class="c1">#     axes_.set_ylabel(&#39;Ground-Truth&#39;)</span>
<span class="c1">#     plt.title(&#39;ROC Confusion Matrix (OP = %0.02f)&#39; % (best_conf2, ), y=1.12)</span>

<span class="c1">#     fig_filename = &#39;classifier-precision-recall-roc.png&#39;</span>
<span class="c1">#     fig_path = abspath(expanduser(join(&#39;~&#39;, &#39;Desktop&#39;, fig_filename)))</span>
<span class="c1">#     plt.savefig(fig_path, bbox_inches=&#39;tight&#39;)</span>


<div class="viewcode-block" id="classifier2_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier2_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">classifier2_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">species_mapping</span><span class="o">=</span><span class="p">{},</span>
                                      <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>
    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>

    <span class="n">species_list_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">))</span>
    <span class="n">species_set_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">species_list</span> <span class="ow">in</span> <span class="n">species_list_list</span><span class="p">:</span>
        <span class="n">species_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">species_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
            <span class="n">species_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="n">species_set_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species_set</span><span class="p">)</span>

    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">species_set_</span> <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
        <span class="k">for</span> <span class="n">species_set_</span> <span class="ow">in</span> <span class="n">species_set_list</span>
    <span class="p">]</span>

    <span class="n">confidence_dict_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier_two&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;scores&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">confidence_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">confidence_dict</span> <span class="ow">in</span> <span class="n">confidence_dict_list</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="n">config_</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;draw_annots&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;thumbsize&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">thumbnail_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;thumbnails&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;img&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config_</span><span class="p">)</span>
        <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="n">thumbnail_list</span><span class="p">,</span> <span class="n">species_set_list</span><span class="p">,</span> <span class="n">confidence_dict_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">test_gid</span><span class="p">,</span> <span class="n">thumbnail</span><span class="p">,</span> <span class="n">species_set</span><span class="p">,</span> <span class="n">confidence_dict</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_set</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">confidence_dict</span><span class="p">:</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%0.04f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">confidence_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">output_filename</span> <span class="o">=</span> <span class="s1">&#39;image-index-</span><span class="si">%s</span><span class="s1">-gid-</span><span class="si">%s</span><span class="s1">-gt-</span><span class="si">%s</span><span class="s1">-pred-</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">test_gid</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">output_filepath</span><span class="p">,</span> <span class="n">thumbnail</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier2_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier2_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier2_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">classifier2_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier2_roc_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier2_roc_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier2_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing ROC for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">classifier2_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">fpr_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">target</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="classifier2_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier2_precision_recall_algo_display">[docs]</a><span class="nd">@register_ibs_method</span>
<span class="k">def</span> <span class="nf">classifier2_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">species_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                              <span class="n">species_mapping</span><span class="o">=</span><span class="p">{},</span>
                                              <span class="n">nice_mapping</span><span class="o">=</span><span class="p">{},</span>
                                              <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                              <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>
    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>  <span class="c1"># NOQA</span>

    <span class="c1"># kwargs[&#39;classifier_two_weight_filepath&#39;] = &#39;v3&#39;</span>
    <span class="c1"># kwargs[&#39;classifier_two_weight_filepath&#39;] = &#39;candidacy&#39;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;classifier_two_weight_filepath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ggr2&#39;</span>

    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="c1"># depc.delete_property(&#39;classifier_two&#39;, test_gid_list, config=kwargs)</span>

    <span class="k">if</span> <span class="n">species_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid</span> <span class="o">=</span> <span class="n">test_gid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">confidence_dict</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier_two&#39;</span><span class="p">,</span> <span class="n">test_gid</span><span class="p">,</span> <span class="s1">&#39;scores&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="n">confidence_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="n">category_set</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">species_list</span><span class="p">)</span>

    <span class="n">config_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_set</span><span class="p">:</span>
        <span class="n">category_nice</span> <span class="o">=</span> <span class="n">nice_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">category_nice</span><span class="p">,</span>
            <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">config_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

    <span class="n">color_list_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">config_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list_</span><span class="p">),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">color_list_</span> <span class="o">+</span> <span class="n">color_list</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">):</span>
        <span class="n">classifier2_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                               <span class="n">test_gid_list</span><span class="o">=</span><span class="n">test_gid_list</span><span class="p">,</span>
                                               <span class="n">species_mapping</span><span class="o">=</span><span class="n">species_mapping</span><span class="p">,</span>
                                               <span class="o">**</span><span class="n">config</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curves&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>

    <span class="n">op_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">classifier2_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                           <span class="n">test_gid_list</span><span class="o">=</span><span class="n">test_gid_list</span><span class="p">,</span>
                                           <span class="n">species_mapping</span><span class="o">=</span><span class="n">species_mapping</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">ap</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="n">tup1</span><span class="p">,</span> <span class="n">tup2</span> <span class="o">=</span> <span class="n">values</span>
        <span class="n">op_dict</span><span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">best_conf</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curves&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>
    <span class="n">species_list_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">))</span>
    <span class="n">species_set_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">species_list</span> <span class="ow">in</span> <span class="n">species_list_list</span><span class="p">:</span>
        <span class="n">species_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">species_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
            <span class="n">species_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="n">species_set_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species_set</span><span class="p">)</span>
    <span class="n">confidence_dict_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier_two&#39;</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="p">,</span> <span class="s1">&#39;scores&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">confidence_dict</span><span class="p">,</span> <span class="n">species_set</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">confidence_dict_list</span><span class="p">,</span> <span class="n">species_set_list</span><span class="p">):</span>
        <span class="n">species_set_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">confidence_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">confidence_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="n">species_set_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_set</span> <span class="o">^</span> <span class="n">species_set_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy: </span><span class="si">%0.04f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> using op_dict = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op_dict</span><span class="p">,</span> <span class="p">))</span>

    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;classifier2-precision-recall-roc.png&#39;</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<span class="c1"># def labeler_tp_tn_fp_fn(ibs, category_list, viewpoint_mapping=None,</span>
<span class="c1">#                         samples=SAMPLES, **kwargs):</span>

<span class="c1">#     def errors(zipped, conf, category):</span>
<span class="c1">#         tp, tn, fp, fn = 0.0, 0.0, 0.0, 0.0</span>
<span class="c1">#         for index, (label, confidence) in enumerate(zipped):</span>
<span class="c1">#             if label == category:</span>
<span class="c1">#                 if conf &lt;= confidence:</span>
<span class="c1">#                     tp += 1</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     fn += 1</span>
<span class="c1">#             else:</span>
<span class="c1">#                 if conf &lt;= confidence:</span>
<span class="c1">#                     fp += 1</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     tn += 1</span>
<span class="c1">#         return tp, tn, fp, fn</span>

<span class="c1">#     depc = ibs.depc_annot</span>
<span class="c1">#     test_gid_set = set(general_get_imageset_gids(ibs, &#39;TEST_SET&#39;))</span>
<span class="c1">#     test_gid_set = list(test_gid_set)</span>
<span class="c1">#     aids_list = ibs.get_image_aids(test_gid_set)</span>
<span class="c1">#     aid_list = ut.flatten(aids_list)</span>
<span class="c1">#     # Get annot species and viewpoints</span>
<span class="c1">#     species_list = ibs.get_annot_species_texts(aid_list)</span>
<span class="c1">#     viewpoint_list = ibs.get_annot_viewpoints(aid_list)</span>
<span class="c1">#     # Filter aids with species of interest and undefined viewpoints</span>
<span class="c1">#     flag_list = [</span>
<span class="c1">#         species in category_list</span>
<span class="c1">#         for species, viewpoint in zip(species_list, viewpoint_list)</span>
<span class="c1">#     ]</span>
<span class="c1">#     if False in flag_list:</span>
<span class="c1">#         aid_list = ut.compress(aid_list, flag_list)</span>
<span class="c1">#         # Get new species and viewpoints</span>
<span class="c1">#         viewpoint_list = ibs.get_annot_viewpoints(aid_list)</span>
<span class="c1">#         species_list = ibs.get_annot_species_texts(aid_list)</span>

<span class="c1">#     # Make ground-truth</span>
<span class="c1">#     label_list = [</span>
<span class="c1">#         &#39;%s:%s&#39; % (</span>
<span class="c1">#             species,</span>
<span class="c1">#             viewpoint_mapping.get(species, {}).get(viewpoint, viewpoint),</span>
<span class="c1">#         )</span>
<span class="c1">#         for species, viewpoint in zip(species_list, viewpoint_list)</span>
<span class="c1">#     ]</span>
<span class="c1">#     # Get predictions</span>
<span class="c1">#     # depc.delete_property(&#39;labeler&#39;, aid_list, config=kwargs)</span>
<span class="c1">#     probability_dict_list = depc.get_property(&#39;labeler&#39;, aid_list, &#39;probs&#39;, config=kwargs)</span>

<span class="c1">#     value1_list = set(label_list)</span>
<span class="c1">#     value2_list = set(probability_dict_list[0].keys())</span>
<span class="c1">#     assert len(value1_list - value2_list) == 0</span>
<span class="c1">#     assert len(value2_list - value1_list) == 0</span>

<span class="c1">#     conf_list = [ _ / float(samples) for _ in range(0, int(samples) + 1) ]</span>
<span class="c1">#     label_dict = {}</span>
<span class="c1">#     for key in value1_list:</span>
<span class="c1">#         print(&#39;\t%r&#39; % (key, ))</span>
<span class="c1">#         conf_dict = {}</span>
<span class="c1">#         confidence_list = [</span>
<span class="c1">#             probability_dict[key]</span>
<span class="c1">#             for probability_dict in probability_dict_list</span>
<span class="c1">#         ]</span>
<span class="c1">#         zipped = list(zip(label_list, confidence_list))</span>
<span class="c1">#         for conf in conf_list:</span>
<span class="c1">#             conf_dict[conf] = errors(zipped, conf, key)</span>
<span class="c1">#         label_dict[key] = conf_dict</span>
<span class="c1">#     return label_dict</span>


<span class="c1"># def labeler_precision_recall_algo(ibs, category_list, label_dict, **kwargs):</span>

<span class="c1">#     if category_list is None:</span>
<span class="c1">#         category_list_ = label_dict.keys()</span>
<span class="c1">#     else:</span>
<span class="c1">#         category_list_ = []</span>
<span class="c1">#         for category in category_list:</span>
<span class="c1">#             for key in label_dict:</span>
<span class="c1">#                 if category in key or category is None:</span>
<span class="c1">#                     category_list_.append(key)</span>

<span class="c1">#     global_conf_dict = {}</span>
<span class="c1">#     for category in category_list_:</span>
<span class="c1">#         conf_dict = label_dict[category]</span>
<span class="c1">#         for conf in conf_dict:</span>
<span class="c1">#             new_list = conf_dict[conf]</span>
<span class="c1">#             if conf not in global_conf_dict:</span>
<span class="c1">#                 global_conf_dict[conf] = new_list</span>
<span class="c1">#             else:</span>
<span class="c1">#                 cur_list = global_conf_dict[conf]</span>
<span class="c1">#                 zipped_ = zip(cur_list, new_list)</span>
<span class="c1">#                 global_conf_dict[conf] = [cur + new for cur, new in zipped_]</span>

<span class="c1">#     conf_list_ = [-1.0, -1.0]</span>
<span class="c1">#     pr_list = [1.0, 0.0]</span>
<span class="c1">#     re_list = [0.0, 1.0]</span>
<span class="c1">#     tpr_list = [0.0, 1.0]</span>
<span class="c1">#     fpr_list = [0.0, 1.0]</span>
<span class="c1">#     # conf_list_ = []</span>
<span class="c1">#     # pr_list = []</span>
<span class="c1">#     # re_list = []</span>
<span class="c1">#     # tpr_list = []</span>
<span class="c1">#     # fpr_list = []</span>
<span class="c1">#     for conf in sorted(global_conf_dict.keys(), reverse=True):</span>
<span class="c1">#         error_list = global_conf_dict[conf]</span>
<span class="c1">#         tp, tn, fp, fn = error_list</span>
<span class="c1">#         try:</span>
<span class="c1">#             pr = tp / (tp + fp)</span>
<span class="c1">#             re = tp / (tp + fn)</span>
<span class="c1">#             tpr = tp / (tp + fn)</span>
<span class="c1">#             fpr = fp / (fp + tn)</span>
<span class="c1">#             conf_list_.append(conf)</span>
<span class="c1">#             pr_list.append(pr)</span>
<span class="c1">#             re_list.append(re)</span>
<span class="c1">#             tpr_list.append(tpr)</span>
<span class="c1">#             fpr_list.append(fpr)</span>
<span class="c1">#         except ZeroDivisionError:</span>
<span class="c1">#             print(&#39;Zero division error (%r) - tp: %r tn: %r fp: %r fn: %r&#39; % (conf, tp, tn, fp, fn, ))</span>

<span class="c1">#     return conf_list_, pr_list, re_list, tpr_list, fpr_list</span>


<span class="c1"># def labeler_precision_recall_algo_plot(ibs, **kwargs):</span>
<span class="c1">#     label = kwargs[&#39;label&#39;]</span>
<span class="c1">#     category_list = kwargs[&#39;category_list&#39;]</span>
<span class="c1">#     print(&#39;Processing Precision-Recall for: %r (category_list = %r)&#39; % (label, category_list, ))</span>
<span class="c1">#     conf_list, pr_list, re_list, tpr_list, fpr_list = labeler_precision_recall_algo(ibs, **kwargs)</span>
<span class="c1">#     return general_area_best_conf(conf_list, re_list, pr_list, **kwargs)</span>


<span class="c1"># def labeler_roc_algo_plot(ibs, **kwargs):</span>
<span class="c1">#     label = kwargs[&#39;label&#39;]</span>
<span class="c1">#     category_list = kwargs[&#39;category_list&#39;]</span>
<span class="c1">#     print(&#39;Processing ROC for: %r (category_list = %r)&#39; % (label, category_list, ))</span>
<span class="c1">#     conf_list, pr_list, re_list, tpr_list, fpr_list = labeler_precision_recall_algo(ibs, **kwargs)</span>
<span class="c1">#     return general_area_best_conf(conf_list, fpr_list, tpr_list, interpolate=False,</span>
<span class="c1">#                                   target=(0.0, 1.0), **kwargs)</span>


<span class="c1"># def labeler_confusion_matrix_algo_plot(ibs, category_list, viewpoint_mapping, category_mapping=None, **kwargs):</span>
<span class="c1">#     print(&#39;Processing Confusion Matrix&#39;)</span>
<span class="c1">#     depc = ibs.depc_annot</span>
<span class="c1">#     test_gid_set = set(general_get_imageset_gids(ibs, &#39;TEST_SET&#39;))</span>
<span class="c1">#     test_gid_set = list(test_gid_set)</span>
<span class="c1">#     aids_list = ibs.get_image_aids(test_gid_set)</span>
<span class="c1">#     aid_list = ut.flatten(aids_list)</span>
<span class="c1">#     species_list = ibs.get_annot_species_texts(aid_list)</span>
<span class="c1">#     viewpoint_list = ibs.get_annot_viewpoints(aid_list)</span>
<span class="c1">#     label_list = [</span>
<span class="c1">#         &#39;%s:%s&#39; % (</span>
<span class="c1">#             species,</span>
<span class="c1">#             viewpoint_mapping.get(species, {}).get(viewpoint, viewpoint),</span>
<span class="c1">#         )</span>
<span class="c1">#         for species, viewpoint in zip(species_list, viewpoint_list)</span>
<span class="c1">#     ]</span>
<span class="c1">#     temp_list = [</span>
<span class="c1">#         (aid, label)</span>
<span class="c1">#         for aid, label in zip(aid_list, label_list)</span>
<span class="c1">#         if label in category_list</span>
<span class="c1">#     ]</span>
<span class="c1">#     aid_list = [_[0] for _ in temp_list]</span>
<span class="c1">#     label_list = [_[1] for _ in temp_list]</span>
<span class="c1">#     conf_list = depc.get_property(&#39;labeler&#39;, aid_list, &#39;score&#39;, config=kwargs)</span>
<span class="c1">#     species_list = depc.get_property(&#39;labeler&#39;, aid_list, &#39;species&#39;, config=kwargs)</span>
<span class="c1">#     viewpoint_list = depc.get_property(&#39;labeler&#39;, aid_list, &#39;viewpoint&#39;, config=kwargs)</span>
<span class="c1">#     prediction_list = [</span>
<span class="c1">#         &#39;%s:%s&#39; % (species, viewpoint, )</span>
<span class="c1">#         for species, viewpoint in zip(species_list, viewpoint_list)</span>
<span class="c1">#     ]</span>

<span class="c1">#     category_list = list(map(simple_code, category_list))</span>
<span class="c1">#     label_list = list(map(simple_code, label_list))</span>
<span class="c1">#     prediction_list = list(map(simple_code, prediction_list))</span>
<span class="c1">#     if category_mapping is None:</span>
<span class="c1">#         category_mapping = { key: index for index, key in enumerate(category_list) }</span>
<span class="c1">#     category_mapping = {</span>
<span class="c1">#         simple_code(key): category_mapping[key]</span>
<span class="c1">#         for key in category_mapping</span>
<span class="c1">#     }</span>
<span class="c1">#     return general_confusion_matrix_algo(label_list, prediction_list, category_list,</span>
<span class="c1">#                                                  category_mapping, conf_list=conf_list,</span>
<span class="c1">#                                                  size=8, **kwargs)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def labeler_precision_recall_algo_display(ibs, category_list=None, viewpoint_mapping=None,</span>
<span class="c1">#                                           category_mapping=None, figsize=(30, 9), **kwargs):</span>
<span class="c1">#     import matplotlib.pyplot as plt</span>
<span class="c1">#     import plottool as pt</span>

<span class="c1">#     if category_list is None:</span>
<span class="c1">#         test_gid_set = set(general_get_imageset_gids(ibs, &#39;TEST_SET&#39;))</span>
<span class="c1">#         test_gid_set = list(test_gid_set)</span>
<span class="c1">#         aids_list = ibs.get_image_aids(test_gid_set)</span>
<span class="c1">#         aid_list = ut.flatten(aids_list)</span>
<span class="c1">#         species_list = ibs.get_annot_species_texts(aid_list)</span>
<span class="c1">#         category_list = sorted(list(set(species_list)))</span>

<span class="c1">#     print(&#39;Compiling raw numbers...&#39;)</span>
<span class="c1">#     kwargs[&#39;labeler_weight_filepath&#39;] = &#39;candidacy&#39;</span>
<span class="c1">#     label_dict = labeler_tp_tn_fp_fn(ibs, category_list, viewpoint_mapping=viewpoint_mapping,</span>
<span class="c1">#                                      **kwargs)</span>

<span class="c1">#     config_list = [</span>
<span class="c1">#         {&#39;label&#39;: &#39;All Species&#39;,         &#39;category_list&#39;: None},</span>
<span class="c1">#         {&#39;label&#39;: &#39;Masai Giraffe&#39;,       &#39;category_list&#39;: [&#39;giraffe_masai&#39;]},</span>
<span class="c1">#         {&#39;label&#39;: &#39;Reticulated Giraffe&#39;, &#39;category_list&#39;: [&#39;giraffe_reticulated&#39;]},</span>
<span class="c1">#         {&#39;label&#39;: &#39;Sea Turtle&#39;,          &#39;category_list&#39;: [&#39;turtle_sea&#39;]},</span>
<span class="c1">#         {&#39;label&#39;: &#39;Whale Fluke&#39;,         &#39;category_list&#39;: [&#39;whale_fluke&#39;]},</span>
<span class="c1">#         {&#39;label&#39;: &#39;Grevy\&#39;s Zebra&#39;,      &#39;category_list&#39;: [&#39;zebra_grevys&#39;]},</span>
<span class="c1">#         {&#39;label&#39;: &#39;Plains Zebra&#39;,        &#39;category_list&#39;: [&#39;zebra_plains&#39;]},</span>
<span class="c1">#     ]</span>
<span class="c1">#     color_list = [(0.0, 0.0, 0.0)]</span>
<span class="c1">#     color_list += pt.distinct_colors(len(config_list) - len(color_list), randomize=False)</span>

<span class="c1">#     fig_ = plt.figure(figsize=figsize, dpi=400)  # NOQA</span>

<span class="c1">#     axes_ = plt.subplot(131)</span>
<span class="c1">#     axes_.set_autoscalex_on(False)</span>
<span class="c1">#     axes_.set_autoscaley_on(False)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Recall&#39;)</span>
<span class="c1">#     axes_.set_ylabel(&#39;Precision&#39;)</span>
<span class="c1">#     axes_.set_xlim([0.0, 1.01])</span>
<span class="c1">#     axes_.set_ylim([0.0, 1.01])</span>
<span class="c1">#     area_list = []</span>
<span class="c1">#     for color, config in zip(color_list, config_list):</span>
<span class="c1">#         area, conf, _ = labeler_precision_recall_algo_plot(ibs, label_dict=label_dict,</span>
<span class="c1">#                                                            color=color, **config)</span>
<span class="c1">#         area_list.append(area)</span>
<span class="c1">#     plt.title(&#39;Precision-Recall Curve&#39;, y=1.19)</span>
<span class="c1">#     plt.legend(bbox_to_anchor=(0.0, 1.02, 1.0, .102), loc=3, ncol=2, mode=&quot;expand&quot;,</span>
<span class="c1">#                borderaxespad=0.0)</span>

<span class="c1">#     axes_ = plt.subplot(132)</span>
<span class="c1">#     axes_.set_autoscalex_on(False)</span>
<span class="c1">#     axes_.set_autoscaley_on(False)</span>
<span class="c1">#     axes_.set_xlabel(&#39;False-Positive Rate&#39;)</span>
<span class="c1">#     axes_.set_ylabel(&#39;True-Positive Rate&#39;)</span>
<span class="c1">#     axes_.set_xlim([0.0, 1.01])</span>
<span class="c1">#     axes_.set_ylim([0.0, 1.01])</span>
<span class="c1">#     for color, config in zip(color_list, config_list):</span>
<span class="c1">#         labeler_roc_algo_plot(ibs, label_dict=label_dict,</span>
<span class="c1">#                               color=color, **config)</span>
<span class="c1">#     plt.title(&#39;ROC Curve&#39;, y=1.19)</span>
<span class="c1">#     plt.legend(bbox_to_anchor=(0.0, 1.02, 1.0, .102), loc=3, ncol=2, mode=&quot;expand&quot;,</span>
<span class="c1">#                borderaxespad=0.0)</span>

<span class="c1">#     key_list = sorted(label_dict.keys())</span>
<span class="c1">#     fuzzy_dict = {}</span>
<span class="c1">#     for index1, label1 in enumerate(key_list):</span>
<span class="c1">#         if label1 == &#39;ignore&#39;:</span>
<span class="c1">#             fuzzy_list = []</span>
<span class="c1">#         else:</span>
<span class="c1">#             species, viewpoint = label1.strip().split(&#39;:&#39;)</span>
<span class="c1">#             fuzzy_list = []</span>
<span class="c1">#             for index2, label2 in enumerate(key_list):</span>
<span class="c1">#                 if species in label2:</span>
<span class="c1">#                     fuzzy_list.append(index2)</span>
<span class="c1">#         fuzzy_dict[index1] = set(fuzzy_list)</span>

<span class="c1">#     axes_ = plt.subplot(133)</span>
<span class="c1">#     axes_.set_aspect(1)</span>
<span class="c1">#     gca_ = plt.gca()</span>
<span class="c1">#     gca_.grid(False)</span>
<span class="c1">#     correct_rate, fuzzy_rate = labeler_confusion_matrix_algo_plot(ibs, key_list, viewpoint_mapping=viewpoint_mapping, category_mapping=category_mapping, fig_=fig_, axes_=axes_, fuzzy_dict=fuzzy_dict, **kwargs)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Predicted (Correct = %0.02f%%, Species = %0.02f%%)&#39; % (correct_rate * 100.0, fuzzy_rate * 100.0, ))</span>
<span class="c1">#     axes_.set_ylabel(&#39;Ground-Truth&#39;)</span>
<span class="c1">#     area_list_ = area_list[1:]</span>
<span class="c1">#     mAP = sum(area_list_) / len(area_list_)</span>
<span class="c1">#     args = (mAP * 100.0, )</span>
<span class="c1">#     plt.title(&#39;Confusion Matrix\nmAP = %0.02f&#39; % args, y=1.19)</span>

<span class="c1">#     fig_filename = &#39;labeler-precision-recall-roc.png&#39;</span>
<span class="c1">#     fig_path = abspath(expanduser(join(&#39;~&#39;, &#39;Desktop&#39;, fig_filename)))</span>
<span class="c1">#     plt.savefig(fig_path, bbox_inches=&#39;tight&#39;)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def background_accuracy_display(ibs, category_list, test_gid_set=None):</span>
<span class="c1">#     if test_gid_set is None:</span>
<span class="c1">#         test_gid_set = set(general_get_imageset_gids(ibs, &#39;TEST_SET&#39;))</span>
<span class="c1">#         test_gid_set = list(test_gid_set)</span>
<span class="c1">#     aids_list = ibs.get_image_aids(test_gid_set)</span>
<span class="c1">#     aid_list = ut.flatten(aids_list)</span>
<span class="c1">#     species_list = ibs.get_annot_species_texts(aid_list)</span>

<span class="c1">#     aid_list = [</span>
<span class="c1">#         aid</span>
<span class="c1">#         for aid, species in zip(aid_list, species_list)</span>
<span class="c1">#         if species in category_list</span>
<span class="c1">#     ]</span>
<span class="c1">#     species_list = ibs.get_annot_species_texts(aid_list)</span>
<span class="c1">#     gid_list = ibs.get_annot_gids(aid_list)</span>

<span class="c1">#     config2_ = {</span>
<span class="c1">#         &#39;fw_detector&#39;: &#39;cnn&#39;</span>
<span class="c1">#     }</span>
<span class="c1">#     hough_cpath_list = ibs.get_annot_probchip_fpath(aid_list, config2_=config2_)</span>
<span class="c1">#     image_list = [vt.imread(hough_cpath) for hough_cpath in hough_cpath_list]</span>
<span class="c1">#     chip_list = ibs.get_annot_chips(aid_list, config2_=config2_)</span>
<span class="c1">#     zipped = zip(aid_list, gid_list, species_list, image_list, chip_list)</span>
<span class="c1">#     for index, (aid, gid, species, image, chip) in enumerate(zipped):</span>
<span class="c1">#         print(index)</span>
<span class="c1">#         canvas = vt.blend_images_multiply(chip, vt.resize_mask(image, chip))</span>
<span class="c1">#         canvas *= 255.0</span>
<span class="c1">#         canvas = np.around(canvas)</span>
<span class="c1">#         canvas[canvas &lt; 0] = 0</span>
<span class="c1">#         canvas[canvas &gt; 255] = 255</span>
<span class="c1">#         canvas = canvas.astype(np.uint8)</span>
<span class="c1">#         cv2.imwrite(&#39;/home/jason/Desktop/background/background.%s.%d.%d.png&#39; % (species, gid, aid, ), canvas)</span>


<div class="viewcode-block" id="aoi2_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.aoi2_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">aoi2_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">category_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_gid_set_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
    <span class="k">if</span> <span class="n">test_gid_set_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_set_</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">)</span>
    <span class="n">test_aid_list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">test_gid_set_</span><span class="p">))))</span>
    <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">test_aid_list_</span><span class="p">)</span>
    <span class="n">interest_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_interest</span><span class="p">(</span><span class="n">test_aid_list_</span><span class="p">)</span>

    <span class="n">test_aid_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">test_aid</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">interest</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_aid_list_</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">interest_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">category_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="n">interest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">interest</span> <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
        <span class="n">test_aid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_aid</span><span class="p">)</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="n">prediction_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;aoi_two&#39;</span><span class="p">,</span> <span class="n">test_aid_list</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;aoi_two&#39;</span><span class="p">,</span> <span class="n">test_aid_list</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">confidence</span> <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">confidence</span>
        <span class="k">for</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prediction_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">general_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="aoi2_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.aoi2_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">aoi2_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">aoi2_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="aoi2_roc_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.aoi2_roc_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">aoi2_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing ROC for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">aoi2_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">fpr_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">target</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="aoi2_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.aoi2_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">aoi2_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">output_cases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">category_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_gid_set_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1"> (Conf = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
    <span class="k">if</span> <span class="n">test_gid_set_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_set_</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">)</span>
    <span class="n">test_aid_list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">test_gid_set_</span><span class="p">))))</span>
    <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">test_aid_list_</span><span class="p">)</span>
    <span class="n">interest_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_interest</span><span class="p">(</span><span class="n">test_aid_list_</span><span class="p">)</span>

    <span class="n">test_aid_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">test_aid</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">interest</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_aid_list_</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">interest_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">category_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="n">interest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">interest</span> <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
        <span class="n">test_aid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_aid</span><span class="p">)</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="n">prediction_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;aoi_two&#39;</span><span class="p">,</span> <span class="n">test_aid_list</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;aoi_two&#39;</span><span class="p">,</span> <span class="n">test_aid_list</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">confidence</span> <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">confidence</span>
        <span class="k">for</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prediction_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="n">conf</span> <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
        <span class="k">for</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="n">confidence_list</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">output_cases</span><span class="p">:</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;aoi2-confusion-incorrect&#39;</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)))</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>

        <span class="n">manifest_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">test_aid_list</span><span class="p">)</span>
        <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="n">test_aid_list</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test_gid</span><span class="p">,</span> <span class="n">test_aid</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_gid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">manifest_dict</span><span class="p">:</span>
                <span class="n">manifest_dict</span><span class="p">[</span><span class="n">test_gid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">assert</span> <span class="n">test_aid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">manifest_dict</span><span class="p">[</span><span class="n">test_gid</span><span class="p">]</span>
            <span class="n">manifest_dict</span><span class="p">[</span><span class="n">test_gid</span><span class="p">][</span><span class="n">test_aid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">test_gid</span> <span class="ow">in</span> <span class="n">manifest_dict</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">test_gid</span><span class="p">)</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">test_gid</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">_resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">t_width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">height_</span><span class="p">,</span> <span class="n">width_</span><span class="p">,</span> <span class="n">channels_</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>

            <span class="k">for</span> <span class="n">test_aid</span> <span class="ow">in</span> <span class="n">manifest_dict</span><span class="p">[</span><span class="n">test_gid</span><span class="p">]:</span>
                <span class="n">label</span><span class="p">,</span> <span class="n">prediction</span> <span class="o">=</span> <span class="n">manifest_dict</span><span class="p">[</span><span class="n">test_gid</span><span class="p">][</span><span class="n">test_aid</span><span class="p">]</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">test_aid</span><span class="p">)</span>
                <span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">bbox</span>
                <span class="n">xbr</span> <span class="o">=</span> <span class="n">xtl</span> <span class="o">+</span> <span class="n">width</span>
                <span class="n">ybr</span> <span class="o">=</span> <span class="n">ytl</span> <span class="o">+</span> <span class="n">height</span>

                <span class="n">xtl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">xtl</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">width_</span><span class="p">))</span>
                <span class="n">ytl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">ytl</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">height_</span><span class="p">))</span>
                <span class="n">xbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">xbr</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">width_</span><span class="p">))</span>
                <span class="n">ybr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">ybr</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">height_</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">46</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">127</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">),</span> <span class="p">(</span><span class="n">xbr</span><span class="p">,</span> <span class="n">ybr</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">46</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">127</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">xtl</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ytl</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">xbr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ybr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">image_filename</span> <span class="o">=</span> <span class="s1">&#39;image_</span><span class="si">%d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test_gid</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">image_filepath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">image_filename</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">image_filepath</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">]</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                         <span class="n">category_mapping</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="aoi2_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.aoi2_precision_recall_algo_display">[docs]</a><span class="nd">@register_ibs_method</span>
<span class="k">def</span> <span class="nf">aoi2_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_cases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="k">as</span> <span class="nn">pt</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">))</span>
    <span class="n">config_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># {&#39;label&#39;: &#39;All Species&#39;,         &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: None},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Masai Giraffe&#39;,       &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: [&#39;giraffe_masai&#39;]},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Reticulated Giraffe&#39;, &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: [&#39;giraffe_reticulated&#39;]},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Sea Turtle&#39;,          &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: [&#39;turtle_sea&#39;]},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Whale Fluke&#39;,         &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: [&#39;whale_fluke&#39;]},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Grevy\&#39;s Zebra&#39;,      &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: [&#39;zebra_grevys&#39;]},</span>
        <span class="c1"># {&#39;label&#39;: &#39;Plains Zebra&#39;,        &#39;aoi_two_weight_filepath&#39;: &#39;ggr2&#39;, &#39;category_list&#39;: [&#39;zebra_plains&#39;]},</span>
        <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Hammerhead&#39;</span><span class="p">,</span>        <span class="s1">&#39;aoi_two_weight_filepath&#39;</span><span class="p">:</span> <span class="s1">&#39;hammerhead&#39;</span><span class="p">,</span> <span class="s1">&#39;category_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;shark_hammerhead&#39;</span><span class="p">]},</span>
    <span class="p">]</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">color_list</span> <span class="o">+=</span> <span class="n">pt</span><span class="o">.</span><span class="n">distinct_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">config_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">aoi2_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">test_gid_set_</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="c1"># index = np.argmax(area_list)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_label1</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">best_config1</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_color1</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_area1</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_conf1</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve (Best: </span><span class="si">%s</span><span class="s1">, AP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label1</span><span class="p">,</span> <span class="n">best_area1</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">aoi2_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color_list</span><span class="p">,</span> <span class="n">config_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="c1"># index = np.argmax(area_list)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_label2</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">best_config2</span> <span class="o">=</span> <span class="n">config_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_color2</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_area2</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_conf2</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve (Best: </span><span class="si">%s</span><span class="s1">, AP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label2</span><span class="p">,</span> <span class="n">best_area2</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aoi2_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">best_color1</span><span class="p">,</span>
                                                      <span class="n">conf</span><span class="o">=</span><span class="n">best_conf1</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span>
                                                      <span class="n">output_cases</span><span class="o">=</span><span class="n">output_cases</span><span class="p">,</span>
                                                      <span class="n">test_gid_set_</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span>
                                                      <span class="o">**</span><span class="n">best_config1</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf1</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.12</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aoi2_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">best_color2</span><span class="p">,</span>
                                                      <span class="n">conf</span><span class="o">=</span><span class="n">best_conf2</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span>
                                                      <span class="n">test_gid_set_</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span>
                                                      <span class="o">**</span><span class="n">best_config2</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Confusion Matrix (OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf2</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.12</span><span class="p">)</span>

    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;aoi2-precision-recall-roc.png&#39;</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="detector_parse_gt"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_parse_gt">[docs]</a><span class="k">def</span> <span class="nf">detector_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">general_get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;TEST_SET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">)</span>

    <span class="n">gt_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">):</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">gt_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;gid&#39;</span>        <span class="p">:</span> <span class="n">gid</span><span class="p">,</span>
                <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;xbr&#39;</span>        <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ybr&#39;</span>        <span class="p">:</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;class&#39;</span>      <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">),</span>
                <span class="s1">&#39;viewpoint&#39;</span>  <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_viewpoints</span><span class="p">(</span><span class="n">aid</span><span class="p">),</span>
                <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">gt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt_list</span>
    <span class="k">return</span> <span class="n">gt_dict</span></div>


<span class="c1"># def detector_parse_pred(ibs, test_gid_list=None, **kwargs):</span>
<span class="c1">#     depc = ibs.depc_image</span>

<span class="c1">#     if test_gid_list is None:</span>
<span class="c1">#         test_gid_list = general_get_imageset_gids(ibs, &#39;TEST_SET&#39;, **kwargs)</span>
<span class="c1">#     uuid_list = ibs.get_image_uuids(test_gid_list)</span>

<span class="c1">#     # depc.delete_property(&#39;detections&#39;, test_gid_list, config=kwargs)</span>
<span class="c1">#     results_list = depc.get_property(&#39;detections&#39;, test_gid_list, None, config=kwargs)</span>
<span class="c1">#     size_list = ibs.get_image_sizes(test_gid_list)</span>
<span class="c1">#     zipped_list = zip(results_list)</span>
<span class="c1">#     # Reformat results for json</span>
<span class="c1">#     results_list = [</span>
<span class="c1">#         [</span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;gid&#39;        : test_gid,</span>
<span class="c1">#                 &#39;xtl&#39;        : bbox[0] / width,</span>
<span class="c1">#                 &#39;ytl&#39;        : bbox[1] / height,</span>
<span class="c1">#                 &#39;width&#39;      : bbox[2] / width,</span>
<span class="c1">#                 &#39;height&#39;     : bbox[3] / height,</span>
<span class="c1">#                 &#39;theta&#39;      : theta,  # round(theta, 4),</span>
<span class="c1">#                 &#39;confidence&#39; : conf,   # round(conf, 4),</span>
<span class="c1">#                 &#39;class&#39;      : class_,</span>
<span class="c1">#                 &#39;viewpoint&#39;  : viewpoint,</span>
<span class="c1">#             }</span>
<span class="c1">#             for bbox, theta, class_, viewpoint, conf in zip(*zipped[0][1:])</span>
<span class="c1">#         ]</span>
<span class="c1">#         for zipped, (width, height), test_gid in zip(zipped_list, size_list, test_gid_list)</span>
<span class="c1">#     ]</span>

<span class="c1">#     pred_dict = {</span>
<span class="c1">#         uuid_ : result_list</span>
<span class="c1">#         for uuid_, result_list in zip(uuid_list, results_list)</span>
<span class="c1">#     }</span>
<span class="c1">#     # print(pred_dict)</span>
<span class="c1">#     return pred_dict</span>


<span class="c1"># def detector_precision_recall_algo(ibs, samples=SAMPLES, force_serial=FORCE_SERIAL, **kwargs):</span>
<span class="c1">#     test_gid_list = general_get_imageset_gids(ibs, &#39;TEST_SET&#39;, **kwargs)</span>
<span class="c1">#     uuid_list = ibs.get_image_uuids(test_gid_list)</span>

<span class="c1">#     print(&#39;\tGather Ground-Truth&#39;)</span>
<span class="c1">#     gt_dict = detector_parse_gt(ibs, test_gid_list=test_gid_list)</span>

<span class="c1">#     print(&#39;\tGather Predictions&#39;)</span>
<span class="c1">#     pred_dict = detector_parse_pred(ibs, test_gid_list=test_gid_list, **kwargs)</span>

<span class="c1">#     print(&#39;\tGenerate Curves...&#39;)</span>
<span class="c1">#     conf_list = [ _ / float(samples) for _ in range(0, int(samples) + 1) ]</span>
<span class="c1">#     conf_list = sorted(conf_list, reverse=True)</span>

<span class="c1">#     uuid_list_list = [ uuid_list for _ in conf_list ]</span>
<span class="c1">#     gt_dict_list   = [ gt_dict   for _ in conf_list ]</span>
<span class="c1">#     pred_dict_list = [ pred_dict for _ in conf_list ]</span>
<span class="c1">#     kwargs_list    = [ kwargs    for _ in conf_list ]</span>
<span class="c1">#     arg_iter = zip(conf_list, uuid_list_list, gt_dict_list, pred_dict_list, kwargs_list)</span>
<span class="c1">#     pr_re_gen = ut.generate2(detector_precision_recall_algo_worker, arg_iter,</span>
<span class="c1">#                              nTasks=len(conf_list), ordered=True,</span>
<span class="c1">#                              chunksize=CHUNK_SIZE, force_serial=force_serial)</span>

<span class="c1">#     conf_list_ = [-1.0, -1.0]</span>
<span class="c1">#     pr_list = [1.0, 0.0]</span>
<span class="c1">#     re_list = [0.0, 1.0]</span>
<span class="c1">#     # conf_list_ = []</span>
<span class="c1">#     # pr_list = []</span>
<span class="c1">#     # re_list = []</span>
<span class="c1">#     for conf, pr, re in pr_re_gen:</span>
<span class="c1">#         conf_list_.append(conf)</span>
<span class="c1">#         pr_list.append(pr)</span>
<span class="c1">#         re_list.append(re)</span>

<span class="c1">#     print(&#39;...complete&#39;)</span>
<span class="c1">#     return conf_list_, pr_list, re_list</span>


<span class="c1"># def detector_precision_recall_algo_worker(conf, uuid_list, gt_dict, pred_dict,</span>
<span class="c1">#                                           kwargs):</span>
<span class="c1">#     tp, fp, fn = 0.0, 0.0, 0.0</span>
<span class="c1">#     for index, uuid_ in enumerate(uuid_list):</span>
<span class="c1">#         if uuid_ in pred_dict:</span>
<span class="c1">#             pred_list = [</span>
<span class="c1">#                 pred</span>
<span class="c1">#                 for pred in pred_dict[uuid_]</span>
<span class="c1">#                 if pred[&#39;confidence&#39;] &gt;= conf</span>
<span class="c1">#             ]</span>
<span class="c1">#             tp_, fp_, fn_ = general_tp_fp_fn(gt_dict[uuid_], pred_list, **kwargs)</span>
<span class="c1">#             tp += tp_</span>
<span class="c1">#             fp += fp_</span>
<span class="c1">#             fn += fn_</span>
<span class="c1">#     pr = tp / (tp + fp)</span>
<span class="c1">#     re = tp / (tp + fn)</span>
<span class="c1">#     return (conf, pr, re)</span>


<span class="c1"># def detector_precision_recall_algo_plot(ibs, **kwargs):</span>
<span class="c1">#     label = kwargs[&#39;label&#39;]</span>
<span class="c1">#     print(&#39;Processing Precision-Recall for: %r&#39; % (label, ))</span>
<span class="c1">#     conf_list, pr_list, re_list = detector_precision_recall_algo(ibs, **kwargs)</span>
<span class="c1">#     return general_area_best_conf(conf_list, re_list, pr_list, **kwargs)</span>


<span class="c1"># def detector_confusion_matrix_algo_plot(ibs, label, color, conf, **kwargs):</span>
<span class="c1">#     print(&#39;Processing Confusion Matrix for: %r (Conf = %0.02f)&#39; % (label, conf, ))</span>

<span class="c1">#     test_gid_list = general_get_imageset_gids(ibs, &#39;TEST_SET&#39;, **kwargs)</span>
<span class="c1">#     uuid_list = ibs.get_image_uuids(test_gid_list)</span>

<span class="c1">#     print(&#39;\tGather Ground-Truth&#39;)</span>
<span class="c1">#     gt_dict = detector_parse_gt(ibs, test_gid_list=test_gid_list)</span>

<span class="c1">#     print(&#39;\tGather Predictions&#39;)</span>
<span class="c1">#     pred_dict = detector_parse_pred(ibs, test_gid_list=test_gid_list, **kwargs)</span>

<span class="c1">#     label_list = []</span>
<span class="c1">#     prediction_list = []</span>
<span class="c1">#     for index, uuid_ in enumerate(uuid_list):</span>
<span class="c1">#         if uuid_ in pred_dict:</span>
<span class="c1">#             gt_list = gt_dict[uuid_]</span>
<span class="c1">#             pred_list = [</span>
<span class="c1">#                 pred</span>
<span class="c1">#                 for pred in pred_dict[uuid_]</span>
<span class="c1">#                 if pred[&#39;confidence&#39;] &gt;= conf</span>
<span class="c1">#             ]</span>
<span class="c1">#             tp, fp, fn = general_tp_fp_fn(gt_list, pred_list, **kwargs)</span>
<span class="c1">#             for _ in range(int(tp)):</span>
<span class="c1">#                 label_list.append(&#39;positive&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;positive&#39;)</span>
<span class="c1">#             for _ in range(int(fp)):</span>
<span class="c1">#                 label_list.append(&#39;negative&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;positive&#39;)</span>
<span class="c1">#             for _ in range(int(fn)):</span>
<span class="c1">#                 label_list.append(&#39;positive&#39;)</span>
<span class="c1">#                 prediction_list.append(&#39;negative&#39;)</span>

<span class="c1">#     category_list = [&#39;positive&#39;, &#39;negative&#39;]</span>
<span class="c1">#     category_mapping = {</span>
<span class="c1">#         &#39;positive&#39;: 0,</span>
<span class="c1">#         &#39;negative&#39;: 1,</span>
<span class="c1">#     }</span>
<span class="c1">#     return general_confusion_matrix_algo(label_list, prediction_list, category_list,</span>
<span class="c1">#                                          category_mapping, **kwargs)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def detector_precision_recall_algo_display(ibs, min_overlap=0.5, figsize=(24, 7), **kwargs):</span>
<span class="c1">#     import matplotlib.pyplot as plt</span>

<span class="c1">#     fig_ = plt.figure(figsize=figsize)</span>

<span class="c1">#     axes_ = plt.subplot(131)</span>
<span class="c1">#     axes_.set_autoscalex_on(False)</span>
<span class="c1">#     axes_.set_autoscaley_on(False)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Recall (Ground-Truth IOU &gt;= %0.02f)&#39; % (min_overlap, ))</span>
<span class="c1">#     axes_.set_ylabel(&#39;Precision&#39;)</span>
<span class="c1">#     axes_.set_xlim([0.0, 1.01])</span>
<span class="c1">#     axes_.set_ylim([0.0, 1.01])</span>

<span class="c1">#     kwargs_list = [</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;min_overlap&#39;            : min_overlap,</span>
<span class="c1">#             &#39;classifier_sensitivity&#39; : 0.64,</span>
<span class="c1">#             &#39;localizer_grid&#39;         : False,</span>
<span class="c1">#             &#39;localizer_sensitivity&#39;  : 0.16,</span>
<span class="c1">#             &#39;labeler_sensitivity&#39;    : 0.42,</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;min_overlap&#39;            : min_overlap,</span>
<span class="c1">#             &#39;classifier_sensitivity&#39; : 0.64,</span>
<span class="c1">#             &#39;localizer_grid&#39;         : False,</span>
<span class="c1">#             &#39;localizer_sensitivity&#39;  : 0.16,</span>
<span class="c1">#             &#39;labeler_sensitivity&#39;    : 0.42,</span>
<span class="c1">#             &#39;check_species&#39;          : True,</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;min_overlap&#39;            : min_overlap,</span>
<span class="c1">#             &#39;classifier_sensitivity&#39; : 0.64,</span>
<span class="c1">#             &#39;localizer_grid&#39;         : False,</span>
<span class="c1">#             &#39;localizer_sensitivity&#39;  : 0.16,</span>
<span class="c1">#             &#39;labeler_sensitivity&#39;    : 0.42,</span>
<span class="c1">#             &#39;check_viewpoint&#39;        : True,</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;min_overlap&#39;            : min_overlap,</span>
<span class="c1">#             &#39;classifier_sensitivity&#39; : 0.04,</span>
<span class="c1">#             &#39;localizer_grid&#39;         : True,</span>
<span class="c1">#             &#39;localizer_sensitivity&#39;  : 0.05,</span>
<span class="c1">#             &#39;labeler_sensitivity&#39;    : 0.39,</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;min_overlap&#39;            : min_overlap,</span>
<span class="c1">#             &#39;classifier_sensitivity&#39; : 0.04,</span>
<span class="c1">#             &#39;localizer_grid&#39;         : True,</span>
<span class="c1">#             &#39;localizer_sensitivity&#39;  : 0.05,</span>
<span class="c1">#             &#39;labeler_sensitivity&#39;    : 0.39,</span>
<span class="c1">#             &#39;check_species&#39;          : True,</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;min_overlap&#39;            : min_overlap,</span>
<span class="c1">#             &#39;classifier_sensitivity&#39; : 0.04,</span>
<span class="c1">#             &#39;localizer_grid&#39;         : True,</span>
<span class="c1">#             &#39;localizer_sensitivity&#39;  : 0.05,</span>
<span class="c1">#             &#39;labeler_sensitivity&#39;    : 0.39,</span>
<span class="c1">#             &#39;check_viewpoint&#39;        : True,</span>
<span class="c1">#         },</span>
<span class="c1">#     ]</span>
<span class="c1">#     label_list = [</span>
<span class="c1">#         &#39;Opt L&#39;,</span>
<span class="c1">#         &#39;Opt L+S&#39;,</span>
<span class="c1">#         &#39;Opt L+S+V&#39;,</span>
<span class="c1">#         &#39;Rec L&#39;,</span>
<span class="c1">#         &#39;Rec L+S&#39;,</span>
<span class="c1">#         &#39;Rec L+S+V&#39;,</span>
<span class="c1">#     ]</span>
<span class="c1">#     color_list = [</span>
<span class="c1">#         &#39;r&#39;,</span>
<span class="c1">#         &#39;b&#39;,</span>
<span class="c1">#         &#39;g&#39;,</span>
<span class="c1">#         &#39;k&#39;,</span>
<span class="c1">#         &#39;y&#39;,</span>
<span class="c1">#         &#39;c&#39;,</span>
<span class="c1">#     ]</span>
<span class="c1">#     ret_list = [</span>
<span class="c1">#         detector_precision_recall_algo_plot(ibs, label=label, color=color, **kwargs_)</span>
<span class="c1">#         for label, color, kwargs_ in zip(label_list, color_list, kwargs_list)</span>
<span class="c1">#     ]</span>

<span class="c1">#     area_list = [ ret[0] for ret in ret_list ]</span>
<span class="c1">#     conf_list = [ ret[1] for ret in ret_list ]</span>
<span class="c1">#     index = np.argmax(area_list)</span>
<span class="c1">#     best_label = label_list[index]</span>
<span class="c1">#     best_kwargs = kwargs_list[index]</span>
<span class="c1">#     best_area = area_list[index]</span>
<span class="c1">#     best_conf = conf_list[index]</span>
<span class="c1">#     plt.title(&#39;Precision-Recall Curve (Best: %s, AP = %0.02f)&#39; % (best_label, best_area, ), y=1.20)</span>
<span class="c1">#     # Display graph</span>
<span class="c1">#     plt.legend(bbox_to_anchor=(0.0, 1.02, 1.0, .102), loc=3, ncol=2, mode=&quot;expand&quot;,</span>
<span class="c1">#                borderaxespad=0.0)</span>

<span class="c1">#     axes_ = plt.subplot(132)</span>
<span class="c1">#     axes_.set_aspect(1)</span>
<span class="c1">#     gca_ = plt.gca()</span>
<span class="c1">#     gca_.grid(False)</span>
<span class="c1">#     correct_rate, _ = detector_confusion_matrix_algo_plot(ibs, &#39;V1&#39;, &#39;r&#39;, conf=best_conf, fig_=fig_, axes_=axes_, **best_kwargs)</span>
<span class="c1">#     axes_.set_xlabel(&#39;Predicted (Correct = %0.02f%%)&#39; % (correct_rate * 100.0, ))</span>
<span class="c1">#     axes_.set_ylabel(&#39;Ground-Truth&#39;)</span>
<span class="c1">#     plt.title(&#39;P-R Confusion Matrix (Algo: %s, OP = %0.02f)&#39; % (best_label, best_conf, ), y=1.26)</span>

<span class="c1">#     best_index = None</span>
<span class="c1">#     best_conf = None</span>
<span class="c1">#     best_pr = 0.0</span>
<span class="c1">#     best_re = 0.0</span>
<span class="c1">#     tup_list  = [ ret[2] for ret in ret_list ]</span>
<span class="c1">#     for index, tup in enumerate(tup_list):</span>
<span class="c1">#         for conf, re, pr in zip(*tup):</span>
<span class="c1">#             if pr &gt; best_pr:</span>
<span class="c1">#                 best_index = index</span>
<span class="c1">#                 best_conf = conf</span>
<span class="c1">#                 best_pr = pr</span>
<span class="c1">#                 best_re = re</span>

<span class="c1">#     if best_index is not None:</span>
<span class="c1">#         axes_ = plt.subplot(131)</span>
<span class="c1">#         plt.plot([best_re], [best_pr], &#39;yo&#39;)</span>

<span class="c1">#         best_label = label_list[best_index]</span>
<span class="c1">#         best_kwargs = kwargs_list[best_index]</span>

<span class="c1">#         axes_ = plt.subplot(133)</span>
<span class="c1">#         axes_.set_aspect(1)</span>
<span class="c1">#         gca_ = plt.gca()</span>
<span class="c1">#         gca_.grid(False)</span>
<span class="c1">#         correct_rate, _ = detector_confusion_matrix_algo_plot(ibs, &#39;V1&#39;, &#39;r&#39;, conf=best_conf, fig_=fig_, axes_=axes_, **best_kwargs)</span>
<span class="c1">#         axes_.set_xlabel(&#39;Predicted (Correct = %0.02f%%)&#39; % (correct_rate * 100.0, ))</span>
<span class="c1">#         axes_.set_ylabel(&#39;Ground-Truth&#39;)</span>
<span class="c1">#         plt.title(&#39;P-R Confusion Matrix (Algo: %s, OP = %0.02f)&#39; % (best_label, best_conf, ), y=1.26)</span>

<span class="c1">#     # plt.show()</span>
<span class="c1">#     fig_filename = &#39;detector-precision-recall-%0.2f.png&#39; % (min_overlap, )</span>
<span class="c1">#     fig_path = abspath(expanduser(join(&#39;~&#39;, &#39;Desktop&#39;, fig_filename)))</span>
<span class="c1">#     plt.savefig(fig_path, bbox_inches=&#39;tight&#39;)</span>


<span class="c1"># @register_ibs_method</span>
<span class="c1"># def detector_metric_graphs(ibs, species_list=[]):</span>
<span class="c1">#     ibs.classifier_precision_recall_algo_display(species_list)</span>
<span class="c1">#     ibs.localizer_precision_recall_algo_display()</span>
<span class="c1">#     ibs.labeler_precision_recall_algo_display()</span>
<span class="c1">#     ibs.detector_precision_recall_algo_display()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.other.detectfuncs</span>
<span class="sd">        python -m ibeis.other.detectfuncs --allexamples</span>
<span class="sd">        python -m ibeis.other.detectfuncs --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Wild Me.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.8.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>