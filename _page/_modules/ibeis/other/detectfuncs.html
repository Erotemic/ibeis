

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.other.detectfuncs &mdash; ibeis 1.5.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ibeis 1.5.2 documentation" href="../../../index.html"/>
        <link rel="up" title="ibeis.other" href="../other.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> ibeis
          

          
          </a>

          
            
            
              <div class="version">
                1.5.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ibeis.html">ibeis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ibeis</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../ibeis.html">ibeis</a> &raquo;</li>
      
          <li><a href="../other.html">ibeis.other</a> &raquo;</li>
      
    <li>ibeis.other.detectfuncs</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ibeis.other.detectfuncs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">developer convenience functions for ibs</span>

<span class="sd">TODO: need to split up into sub modules:</span>
<span class="sd">    consistency_checks</span>
<span class="sd">    feasibility_fixes</span>
<span class="sd">    move the export stuff to dbio</span>

<span class="sd">    then there are also convineience functions that need to be ordered at least</span>
<span class="sd">    within this file</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">expanduser</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">abspath</span>
<span class="kn">import</span> <span class="nn">ibeis.constants</span> <span class="kn">as</span> <span class="nn">const</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">vtool</span> <span class="kn">as</span> <span class="nn">vt</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">detecttools.pypascalmarkup</span> <span class="kn">import</span> <span class="n">PascalVOC_Markup_Annotation</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="s1">&#39;COMMIT TO DETECTTOOLS&#39;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">controller_inject</span>
<span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">annotmatch_funcs</span>  <span class="c1"># NOQA</span>

<span class="c1"># Inject utool functions</span>
<span class="p">(</span><span class="k">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s1">&#39;[other.detectfuncs]&#39;</span><span class="p">)</span>


<span class="c1"># Must import class before injection</span>
<span class="n">CLASS_INJECT_KEY</span><span class="p">,</span> <span class="n">register_ibs_method</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">controller_inject</span><span class="o">.</span><span class="n">make_ibs_register_decorator</span><span class="p">(</span><span class="n">__name__</span><span class="p">))</span>


<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="export_to_xml"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.export_to_xml">[docs]</a><span class="k">def</span> <span class="nf">export_to_xml</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">enforce_yaw</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">purge</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

    <span class="n">current_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="c1"># target_size = 900</span>
    <span class="n">information</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;database_name&#39;</span> <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">datadir</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/LearningData/&#39;</span>
    <span class="n">imagedir</span> <span class="o">=</span> <span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;JPEGImages/&#39;</span>
    <span class="n">annotdir</span> <span class="o">=</span> <span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;Annotations/&#39;</span>
    <span class="n">setsdir</span> <span class="o">=</span> <span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;ImageSets/&#39;</span>
    <span class="n">mainsetsdir</span> <span class="o">=</span> <span class="n">setsdir</span> <span class="o">+</span> <span class="s1">&#39;Main/&#39;</span>
    <span class="k">if</span> <span class="n">purge</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">imagedir</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">annotdir</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">setsdir</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">mainsetsdir</span><span class="p">)</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">sets_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;test&#39;</span>     <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;train&#39;</span>    <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;trainval&#39;</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;val&#39;</span>      <span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span> <span class="k">else</span> <span class="n">offset</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">train_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="s1">&#39;TRAIN_SET&#39;</span><span class="p">)))</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="s1">&#39;TEST_SET&#39;</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">train_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Exporting </span><span class="si">%d</span><span class="s1"> images&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">),))</span>
    <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">:</span>
        <span class="n">yawed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">image_uri</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uris</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">image_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fulldir</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fulldir</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># NOQA</span>
            <span class="n">out_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_</span><span class="si">%06d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_year</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">out_img</span> <span class="o">=</span> <span class="n">out_name</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;IBEIS&quot;</span>

            <span class="n">_image</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">_image</span><span class="o">.</span><span class="n">shape</span>

            <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="n">height</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">width</span>
                <span class="n">decrease</span> <span class="o">=</span> <span class="n">target_size</span> <span class="o">/</span> <span class="n">width</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">target_size</span>
                <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_size</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span>
                <span class="n">decrease</span> <span class="o">=</span> <span class="n">target_size</span> <span class="o">/</span> <span class="n">height</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">target_size</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_size</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>

            <span class="n">dst_img</span> <span class="o">=</span> <span class="n">imagedir</span> <span class="o">+</span> <span class="n">out_img</span>
            <span class="n">_image</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">_image</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
            <span class="n">vt</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">dst_img</span><span class="p">,</span> <span class="n">_image</span><span class="p">)</span>

            <span class="n">annotation</span> <span class="o">=</span> <span class="n">PascalVOC_Markup_Annotation</span><span class="p">(</span><span class="n">dst_img</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">out_img</span><span class="p">,</span>
                                                     <span class="n">source</span><span class="o">=</span><span class="n">image_uri</span><span class="p">,</span>
                                                     <span class="o">**</span><span class="n">information</span><span class="p">)</span>
            <span class="n">bbox_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">theta_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_thetas</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">theta</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">):</span>
                <span class="c1"># Transformation matrix</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">rotation_around_bbox_mat3x3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
                <span class="c1"># Get verticies of the annotation polygon</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">verts_from_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="c1"># Rotate and transform vertices</span>
                <span class="n">xyz_pts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">add_homogenous_coordinate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="n">trans_pts</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">remove_homogenous_coordinate</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz_pts</span><span class="p">))</span>
                <span class="n">new_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">trans_pts</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">x_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">new_verts</span><span class="p">]</span>
                <span class="n">y_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">new_verts</span><span class="p">]</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">*</span> <span class="n">decrease</span><span class="p">)</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span> <span class="o">*</span> <span class="n">decrease</span><span class="p">)</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span> <span class="o">*</span> <span class="n">decrease</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span> <span class="o">*</span> <span class="n">decrease</span><span class="p">)</span>
                <span class="c1"># Bounds check</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1">#TODO: Change species_name to getter in IBEISControl once</span>
                <span class="c1">#implemented</span>
                <span class="c1">#species_name = &#39;grevys_zebra&#39;</span>
                <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">species_name</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="c1"># if species_name not in [&#39;zebra_plains&#39;, &#39;zebra_grevys&#39;]:</span>
                <span class="c1">#     species_name = &#39;unspecified&#39;</span>
                <span class="c1"># yaw = ibs.get_annot_yaw_texts(aid)</span>
                <span class="c1"># if yaw != &#39;&#39; and yaw is not None:</span>
                <span class="c1">#     info[&#39;pose&#39;] = yaw</span>
                <span class="n">yaw</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_yaws</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">yaw</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">yaw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%0.06f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yaw</span><span class="p">,</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">yawed</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;UNVIEWPOINTED: </span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">gid</span><span class="p">)</span>
                <span class="n">annotation</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span>
                    <span class="n">species_name</span><span class="p">,</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),</span> <span class="o">**</span><span class="n">info</span><span class="p">)</span>
            <span class="n">dst_annot</span> <span class="o">=</span> <span class="n">annotdir</span> <span class="o">+</span> <span class="n">out_name</span>  <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span>

            <span class="c1"># # Update sets</span>
            <span class="c1"># state = random.uniform(0.0, 1.0)</span>
            <span class="c1"># if state &lt;= 0.50:</span>
            <span class="c1">#     sets_dict[&#39;test&#39;].append(out_name)</span>
            <span class="c1"># elif state &lt;= 0.75:</span>
            <span class="c1">#     sets_dict[&#39;train&#39;].append(out_name)</span>
            <span class="c1">#     sets_dict[&#39;trainval&#39;].append(out_name)</span>
            <span class="c1"># else:</span>
            <span class="c1">#     sets_dict[&#39;val&#39;].append(out_name)</span>
            <span class="c1">#     sets_dict[&#39;trainval&#39;].append(out_name)</span>

            <span class="k">if</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">test_gid_set</span><span class="p">:</span>
                <span class="n">sets_dict</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">train_gid_set</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">state</span> <span class="o">&lt;=</span> <span class="mf">0.75</span><span class="p">:</span>
                    <span class="n">sets_dict</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_name</span><span class="p">)</span>
                    <span class="n">sets_dict</span><span class="p">[</span><span class="s1">&#39;trainval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sets_dict</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_name</span><span class="p">)</span>
                    <span class="n">sets_dict</span><span class="p">[</span><span class="s1">&#39;trainval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

            <span class="c1"># Write XML</span>
            <span class="k">if</span> <span class="bp">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">enforce_yaw</span> <span class="ow">or</span> <span class="n">yawed</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Copying:</span><span class="se">\n</span><span class="si">%r</span><span class="se">\n</span><span class="si">%r</span><span class="se">\n</span><span class="si">%r</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">image_path</span><span class="p">,</span> <span class="n">dst_img</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="p">))</span>
                <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst_annot</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="n">xml_data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">xml</span><span class="p">())</span>
                <span class="n">xml_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">while</span> <span class="n">exists</span><span class="p">(</span><span class="n">dst_annot</span><span class="p">):</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">out_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_</span><span class="si">%06d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_year</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="p">)</span>
                    <span class="n">dst_annot</span> <span class="o">=</span> <span class="n">annotdir</span> <span class="o">+</span> <span class="n">out_name</span>  <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Skipping:</span><span class="se">\n</span><span class="si">%r</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sets_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mainsetsdir</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">sets_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">sets_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;...completed&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datadir</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="imageset_train_test_split"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.imageset_train_test_split">[docs]</a><span class="k">def</span> <span class="nf">imageset_train_test_split</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">train_split</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
    <span class="n">distro_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">aid_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">distro_dict</span><span class="p">:</span>
            <span class="n">distro_dict</span><span class="p">[</span><span class="n">total</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">distro_dict</span><span class="p">[</span><span class="n">total</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing train/test imagesets...&#39;</span><span class="p">)</span>
    <span class="n">global_train_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_test_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">distro</span><span class="p">,</span> <span class="n">gid_list_</span> <span class="ow">in</span> <span class="n">distro_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list_</span><span class="p">)</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">gid_list_</span><span class="p">)</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="n">total</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">train_split</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1E-9</span>  <span class="c1"># weird</span>
        <span class="k">if</span> <span class="n">split_index</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">split_index</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">split_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">split_index</span><span class="p">)</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_index</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">distro</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">split_index</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">distro: </span><span class="si">%d</span><span class="s1"> - total: </span><span class="si">%d</span><span class="s1"> - split_index: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">train_list</span> <span class="o">=</span> <span class="n">gid_list_</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>
        <span class="n">test_list</span> <span class="o">=</span> <span class="n">gid_list_</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_list</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">test: </span><span class="si">%d</span><span class="se">\n\t</span><span class="s1">train: </span><span class="si">%d</span><span class="se">\n\t</span><span class="s1">split: </span><span class="si">%0.04f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">global_train_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">train_list</span><span class="p">)</span>
        <span class="n">global_test_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">test_list</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">global_train_list</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">global_test_list</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">global_train_list</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_test_list</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">global_train_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">),</span>
        <span class="n">train_split</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">train_imgsetid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_imagesets</span><span class="p">(</span><span class="s1">&#39;TRAIN_SET&#39;</span><span class="p">)</span>
    <span class="n">test_imgsetid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_imagesets</span><span class="p">(</span><span class="s1">&#39;TEST_SET&#39;</span><span class="p">)</span>

    <span class="n">temp_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">train_imgsetid</span><span class="p">)</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_images_and_imagesets</span><span class="p">(</span><span class="n">temp_list</span><span class="p">,</span> <span class="p">[</span><span class="n">train_imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_list</span><span class="p">))</span>
    <span class="n">temp_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">test_imgsetid</span><span class="p">)</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_images_and_imagesets</span><span class="p">(</span><span class="n">temp_list</span><span class="p">,</span> <span class="p">[</span><span class="n">test_imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_list</span><span class="p">))</span>

    <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_imgsetids</span><span class="p">(</span><span class="n">global_train_list</span><span class="p">,</span> <span class="p">[</span><span class="n">train_imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_train_list</span><span class="p">))</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_imgsetids</span><span class="p">(</span><span class="n">global_test_list</span><span class="p">,</span> <span class="p">[</span><span class="n">test_imgsetid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_test_list</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Complete... </span><span class="si">%d</span><span class="s1"> train + </span><span class="si">%d</span><span class="s1"> test = </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%0.04f</span><span class="s1"> </span><span class="si">%0.04f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="localizer_distributions"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_distributions">[docs]</a><span class="k">def</span> <span class="nf">localizer_distributions</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="c1"># Process distributions of densities</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
    <span class="n">distro_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">species_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">aid_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">total</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">distro_dict</span><span class="p">:</span>
            <span class="n">distro_dict</span><span class="p">[</span><span class="n">total</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">distro_dict</span><span class="p">[</span><span class="n">total</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_grevys&#39;</span><span class="p">]:</span>
                <span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;unspecified&#39;</span>
            <span class="n">viewpoint</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_yaw_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">:</span>
                <span class="n">species_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">viewpoint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]:</span>
                <span class="n">species_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">viewpoint</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">viewpoint</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Density distribution&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">distro</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distro_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">distro</span><span class="p">,</span> <span class="n">distro_dict</span><span class="p">[</span><span class="n">distro</span><span class="p">]))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">species_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Species viewpoint distribution: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">viewpoint_dict</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">viewpoint</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">viewpoint_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">viewpoint</span><span class="p">,</span> <span class="n">viewpoint_dict</span><span class="p">[</span><span class="n">viewpoint</span><span class="p">]))</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">viewpoint_dict</span><span class="p">[</span><span class="n">viewpoint</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="p">))</span>

    <span class="n">plot_distrobutions</span><span class="p">(</span><span class="n">distro_dict</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_distrobutions"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.plot_distrobutions">[docs]</a><span class="k">def</span> <span class="nf">plot_distrobutions</span><span class="p">(</span><span class="n">distro_dict</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">key_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distro_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;7+&#39;</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">7</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span> <span class="p">]</span>
    <span class="n">size_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">distro_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span> <span class="p">]</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="s1">&#39;lightskyblue&#39;</span><span class="p">,</span> <span class="s1">&#39;lightcoral&#39;</span><span class="p">]</span>
    <span class="n">explode</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">size_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">size_list</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="n">explode</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">label_list</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span>
            <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="general_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">general_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="n">category</span> <span class="ow">and</span> <span class="n">conf</span> <span class="o">&lt;=</span> <span class="n">confidence</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">!=</span> <span class="n">category</span> <span class="ow">and</span> <span class="n">conf</span> <span class="o">&lt;=</span> <span class="n">confidence</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">error_list</span>

    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">))</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">conf_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">conf_list</span><span class="p">:</span>
        <span class="n">conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>

    <span class="n">conf_list_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">tpr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">fpr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="n">conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">error_list</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">re</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">tpr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">fpr</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">pr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
        <span class="n">tpr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
        <span class="n">fpr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span>

</div>
<div class="viewcode-block" id="general_identify_operating_point"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_identify_operating_point">[docs]</a><span class="k">def</span> <span class="nf">general_identify_operating_point</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">x_limit</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
    <span class="n">best_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_conf_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_x_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_y_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">):</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">invert</span> <span class="k">else</span> <span class="n">x</span>
        <span class="k">if</span> <span class="n">x_</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">x_limit</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">y_</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_</span> <span class="o">*</span> <span class="n">x_</span> <span class="o">+</span> <span class="n">y_</span> <span class="o">*</span> <span class="n">y_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">best_length</span><span class="p">:</span>
            <span class="n">best_length</span> <span class="o">=</span> <span class="n">length</span>
            <span class="n">best_conf_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">conf</span><span class="p">]</span>
            <span class="n">best_x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">best_y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="n">best_length</span><span class="p">:</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">abs</span><span class="p">(</span><span class="n">best_conf</span> <span class="o">-</span> <span class="n">conf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="k">for</span> <span class="n">best_conf</span> <span class="ow">in</span> <span class="n">best_conf_list</span> <span class="p">]</span>
            <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="n">flag_list</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">best_conf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
            <span class="n">best_x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">best_y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">best_conf_list</span><span class="p">,</span> <span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span>

</div>
<div class="viewcode-block" id="general_area_best_conf"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_area_best_conf">[docs]</a><span class="k">def</span> <span class="nf">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">x_limit</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">best_conf_list</span><span class="p">,</span> <span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span> <span class="o">=</span> <span class="n">general_identify_operating_point</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span> <span class="n">x_limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="n">best_conf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># best_conf_list_ = &#39;,&#39;.join([ &#39;%0.02f&#39; % (conf, ) for conf in best_conf_list ])</span>
    <span class="c1"># label = &#39;%s [OP = %s]&#39; % (label, best_conf_list_, )</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [OP = </span><span class="si">%0.02f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_x_list</span><span class="p">,</span> <span class="n">best_y_list</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">o&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y_list</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_conf_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf_list</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="n">general_identify_operating_point</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">x_limit</span><span class="o">=</span><span class="n">x_limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">area</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="n">tup</span>

</div>
<div class="viewcode-block" id="general_confusion_matrix_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_confusion_matrix_algo">[docs]</a><span class="k">def</span> <span class="nf">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_correct_list</span><span class="p">,</span> <span class="n">label_predict_list</span><span class="p">,</span>
                                  <span class="n">category_list</span><span class="p">,</span> <span class="n">category_mapping</span><span class="p">,</span>
                                  <span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="p">,</span> <span class="n">fuzzy_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                  <span class="n">conf_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># import matplotlib.colors as colors</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">suppressed_label</span> <span class="o">=</span> <span class="s1">&#39;SUP&#39;</span>
    <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">conf_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="n">category_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suppressed_label</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">category_mapping</span><span class="p">[</span><span class="n">suppressed_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">fuzzy_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="c1"># Get the number of categories</span>
    <span class="n">num_categories</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span>

    <span class="c1"># Build the confusion matrix</span>
    <span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_categories</span><span class="p">,</span> <span class="n">num_categories</span><span class="p">))</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">label_correct_list</span><span class="p">,</span> <span class="n">label_predict_list</span><span class="p">)</span>
    <span class="n">suppressed</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">suppressed_correct</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">suppressed_fuzzy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">label_correct</span><span class="p">,</span> <span class="n">label_predict</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf_</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">conf_</span> <span class="o">&lt;</span> <span class="n">conf</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label_correct</span> <span class="o">!=</span> <span class="n">label_predict</span><span class="p">:</span>
                    <span class="n">suppressed_correct</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">fuzzy_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_correct</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_predict</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">y</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
                        <span class="n">suppressed_fuzzy</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">label_predict</span> <span class="o">=</span> <span class="n">suppressed_label</span>
                <span class="n">suppressed</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Perform any mapping that needs to be done</span>
        <span class="n">correct_</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_correct</span><span class="p">]</span>
        <span class="n">predict_</span> <span class="o">=</span> <span class="n">category_mapping</span><span class="p">[</span><span class="n">label_predict</span><span class="p">]</span>
        <span class="c1"># Add to the confidence matrix</span>
        <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">correct_</span><span class="p">][</span><span class="n">predict_</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Normalize the confusion matrix using the rows</span>
    <span class="n">row_normalizer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">confusion_normalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">confusion_matrix</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">row_normalizer</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># Draw the confusion matrix</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">axes_</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_normalized</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="n">suppressed_correct</span>
    <span class="n">fuzzy</span> <span class="o">=</span> <span class="n">suppressed_fuzzy</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_categories</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_categories</span><span class="p">):</span>
            <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">correct</span> <span class="o">+=</span> <span class="n">number</span>
            <span class="k">if</span> <span class="n">fuzzy_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
                <span class="n">fuzzy</span> <span class="o">+=</span> <span class="n">number</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">number</span>
            <span class="n">axes_</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span>
            <span class="p">)</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">fig_</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># NOQA</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_categories</span><span class="p">),</span> <span class="n">category_list</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_categories</span><span class="p">),</span> <span class="n">category_list</span><span class="p">)</span>
    <span class="n">margin_small</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">margin_large</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">margin_small</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="n">margin_large</span><span class="p">,</span>
        <span class="n">bottom</span><span class="o">=</span><span class="n">margin_small</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="n">margin_large</span>
    <span class="p">)</span>

    <span class="n">correct_rate</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">fuzzy_rate</span> <span class="o">=</span> <span class="n">fuzzy</span> <span class="o">/</span> <span class="n">total</span>
    <span class="k">return</span> <span class="n">correct_rate</span><span class="p">,</span> <span class="n">fuzzy_rate</span>

</div>
<div class="viewcode-block" id="general_intersection_over_union"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_intersection_over_union">[docs]</a><span class="k">def</span> <span class="nf">general_intersection_over_union</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">):</span>
    <span class="n">x_overlap</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;xtl&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;xtl&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span> <span class="o">-</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;xtl&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;xtl&#39;</span><span class="p">]))</span>
    <span class="n">y_overlap</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;ytl&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;ytl&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="o">-</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;ytl&#39;</span><span class="p">],</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;ytl&#39;</span><span class="p">]))</span>
    <span class="n">intersection</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_overlap</span> <span class="o">*</span> <span class="n">y_overlap</span><span class="p">)</span>
    <span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bbox1</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bbox2</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">intersection</span>
    <span class="k">return</span> <span class="n">intersection</span> <span class="o">/</span> <span class="n">union</span>

</div>
<div class="viewcode-block" id="general_overlap"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_overlap">[docs]</a><span class="k">def</span> <span class="nf">general_overlap</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred_list</span><span class="p">):</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">gt_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gt_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_list</span><span class="p">):</span>
            <span class="n">overlap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">general_intersection_over_union</span><span class="p">(</span><span class="n">gt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">overlap</span>

</div>
<div class="viewcode-block" id="general_tp_fp_fn"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_tp_fp_fn">[docs]</a><span class="k">def</span> <span class="nf">general_tp_fp_fn</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred_list</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="n">duplicate_assign</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">check_species</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">check_viewpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">general_overlap</span><span class="p">(</span><span class="n">gt_list</span><span class="p">,</span> <span class="n">pred_list</span><span class="p">)</span>
    <span class="n">num_gt</span><span class="p">,</span> <span class="n">num_pred</span> <span class="o">=</span> <span class="n">overlap</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">num_gt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">num_pred</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">num_pred</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">num_gt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_overlap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_overlap</span><span class="p">[</span><span class="n">max_overlap</span> <span class="o">&lt;</span> <span class="n">min_overlap</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">assignment_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">i</span> <span class="p">:</span> <span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gt</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_overlap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignment_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># Fix where multiple GT claim the same prediction</span>
        <span class="k">if</span> <span class="n">tp</span> <span class="o">&gt;</span> <span class="n">num_pred</span><span class="p">:</span>
            <span class="n">index_list_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">assignment_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_list_</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">assignment_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignment_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">check_species</span> <span class="ow">or</span> <span class="n">check_viewpoint</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gt</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">assignment_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="c1"># print(gt_list[gt][&#39;species&#39;], pred_list[pred][&#39;species&#39;])</span>
                <span class="c1"># print(gt_list[gt][&#39;viewpoint&#39;], pred_list[pred][&#39;viewpoint&#39;])</span>
                <span class="k">if</span> <span class="n">gt_list</span><span class="p">[</span><span class="n">gt</span><span class="p">][</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pred_list</span><span class="p">[</span><span class="n">pred</span><span class="p">][</span><span class="s1">&#39;species&#39;</span><span class="p">]:</span>
                    <span class="n">tp</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">check_viewpoint</span> <span class="ow">and</span> <span class="n">gt_list</span><span class="p">[</span><span class="n">gt</span><span class="p">][</span><span class="s1">&#39;viewpoint&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pred_list</span><span class="p">[</span><span class="n">pred</span><span class="p">][</span><span class="s1">&#39;viewpoint&#39;</span><span class="p">]:</span>
                    <span class="n">tp</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">num_pred</span> <span class="o">-</span> <span class="n">tp</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">num_gt</span> <span class="o">-</span> <span class="n">tp</span>
    <span class="k">return</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span>

</div>
<div class="viewcode-block" id="general_parse_gt"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.general_parse_gt">[docs]</a><span class="k">def</span> <span class="nf">general_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">)</span>

    <span class="n">gt_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">):</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;species&#39;</span>    <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">),</span>
                <span class="s1">&#39;viewpoint&#39;</span>  <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_yaw_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">),</span>
                <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list</span>
    <span class="k">return</span> <span class="n">gt_dict</span>

</div>
<div class="viewcode-block" id="localizer_parse_pred"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_parse_pred">[docs]</a><span class="k">def</span> <span class="nf">localizer_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>

    <span class="k">if</span> <span class="n">test_gid_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="n">results_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;localizations&#39;</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">size_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>
    <span class="n">zipped_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">results_list</span><span class="p">)</span>
    <span class="c1"># Reformat results for json</span>
    <span class="n">results_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;theta&#39;</span>      <span class="p">:</span> <span class="n">theta</span><span class="p">,</span>  <span class="c1"># round(theta, 4),</span>
                <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="n">conf</span><span class="p">,</span>   <span class="c1"># round(conf, 4),</span>
                <span class="c1"># &#39;class&#39;      : class_,</span>
                <span class="s1">&#39;species&#39;</span>    <span class="p">:</span> <span class="n">class_</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">class_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">zipped</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">zipped</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">zipped_list</span><span class="p">,</span> <span class="n">size_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">pred_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">uuid_</span> <span class="p">:</span> <span class="n">result_list</span>
        <span class="k">for</span> <span class="n">uuid_</span><span class="p">,</span> <span class="n">result_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">results_list</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">pred_dict</span>

</div>
<div class="viewcode-block" id="localizer_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">force_serial</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># test_gid_set = ibs.get_imageset_gids(ibs.get_imageset_imgsetids_from_text(&#39;TEST_SET&#39;))</span>
    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="n">general_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Predictions&#39;</span><span class="p">)</span>
    <span class="n">pred_dict</span> <span class="o">=</span> <span class="n">localizer_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Generate Curves...&#39;</span><span class="p">)</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">uuid_list_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">uuid_list</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">gt_dict_list</span>   <span class="o">=</span> <span class="p">[</span> <span class="n">gt_dict</span>   <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">pred_dict_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pred_dict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">kwargs_list</span>    <span class="o">=</span> <span class="p">[</span> <span class="n">kwargs</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">arg_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">uuid_list_list</span><span class="p">,</span> <span class="n">gt_dict_list</span><span class="p">,</span> <span class="n">pred_dict_list</span><span class="p">,</span> <span class="n">kwargs_list</span><span class="p">)</span>
    <span class="n">pr_re_gen</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">localizer_precision_recall_algo_worker</span><span class="p">,</span> <span class="n">arg_iter</span><span class="p">,</span>
                            <span class="n">nTasks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">conf_list</span><span class="p">),</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">force_serial</span><span class="o">=</span><span class="n">force_serial</span><span class="p">)</span>

    <span class="n">conf_list_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">pr_re_gen</span><span class="p">:</span>
        <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">pr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;...complete&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span>

</div>
<div class="viewcode-block" id="localizer_precision_recall_algo_worker"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_worker">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo_worker</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
    <span class="n">conf</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">,</span> <span class="n">gt_dict</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">tup</span>
    <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">:</span>
            <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">pred</span>
                <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pred</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">conf</span>
            <span class="p">]</span>
            <span class="n">tp_</span><span class="p">,</span> <span class="n">fp_</span><span class="p">,</span> <span class="n">fn_</span> <span class="o">=</span> <span class="n">general_tp_fp_fn</span><span class="p">(</span><span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">],</span> <span class="n">temp_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">tp</span> <span class="o">+=</span> <span class="n">tp_</span>
            <span class="n">fp</span> <span class="o">+=</span> <span class="n">fp_</span>
            <span class="n">fn</span> <span class="o">+=</span> <span class="n">fn_</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">re</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">re</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="localizer_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span> <span class="o">=</span> <span class="n">localizer_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="localizer_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">localizer_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1"> (Conf = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="p">))</span>

    <span class="c1"># test_gid_set = ibs.get_imageset_gids(ibs.get_imageset_imgsetids_from_text(&#39;TEST_SET&#39;))</span>
    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="n">general_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Predictions&#39;</span><span class="p">)</span>
    <span class="n">pred_dict</span> <span class="o">=</span> <span class="n">localizer_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">:</span>
            <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">pred</span>
                <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pred</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">conf</span>
            <span class="p">]</span>
            <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">general_tp_fp_fn</span><span class="p">(</span><span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">],</span> <span class="n">temp_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tp</span><span class="p">)):</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
                <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fp</span><span class="p">)):</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">)</span>
                <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fn</span><span class="p">)):</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
                <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">)</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">]</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                         <span class="n">category_mapping</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="localizer_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_display">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall (Ground-Truth IOU &gt;= </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>

    <span class="n">kwargs_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;min_overlap&#39;</span> <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;min_overlap&#39;</span> <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;min_overlap&#39;</span> <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;min_overlap&#39;</span> <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>  <span class="s1">&#39;config_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;weight_filepath&#39;</span> <span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">},</span>
    <span class="p">]</span>
    <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Retrained&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Retrained (GRID)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Original&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Original (GRID)&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ret_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ret_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ret_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">ret_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localizer_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
    <span class="n">best_name</span> <span class="o">=</span> <span class="n">name_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_kwargs</span> <span class="o">=</span> <span class="n">kwargs_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_area</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve (Best: </span><span class="si">%s</span><span class="s1">, mAP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_name</span><span class="p">,</span> <span class="n">best_area</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.13</span><span class="p">)</span>
    <span class="c1"># Display graph</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">localizer_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span> <span class="o">**</span><span class="n">best_kwargs</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (Algo: </span><span class="si">%s</span><span class="s1">, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_name</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.26</span><span class="p">)</span>

    <span class="n">best_index</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">best_pr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_re</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tup_list</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">tup</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tup_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pr</span> <span class="o">&gt;</span> <span class="n">best_pr</span><span class="p">:</span>
                <span class="n">best_index</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf</span>
                <span class="n">best_pr</span> <span class="o">=</span> <span class="n">pr</span>
                <span class="n">best_re</span> <span class="o">=</span> <span class="n">re</span>

    <span class="k">if</span> <span class="n">best_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">best_re</span><span class="p">],</span> <span class="p">[</span><span class="n">best_pr</span><span class="p">],</span> <span class="s1">&#39;yo&#39;</span><span class="p">)</span>

        <span class="n">best_name</span> <span class="o">=</span> <span class="n">name_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
        <span class="n">best_kwargs</span> <span class="o">=</span> <span class="n">kwargs_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>

        <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">localizer_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span> <span class="o">**</span><span class="n">best_kwargs</span><span class="p">)</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (Algo: </span><span class="si">%s</span><span class="s1">, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_name</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.26</span><span class="p">)</span>

    <span class="c1"># plt.show()</span>
    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;localizer-precision-recall-</span><span class="si">%0.2f</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="localizer_precision_recall_algo_display_animate"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_precision_recall_algo_display_animate">[docs]</a><span class="k">def</span> <span class="nf">localizer_precision_recall_algo_display_animate</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">min_overlap</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">localizer_precision_recall_algo_display</span><span class="p">(</span><span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="classifier_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">classifier_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>
    <span class="n">category_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_grevys&#39;</span><span class="p">])</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
    <span class="n">species_set_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">aid_list</span> <span class="ow">in</span> <span class="n">aids_list</span>
    <span class="p">]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;negative&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_set</span> <span class="o">&amp;</span> <span class="n">category_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;positive&#39;</span>
        <span class="k">for</span> <span class="n">species_set</span> <span class="ow">in</span> <span class="n">species_set_list</span>
    <span class="p">]</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">)</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">confidence</span> <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">confidence</span>
        <span class="k">for</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prediction_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">general_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="classifier_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">classifier_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="classifier_roc_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_roc_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;invert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing ROC for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">classifier_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">fpr_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="classifier_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">classifier_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1"> (Conf = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>
    <span class="n">category_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_grevys&#39;</span><span class="p">])</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
    <span class="n">species_set_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">aid_list</span> <span class="ow">in</span> <span class="n">aids_list</span>
    <span class="p">]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;negative&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_set</span> <span class="o">&amp;</span> <span class="n">category_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;positive&#39;</span>
        <span class="k">for</span> <span class="n">species_set</span> <span class="ow">in</span> <span class="n">species_set_list</span>
    <span class="p">]</span>
    <span class="n">confidence_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">)</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="n">conf</span> <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
        <span class="k">for</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="n">confidence_list</span>
    <span class="p">]</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">]</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                         <span class="n">category_mapping</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="classifier_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_precision_recall_algo_display">[docs]</a><span class="k">def</span> <span class="nf">classifier_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">area</span><span class="p">,</span> <span class="n">best_conf1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classifier_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve (mAP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">area</span><span class="p">,</span> <span class="n">best_conf2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classifier_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve (mAP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classifier_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf1</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf1</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.12</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classifier_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf2</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Confusion Matrix (OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf2</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.12</span><span class="p">)</span>

    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;classifier-precision-recall-roc.png&#39;</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="labeler_tp_tn_fp_fn"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_tp_tn_fp_fn">[docs]</a><span class="k">def</span> <span class="nf">labeler_tp_tn_fp_fn</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ibeis.algo.detect.labeler.model</span> <span class="kn">import</span> <span class="n">label_list</span> <span class="k">as</span> <span class="n">category_list</span>

    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="n">category</span> <span class="ow">and</span> <span class="n">conf</span> <span class="o">&lt;=</span> <span class="n">confidence</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">!=</span> <span class="n">category</span> <span class="ow">and</span> <span class="n">conf</span> <span class="o">&lt;=</span> <span class="n">confidence</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">!=</span> <span class="n">category</span><span class="p">:</span>
                <span class="n">error_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">error_list</span>

    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
    <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
    <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
    <span class="n">yaw_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_yaw_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
    <span class="n">category_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_grevys&#39;</span><span class="p">])</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="p">)</span> <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">category_set</span> <span class="k">else</span> <span class="s1">&#39;ignore&#39;</span>
        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">yaw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species_list</span><span class="p">,</span> <span class="n">yaw_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">probability_dict_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;labeler&#39;</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="s1">&#39;probs&#39;</span><span class="p">)</span>
    <span class="n">probability_dict_list</span> <span class="o">=</span> <span class="n">probability_dict_list</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>

    <span class="n">label_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">conf_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confidence_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">probability_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">probability_dict</span> <span class="ow">in</span> <span class="n">probability_dict_list</span>
        <span class="p">]</span>
        <span class="n">zipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">conf_list</span><span class="p">:</span>
            <span class="n">conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
        <span class="n">label_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_dict</span>
    <span class="k">return</span> <span class="n">label_dict</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="labeler_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">labeler_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span> <span class="n">label_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">global_conf_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">:</span>
        <span class="n">conf_dict</span> <span class="o">=</span> <span class="n">label_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">conf_dict</span><span class="p">:</span>
            <span class="n">new_list</span> <span class="o">=</span> <span class="n">conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">conf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_conf_dict</span><span class="p">:</span>
                <span class="n">global_conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_list</span> <span class="o">=</span> <span class="n">global_conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span>
                <span class="n">zipped_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cur_list</span><span class="p">,</span> <span class="n">new_list</span><span class="p">)</span>
                <span class="n">global_conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur</span> <span class="o">+</span> <span class="n">new</span> <span class="k">for</span> <span class="n">cur</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">zipped_</span><span class="p">]</span>

    <span class="n">conf_list_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">tpr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">fpr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">global_conf_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="n">global_conf_dict</span><span class="p">[</span><span class="n">conf</span><span class="p">]</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">error_list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">re</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">tpr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">fpr</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">bad conf </span><span class="si">%0.05f</span><span class="s1"> - </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="p">))</span>
            <span class="k">continue</span>
        <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">pr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
        <span class="n">tpr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
        <span class="n">fpr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span>

</div>
<div class="viewcode-block" id="labeler_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">labeler_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">category_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;category_list&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1"> (category_list = </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">labeler_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="labeler_roc_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_roc_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">labeler_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="n">category_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;category_list&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;invert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing ROC for: </span><span class="si">%r</span><span class="s1"> (category_list = </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="n">fpr_list</span> <span class="o">=</span> <span class="n">labeler_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">fpr_list</span><span class="p">,</span> <span class="n">tpr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="labeler_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">labeler_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">simpler</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;IGNORE&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;PZ&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;zebra_grevys&#39;</span><span class="p">,</span> <span class="s1">&#39;GZ&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;frontleft&#39;</span><span class="p">,</span>    <span class="s1">&#39;FL&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;frontright&#39;</span><span class="p">,</span>   <span class="s1">&#39;FR&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;backleft&#39;</span><span class="p">,</span>     <span class="s1">&#39;BL&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;backright&#39;</span><span class="p">,</span>    <span class="s1">&#39;BR&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">,</span>        <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;back&#39;</span><span class="p">,</span>         <span class="s1">&#39;B&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>         <span class="s1">&#39;L&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>        <span class="s1">&#39;R&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span>

    <span class="kn">from</span> <span class="nn">ibeis.algo.detect.labeler.model</span> <span class="kn">import</span> <span class="n">label_list</span> <span class="k">as</span> <span class="n">category_list</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_annot</span>
    <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
    <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
    <span class="n">yaw_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_yaw_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
    <span class="n">category_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_grevys&#39;</span><span class="p">])</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="p">)</span> <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">category_set</span> <span class="k">else</span> <span class="s1">&#39;ignore&#39;</span>
        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">yaw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species_list</span><span class="p">,</span> <span class="n">yaw_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;labeler&#39;</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">)</span>
    <span class="n">species_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;labeler&#39;</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">)</span>
    <span class="n">yaw_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;labeler&#39;</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="s1">&#39;viewpoint&#39;</span><span class="p">)</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="p">)</span> <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">category_set</span> <span class="k">else</span> <span class="s1">&#39;ignore&#39;</span>
        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">yaw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species_list</span><span class="p">,</span> <span class="n">yaw_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">simpler</span><span class="p">,</span> <span class="n">category_list</span><span class="p">)</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">simpler</span><span class="p">,</span> <span class="n">label_list</span><span class="p">)</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">simpler</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">)</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                                 <span class="n">category_mapping</span><span class="p">,</span> <span class="n">conf_list</span><span class="o">=</span><span class="n">conf_list</span><span class="p">,</span>
                                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="labeler_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_precision_recall_algo_display">[docs]</a><span class="k">def</span> <span class="nf">labeler_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">ibeis.algo.detect.labeler.model</span> <span class="kn">import</span> <span class="n">label_list</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Compiling raw numebrs...&#39;</span><span class="p">)</span>
    <span class="n">label_dict</span> <span class="o">=</span> <span class="n">labeler_tp_tn_fp_fn</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">category_color_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="bp">None</span>          <span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;All&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;:&#39;</span>           <span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;Zebras&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;zebra_plains&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;Plains Only&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;zebra_grevys&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;Grevy</span><span class="se">\&#39;</span><span class="s1">s Only&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ignore&#39;</span>      <span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;Ignore Only&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>  <span class="c1"># NOQA</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label_</span> <span class="ow">in</span> <span class="n">category_color_list</span><span class="p">:</span>
        <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_list</span> <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">label</span> <span class="p">]</span>
        <span class="n">area</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">labeler_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">category_list</span><span class="o">=</span><span class="n">category_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label_dict</span><span class="o">=</span><span class="n">label_dict</span><span class="p">)</span>
        <span class="n">area_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
        <span class="n">conf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
    <span class="n">best_area</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve (Algo: All, mAP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_area</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True-Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label_</span> <span class="ow">in</span> <span class="n">category_color_list</span><span class="p">:</span>
        <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_list</span> <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">label</span> <span class="p">]</span>
        <span class="n">area</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">labeler_roc_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">category_list</span><span class="o">=</span><span class="n">category_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label_dict</span><span class="o">=</span><span class="n">label_dict</span><span class="p">)</span>
        <span class="n">area_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
        <span class="n">conf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
    <span class="n">best_area</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve (Algo: All, mAP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_area</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">fuzzy_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index1</span><span class="p">,</span> <span class="n">label1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label1</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
            <span class="n">fuzzy_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">species</span><span class="p">,</span> <span class="n">viewpoint</span> <span class="o">=</span> <span class="n">label1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">fuzzy_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index2</span><span class="p">,</span> <span class="n">label2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">label2</span><span class="p">:</span>
                    <span class="n">fuzzy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index2</span><span class="p">)</span>
        <span class="n">fuzzy_dict</span><span class="p">[</span><span class="n">index1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fuzzy_list</span><span class="p">)</span>
    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">fuzzy_rate</span> <span class="o">=</span> <span class="n">labeler_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span> <span class="n">fuzzy_dict</span><span class="o">=</span><span class="n">fuzzy_dict</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">, Species = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">fuzzy_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">fuzzy_rate</span> <span class="o">=</span> <span class="n">labeler_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span> <span class="n">fuzzy_dict</span><span class="o">=</span><span class="n">fuzzy_dict</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">, Species = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">fuzzy_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (Algo: All, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_conf</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">)</span>

    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;labeler-precision-recall-roc.png&#39;</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="detector_parse_gt"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_parse_gt">[docs]</a><span class="k">def</span> <span class="nf">detector_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_gid_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>
    <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">)</span>

    <span class="n">gt_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">):</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;species&#39;</span>    <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">),</span>
                <span class="s1">&#39;viewpoint&#39;</span>  <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_yaw_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">),</span>
                <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zebra_grevys&#39;</span><span class="p">,</span> <span class="s1">&#39;zebra_plains&#39;</span><span class="p">]:</span>
                <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">UNKNOWN</span>
                <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;viewpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list</span>
    <span class="k">return</span> <span class="n">gt_dict</span>

</div>
<div class="viewcode-block" id="detector_parse_pred"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_parse_pred">[docs]</a><span class="k">def</span> <span class="nf">detector_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">depc</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">depc_image</span>

    <span class="k">if</span> <span class="n">test_gid_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_gids</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_imageset_imgsetids_from_text</span><span class="p">(</span><span class="s1">&#39;TEST_SET&#39;</span><span class="p">))</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="c1"># depc.delete_property(&#39;detections&#39;, test_gid_set, config=kwargs)</span>
    <span class="n">results_list</span> <span class="o">=</span> <span class="n">depc</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;detections&#39;</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">size_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>
    <span class="n">zipped_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">results_list</span><span class="p">)</span>
    <span class="c1"># Reformat results for json</span>
    <span class="n">results_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;xtl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;ytl&#39;</span>        <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span>      <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span>     <span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span><span class="p">,</span>
                <span class="s1">&#39;theta&#39;</span>      <span class="p">:</span> <span class="n">theta</span><span class="p">,</span>  <span class="c1"># round(theta, 4),</span>
                <span class="s1">&#39;confidence&#39;</span> <span class="p">:</span> <span class="n">conf</span><span class="p">,</span>   <span class="c1"># round(conf, 4),</span>
                <span class="s1">&#39;species&#39;</span>    <span class="p">:</span> <span class="n">species_</span><span class="p">,</span>
                <span class="s1">&#39;viewpoint&#39;</span>  <span class="p">:</span> <span class="n">viewpoint</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">species_</span><span class="p">,</span> <span class="n">viewpoint</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">zipped</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">zipped</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">zipped_list</span><span class="p">,</span> <span class="n">size_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">pred_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">uuid_</span> <span class="p">:</span> <span class="n">result_list</span>
        <span class="k">for</span> <span class="n">uuid_</span><span class="p">,</span> <span class="n">result_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">results_list</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1"># print(pred_dict)</span>
    <span class="k">return</span> <span class="n">pred_dict</span>

</div>
<div class="viewcode-block" id="detector_precision_recall_algo"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_precision_recall_algo">[docs]</a><span class="k">def</span> <span class="nf">detector_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">force_serial</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># test_gid_set = ibs.get_imageset_gids(ibs.get_imageset_imgsetids_from_text(&#39;TEST_SET&#39;))</span>
    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="n">detector_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Predictions&#39;</span><span class="p">)</span>
    <span class="n">pred_dict</span> <span class="o">=</span> <span class="n">detector_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Generate Curves...&#39;</span><span class="p">)</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">uuid_list_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">uuid_list</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">gt_dict_list</span>   <span class="o">=</span> <span class="p">[</span> <span class="n">gt_dict</span>   <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">pred_dict_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pred_dict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">kwargs_list</span>    <span class="o">=</span> <span class="p">[</span> <span class="n">kwargs</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">conf_list</span> <span class="p">]</span>
    <span class="n">arg_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">uuid_list_list</span><span class="p">,</span> <span class="n">gt_dict_list</span><span class="p">,</span> <span class="n">pred_dict_list</span><span class="p">,</span> <span class="n">kwargs_list</span><span class="p">)</span>
    <span class="n">pr_re_gen</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">detector_precision_recall_algo_worker</span><span class="p">,</span> <span class="n">arg_iter</span><span class="p">,</span>
                            <span class="n">nTasks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">conf_list</span><span class="p">),</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">force_serial</span><span class="o">=</span><span class="n">force_serial</span><span class="p">)</span>

    <span class="n">conf_list_</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">pr_re_gen</span><span class="p">:</span>
        <span class="n">conf_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">pr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;...complete&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conf_list_</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span>

</div>
<div class="viewcode-block" id="detector_precision_recall_algo_worker"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_precision_recall_algo_worker">[docs]</a><span class="k">def</span> <span class="nf">detector_precision_recall_algo_worker</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
    <span class="n">conf</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">,</span> <span class="n">gt_dict</span><span class="p">,</span> <span class="n">pred_dict</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">tup</span>
    <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">:</span>
            <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">pred</span>
                <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pred</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">conf</span>
            <span class="p">]</span>
            <span class="n">tp_</span><span class="p">,</span> <span class="n">fp_</span><span class="p">,</span> <span class="n">fn_</span> <span class="o">=</span> <span class="n">general_tp_fp_fn</span><span class="p">(</span><span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">],</span> <span class="n">temp_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">tp</span> <span class="o">+=</span> <span class="n">tp_</span>
            <span class="n">fp</span> <span class="o">+=</span> <span class="n">fp_</span>
            <span class="n">fn</span> <span class="o">+=</span> <span class="n">fn_</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">re</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">re</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="detector_precision_recall_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_precision_recall_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">detector_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Precision-Recall for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">conf_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="n">re_list</span> <span class="o">=</span> <span class="n">detector_precision_recall_algo</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">general_area_best_conf</span><span class="p">(</span><span class="n">conf_list</span><span class="p">,</span> <span class="n">re_list</span><span class="p">,</span> <span class="n">pr_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="detector_confusion_matrix_algo_plot"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_confusion_matrix_algo_plot">[docs]</a><span class="k">def</span> <span class="nf">detector_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing Confusion Matrix for: </span><span class="si">%r</span><span class="s1"> (Conf = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="p">))</span>

    <span class="c1"># test_gid_set = ibs.get_imageset_gids(ibs.get_imageset_imgsetids_from_text(&#39;TEST_SET&#39;))</span>
    <span class="n">test_gid_set</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">gt_dict</span> <span class="o">=</span> <span class="n">detector_parse_gt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Gather Predictions&#39;</span><span class="p">)</span>
    <span class="n">pred_dict</span> <span class="o">=</span> <span class="n">detector_parse_pred</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">test_gid_set</span><span class="o">=</span><span class="n">test_gid_set</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prediction_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">uuid_</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">:</span>
            <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">pred</span>
                <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pred</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">conf</span>
            <span class="p">]</span>
            <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">general_tp_fp_fn</span><span class="p">(</span><span class="n">gt_dict</span><span class="p">[</span><span class="n">uuid_</span><span class="p">],</span> <span class="n">temp_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tp</span><span class="p">)):</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
                <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fp</span><span class="p">)):</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">)</span>
                <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fn</span><span class="p">)):</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
                <span class="n">prediction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;negative&#39;</span><span class="p">)</span>

    <span class="n">category_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">]</span>
    <span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">general_confusion_matrix_algo</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">prediction_list</span><span class="p">,</span> <span class="n">category_list</span><span class="p">,</span>
                                         <span class="n">category_mapping</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="detector_precision_recall_algo_display"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_precision_recall_algo_display">[docs]</a><span class="k">def</span> <span class="nf">detector_precision_recall_algo_display</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

    <span class="n">fig_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_autoscaley_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall (Ground-Truth IOU &gt;= </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>

    <span class="n">kwargs_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;min_overlap&#39;</span>            <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span>
            <span class="s1">&#39;classifier_sensitivity&#39;</span> <span class="p">:</span> <span class="mf">0.64</span><span class="p">,</span>
            <span class="s1">&#39;localizer_grid&#39;</span>         <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s1">&#39;localizer_sensitivity&#39;</span>  <span class="p">:</span> <span class="mf">0.16</span><span class="p">,</span>
            <span class="s1">&#39;labeler_sensitivity&#39;</span>    <span class="p">:</span> <span class="mf">0.42</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;min_overlap&#39;</span>            <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span>
            <span class="s1">&#39;classifier_sensitivity&#39;</span> <span class="p">:</span> <span class="mf">0.64</span><span class="p">,</span>
            <span class="s1">&#39;localizer_grid&#39;</span>         <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s1">&#39;localizer_sensitivity&#39;</span>  <span class="p">:</span> <span class="mf">0.16</span><span class="p">,</span>
            <span class="s1">&#39;labeler_sensitivity&#39;</span>    <span class="p">:</span> <span class="mf">0.42</span><span class="p">,</span>
            <span class="s1">&#39;check_species&#39;</span>          <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;min_overlap&#39;</span>            <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span>
            <span class="s1">&#39;classifier_sensitivity&#39;</span> <span class="p">:</span> <span class="mf">0.64</span><span class="p">,</span>
            <span class="s1">&#39;localizer_grid&#39;</span>         <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s1">&#39;localizer_sensitivity&#39;</span>  <span class="p">:</span> <span class="mf">0.16</span><span class="p">,</span>
            <span class="s1">&#39;labeler_sensitivity&#39;</span>    <span class="p">:</span> <span class="mf">0.42</span><span class="p">,</span>
            <span class="s1">&#39;check_viewpoint&#39;</span>        <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;min_overlap&#39;</span>            <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span>
            <span class="s1">&#39;classifier_sensitivity&#39;</span> <span class="p">:</span> <span class="mf">0.04</span><span class="p">,</span>
            <span class="s1">&#39;localizer_grid&#39;</span>         <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s1">&#39;localizer_sensitivity&#39;</span>  <span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="s1">&#39;labeler_sensitivity&#39;</span>    <span class="p">:</span> <span class="mf">0.39</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;min_overlap&#39;</span>            <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span>
            <span class="s1">&#39;classifier_sensitivity&#39;</span> <span class="p">:</span> <span class="mf">0.04</span><span class="p">,</span>
            <span class="s1">&#39;localizer_grid&#39;</span>         <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s1">&#39;localizer_sensitivity&#39;</span>  <span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="s1">&#39;labeler_sensitivity&#39;</span>    <span class="p">:</span> <span class="mf">0.39</span><span class="p">,</span>
            <span class="s1">&#39;check_species&#39;</span>          <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;min_overlap&#39;</span>            <span class="p">:</span> <span class="n">min_overlap</span><span class="p">,</span>
            <span class="s1">&#39;classifier_sensitivity&#39;</span> <span class="p">:</span> <span class="mf">0.04</span><span class="p">,</span>
            <span class="s1">&#39;localizer_grid&#39;</span>         <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s1">&#39;localizer_sensitivity&#39;</span>  <span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="s1">&#39;labeler_sensitivity&#39;</span>    <span class="p">:</span> <span class="mf">0.39</span><span class="p">,</span>
            <span class="s1">&#39;check_viewpoint&#39;</span>        <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Opt L&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Opt L+S&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Opt L+S+V&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Rec L&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Rec L+S&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Rec L+S+V&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;r&#39;</span><span class="p">,</span>
        <span class="s1">&#39;b&#39;</span><span class="p">,</span>
        <span class="s1">&#39;g&#39;</span><span class="p">,</span>
        <span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="s1">&#39;y&#39;</span><span class="p">,</span>
        <span class="s1">&#39;c&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">detector_precision_recall_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">x_limit</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">kwargs_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">color_list</span><span class="p">,</span> <span class="n">kwargs_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">conf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
    <span class="n">best_label</span> <span class="o">=</span> <span class="n">label_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_kwargs</span> <span class="o">=</span> <span class="n">kwargs_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_area</span> <span class="o">=</span> <span class="n">area_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve (Best: </span><span class="si">%s</span><span class="s1">, mAP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label</span><span class="p">,</span> <span class="n">best_area</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.20</span><span class="p">)</span>
    <span class="c1"># Display graph</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">102</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">detector_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span> <span class="o">**</span><span class="n">best_kwargs</span><span class="p">)</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (Algo: </span><span class="si">%s</span><span class="s1">, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.26</span><span class="p">)</span>

    <span class="n">best_index</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">best_conf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">best_pr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_re</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tup_list</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">ret_list</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">tup</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tup_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">conf</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pr</span> <span class="o">&gt;</span> <span class="n">best_pr</span><span class="p">:</span>
                <span class="n">best_index</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">best_conf</span> <span class="o">=</span> <span class="n">conf</span>
                <span class="n">best_pr</span> <span class="o">=</span> <span class="n">pr</span>
                <span class="n">best_re</span> <span class="o">=</span> <span class="n">re</span>

    <span class="k">if</span> <span class="n">best_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">best_re</span><span class="p">],</span> <span class="p">[</span><span class="n">best_pr</span><span class="p">],</span> <span class="s1">&#39;yo&#39;</span><span class="p">)</span>

        <span class="n">best_label</span> <span class="o">=</span> <span class="n">label_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
        <span class="n">best_kwargs</span> <span class="o">=</span> <span class="n">kwargs_list</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>

        <span class="n">axes_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gca_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">gca_</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">correct_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">detector_confusion_matrix_algo_plot</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">best_conf</span><span class="p">,</span> <span class="n">fig_</span><span class="o">=</span><span class="n">fig_</span><span class="p">,</span> <span class="n">axes_</span><span class="o">=</span><span class="n">axes_</span><span class="p">,</span> <span class="o">**</span><span class="n">best_kwargs</span><span class="p">)</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (Correct = </span><span class="si">%0.02f%%</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correct_rate</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">axes_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ground-Truth&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-R Confusion Matrix (Algo: </span><span class="si">%s</span><span class="s1">, OP = </span><span class="si">%0.02f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_label</span><span class="p">,</span> <span class="n">best_conf</span><span class="p">,</span> <span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.26</span><span class="p">)</span>

    <span class="c1"># plt.show()</span>
    <span class="n">fig_filename</span> <span class="o">=</span> <span class="s1">&#39;detector-precision-recall-</span><span class="si">%0.2f</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_overlap</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="n">fig_filename</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="detector_metric_graphs"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_metric_graphs">[docs]</a><span class="k">def</span> <span class="nf">detector_metric_graphs</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">classifier_precision_recall_algo_display</span><span class="p">()</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">localizer_precision_recall_algo_display</span><span class="p">()</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">labeler_precision_recall_algo_display</span><span class="p">()</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">detector_precision_recall_algo_display</span><span class="p">()</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="classifier_train"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.classifier_train">[docs]</a><span class="k">def</span> <span class="nf">classifier_train</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ibeis_cnn.ingest_ibeis</span> <span class="kn">import</span> <span class="n">get_cnn_classifier_training_images</span>
    <span class="kn">from</span> <span class="nn">ibeis.algo.detect.classifier.classifier</span> <span class="kn">import</span> <span class="n">train_classifier</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="s1">&#39;extracted&#39;</span><span class="p">)</span>
    <span class="n">get_cnn_classifier_training_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;classifier&#39;</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">train_classifier</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_path</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="localizer_train"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.localizer_train">[docs]</a><span class="k">def</span> <span class="nf">localizer_train</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pydarknet</span> <span class="kn">import</span> <span class="n">Darknet_YOLO_Detector</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;localizer&#39;</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
    <span class="n">dark</span> <span class="o">=</span> <span class="n">Darknet_YOLO_Detector</span><span class="p">()</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">dark</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">dark</span>
    <span class="k">return</span> <span class="n">model_path</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="labeler_train"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.labeler_train">[docs]</a><span class="k">def</span> <span class="nf">labeler_train</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ibeis_cnn.ingest_ibeis</span> <span class="kn">import</span> <span class="n">get_cnn_labeler_training_images</span>
    <span class="kn">from</span> <span class="nn">ibeis.algo.detect.labeler.labeler</span> <span class="kn">import</span> <span class="n">train_labeler</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="s1">&#39;extracted&#39;</span><span class="p">)</span>
    <span class="n">get_cnn_labeler_training_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;labeler&#39;</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">train_labeler</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">source_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_path</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="detector_train"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detector_train">[docs]</a><span class="k">def</span> <span class="nf">detector_train</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">localizer_train</span><span class="p">()</span>
    <span class="n">localizer_weight_path</span><span class="p">,</span> <span class="n">localizer_config_path</span><span class="p">,</span> <span class="n">localizer_class_path</span> <span class="o">=</span> <span class="n">results</span>
    <span class="n">classifier_model_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">classifier_train</span><span class="p">()</span>
    <span class="n">labeler_model_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">labeler_train</span><span class="p">()</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;detector&#39;</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">localizer_weight_path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;localizer.weights&#39;</span><span class="p">))</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">localizer_config_path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;localizer.config&#39;</span><span class="p">))</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">localizer_class_path</span><span class="p">,</span>  <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;localizer.classes&#39;</span><span class="p">))</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">classifier_model_path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;classifier.npy&#39;</span><span class="p">))</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">labeler_model_path</span><span class="p">,</span>    <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;labeler.npy&#39;</span><span class="p">))</span>

</div>
<span class="k">def</span> <span class="nf">_resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">t_width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">t_height</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;RESIZING WITH t_width = </span><span class="si">%r</span><span class="s1"> and t_height = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t_width</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="k">elif</span> <span class="n">t_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">t_width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">t_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_height</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">t_height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">t_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_width</span><span class="p">)</span>
    <span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_width</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">t_height</span><span class="p">)</span>
    <span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">t_width</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">t_height</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">t_width</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;target size too small&#39;</span>
    <span class="k">assert</span> <span class="n">t_width</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">t_height</span> <span class="o">&lt;=</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;target size too large (capped at 1000%)&#39;</span>
    <span class="c1"># interpolation = cv2.INTER_LANCZOS4</span>
    <span class="n">interpolation</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">t_width</span><span class="p">,</span> <span class="n">t_height</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>


<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="detect_write_detection_all"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.detect_write_detection_all">[docs]</a><span class="k">def</span> <span class="nf">detect_write_detection_all</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="n">test_gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
    <span class="n">test_image_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>
    <span class="n">test_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">)</span>

    <span class="n">write_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">)))</span>
    <span class="c1"># gt_dict = detect_parse_gt(ibs_, test_gid_set=test_gid_list)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">test_gid</span><span class="p">,</span> <span class="n">test_uuid</span><span class="p">,</span> <span class="n">test_image</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">test_gid_list</span><span class="p">,</span> <span class="n">test_uuid_list</span><span class="p">,</span> <span class="n">test_image_list</span><span class="p">)):</span>
        <span class="n">height_old</span><span class="p">,</span> <span class="n">width_old</span><span class="p">,</span> <span class="n">channels_old</span> <span class="o">=</span> <span class="n">test_image</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">test_image</span> <span class="o">=</span> <span class="n">_resize</span><span class="p">(</span><span class="n">test_image</span><span class="p">,</span> <span class="n">t_width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">height_</span><span class="p">,</span> <span class="n">width_</span><span class="p">,</span> <span class="n">channels_</span> <span class="o">=</span> <span class="n">test_image</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rescale</span> <span class="o">=</span> <span class="n">width_</span> <span class="o">/</span> <span class="n">width_old</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">test_gid</span><span class="p">)</span>
        <span class="n">annot_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">annot_list</span><span class="p">:</span>
            <span class="n">xbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">xtl</span> <span class="o">+</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">rescale</span><span class="p">)</span>
            <span class="n">ybr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ytl</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">rescale</span><span class="p">)</span>
            <span class="n">xtl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xtl</span> <span class="o">*</span> <span class="n">rescale</span><span class="p">)</span>
            <span class="n">ytl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ytl</span> <span class="o">*</span> <span class="n">rescale</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">test_image</span><span class="p">,</span> <span class="p">(</span><span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">),</span> <span class="p">(</span><span class="n">xbr</span><span class="p">,</span> <span class="n">ybr</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">write_filepath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">write_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.jpg&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">write_filepath</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">write_filepath</span><span class="p">,</span> <span class="n">test_image</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="redownload_detection_models"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.redownload_detection_models">[docs]</a><span class="k">def</span> <span class="nf">redownload_detection_models</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        ibs (IBEISController):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;from ibeis.algo.detect import grabmodels; grabmodels.redownload_models()&quot;</span>
<span class="sd">        python -c &quot;import utool, ibeis.algo; utool.view_directory(ibeis.algo.detect.grabmodels._expand_modeldir())&quot;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.other.detectfuncs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = redownload_detection_models(ibs)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[other.detectfuncs] redownload_detection_models&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">ibeis.algo.detect</span> <span class="kn">import</span> <span class="n">grabmodels</span>
    <span class="n">modeldir</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_detect_modeldir</span><span class="p">()</span>
    <span class="n">grabmodels</span><span class="o">.</span><span class="n">redownload_models</span><span class="p">(</span><span class="n">modeldir</span><span class="o">=</span><span class="n">modeldir</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="view_model_dir"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.view_model_dir">[docs]</a><span class="k">def</span> <span class="nf">view_model_dir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[other.detectfuncs] redownload_detection_models&#39;</span><span class="p">)</span>
    <span class="n">modeldir</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_detect_modeldir</span><span class="p">()</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">view_directory</span><span class="p">(</span><span class="n">modeldir</span><span class="p">)</span>
    <span class="c1">#grabmodels.redownload_models(modeldir=modeldir)</span>

</div>
<div class="viewcode-block" id="remove_rfdetect"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.remove_rfdetect">[docs]</a><span class="k">def</span> <span class="nf">remove_rfdetect</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="n">aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">search_annot_notes</span><span class="p">(</span><span class="s1">&#39;rfdetect&#39;</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_notes</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span>
    <span class="n">newnotes</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;rfdetect&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">]</span>
    <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_notes</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="n">newnotes</span><span class="p">)</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="fix_horizontal_bounding_boxes_to_orient"><a class="viewcode-back" href="../../../ibeis.other.html#ibeis.other.detectfuncs.fix_horizontal_bounding_boxes_to_orient">[docs]</a><span class="k">def</span> <span class="nf">fix_horizontal_bounding_boxes_to_orient</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">):</span>
    <span class="n">orient</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_orientation</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
    <span class="n">bbox_list_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">bbox_list</span><span class="p">:</span>
        <span class="p">(</span><span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">=</span> <span class="n">bbox</span>
        <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">full_w</span><span class="p">,</span> <span class="n">full_h</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span> <span class="o">=</span> <span class="n">full_w</span> <span class="o">-</span> <span class="n">ytl</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span> <span class="n">xtl</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span>
        <span class="k">elif</span> <span class="n">orient</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">full_w</span><span class="p">,</span> <span class="n">full_h</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span> <span class="o">=</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">full_h</span> <span class="o">-</span> <span class="n">xtl</span> <span class="o">-</span> <span class="n">width</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">bbox_</span> <span class="o">=</span> <span class="p">(</span><span class="n">xtl</span><span class="p">,</span> <span class="n">ytl</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">bbox_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bbox_list_</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.other.detectfuncs</span>
<span class="sd">        python -m ibeis.other.detectfuncs --allexamples</span>
<span class="sd">        python -m ibeis.other.detectfuncs --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.5.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>