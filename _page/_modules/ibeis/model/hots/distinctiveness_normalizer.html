

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.model.hots.distinctiveness_normalizer &mdash; ibeis 1.5.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ibeis 1.5.2 documentation" href="../../../../index.html"/>
        <link rel="up" title="ibeis.model.hots" href="../hots.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> ibeis
          

          
          </a>

          
            
            
              <div class="version">
                1.5.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ibeis.html">ibeis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">ibeis</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../../ibeis.html">ibeis</a> &raquo;</li>
      
          <li><a href="../../model.html">ibeis.model</a> &raquo;</li>
      
          <li><a href="../hots.html">ibeis.model.hots</a> &raquo;</li>
      
    <li>ibeis.model.hots.distinctiveness_normalizer</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ibeis.model.hots.distinctiveness_normalizer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">External mechanism for computing feature distinctiveness</span>

<span class="sd">stores some set of vectors which lose their association with</span>
<span class="sd">their parent.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">utool</span>
<span class="c1">#from os.path import join</span>
<span class="c1">#import numpy as np</span>
<span class="kn">import</span> <span class="nn">vtool</span> <span class="kn">as</span> <span class="nn">vt</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">map</span>
<span class="c1">#import vtool as vt</span>
<span class="kn">import</span> <span class="nn">six</span>  <span class="c1"># NOQA</span>
<span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">import</span> <span class="nn">pyflann</span>
<span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">sysres</span>
<span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">hstypes</span>
<span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s1">&#39;[distinctnorm]&#39;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="n">DCVS_DEFAULT</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfoList</span><span class="p">(</span><span class="s1">&#39;distinctivness&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;dcvs_power&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span>    <span class="n">varyvals</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;dcvs_min_clip&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;mn&#39;</span><span class="p">,</span> <span class="n">varyvals</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mo">02</span><span class="p">,</span> <span class="o">.</span><span class="mo">03</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]),</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;dcvs_max_clip&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;mx&#39;</span><span class="p">,</span> <span class="n">varyvals</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mo">05</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="mi">45</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ParamInfo</span><span class="p">(</span><span class="s1">&#39;dcvs_K&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;dcvsK&#39;</span><span class="p">,</span>      <span class="n">varyvals</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]),</span>
<span class="p">])</span>


<span class="n">DISTINCTIVENESS_NORMALIZER_CACHE</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">BASELINE_DISTINCTIVNESS_URLS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># TODO: Populate</span>
    <span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_GREVY</span><span class="p">:</span> <span class="n">const</span><span class="o">.</span><span class="n">ZIPPED_URLS</span><span class="o">.</span><span class="n">GZ_DISTINCTIVE</span><span class="p">,</span>
    <span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">:</span> <span class="n">const</span><span class="o">.</span><span class="n">ZIPPED_URLS</span><span class="o">.</span><span class="n">PZ_DISTINCTIVE</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">PUBLISH_DIR</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unixpath</span><span class="p">(</span><span class="s1">&#39;~/Dropbox/IBEIS&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="testdata_distinctiveness"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.testdata_distinctiveness">[docs]</a><span class="k">def</span> <span class="nf">testdata_distinctiveness</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # SLOW_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dstcnvs_normer, qreq_ = testdata_distinctiveness()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">ibeis</span>
    <span class="c1"># build test data</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--db&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;testdb1&#39;</span><span class="p">)</span>
    <span class="n">species</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--species&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">aid</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s1">&#39;--aid&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">aid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species_texts</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">species</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">db</span> <span class="o">==</span> <span class="s1">&#39;testdb1&#39;</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
    <span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">)</span>
    <span class="n">qaids</span> <span class="o">=</span> <span class="p">[</span><span class="n">aid</span><span class="p">]</span> <span class="k">if</span> <span class="n">aid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">daids</span>
    <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
    <span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">request_ibeis_distinctiveness_normalizer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">qreq_</span>

</div>
<span class="nd">@six.add_metaclass</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ReloadingMetaclass</span><span class="p">)</span>
<div class="viewcode-block" id="DistinctivnessNormalizer"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer">[docs]</a><span class="k">class</span> <span class="nc">DistinctivnessNormalizer</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">Cachable</span><span class="p">):</span>
    <span class="n">ext</span>    <span class="o">=</span> <span class="s1">&#39;.cPkl&#39;</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;distinctivness&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; cfgstring should be the species trained on &quot;&quot;&quot;</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">vecs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">=</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">VEC_PSEUDO_MAX_DISTANCE</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">max_distance_sqrd</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="o">=</span> <span class="n">cachedir</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;kdtree&#39;</span><span class="p">,</span> <span class="s1">&#39;trees&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="mi">800</span><span class="p">}</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">checks</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;checks&#39;</span><span class="p">)</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cores</span>  <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cores&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="DistinctivnessNormalizer.get_prefix"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_prefix">[docs]</a>    <span class="k">def</span> <span class="nf">get_prefix</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DistinctivnessNormalizer</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.get_cfgstr"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_cfgstr">[docs]</a>    <span class="k">def</span> <span class="nf">get_cfgstr</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">species</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="n">cfgstr</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">species</span>
        <span class="k">return</span> <span class="n">cfgstr</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.add_support"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.add_support">[docs]</a>    <span class="k">def</span> <span class="nf">add_support</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">new_vecs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.archive"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.archive">[docs]</a>    <span class="k">def</span> <span class="nf">archive</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">cachedir</span>      <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cachedir</span>
        <span class="n">data_fpath</span>    <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="c1">#flann_fpath   = dstcnvs_normer.get_flann_fpath(cachedir)</span>
        <span class="n">archive_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.zip&#39;</span><span class="p">)</span>
        <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">data_fpath</span><span class="p">,</span>
            <span class="c1">#flann_fpath</span>
        <span class="p">]</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">archive_files</span><span class="p">(</span><span class="n">archive_fpath</span><span class="p">,</span> <span class="n">fpath_list</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">archive_fpath</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.publish"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.publish">[docs]</a>    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets this as the default normalizer available for download</span>
<span class="sd">        ONLY DEVELOPERS CAN PERFORM THIS OPERATION</span>

<span class="sd">        Args:</span>
<span class="sd">            cachedir (str):</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-publish</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; dstcnvs_normer = testdata_distinctiveness()[0]</span>
<span class="sd">            &gt;&gt;&gt; dstcnvs_normer.rebuild()</span>
<span class="sd">            &gt;&gt;&gt; dstcnvs_normer.save()</span>
<span class="sd">            &gt;&gt;&gt; result = dstcnvs_normer.publish(cachedir)</span>
<span class="sd">            &gt;&gt;&gt; # verify results</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">join</span>
        <span class="k">assert</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_developer</span><span class="p">(),</span> <span class="s1">&#39;ONLY DEVELOPERS CAN PERFORM THIS OPERATION&#39;</span>
        <span class="n">cachedir</span>      <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cachedir</span>
        <span class="n">archive_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">archive</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">archive_fname</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">archive_fpath</span><span class="p">)</span>
        <span class="n">publish_dpath</span> <span class="o">=</span> <span class="n">PUBLISH_DIR</span>
        <span class="n">publish_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">publish_dpath</span><span class="p">,</span> <span class="n">archive_fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">publish_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Overwriting model&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;old nBytes(publish_fpath) = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_file_nBytes_str</span><span class="p">(</span><span class="n">publish_fpath</span><span class="p">),))</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;new nBytes(archive_fpath) = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_file_nBytes_str</span><span class="p">(</span><span class="n">archive_fpath</span><span class="p">),))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Publishing model&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;publish_fpath = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">publish_fpath</span><span class="p">,))</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">archive_fpath</span><span class="p">,</span> <span class="n">publish_fpath</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.get_flann_fpath"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_flann_fpath">[docs]</a>    <span class="k">def</span> <span class="nf">get_flann_fpath</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="p">):</span>
        <span class="n">flann_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.flann&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flann_fpath</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.exists"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">need_flann</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            cachedir (str): cache directory</span>
<span class="sd">            verbose (bool):  verbosity flag</span>

<span class="sd">        Returns:</span>
<span class="sd">            flag: load_success</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-exists</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # SLOW_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; # build test data</span>
<span class="sd">            &gt;&gt;&gt; dstcnvs_normer = testdata_distinctiveness()[0]</span>
<span class="sd">            &gt;&gt;&gt; assert dstcnvs_normer.exists()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span>
        <span class="n">cachedir</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cachedir</span>
        <span class="n">cpkl_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="n">flann_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_flann_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cpkl_fpath</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">need_flann</span><span class="p">:</span>
            <span class="n">fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flann_fpath</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">flag</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.load"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Inherited method</span>
        <span class="n">cachedir</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cachedir</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ignore_keys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flann&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DistinctivnessNormalizer</span><span class="p">,</span> <span class="n">dstcnvs_normer</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">load_or_build_flann</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">## Load Flann</span>
        <span class="c1">#if ut.VERBOSE:</span>
        <span class="c1">#    print(&#39;[nnindex] load_success = %r&#39; % (load_success,))</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.load_or_build_flann"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.load_or_build_flann">[docs]</a>    <span class="k">def</span> <span class="nf">load_or_build_flann</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">flann_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_flann_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">flann_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span> <span class="o">=</span> <span class="n">pyflann</span><span class="o">.</span><span class="n">FLANN</span><span class="p">()</span>
                <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span><span class="o">.</span><span class="n">load_index</span><span class="p">(</span><span class="n">flann_fpath</span><span class="p">,</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">vecs</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span><span class="o">.</span><span class="n">_FLANN__curindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                <span class="c1">#load_success = True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;... cannot load distinctiveness flann&#39;</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">ensure_flann</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
            <span class="c1">#raise IOError(&#39;cannot load distinctiveness flann&#39;)</span>
        <span class="c1">#return load_success</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.save"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        args = tuple()</span>
<span class="sd">        kwargs = {}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cachedir</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cachedir</span>
        <span class="c1"># Inherited method</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ignore_keys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flann&#39;</span><span class="p">]</span>
        <span class="c1"># Save everything but flann</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DistinctivnessNormalizer</span><span class="p">,</span> <span class="n">dstcnvs_normer</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Save flann</span>
        <span class="k">if</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">save_flann</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.save_flann"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.save_flann">[docs]</a>    <span class="k">def</span> <span class="nf">save_flann</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">cachedir</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cachedir</span> <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cachedir</span>
        <span class="n">flann_fpath</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_flann_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;flann.save_index(</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">ut</span><span class="o">.</span><span class="n">path_ndir_split</span><span class="p">(</span><span class="n">flann_fpath</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span><span class="o">.</span><span class="n">save_index</span><span class="p">(</span><span class="n">flann_fpath</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.init_support"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.init_support">[docs]</a>    <span class="k">def</span> <span class="nf">init_support</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">vecs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">vecs</span> <span class="o">=</span> <span class="n">vecs</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.rebuild"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.rebuild">[docs]</a>    <span class="k">def</span> <span class="nf">rebuild</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">build_flann_index</span><span class="p">(</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">vecs</span><span class="p">,</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann_params</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">vecs</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">VEC_TYPE</span><span class="p">:</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">=</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">VEC_PSEUDO_MAX_DISTANCE</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">max_distance_sqrd</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">**</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.ensure_flann"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.ensure_flann">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_flann</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_flann_fpath</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)):</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">save_flann</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistinctivnessNormalizer.get_distinctiveness"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_distinctiveness">[docs]</a>    <span class="k">def</span> <span class="nf">get_distinctiveness</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">dcvs_K</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dcvs_power</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dcvs_max_clip</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dcvs_min_clip</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            qfx2_vec (ndarray):  mapping from query feature index to vec</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --db GZ_ALL --show</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show --dcvs_power .25</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show --dcvs_power .5</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show --dcvs_power .1</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show --dcvs_K 1&amp;</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show --dcvs_K 2&amp;</span>
<span class="sd">            python -m ibeis.model.hots.distinctiveness_normalizer --test-get_distinctiveness --show --dcvs_K 3&amp;</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # SLOW_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; dstcnvs_normer, qreq_ = testdata_distinctiveness()</span>
<span class="sd">            &gt;&gt;&gt; qaid = qreq_.get_external_qaids()[0]</span>
<span class="sd">            &gt;&gt;&gt; qfx2_vec = qreq_.ibs.get_annot_vecs(qaid, config2_=qreq_.qparams)</span>
<span class="sd">            &gt;&gt;&gt; default_dict = {&#39;dcvs_power&#39;: .25, &#39;dcvs_K&#39;: 5, &#39;dcvs_max_clip&#39;: .5}</span>
<span class="sd">            &gt;&gt;&gt; kwargs = ut.argparse_dict(default_dict)</span>
<span class="sd">            &gt;&gt;&gt; qfx2_dstncvs = dstcnvs_normer.get_distinctiveness(qfx2_vec, **kwargs)</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_eq(len(qfx2_dstncvs.shape), 1)</span>
<span class="sd">            &gt;&gt;&gt; assert np.all(qfx2_dstncvs) &lt;= 1</span>
<span class="sd">            &gt;&gt;&gt; assert np.all(qfx2_dstncvs) &gt;= 0</span>
<span class="sd">            &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">            &gt;&gt;&gt; # Show distinctivness on an animal and a corresponding graph</span>
<span class="sd">            &gt;&gt;&gt; import plottool as pt</span>
<span class="sd">            &gt;&gt;&gt; chip = qreq_.ibs.get_annot_chips(qaid)</span>
<span class="sd">            &gt;&gt;&gt; qfx2_kpts = qreq_.ibs.get_annot_kpts(qaid, config2_=qreq_.qparams)</span>
<span class="sd">            &gt;&gt;&gt; show_chip_distinctiveness_plot(chip, qfx2_kpts, qfx2_dstncvs)</span>
<span class="sd">            &gt;&gt;&gt; #pt.figure(2)</span>
<span class="sd">            &gt;&gt;&gt; #pt.show_all_colormaps()</span>
<span class="sd">            &gt;&gt;&gt; pt.show_if_requested()</span>

<span class="sd">        Ignore:</span>
<span class="sd">            %s/\(^ *\)\(.*\)/\1&gt;&gt;&gt; \2/c</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#ut.embed()</span>
        <span class="k">assert</span> <span class="n">dcvs_K</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dcvs_K</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">vecs</span><span class="p">),</span> <span class="s1">&#39;dcvs_K=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dcvs_K</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#(qfx2_idx, qfx2_dist_sqrd) = dstcnvs_normer.empty_neighbors(0, dcvs_K)</span>
            <span class="n">qfx2_idx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">dcvs_K</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">qfx2_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">dcvs_K</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># perform nearest neighbors</span>
            <span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist_sqrd</span><span class="p">)</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">flann</span><span class="o">.</span><span class="n">nn_index</span><span class="p">(</span>
                <span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">dcvs_K</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">checks</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">cores</span><span class="p">)</span>
            <span class="c1"># Ensure that distance returned are between 0 and 1</span>
            <span class="c1">#qfx2_dist = qfx2_dist / (dstcnvs_normer.max_distance ** 2)</span>
            <span class="n">qfx2_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">qfx2_dist_sqrd</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span> <span class="o">/</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">VEC_PSEUDO_MAX_DISTANCE</span>
            <span class="c1">#qfx2_dist32 = np.sqrt(np.divide(qfx2_dist_sqrd, dstcnvs_normer.max_distance_sqrd))</span>
            <span class="c1">#qfx2_dist =</span>
            <span class="c1">#qfx2_dist = np.sqrt(qfx2_dist) / dstcnvs_normer.max_distance</span>
        <span class="k">if</span> <span class="n">dcvs_K</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">qfx2_dist</span> <span class="o">=</span> <span class="n">qfx2_dist</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="n">norm_dist</span> <span class="o">=</span> <span class="n">qfx2_dist</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">dcvs_K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">qfx2_dstncvs</span> <span class="o">=</span> <span class="n">compute_distinctiveness_from_dist</span><span class="p">(</span><span class="n">norm_dist</span><span class="p">,</span> <span class="n">dcvs_power</span><span class="p">,</span> <span class="n">dcvs_max_clip</span><span class="p">,</span> <span class="n">dcvs_min_clip</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qfx2_dstncvs</span>

</div></div>
<div class="viewcode-block" id="compute_distinctiveness_from_dist"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.compute_distinctiveness_from_dist">[docs]</a><span class="k">def</span> <span class="nf">compute_distinctiveness_from_dist</span><span class="p">(</span><span class="n">norm_dist</span><span class="p">,</span> <span class="n">dcvs_power</span><span class="p">,</span> <span class="n">dcvs_max_clip</span><span class="p">,</span> <span class="n">dcvs_min_clip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute distinctiveness from distance to dcvs_K+1 nearest neighbor</span>

<span class="sd">    Ignore:</span>
<span class="sd">        norm_dist = np.random.rand(1000)</span>

<span class="sd">        import numexpr</span>

<span class="sd">        %timeit np.divide(norm_dist, dcvs_max_clip)</span>
<span class="sd">        %timeit numexpr.evaluate(&#39;norm_dist / dcvs_max_clip&#39;, local_dict=dict(norm_dist=norm_dist, dcvs_max_clip=dcvs_max_clip))</span>
<span class="sd">        wd_cliped = np.divide(norm_dist, dcvs_max_clip)</span>

<span class="sd">        %timeit numexpr.evaluate(&#39;wd_cliped &gt; 1.0&#39;, local_dict=locals())</span>
<span class="sd">        %timeit np.greater(wd_cliped, 1.0)</span>

<span class="sd">        %timeit np.power(wd_cliped, dcvs_power)</span>
<span class="sd">        %timeit numexpr.evaluate(&#39;wd_cliped ** dcvs_power&#39;, local_dict=locals())</span>

<span class="sd">        %timeit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># expondent to augment distinctiveness scores.</span>
    <span class="c1"># clip the distinctiveness at this fraction</span>
    <span class="n">clip_range</span> <span class="o">=</span> <span class="n">dcvs_max_clip</span> <span class="o">-</span> <span class="n">dcvs_min_clip</span>
    <span class="c1"># apply distinctivness normalization</span>
    <span class="n">_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">norm_dist</span><span class="p">,</span> <span class="n">dcvs_min_clip</span><span class="p">,</span> <span class="n">dcvs_max_clip</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span> <span class="n">dcvs_min_clip</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">_tmp</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span> <span class="n">clip_range</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">_tmp</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span> <span class="n">dcvs_power</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">_tmp</span><span class="p">)</span>
    <span class="n">dstncvs</span> <span class="o">=</span> <span class="n">_tmp</span>
    <span class="k">return</span> <span class="n">dstncvs</span>

</div>
<div class="viewcode-block" id="show_chip_distinctiveness_plot"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.show_chip_distinctiveness_plot">[docs]</a><span class="k">def</span> <span class="nf">show_chip_distinctiveness_plot</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">kpts</span><span class="p">,</span> <span class="n">dstncvs</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ensure_divider</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#ax1 = divider.append_axes(&quot;left&quot;, size=&quot;50%&quot;, pad=0)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">ax</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="c1">#f, (ax1, ax2) = pt.plt.subplots(1, 2, sharex=True)</span>
    <span class="n">cmapstr</span> <span class="o">=</span> <span class="s1">&#39;rainbow&#39;</span>  <span class="c1"># &#39;hot&#39;</span>
    <span class="n">color_list</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">df2</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmapstr</span><span class="p">)(</span><span class="n">ut</span><span class="o">.</span><span class="n">norm_zero_one</span><span class="p">(</span><span class="n">dstncvs</span><span class="p">))</span>
    <span class="n">sortx</span> <span class="o">=</span> <span class="n">dstncvs</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="c1">#pt.df2.plt.plot(qfx2_dstncvs[sortx], c=color_list[sortx])</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">colorline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sortx</span><span class="p">)),</span> <span class="n">dstncvs</span><span class="p">[</span><span class="n">sortx</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmapstr</span><span class="p">))</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sortx</span><span class="p">))</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">dark_background</span><span class="p">()</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">darken</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># MATPLOTLIB BUG CANNOT SHOW DIFFERENT ALPHA FOR POINTS AND KEYPOINTS AT ONCE</span>
    <span class="c1">#pt.draw_kpts2(kpts, pts_color=color_list, ell_color=color_list, ell_alpha=.1, ell=True, pts=True)</span>
    <span class="c1">#pt.draw_kpts2(kpts, color_list=color_list, pts_alpha=1.0, pts_size=1.5,</span>
    <span class="c1">#              ell=True, ell_alpha=.1, pts=False)</span>
    <span class="n">ell</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--ell&#39;</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">draw_kpts2</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="n">color_list</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span> <span class="n">pts_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pts_size</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                  <span class="n">ell</span><span class="o">=</span><span class="n">ell</span><span class="p">,</span> <span class="n">ell_alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="ow">not</span> <span class="n">ell</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#pt.figure(fnum, pnum=pnum)</span>

</div>
<div class="viewcode-block" id="download_baseline_distinctiveness_normalizer"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.download_baseline_distinctiveness_normalizer">[docs]</a><span class="k">def</span> <span class="nf">download_baseline_distinctiveness_normalizer</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">species</span><span class="p">):</span>
    <span class="n">zipped_url</span> <span class="o">=</span> <span class="n">BASELINE_DISTINCTIVNESS_URLS</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
    <span class="n">utool</span><span class="o">.</span><span class="n">grab_zipped_url</span><span class="p">(</span><span class="n">zipped_url</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="n">cachedir</span><span class="p">)</span>
    <span class="c1">#ut.assert_eq(ut.unixpath(cachedir), dir_)</span>

</div>
<div class="viewcode-block" id="request_ibeis_distinctiveness_normalizer"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.request_ibeis_distinctiveness_normalizer">[docs]</a><span class="k">def</span> <span class="nf">request_ibeis_distinctiveness_normalizer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        qreq_ (QueryRequest):  query request object with hyper-parameters</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-request_ibeis_distinctiveness_normalizer</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # SLOW_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; daids = ibs.get_valid_aids(species=ibeis.const.Species.ZEB_PLAIN)</span>
<span class="sd">        &gt;&gt;&gt; qaids = ibs.get_valid_aids(species=ibeis.const.Species.ZEB_PLAIN)</span>
<span class="sd">        &gt;&gt;&gt; qreq_ = ibs.new_query_request(qaids, daids)</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; dstcnvs_normer = request_ibeis_distinctiveness_normalizer(qreq_)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; assert dstcnvs_normer is not None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">DISTINCTIVENESS_NORMALIZER_CACHE</span>
    <span class="n">unique_species</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_unique_species</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_species</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">species</span> <span class="o">=</span> <span class="n">unique_species</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">global_distinctdir</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_global_distinctiveness_modeldir</span><span class="p">()</span>
    <span class="n">cachedir</span> <span class="o">=</span> <span class="n">global_distinctdir</span>
    <span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">request_species_distinctiveness_normalizer</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">cachedir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dstcnvs_normer</span>

</div>
<div class="viewcode-block" id="request_species_distinctiveness_normalizer"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.request_species_distinctiveness_normalizer">[docs]</a><span class="k">def</span> <span class="nf">request_species_distinctiveness_normalizer</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper function to get distinctivness model independent of IBEIS.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">DISTINCTIVENESS_NORMALIZER_CACHE</span><span class="p">:</span>
        <span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">DISTINCTIVENESS_NORMALIZER_CACHE</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cachedir</span> <span class="o">=</span> <span class="n">sysres</span><span class="o">.</span><span class="n">get_global_distinctiveness_modeldir</span><span class="p">(</span><span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">DistinctivnessNormalizer</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cachedir</span><span class="p">):</span>
            <span class="c1"># download normalizer if it doesn&#39;t exist</span>
            <span class="n">download_baseline_distinctiveness_normalizer</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_object_size_str</span><span class="p">(</span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="s1">&#39;dstcnvs_normer = &#39;</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Loaded distinctivness normalizer&#39;</span><span class="p">)</span>
        <span class="c1">#dstcnvs_normer.ensure_flann(cachedir)</span>
        <span class="k">assert</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">need_flann</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s1">&#39;normalizer should have been downloaded, but it doesnt exist&#39;</span>
        <span class="n">DISTINCTIVENESS_NORMALIZER_CACHE</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span>
    <span class="k">return</span> <span class="n">dstcnvs_normer</span>

</div>
<div class="viewcode-block" id="clear_distinctivness_cache"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.clear_distinctivness_cache">[docs]</a><span class="k">def</span> <span class="nf">clear_distinctivness_cache</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
    <span class="n">global_distinctdir</span> <span class="o">=</span> <span class="n">sysres</span><span class="o">.</span><span class="n">get_global_distinctiveness_modeldir</span><span class="p">()</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">remove_files_in_dir</span><span class="p">(</span><span class="n">global_distinctdir</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="list_distinctivness_cache"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.list_distinctivness_cache">[docs]</a><span class="k">def</span> <span class="nf">list_distinctivness_cache</span><span class="p">():</span>
    <span class="n">global_distinctdir</span> <span class="o">=</span> <span class="n">sysres</span><span class="o">.</span><span class="n">get_global_distinctiveness_modeldir</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_str</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">global_distinctdir</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="list_published_distinctivness"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.list_published_distinctivness">[docs]</a><span class="k">def</span> <span class="nf">list_published_distinctivness</span><span class="p">():</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-list_published_distinctivness</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # SLOW_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; published_fpaths = list_published_distinctivness()</span>
<span class="sd">        &gt;&gt;&gt; print(ut.list_str(published_fpaths))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">published_fpaths</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">PUBLISH_DIR</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">published_fpaths</span>

</div>
<div class="viewcode-block" id="view_distinctiveness_model_dir"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.view_distinctiveness_model_dir">[docs]</a><span class="k">def</span> <span class="nf">view_distinctiveness_model_dir</span><span class="p">():</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-view_distinctiveness_model_dir</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; view_distinctiveness_model_dir()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">global_distinctdir</span> <span class="o">=</span> <span class="n">sysres</span><span class="o">.</span><span class="n">get_global_distinctiveness_modeldir</span><span class="p">()</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">vd</span><span class="p">(</span><span class="n">global_distinctdir</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="view_publish_dir"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.view_publish_dir">[docs]</a><span class="k">def</span> <span class="nf">view_publish_dir</span><span class="p">():</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-view_publish_dir</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; view_publish_dir()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">vd</span><span class="p">(</span><span class="n">PUBLISH_DIR</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="test_single_annot_distinctiveness_params"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.test_single_annot_distinctiveness_params">[docs]</a><span class="k">def</span> <span class="nf">test_single_annot_distinctiveness_params</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-test_single_annot_distinctiveness_params --show</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-test_single_annot_distinctiveness_params --show --db GZ_ALL</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(ut.get_argval(&#39;--db&#39;, type_=str, default=&#39;PZ_MTEST&#39;))</span>
<span class="sd">        &gt;&gt;&gt; aid = ut.get_argval(&#39;--aid&#39;, type_=int, default=1)</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; test_single_annot_distinctiveness_params(ibs, aid)</span>
<span class="sd">        &gt;&gt;&gt; pt.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">####</span>
    <span class="c1"># TODO: Also paramatarize the downweighting based on the keypoint size</span>
    <span class="c1">####</span>
    <span class="c1"># HACK IN ABILITY TO SET CONFIG</span>
    <span class="kn">from</span> <span class="nn">ibeis.init.main_commands</span> <span class="kn">import</span> <span class="n">postload_commands</span>
    <span class="kn">from</span> <span class="nn">ibeis.model</span> <span class="kn">import</span> <span class="n">Config</span>
    <span class="n">postload_commands</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>

    <span class="c1">#cfglbl_list = cfgdict_list</span>
    <span class="c1">#ut.all_dict_combinations_lbls(varied_dict)</span>

    <span class="c1"># Get info to find distinctivness of</span>
    <span class="n">species_text</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_species</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
    <span class="c1"># FIXME; qreq_ params for config rowid</span>
    <span class="n">vecs</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
    <span class="n">kpts</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_kpts</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
    <span class="n">chip</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chips</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>

    <span class="c1"># Paramater space to search</span>
    <span class="c1"># TODO: use slicing to control the params being varied</span>
    <span class="c1"># Use GridSearch class to modify paramaters as you go.</span>

    <span class="n">varied_dict</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">DCVS_DEFAULT</span><span class="o">.</span><span class="n">get_varydict</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Varied Dict: &#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">dict_str</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">))</span>

    <span class="n">cfgdict_list</span><span class="p">,</span> <span class="n">cfglbl_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">make_constrained_cfg_and_lbl_list</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">)</span>

    <span class="c1"># Get groundtruthish distinctivness map</span>
    <span class="c1"># for objective function</span>
    <span class="c1"># Load distinctivness normalizer</span>
    <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;Loading Distinctivness Normalizer for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">species_text</span><span class="p">)):</span>
        <span class="n">dstcvnss_normer</span> <span class="o">=</span> <span class="n">request_species_distinctiveness_normalizer</span><span class="p">(</span><span class="n">species_text</span><span class="p">)</span>

    <span class="c1"># Get distinctivness over all params</span>
    <span class="n">dstncvs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dstcvnss_normer</span><span class="o">.</span><span class="n">get_distinctiveness</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="o">**</span><span class="n">cfgdict</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cfgdict</span> <span class="ow">in</span> <span class="n">ut</span><span class="o">.</span><span class="n">ProgressIter</span><span class="p">(</span><span class="n">cfgdict_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s1">&#39;get dstcvns&#39;</span><span class="p">)]</span>

    <span class="c1">#fgweights = ibs.get_annot_fgweights([aid])[0]</span>
    <span class="c1">#dstncvs_list = [x * fgweights for x in dstncvs_list]</span>
    <span class="n">fnum</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="kn">import</span> <span class="nn">functools</span>
    <span class="n">show_func</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">show_chip_distinctiveness_plot</span><span class="p">,</span> <span class="n">chip</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">interact_gridsearch_result_images</span><span class="p">(</span>
        <span class="n">show_func</span><span class="p">,</span> <span class="n">cfgdict_list</span><span class="p">,</span> <span class="n">cfglbl_list</span><span class="p">,</span> <span class="n">dstncvs_list</span><span class="p">,</span>
        <span class="n">score_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">figtitle</span><span class="o">=</span><span class="s1">&#39;dstncvs gridsearch&#39;</span><span class="p">)</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="dev_train_distinctiveness"><a class="viewcode-back" href="../../../../ibeis.model.hots.html#ibeis.model.hots.distinctiveness_normalizer.dev_train_distinctiveness">[docs]</a><span class="k">def</span> <span class="nf">dev_train_distinctiveness</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        ibs (IBEISController):  ibeis controller object</span>
<span class="sd">        species (None):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --test-dev_train_distinctiveness</span>

<span class="sd">        alias dev_train_distinctiveness=&#39;python -m ibeis.model.hots.distinctiveness_normalizer --test-dev_train_distinctiveness&#39;</span>
<span class="sd">        # Publishing (uses cached normalizers if available)</span>
<span class="sd">        dev_train_distinctiveness --species GZ --publish</span>
<span class="sd">        dev_train_distinctiveness --species PZ --publish</span>
<span class="sd">        dev_train_distinctiveness --species PZ --retrain</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.model.hots.distinctiveness_normalizer import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; species_code = ut.get_argval(&#39;--species&#39;, str, &#39;GZ&#39;)</span>
<span class="sd">        &gt;&gt;&gt; species = sysres.resolve_species(species_code)</span>
<span class="sd">        &gt;&gt;&gt; dev_train_distinctiveness(species)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">ibeis</span>
    <span class="c1">#if &#39;species&#39; not in vars() or species is None:</span>
    <span class="c1">#    species = const.Species.ZEB_GREVY</span>
    <span class="k">if</span> <span class="n">species</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_GREVY</span><span class="p">:</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="s1">&#39;GZ_ALL&#39;</span>
    <span class="k">elif</span> <span class="n">species</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">:</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="s1">&#39;PZ_Master0&#39;</span>
    <span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
    <span class="n">global_distinctdir</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_global_distinctiveness_modeldir</span><span class="p">()</span>
    <span class="n">cachedir</span> <span class="o">=</span> <span class="n">global_distinctdir</span>
    <span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">DistinctivnessNormalizer</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="n">cachedir</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--retrain&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;force cache miss&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;loading distinctiveness&#39;</span><span class="p">):</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="c1"># Cache hit</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;distinctivness model cache hit&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;distinctivness model cache miss&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;training distinctiveness&#39;</span><span class="p">):</span>
            <span class="c1"># Need to train</span>
            <span class="c1"># Add one example from each name</span>
            <span class="c1"># TODO: add one exemplar per viewpoint for each name</span>
            <span class="c1">#max_vecs = 1E6</span>
            <span class="c1">#max_annots = 975</span>
            <span class="n">max_annots</span> <span class="o">=</span> <span class="mi">975</span>
            <span class="c1">#ibs.fix_and_clean_database()</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_nids</span><span class="p">()</span>
            <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
            <span class="c1"># remove junk</span>
            <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">filter_junk_annotations</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
            <span class="c1"># remove empty</span>
            <span class="n">aids_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">aids</span> <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">aids_list</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">num_annots_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">))</span>
            <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">aids_list</span><span class="p">,</span> <span class="n">num_annots_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c1"># take only one annot per name</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">aids_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Keep only a certain number of annots for distinctiveness mapping</span>
            <span class="n">aid_list_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">listclip</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">max_annots</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;total num named annots = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">num_annots_list</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;training distinctiveness using </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> singleton annots&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aid_list_</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)))</span>
            <span class="c1"># vec</span>
            <span class="c1"># FIXME: qreq_ params for config rowid</span>
            <span class="n">vecs_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">aid_list_</span><span class="p">)</span>
            <span class="n">num_vecs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">vecs_list</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;num_vecs = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_vecs</span><span class="p">,))</span>
            <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">vecs_list</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;vecs size = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_object_size_str</span><span class="p">(</span><span class="n">vecs</span><span class="p">),))</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">init_support</span><span class="p">(</span><span class="n">vecs</span><span class="p">)</span>
            <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">global_distinctdir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--publish&#39;</span><span class="p">):</span>
        <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">publish</span><span class="p">()</span>
    <span class="c1">#vsone_</span>
    <span class="c1">#inct</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --allexamples</span>
<span class="sd">        python -m ibeis.model.hots.distinctiveness_normalizer --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.5.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>