

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.control.manual_wildbook_funcs &mdash; ibeis 1.4.4 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ibeis 1.4.4 documentation" href="../../../index.html"/>
        <link rel="up" title="ibeis.control" href="../control.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="fa fa-home"> ibeis</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ibeis.html">ibeis package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.__main__">ibeis.__main__ module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.all_imports">ibeis.all_imports module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.constants">ibeis.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.ibsfuncs">ibeis.ibsfuncs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.main_module">ibeis.main_module module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.params">ibeis.params module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.species">ibeis.species module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis">Module contents</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ibeis</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../ibeis.html">ibeis</a> &raquo;</li>
      
          <li><a href="../control.html">ibeis.control</a> &raquo;</li>
      
    <li>ibeis.control.manual_wildbook_funcs</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for ibeis.control.manual_wildbook_funcs</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">six</span>  <span class="c"># NOQA</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">lockfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">controller_inject</span>
<span class="kn">from</span> <span class="nn">ibeis.control.controller_inject</span> <span class="kn">import</span> <span class="n">make_ibs_register_decorator</span>
<span class="k">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[manual_wildbook]&#39;</span><span class="p">)</span>

<span class="n">CLASS_INJECT_KEY</span><span class="p">,</span> <span class="n">register_ibs_method</span> <span class="o">=</span> <span class="n">make_ibs_register_decorator</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">register_api</span>   <span class="o">=</span> <span class="n">controller_inject</span><span class="o">.</span><span class="n">get_ibeis_flask_api</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">register_route</span> <span class="o">=</span> <span class="n">controller_inject</span><span class="o">.</span><span class="n">get_ibeis_flask_route</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c">#PREFERED_BROWSER = &#39;chrome&#39;</span>
<span class="c">#PREFERED_BROWSER = &#39;firefox&#39;</span>
<span class="n">PREFERED_BROWSER</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c">#webbrowser._tryorder</span>


<div class="viewcode-block" id="hyrule_reset_wildbook"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.hyrule_reset_wildbook">[docs]</a><span class="k">def</span> <span class="nf">hyrule_reset_wildbook</span><span class="p">():</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --exec-hyrule_reset_wildbook</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.control.manual_wildbook_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; result = hyrule_reset_wildbook()</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">presetup_part</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    scp jonc@pachy.cs.uic.edu:/var/lib/tomcat/webapps/ibeis.war ~/Downloads/pachy_ibeis.war</span>
<span class="s">    # Slightly less volitile location</span>
<span class="s">    rm ~/Downloads/ibeis.war</span>
<span class="s">    wget  -o ~/Downloads/ibeis.war http://dev.wildme.org/ibeis_data_dir/ibeis.war</span>
<span class="s">    wget http://dev.wildme.org/ibeis_data_dir/ibeis.war</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_developer</span><span class="p">()</span>
    <span class="n">delete_part</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #!/bin/bash</span>

<span class="sd">        # --- FRESHSTART ---</span>
<span class="sd">        # Make sure that tomcat vars are set</span>
<span class="sd">        export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64</span>

<span class="sd">        export WILDBOOK_TESTDIR=$CODE_DIR/Wildbook/tmp</span>
<span class="sd">        export TOMCAT_DIR=$WILDBOOK_TESTDIR/apache-tomcat-8.0.24</span>
<span class="sd">        export TOMCAT_HOME=$TOMCAT_DIR</span>
<span class="sd">        export CATALINA_HOME=$TOMCAT_DIR</span>

<span class="sd">        export WB_TARGET=ibeis</span>

<span class="sd">        # ensure everything is shutdown before we start</span>
<span class="sd">        $CATALINA_HOME/bin/shutdown.sh</span>

<span class="sd">        # Clean up old tomcat</span>
<span class="sd">        rm -rf $WILDBOOK_TESTDIR/apache-tomcat-8.0.24</span>
<span class="sd">        # REMOVE EVERYTHING.</span>
<span class="sd">        rm -rf $WILDBOOK_TESTDIR</span>
<span class="sd">        mkdir $WILDBOOK_TESTDIR</span>
<span class="sd">        cd $WILDBOOK_TESTDIR</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">ignore_part</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    cd $CODE_DIR/Wildbook</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">ignore_part</span>

    <span class="n">create_part</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #!/bin/bash</span>
<span class="sd">        cd $WILDBOOK_TESTDIR</span>
<span class="sd">        unzip -q $WILDBOOK_TESTDIR/../apache-tomcat-8.0.24.zip -d $WILDBOOK_TESTDIR</span>

<span class="sd">        # make catalina runnable</span>
<span class="sd">        chmod +x $CATALINA_HOME/bin/catalina.sh</span>
<span class="sd">        chmod +x $CATALINA_HOME/bin/startup.sh</span>
<span class="sd">        chmod +x $CATALINA_HOME/bin/shutdown.sh</span>

<span class="sd">        # Install a wildbook .war file into tomcat webapps</span>
<span class="sd">        # assumes we&#39;ve already downloaded the war file</span>
<span class="sd">        cp ~/Downloads/$WB_TARGET.war $CATALINA_HOME/webapps/</span>

<span class="sd">        # RUN TOMCAT SERVER (WE MUST BE IN THE TESTDIR ON STARTUP)</span>
<span class="sd">        $CATALINA_HOME/bin/startup.sh</span>
<span class="sd">        sleep .5</span>
<span class="sd">        $CATALINA_HOME/bin/shutdown.sh</span>
<span class="sd">        sleep .5</span>
<span class="sd">        sed -i &#39;s/\/EncounterSetMarkedIndividual = authc, roles\[admin\]/&lt;!--\/EncounterSetMarkedIndividual = authc, roles\[admin\]--&gt;/&#39; $TOMCAT_DIR/webapps/$WB_TARGET/WEB-INF/web.xml</span>
<span class="sd">        sleep .5</span>
<span class="sd">        $CATALINA_HOME/bin/startup.sh</span>

<span class="sd">        # google-chrome --new-window http://localhost:8080/$WB_TARGET</span>
<span class="sd">        # firefox http://localhost:8080/$WB_TARGET</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="n">fix_settings</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    # ensure everything is shutdown before we start</span>
<span class="s">    $CATALINA_HOME/bin/shutdown.sh</span>

<span class="s">    # Fix authentication</span>
<span class="s">    gvim $TOMCAT_DIR/webapps/$WB_TARGET/WEB-INF/web.xml</span>

<span class="s">    sed &#39;s/\/EncounterSetMarkedIndividual = authc, roles\[admin\]/foo/&#39; $TOMCAT_DIR/webapps/$WB_TARGET/WEB-INF/web.xml</span>
<span class="s">    sed -i &#39;s/^\(^ *\)\/EncounterSetMarkedIndividual = authc, roles\[admin\]/</span><span class="se">\1</span><span class="s">&lt;!--\/EncounterSetMarkedIndividual = authc, roles\[admin\]--&gt;/&#39; $TOMCAT_DIR/webapps/$WB_TARGET/WEB-INF/web.xml  | grep EncounterSetMarkedIndividual</span>
<span class="s">    sed &#39;s/^\(^ *\)\/EncounterSetMarkedIndividual = authc, roles\[admin\]/</span><span class="se">\1</span><span class="s">&lt;!--\/EncounterSetMarkedIndividual = authc, roles\[admin\]--&gt;/&#39; $TOMCAT_DIR/webapps/$WB_TARGET/WEB-INF/web.xml  | grep EncounterSetMarkedIndividual</span>

<span class="s">    # Replace</span>
<span class="s">    &#39;/EncounterSetMarkedIndividual = authc, roles[admin]&#39;</span>
<span class="s">    # WITH</span>
<span class="s">    &#39;&lt;!--/EncounterSetMarkedIndividual = authc, roles[admin]--&gt;&#39;</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">fix_settings</span>

    <span class="n">bash_script</span> <span class="o">=</span> <span class="n">delete_part</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">create_part</span>
    <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;+-------&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Executing bash script: &#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">print_code</span><span class="p">(</span><span class="n">bash_script</span><span class="p">,</span> <span class="s">&#39;bash&#39;</span><span class="p">)</span>
        <span class="c">#print(bash_script)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;L______&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">bash_script</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">write_script</span><span class="p">(</span><span class="n">fpath_</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">fpath_</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">chmod_add_executable</span><span class="p">(</span><span class="n">fpath_</span><span class="p">)</span>

        <span class="n">fpath</span> <span class="o">=</span> <span class="s">&#39;hyrule_reset_wildbook.sh&#39;</span>
        <span class="n">fpath1</span> <span class="o">=</span> <span class="s">&#39;hyrule_delete_wildbook.sh&#39;</span>
        <span class="n">fpath2</span> <span class="o">=</span> <span class="s">&#39;hyrule_create_wildbook.sh&#39;</span>
        <span class="n">write_script</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">bash_script</span><span class="p">)</span>
        <span class="n">write_script</span><span class="p">(</span><span class="n">fpath1</span><span class="p">,</span> <span class="n">delete_part</span><span class="p">)</span>
        <span class="n">write_script</span><span class="p">(</span><span class="n">fpath2</span><span class="p">,</span> <span class="n">create_part</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fpath</span>

</div>
<div class="viewcode-block" id="hyrule_wildbook_login"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.hyrule_wildbook_login">[docs]</a><span class="k">def</span> <span class="nf">hyrule_wildbook_login</span><span class="p">():</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        tuple: (wb_target, tomcat_dpath)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --exec-hyrule_wildbook_login</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.control.manual_wildbook_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; hyrule_wildbook_login()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Use selenimum to login to wildbook</span>
    <span class="n">manaul_login</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">wb_target</span> <span class="o">=</span> <span class="s">&#39;ibeis&#39;</span>
    <span class="n">wb_url</span> <span class="o">=</span> <span class="s">&#39;http://localhost:8080/&#39;</span> <span class="o">+</span> <span class="n">wb_target</span>
    <span class="k">if</span> <span class="n">manaul_login</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">get_prefered_browser</span><span class="p">(</span><span class="n">PREFERED_BROWSER</span><span class="p">)</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">wb_url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">grab_selenium_driver</span><span class="p">(</span><span class="n">PREFERED_BROWSER</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wb_url</span><span class="p">)</span>
        <span class="n">login_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_partial_link_text</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span><span class="p">)</span>
        <span class="n">login_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c"># Find login elements</span>
        <span class="n">username_field</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">password_field</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&#39;password&#39;</span><span class="p">)</span>
        <span class="n">submit_login_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&#39;submit&#39;</span><span class="p">)</span>
        <span class="n">rememberMe_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&#39;rememberMe&#39;</span><span class="p">)</span>
        <span class="c"># Execute elements</span>
        <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;tomcat&#39;</span><span class="p">)</span>
        <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;tomcat123&#39;</span><span class="p">)</span>
        <span class="n">rememberMe_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">submit_login_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c"># Accept agreement</span>
        <span class="n">accept_aggrement_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&#39;acceptUserAgreement&#39;</span><span class="p">)</span>
        <span class="n">accept_aggrement_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="c"># Goto individuals page</span>
        <span class="n">individuals</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_partial_link_text</span><span class="p">(</span><span class="s">&#39;Individuals&#39;</span><span class="p">)</span>
        <span class="n">individuals</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">view_all</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_partial_link_text</span><span class="p">(</span><span class="s">&#39;View All&#39;</span><span class="p">)</span>
        <span class="n">view_all</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="testdata_wildbook_server"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.testdata_wildbook_server">[docs]</a><span class="k">def</span> <span class="nf">testdata_wildbook_server</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRICATE</span>
<span class="sd">    SeeAlso:</span>
<span class="sd">        ~/local/build_scripts/init_wildbook.sh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Very hacky and specific testdata script.</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_developer</span><span class="p">():</span>
        <span class="n">tomcat_dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;CODE_DIR&#39;</span><span class="p">],</span> <span class="s">&#39;Wildbook/tmp/apache-tomcat-8.0.24&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tomcat_dpath</span> <span class="o">=</span> <span class="s">&#39;/var/lib/tomcat&#39;</span>
    <span class="n">wb_target</span> <span class="o">=</span> <span class="s">&#39;ibeis&#39;</span>
    <span class="k">return</span> <span class="n">wb_target</span><span class="p">,</span> <span class="n">tomcat_dpath</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="get_wildbook_info"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.get_wildbook_info">[docs]</a><span class="k">def</span> <span class="nf">get_wildbook_info</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">tomcat_dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wb_target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># TODO: Clean this up</span>
    <span class="n">wildbook_base_url</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_wildbook_base_url</span><span class="p">(</span><span class="n">wb_target</span><span class="p">)</span>
    <span class="n">wildbook_tomcat_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_wildbook_tomcat_path</span><span class="p">(</span><span class="n">tomcat_dpath</span><span class="p">,</span> <span class="n">wb_target</span><span class="p">)</span>
    <span class="c"># Setup</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Looking for WildBook installation: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">wildbook_tomcat_path</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">assert_exists</span><span class="p">(</span><span class="n">wildbook_tomcat_path</span><span class="p">,</span> <span class="s">&#39;Wildbook is not installed on this machine&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wildbook_base_url</span><span class="p">,</span> <span class="n">wildbook_tomcat_path</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="get_wildbook_tomcat_path"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.get_wildbook_tomcat_path">[docs]</a><span class="k">def</span> <span class="nf">get_wildbook_tomcat_path</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">tomcat_dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wb_target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_developer</span><span class="p">():</span>
        <span class="n">DEFAULT_TOMCAT_PATH</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;CODE_DIR&#39;</span><span class="p">],</span> <span class="s">&#39;Wildbook/tmp/apache-tomcat-8.0.24&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">DEFAULT_TOMCAT_PATH</span> <span class="o">=</span> <span class="s">&#39;/var/lib/tomcat&#39;</span>
    <span class="n">tomcat_dpath</span> <span class="o">=</span> <span class="n">DEFAULT_TOMCAT_PATH</span> <span class="k">if</span> <span class="n">tomcat_dpath</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">tomcat_dpath</span>
    <span class="n">wb_target</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">WILDBOOK_TARGET</span> <span class="k">if</span> <span class="n">wb_target</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">wb_target</span>
    <span class="n">wildbook_tomcat_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">tomcat_dpath</span><span class="p">,</span> <span class="s">&#39;webapps&#39;</span><span class="p">,</span> <span class="n">wb_target</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wildbook_tomcat_path</span>

</div>
<span class="nd">@register_ibs_method</span>
<div class="viewcode-block" id="get_wildbook_base_url"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.get_wildbook_base_url">[docs]</a><span class="k">def</span> <span class="nf">get_wildbook_base_url</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">wb_target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">wb_target</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">WILDBOOK_TARGET</span> <span class="k">if</span> <span class="n">wb_target</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">wb_target</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="s">&#39;127.0.0.1&#39;</span>
    <span class="n">wb_port</span> <span class="o">=</span> <span class="mi">8080</span>
    <span class="n">wildbook_base_url</span> <span class="o">=</span> <span class="s">&#39;http://&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wb_port</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">wb_target</span>
    <span class="k">return</span> <span class="n">wildbook_base_url</span>

</div>
<div class="viewcode-block" id="submit_wildbook_url"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.submit_wildbook_url">[docs]</a><span class="k">def</span> <span class="nf">submit_wildbook_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">browse_on_error</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    mirroring the one in IBEISController.py, but with changed functionality</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dryrun</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[DRYrun_submit] URL=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[submit] URL=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;tomcat&#39;</span><span class="p">,</span> <span class="s">&#39;tomcat123&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
                <span class="c">#r = requests.post(url, data=None, auth=(&#39;tomcat&#39;, &#39;tomcat123&#39;))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Could not connect to Wildbook server at url=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">errmsg_list</span> <span class="o">=</span> <span class="p">([(</span><span class="s">&#39;Wildbook response NOT ok (200)&#39;</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">errmsg_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                    <span class="p">(</span><span class="s">&#39;WILDBOOK SERVER RESPONSE = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="p">)),</span>
                <span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errmsg_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                    <span class="p">(</span><span class="s">&#39;WILDBOOK SERVER STATUS = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,)),</span>
                    <span class="p">(</span><span class="s">&#39;WILDBOOK SERVER RESPONSE TEXT = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,)),</span>
                <span class="p">])</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errmsg_list</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">browse_on_error</span><span class="p">:</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">get_prefered_browser</span><span class="p">(</span><span class="n">PREFERED_BROWSER</span><span class="p">)</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">response</span>

</div>
<div class="viewcode-block" id="update_wildbook_config"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.update_wildbook_config">[docs]</a><span class="k">def</span> <span class="nf">update_wildbook_config</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">wildbook_tomcat_path</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">wildbook_properteis_dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">wildbook_tomcat_path</span><span class="p">,</span> <span class="s">&#39;WEB-INF/classes/bundles/&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs.wildbook_signal_eid_list()] Wildbook properties=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wildbook_properteis_dpath</span><span class="p">,</span> <span class="p">))</span>
    <span class="c"># The src file is non-standard. It should be remove here as well</span>
    <span class="n">wildbook_config_fpath_dst</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">wildbook_properteis_dpath</span><span class="p">,</span> <span class="s">&#39;commonConfiguration.properties&#39;</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">assert_exists</span><span class="p">(</span><span class="n">wildbook_properteis_dpath</span><span class="p">)</span>
    <span class="c"># for come reason the .default file is not there, that should be ok though</span>
    <span class="n">orig_content</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">read_from</span><span class="p">(</span><span class="n">wildbook_config_fpath_dst</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">orig_content</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;IBEIS_DB_path = .*&#39;</span><span class="p">,</span> <span class="s">&#39;IBEIS_DB_path = &#39;</span> <span class="o">+</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_db_core_path</span><span class="p">(),</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;IBEIS_image_path = .*&#39;</span><span class="p">,</span> <span class="s">&#39;IBEIS_image_path = &#39;</span> <span class="o">+</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imgdir</span><span class="p">(),</span> <span class="n">content</span><span class="p">)</span>

    <span class="c"># Write to the configuration if it is different</span>
    <span class="k">if</span> <span class="n">orig_content</span> <span class="o">!=</span> <span class="n">content</span><span class="p">:</span>
        <span class="n">need_sudo</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_file_writable</span><span class="p">(</span><span class="n">wildbook_config_fpath_dst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">need_sudo</span><span class="p">:</span>
            <span class="n">quoted_content</span> <span class="o">=</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs.wildbook_signal_eid_list()] To update the Wildbook configuration, we need sudo privaleges&#39;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="s">&#39;sh&#39;</span><span class="p">,</span> <span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;echo&#39;</span><span class="p">,</span> <span class="n">quoted_content</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">wildbook_config_fpath_dst</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">]</span>
            <span class="c"># ut.cmd(command, sudo=True)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dryrun</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">write_to</span><span class="p">(</span><span class="n">wildbook_config_fpath_dst</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>


<span class="c"># @default_decorator</span></div>
<div class="viewcode-block" id="export_to_wildbook"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.export_to_wildbook">[docs]</a><span class="k">def</span> <span class="nf">export_to_wildbook</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports identified chips to wildbook</span>

<span class="sd">        Legacy:</span>
<span class="sd">            import ibeis.dbio.export_wb as wb</span>
<span class="sd">            print(&#39;[ibs] exporting to wildbook&#39;)</span>
<span class="sd">            eid_list = ibs.get_valid_eids()</span>
<span class="sd">            addr = &#39;http://127.0.0.1:8080/wildbook-4.1.0-RELEASE&#39;</span>
<span class="sd">            #addr = &#39;http://tomcat:tomcat123@127.0.0.1:8080/wildbook-5.0.0-EXPERIMENTAL&#39;</span>
<span class="sd">            ibs._send_wildbook_request(addr)</span>
<span class="sd">            wb.export_ibeis_to_wildbook(ibs, eid_list)</span>

<span class="sd">            # compute encounters</span>
<span class="sd">            # get encounters by id</span>
<span class="sd">            # get ANNOTATIONs by encounter id</span>
<span class="sd">            # submit requests to wildbook</span>
<span class="sd">            return None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

</div>
<span class="nd">@register_ibs_method</span>
<span class="nd">@register_api</span><span class="p">(</span><span class="s">&#39;/api/core/wildbook_signal_annot_name_changes/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="wildbook_signal_annot_name_changes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.wildbook_signal_annot_name_changes">[docs]</a><span class="k">def</span> <span class="nf">wildbook_signal_annot_name_changes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tomcat_dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wb_target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        aid_list (int):  list of annotation ids(default = None)</span>
<span class="sd">        tomcat_dpath (None): (default = None)</span>
<span class="sd">        wb_target (None): (default = None)</span>
<span class="sd">        dryrun (bool): (default = False)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_annot_name_changes:0 --dryrun</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_annot_name_changes:1 --dryrun</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_annot_name_changes:1</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_annot_name_changes:2</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.control.manual_wildbook_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(defaultdb=&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #gid_list = ibs.get_valid_gids()[0:10]</span>
<span class="sd">        &gt;&gt;&gt; gid_list = ibs.get_valid_gids()[3:5]</span>
<span class="sd">        &gt;&gt;&gt; aid_list = ut.flatten(ibs.get_image_aids(gid_list))</span>
<span class="sd">        &gt;&gt;&gt; # Test case where some names change, some do not. There are no new names.</span>
<span class="sd">        &gt;&gt;&gt; old_nid_list = ibs.get_annot_name_rowids(aid_list)</span>
<span class="sd">        &gt;&gt;&gt; new_nid_list = ut.list_roll(old_nid_list, 1)</span>
<span class="sd">        &gt;&gt;&gt; ibs.set_annot_name_rowids(aid_list, new_nid_list)</span>
<span class="sd">        &gt;&gt;&gt; dryrun = ut.get_argflag(&#39;--dryrun&#39;)</span>
<span class="sd">        &gt;&gt;&gt; wb_target, tomcat_dpath = testdata_wildbook_server()</span>
<span class="sd">        &gt;&gt;&gt; result = ibs.wildbook_signal_annot_name_changes(aid_list, tomcat_dpath, wb_target, dryrun)</span>
<span class="sd">        &gt;&gt;&gt; ibs.set_annot_name_rowids(aid_list, old_nid_list)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.control.manual_wildbook_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(defaultdb=&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #gid_list = ibs.get_valid_gids()[0:10]</span>
<span class="sd">        &gt;&gt;&gt; gid_list = ibs.get_valid_gids()[3:5]</span>
<span class="sd">        &gt;&gt;&gt; aid_list = ut.flatten(ibs.get_image_aids(gid_list))</span>
<span class="sd">        &gt;&gt;&gt; # Test case where all names change to one known name</span>
<span class="sd">        &gt;&gt;&gt; #old_nid_list = ibs.get_annot_name_rowids(aid_list)</span>
<span class="sd">        &gt;&gt;&gt; #new_nid_list = [old_nid_list[0]] * len(old_nid_list)</span>
<span class="sd">        &gt;&gt;&gt; old_nid_list = [1, 2]</span>
<span class="sd">        &gt;&gt;&gt; new_nid_list = [1, 1]</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;old_nid_list = %r&#39; % (old_nid_list,))</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;new_nid_list = %r&#39; % (new_nid_list,))</span>
<span class="sd">        &gt;&gt;&gt; ibs.set_annot_name_rowids(aid_list, new_nid_list)</span>
<span class="sd">        &gt;&gt;&gt; dryrun = ut.get_argflag(&#39;--dryrun&#39;)</span>
<span class="sd">        &gt;&gt;&gt; wb_target, tomcat_dpath = testdata_wildbook_server()</span>
<span class="sd">        &gt;&gt;&gt; result = ibs.wildbook_signal_annot_name_changes(aid_list, tomcat_dpath, wb_target, dryrun)</span>
<span class="sd">        &gt;&gt;&gt; # Undo changes here (not undone in wildbook)</span>
<span class="sd">        &gt;&gt;&gt; #ibs.set_annot_name_rowids(aid_list, old_nid_list)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.control.manual_wildbook_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(defaultdb=&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; gid_list = ibs.get_valid_gids()[3:5]</span>
<span class="sd">        &gt;&gt;&gt; aid_list = ut.flatten(ibs.get_image_aids(gid_list))</span>
<span class="sd">        &gt;&gt;&gt; old_nid_list = [1, 2]</span>
<span class="sd">        &gt;&gt;&gt; ibs.set_annot_name_rowids(aid_list, old_nid_list)</span>
<span class="sd">        &gt;&gt;&gt; # Signal what currently exists (should put them back to normal)</span>
<span class="sd">        &gt;&gt;&gt; dryrun = ut.get_argflag(&#39;--dryrun&#39;)</span>
<span class="sd">        &gt;&gt;&gt; wb_target, tomcat_dpath = testdata_wildbook_server()</span>
<span class="sd">        &gt;&gt;&gt; result = ibs.wildbook_signal_annot_name_changes(aid_list, tomcat_dpath, wb_target, dryrun)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs.wildbook_signal_eid_list()] signaling any annotation name changes to wildbook&#39;</span><span class="p">)</span>

    <span class="n">wildbook_base_url</span><span class="p">,</span> <span class="n">wildbook_tomcat_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_wildbook_info</span><span class="p">(</span><span class="n">tomcat_dpath</span><span class="p">,</span> <span class="n">wb_target</span><span class="p">)</span>
    <span class="n">url_command</span> <span class="o">=</span> <span class="s">&#39;EncounterSetMarkedIndividual&#39;</span>
    <span class="n">BASIC_AUTH</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">BASIC_AUTH</span><span class="p">:</span>
        <span class="c">#url_command += &#39;=authcBasicWildbook&#39;</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s">&#39;tomcat&#39;</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s">&#39;tomcat123&#39;</span>
        <span class="n">wildbook_base_url</span> <span class="o">=</span> <span class="s">&#39;http://&#39;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s">&#39;@&#39;</span> <span class="o">+</span> <span class="n">wildbook_base_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;http://&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">url_args_fmtstr</span> <span class="o">=</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="s">&#39;encounterID={annot_uuid!s}&#39;</span><span class="p">,</span>
        <span class="s">&#39;individualID={name_text!s}&#39;</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="n">submit_namchange_url_fmtstr</span> <span class="o">=</span> <span class="n">wildbook_base_url</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">url_command</span> <span class="o">+</span> <span class="s">&#39;?&#39;</span> <span class="o">+</span> <span class="n">url_args_fmtstr</span>

    <span class="k">if</span> <span class="n">aid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">is_known</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Build URLs to submit</span>
    <span class="n">annot_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_uuids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
    <span class="n">annot_name_text_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_texts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
    <span class="n">submit_url_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">submit_namchange_url_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">annot_uuid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">annot_uuid</span><span class="p">),</span> <span class="n">name_text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">name_text</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">annot_uuid</span><span class="p">,</span> <span class="n">name_text</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">annot_uuid_list</span><span class="p">,</span> <span class="n">annot_name_text_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># Submit each URL</span>
    <span class="n">status_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">submit_url_list</span><span class="p">:</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">submit_wildbook_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">)</span>
        <span class="c">#print(ut.dict_str(response.__dict__, truncate=0))</span>
        <span class="n">status_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="c"># encounter in this message is a wb-encounter not our ia-encounter</span>
            <span class="k">print</span><span class="p">(</span><span class="n">response_json</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Failed getting json from responce. This probably means there is an authentication issue&#39;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">assert</span> <span class="n">response_json</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">status_list</span>

</div>
<span class="nd">@register_ibs_method</span>
<span class="nd">@register_api</span><span class="p">(</span><span class="s">&#39;/api/core/wildbook_signal_eid_list/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="wildbook_signal_eid_list"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.manual_wildbook_funcs.wildbook_signal_eid_list">[docs]</a><span class="k">def</span> <span class="nf">wildbook_signal_eid_list</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">set_shipped_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">open_url_on_complete</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">tomcat_dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wb_target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exports specified encounters to wildbook. This is a synchronous call.</span>

<span class="sd">    Args:</span>
<span class="sd">        eid_list (list): (default = None)</span>
<span class="sd">        set_shipped_flag (bool): (default = True)</span>
<span class="sd">        open_url_on_complete (bool): (default = True)</span>

<span class="sd">    RESTful:</span>
<span class="sd">        Method: PUT</span>
<span class="sd">        URL:    /api/core/wildbook_signal_eid_list/</span>

<span class="sd">    Ignore:</span>
<span class="sd">        cd $CODE_DIR/Wildbook/tmp</span>

<span class="sd">        # Reset IBEIS database</span>
<span class="sd">        python -m ibeis.tests.reset_testdbs --reset_mtest</span>

<span class="sd">        # Reset Wildbook database</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --exec-hyrule_reset_wildbook</span>

<span class="sd">        # Login to wildbook</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --exec-hyrule_wildbook_login</span>

<span class="sd">        # Ship Encounters to wildbook</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_eid_list</span>

<span class="sd">        # Change annotations names to a single name</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_annot_name_changes:1</span>

<span class="sd">        # Change annotations names back to normal</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_annot_name_changes:2</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_eid_list</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_eid_list --dryrun</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --test-wildbook_signal_eid_list --break</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        ~/local/build_scripts/init_wildbook.sh</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from ibeis.control.manual_wildbook_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dryrun = ut.get_argflag(&#39;--dryrun&#39;)</span>
<span class="sd">        &gt;&gt;&gt; wb_target, tomcat_dpath = testdata_wildbook_server()</span>
<span class="sd">        &gt;&gt;&gt; import ibeis</span>
<span class="sd">        &gt;&gt;&gt; ibs = ibeis.opendb(defaultdb=&#39;PZ_MTEST&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #gid_list = ibs.get_valid_gids()[0:10]</span>
<span class="sd">        &gt;&gt;&gt; gid_list = ibs.get_valid_gids()[3:5]</span>
<span class="sd">        &gt;&gt;&gt; new_eid = ibs.create_new_encounter_from_images(gid_list)  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;new encounter uuid = %r&#39; % (ibs.get_encounter_uuid(new_eid),))</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;new encounter text = %r&#39; % (ibs.get_encounter_text(new_eid),))</span>
<span class="sd">        &gt;&gt;&gt; eid_list = [new_eid]</span>
<span class="sd">        &gt;&gt;&gt; ibs.set_encounter_processed_flags([new_eid], [1])</span>
<span class="sd">        &gt;&gt;&gt; gid_list = ibs.get_encounter_gids(new_eid)</span>
<span class="sd">        &gt;&gt;&gt; ibs.set_image_reviewed(gid_list, [1] * len(gid_list))</span>
<span class="sd">        &gt;&gt;&gt; set_shipped_flag = True</span>
<span class="sd">        &gt;&gt;&gt; open_url_on_complete = True</span>
<span class="sd">        &gt;&gt;&gt; result = ibs.wildbook_signal_eid_list(eid_list, set_shipped_flag, open_url_on_complete, tomcat_dpath, wb_target, dryrun)</span>
<span class="sd">        &gt;&gt;&gt; # cleanup</span>
<span class="sd">        &gt;&gt;&gt; #ibs.delete_encounters(new_eid)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_send</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">use_config_file</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">):</span>
        <span class="n">encounter_uuid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_uuid</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">submit_eid_url_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encounter_uuid</span><span class="o">=</span><span class="n">encounter_uuid</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[_send] URL=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">smart_xml_fname</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_smart_xml_fnames</span><span class="p">([</span><span class="n">eid</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">smart_waypoint_id</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_smart_waypoint_ids</span><span class="p">([</span><span class="n">eid</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">smart_xml_fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">smart_waypoint_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Send smart data if availabel</span>
            <span class="k">print</span><span class="p">(</span><span class="n">smart_xml_fname</span><span class="p">,</span> <span class="n">smart_waypoint_id</span><span class="p">)</span>
            <span class="n">smart_xml_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_smart_patrol_dir</span><span class="p">(),</span> <span class="n">smart_xml_fname</span><span class="p">)</span>
            <span class="n">smart_xml_content_list</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">smart_xml_fpath</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[_send] Sending with SMART payload - patrol: </span><span class="si">%r</span><span class="s"> (</span><span class="si">%d</span><span class="s"> lines) waypoint_id: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">smart_xml_fpath</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">smart_xml_content_list</span><span class="p">),</span> <span class="n">smart_waypoint_id</span><span class="p">))</span>
            <span class="n">smart_xml_content</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">smart_xml_content_list</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;smart_xml_content&#39;</span><span class="p">:</span> <span class="n">smart_xml_content</span><span class="p">,</span>
                <span class="s">&#39;smart_waypoint_id&#39;</span><span class="p">:</span> <span class="n">smart_waypoint_id</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_config_file</span><span class="p">:</span>
                <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s">&#39;IBEIS_DB_path&#39;</span>    <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_db_core_path</span><span class="p">(),</span>
                    <span class="s">&#39;IBEIS_image_path&#39;</span> <span class="p">:</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_imgdir</span><span class="p">(),</span>
                <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">submit_wildbook_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">_complete</span><span class="p">(</span><span class="n">eid</span><span class="p">):</span>
        <span class="n">encounter_uuid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_uuid</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
        <span class="n">complete_url_</span> <span class="o">=</span> <span class="n">complete_url_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encounter_uuid</span><span class="o">=</span><span class="n">encounter_uuid</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[_complete] URL=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">complete_url_</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">if</span> <span class="n">open_url_on_complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dryrun</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">get_prefered_browser</span><span class="p">(</span><span class="n">PREFERED_BROWSER</span><span class="p">)</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">complete_url_</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_eids</span><span class="p">()</span>
    <span class="c"># Check to make sure encounters are ok:</span>
    <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">eid_list</span><span class="p">:</span>
        <span class="c"># First, check if encounter can be pushed</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_aids</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;Encounter eid=</span><span class="si">%r</span><span class="s"> cannot be shipped becuase there are no annotations&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eid</span><span class="p">,)</span>
        <span class="n">unknown_flags</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">is_aid_unknown</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">unnamed_aid_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_compress</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">unknown_flags</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">unnamed_aid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;Encounter eid=</span><span class="si">%r</span><span class="s"> cannot be shipped becuase annotation(s) </span><span class="si">%r</span><span class="s"> are not named&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">unnamed_aid_list</span><span class="p">,</span> <span class="p">)</span>

    <span class="c"># Configuration</span>
    <span class="n">use_config_file</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">wildbook_base_url</span><span class="p">,</span> <span class="n">wildbook_tomcat_path</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_wildbook_info</span><span class="p">(</span><span class="n">tomcat_dpath</span><span class="p">,</span> <span class="n">wb_target</span><span class="p">)</span>
    <span class="n">submit_eid_url_fmtstr</span>   <span class="o">=</span> <span class="n">wildbook_base_url</span> <span class="o">+</span> <span class="s">&#39;/OccurrenceCreateIBEIS?ibeis_encounter_id={encounter_uuid!s}&#39;</span>
    <span class="n">complete_url_fmtstr</span> <span class="o">=</span> <span class="n">wildbook_base_url</span> <span class="o">+</span> <span class="s">&#39;/occurrence.jsp?number={encounter_uuid!s}&#39;</span>
    <span class="c"># Call Wildbook url to signal update</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs.wildbook_signal_eid_list()] shipping eid_list = </span><span class="si">%r</span><span class="s"> to wildbook&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eid_list</span><span class="p">,</span> <span class="p">))</span>

    <span class="c"># With a lock file, modify the configuration with the new settings</span>
    <span class="n">lock_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_ibeis_resource_dir</span><span class="p">(),</span> <span class="s">&#39;wildbook.lock&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">lockfile</span><span class="o">.</span><span class="n">LockFile</span><span class="p">(</span><span class="n">lock_fpath</span><span class="p">):</span>
        <span class="c"># Update the Wildbook configuration to see *THIS* ibeis database</span>
        <span class="k">if</span> <span class="n">use_config_file</span><span class="p">:</span>
            <span class="n">update_wildbook_config</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">wildbook_tomcat_path</span><span class="p">,</span> <span class="n">dryrun</span><span class="p">)</span>

        <span class="c"># Check and push &#39;done&#39; encounters</span>
        <span class="n">status_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">eid_list</span><span class="p">:</span>
            <span class="c">#Check for nones</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">_send</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">use_config_file</span><span class="o">=</span><span class="n">use_config_file</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">)</span>
            <span class="n">status_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">set_shipped_flag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dryrun</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">set_encounter_shipped_flags</span><span class="p">([</span><span class="n">eid</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">_complete</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ibs</span><span class="o">.</span><span class="n">set_encounter_shipped_flags</span><span class="p">([</span><span class="n">eid</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">status_list</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --allexamples</span>
<span class="sd">        python -m ibeis.control.manual_wildbook_funcs --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jon Crall.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.4.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>