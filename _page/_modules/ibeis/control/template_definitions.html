<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ibeis.control.template_definitions &mdash; ibeis 0.1.0.dev1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ibeis 0.1.0.dev1 documentation" href="../../../index.html" />
    <link rel="up" title="ibeis.control" href="../control.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../ibeis.html" >ibeis</a> &raquo;</li>
          <li><a href="../control.html" accesskey="U">ibeis.control</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ibeis.control.template_definitions</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CommandLine:</span>
<span class="sd">    python ibeis/control/templates.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">Theader_ibeiscontrol</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # AUTOGENERATED ON {timestamp}</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    ToRegenerate:</span>
<span class="sd">    python ibeis/control/templates.py --dump-autogen-controller</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    from __future__ import absolute_import, division, print_function</span>
<span class="sd">    import functools  # NOQA</span>
<span class="sd">    import six  # NOQA</span>
<span class="sd">    from six.moves import map, range  # NOQA</span>
<span class="sd">    from ibeis import constants</span>
<span class="sd">    from ibeis.control.IBEISControl import IBEISController</span>
<span class="sd">    import utool  # NOQA</span>
<span class="sd">    import utool as ut  # NOQA</span>
<span class="sd">    print, print_, printDBG, rrr, profile = ut.inject(__name__, &#39;[autogen_ibsfuncs]&#39;)</span>

<span class="sd">    # Create dectorator to inject these functions into the IBEISController</span>
<span class="sd">    register_ibs_aliased_method   = ut.make_class_method_decorator((IBEISController, &#39;autogen&#39;))</span>
<span class="sd">    register_ibs_unaliased_method = ut.make_class_method_decorator((IBEISController, &#39;autogen&#39;))</span>


<span class="sd">    def register_ibs_method(func):</span>
<span class="sd">        aliastup = (func, &#39;autogen_&#39; + ut.get_funcname(func))</span>
<span class="sd">        register_ibs_unaliased_method(func)</span>
<span class="sd">        register_ibs_aliased_method(aliastup)</span>
<span class="sd">        return func</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tfooter_ibeiscontrol</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    if __name__ == &#39;__main__&#39;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {main_docstr_body}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        import utool as ut</span>
<span class="sd">        testable_list = [</span>
<span class="sd">            get_annot_featweight_rowids</span>
<span class="sd">        ]</span>
<span class="sd">        ut.doctest_funcs(testable_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- CONFIG ---</span>
<span class="c">#-----------------</span>

<span class="n">Tcfg_leaf_config_rowid_getter</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@ider</span>
<span class="sd">    def get_{leaf}_config_rowid({self}, qreq_=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        returns config_rowid of the current configuration</span>
<span class="sd">        Config rowids are always ensured</span>

<span class="sd">        leaf = {leaf}</span>

<span class="sd">        Tcfg_leaf_config_rowid_getter</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import ibeis; {self} = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_cfg_rowid = {self}.get_{leaf}_config_rowid()</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if qreq_ is not None:</span>
<span class="sd">            {leaf}_cfg_suffix = qreq_.qparams.{leaf}_cfgstr</span>
<span class="sd">            # TODO store config_rowid in qparams</span>
<span class="sd">        else:</span>
<span class="sd">            {leaf}_cfg_suffix = {self}.cfg.{leaf}_cfg.get_cfgstr()</span>
<span class="sd">        {leaf}_cfg_rowid = {self}.add_config({leaf}_cfg_suffix)</span>
<span class="sd">        return {leaf}_cfg_rowid</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- IDERS ---</span>
<span class="c">#-----------------</span>


<span class="n">Tider_all_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@ider</span>
<span class="sd">    def _get_all_{tbl}_rowids({self}):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Tider_all_rowids</span>

<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): unfiltered {tbl}_rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        all_{tbl}_rowids = {self}.{dbself}.get_all_rowids({TABLE})</span>
<span class="sd">        return all_{tbl}_rowids</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- ADDERS ---</span>
<span class="c">#-----------------</span>


<span class="n">Tadder_pl_dependant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@adder</span>
<span class="sd">    def add_{parent}_{leaf}s({self}, {parent}_rowid_list, qreq_=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Adds / ensures / computes a dependant property</span>

<span class="sd">        Tadder_pl_dependant -- CRITICAL FUNCTION MUST EXIST FOR ALL DEPENDANTS</span>

<span class="sd">        parent={parent}</span>
<span class="sd">        leaf={leaf}</span>

<span class="sd">        returns config_rowid of the current configuration</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import ibeis</span>
<span class="sd">            &gt;&gt;&gt; {self} = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; {parent}_rowid_list = {self}.get_valid_{parent}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; qreq_ = None</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = {self}.add_{parent}_{leaf}s({parent}_rowid_list, qreq_=qreq_)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        #REM raise NotImplementedError(&#39;this code is a stub, you must populate it&#39;)</span>
<span class="sd">        from ibeis.model.preproc import preproc_{leaf}</span>
<span class="sd">        # Get requested configuration id</span>
<span class="sd">        config_rowid = {self}.get_{leaf}_config_rowid(qreq_=qreq_)</span>
<span class="sd">        # Find leaf rowids that need to be computed</span>
<span class="sd">        {leaf}_rowid_list = {self}.get_{parent}_{leaf}_rowids({parent}_rowid_list, qreq_=qreq_, ensure=False)</span>
<span class="sd">        # Get corresponding &quot;dirty&quot; parent rowids</span>
<span class="sd">        dirty_{parent}_rowid_list = utool.get_dirty_items({parent}_rowid_list, {leaf}_rowid_list)</span>
<span class="sd">        if len(dirty_{parent}_rowid_list) &gt; 0:</span>
<span class="sd">            if utool.VERBOSE:</span>
<span class="sd">                print(&#39;[{self}] adding %d / %d {leaf}&#39; % (len(dirty_{parent}_rowid_list), len({parent}_rowid_list)))</span>

<span class="sd">            # Dependant columns do not need true from_superkey getters.</span>
<span class="sd">            # We can use the  Tgetter_rl_dependant_rowids instead</span>
<span class="sd">            get_rowid_from_superkey = functools.partial({self}.get_{parent}_{leaf}_rowids, qreq_=qreq_, ensure=False)</span>
<span class="sd">            {leaf_other_propname_lists} = preproc_{leaf}.add_{leaf}_params_gen({self}, {parent}_rowid_list)</span>
<span class="sd">            params_iter = (({parent}_rowid, config_rowid, {leaf_other_propnames})</span>
<span class="sd">                           for {parent}_rowid, {leaf_other_propnames} in</span>
<span class="sd">                           zip({parent}_rowid_list, {leaf_other_propname_lists}))</span>
<span class="sd">            colnames = {nonprimary_leaf_colnames}</span>
<span class="sd">            {leaf}_rowid_list = {self}.dbcache.add_cleanly({LEAF_TABLE}, colnames, params_iter, get_rowid_from_superkey)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="n">Tadder_rl_dependant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@adder</span>
<span class="sd">    def add_{root}_{leaf}s({self}, {root}_rowid_list, qreq_=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Adds / ensures / computes a dependant property</span>

<span class="sd">        CONVINIENCE FUNCTION</span>

<span class="sd">        Tadder_rl_dependant</span>

<span class="sd">        root={root}</span>
<span class="sd">        leaf={leaf}</span>

<span class="sd">        returns config_rowid of the current configuration</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import ibeis</span>
<span class="sd">            &gt;&gt;&gt; {self} = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}.get_valid_{root}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; qreq_ = None</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = {self}.add_{root}_{leaf}s({root}_rowid_list, qreq_=qreq_)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {leaf_parent}_rowid_list = {self}.get_{root}_{leaf_parent}_rowids({root}_rowid_list, qreq_=qreq_, ensure=True)</span>
<span class="sd">        {leaf}_rowid_list = {self}.add_{leaf_parent}_{leaf}s({leaf_parent}_rowid_list, qreq_=qreq_)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- GETTERS ---</span>
<span class="c">#-----------------</span>

<span class="c"># CHILD ROWID GETTERS</span>

<span class="n">Tline_pc_dependant_rowid</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    {child}_rowid_list = {self}.get_{parent}_{child}_rowids({parent}_rowid_list, qreq_=qreq_, ensure=ensure)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="n">Tgetter_rl_pclines_dependant_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{root}_{col}s({self}, {root}_rowid_list, qreq_=None, ensure=False):</span>
<span class="sd">        &quot;&quot;&quot; get {col} data of the {root} table using the dependant {leaf} table</span>

<span class="sd">        Tgetter_rl_pclines_dependant_column</span>

<span class="sd">        root = {root}</span>
<span class="sd">        col  = {col}</span>
<span class="sd">        leaf = {leaf}</span>


<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {col}_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # Get leaf rowids</span>
<span class="sd">        {pc_dependant_rowid_lines}</span>
<span class="sd">        # Get col values</span>
<span class="sd">        {col}_list = {self}.get_{leaf}_{col}({leaf}_rowid_list)</span>
<span class="sd">        return {col}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">Tgetter_rl_dependant_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{root}_{leaf}_rowids({self}, {root}_rowid_list, qreq_=None, ensure=False, eager=True, nParams=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        get {leaf} rowids of {root} under the current state configuration</span>

<span class="sd">        Tgetter_rl_dependant_rowids</span>

<span class="sd">        root        = {root}</span>
<span class="sd">        leaf_parent = {leaf_parent}</span>
<span class="sd">        leaf        = {leaf}</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {leaf}_rowid_list</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import ibeis</span>
<span class="sd">            &gt;&gt;&gt; {self} = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}.get_valid_{root}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; qreq_ = None</span>
<span class="sd">            &gt;&gt;&gt; ensure = False</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list1 = {self}.get_{root}_{leaf}_rowids({root}_rowid_list, qreq_, ensure)</span>
<span class="sd">            &gt;&gt;&gt; print({leaf}_rowid_list1)</span>
<span class="sd">            &gt;&gt;&gt; ensure = True</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list2 = {self}.get_{root}_{leaf}_rowids({root}_rowid_list, qreq_, ensure)</span>
<span class="sd">            &gt;&gt;&gt; print({leaf}_rowid_list2)</span>
<span class="sd">            &gt;&gt;&gt; ensure = False</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list3 = {self}.get_{root}_{leaf}_rowids({root}_rowid_list, qreq_, ensure)</span>
<span class="sd">            &gt;&gt;&gt; print({leaf}_rowid_list3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if ensure:</span>
<span class="sd">            # Ensuring dependant columns is equivilant to adding cleanly</span>
<span class="sd">            return {self}.add_{root}_{leaf}s({root}_rowid_list, qreq_=qreq_)</span>
<span class="sd">        else:</span>
<span class="sd">            # Get leaf_parent rowids</span>
<span class="sd">            {leaf_parent}_rowid_list = {self}.get_{root}_{leaf_parent}_rowids(</span>
<span class="sd">                {root}_rowid_list, qreq_=qreq_, ensure=False)</span>
<span class="sd">            colnames = ({LEAF}_ROWID,)</span>
<span class="sd">            config_rowid = {self}.get_{leaf}_config_rowid(qreq_=qreq_)</span>
<span class="sd">            andwhere_colnames = ({LEAF_PARENT}_ROWID, CONFIG_ROWID,)</span>
<span class="sd">            params_iter = [({leaf_parent}_rowid, config_rowid,) for {leaf_parent}_rowid in {leaf_parent}_rowid_list]</span>
<span class="sd">            {leaf}_rowid_list = {self}.{dbself}.get_where2(</span>
<span class="sd">                {LEAF_TABLE}, colnames, params_iter, andwhere_colnames, eager=eager, nParams=nParams)</span>
<span class="sd">            return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tgetter_pl_dependant_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{parent}_{leaf}_rowids({self}, {parent}_rowid_list, qreq_=None, ensure=False, eager=True, nParams=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        get {leaf} rowids of {parent} under the current state configuration</span>

<span class="sd">        Tgetter_pl_dependant_rowids</span>

<span class="sd">        Args:</span>
<span class="sd">            {parent}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {leaf}_rowid_list</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import ibeis</span>
<span class="sd">            &gt;&gt;&gt; {self} = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; {parent}_rowid_list = {self}.get_valid_{parent}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; qreq_ = None</span>
<span class="sd">            &gt;&gt;&gt; ensure = False</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = {self}.get_{parent}_{leaf}_rowids({parent}_rowid_list, qreq_, ensure)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if ensure:</span>
<span class="sd">            {leaf}_rowid_list = {self}.add_{parent}_{leaf}s({parent}_rowid_list, qreq_=qreq_)</span>
<span class="sd">            return {leaf}_rowid_list</span>
<span class="sd">        else:</span>
<span class="sd">            colnames = ({LEAF}_ROWID,)</span>
<span class="sd">            config_rowid = {self}.get_{leaf}_config_rowid(qreq_=qreq_)</span>
<span class="sd">            andwhere_colnames = ({PARENT}_ROWID, CONFIG_ROWID,)</span>
<span class="sd">            params_iter = (({parent}_rowid, config_rowid,) for {parent}_rowid in {parent}_rowid_list)</span>
<span class="sd">            {leaf}_rowid_list = {self}.{dbself}.get_where2(</span>
<span class="sd">                {LEAF_TABLE}, colnames, params_iter, andwhere_colnames, eager=eager, nParams=nParams)</span>
<span class="sd">            return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tgetter_rl_dependant_all_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{root}_{leaf}_all_rowids({self}, {root}_rowid_list, eager=True, nParams=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        get {leaf} rowids of {root} under the current state configuration</span>

<span class="sd">        Tgetter_rl_dependant_all_rowids</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {leaf}_rowid_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = ({LEAF_PARENT}_ROWID,)</span>
<span class="sd">        {leaf}_rowid_list = {self}.{dbself}.get(</span>
<span class="sd">            {LEAF_TABLE}, colnames, {root}_rowid_list,</span>
<span class="sd">            id_colname={ROOT}_ROWID, eager=eager, nParams=nParams)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tgetter_table_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{tbl}_{col}({self}, {tbl}_rowid_list, eager=True):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        gets data from the &quot;native&quot; column &quot;{col}&quot; in the &quot;{tbl}&quot; table</span>

<span class="sd">        Tgetter_table_column</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {col}_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        id_iter = {tbl}_rowid_list</span>
<span class="sd">        colnames = ({COLNAME},)</span>
<span class="sd">        {col}_list = {self}.dbcache.get({TABLE}, colnames, id_iter, id_colname=&#39;rowid&#39;, eager=eager)</span>
<span class="sd">        return {col}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">Tgetter_pc_dependant_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{parent}_{col}({self}, {parent}_rowid_list, qreq_=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        get {col} data of the {parent} table using the dependant {child} table</span>

<span class="sd">        Tgetter_pc_dependant_column</span>

<span class="sd">        Args:</span>
<span class="sd">            {parent}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {col}_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {child}_rowid_list = {self}.get_{parent}_{child}_rowids({parent}_rowid_list)</span>
<span class="sd">        {col}_list = {self}.get_{child}_{col}({child}_rowid_list, qreq_=qreq_)</span>
<span class="sd">        return {col}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">Tgetter_native_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{tbl}_rowid_from_superkey({self}, {superkey_args}, eager=True, nParams=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Tgetter_native_rowid_from_superkey</span>

<span class="sd">        Args:</span>
<span class="sd">            superkey lists: {superkey_args}</span>

<span class="sd">        Returns:</span>
<span class="sd">            {tbl}_rowid_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = ({TBL}_ROWID),</span>
<span class="sd">        # FIXME: col_rowid is not correct</span>
<span class="sd">        params_iter = zip({superkey_args})</span>
<span class="sd">        andwhere_colnames = [{superkey_args}]</span>
<span class="sd">        {tbl}_rowid_list = {self}.{dbself}.get_where2(</span>
<span class="sd">            {TABLE}, colnames, params_iter, andwhere_colnames, eager=eager, nParams=nParams)</span>
<span class="sd">        return {tbl}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c">#id_iter = (({tbl}_rowid,) for {tbl}_rowid in {tbl}_rowid_list)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- SETTERS ---</span>
<span class="c">#-----------------</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- DELETERS ---</span>
<span class="c">#-----------------</span>

<span class="n">Tline_pc_dependant_delete</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    _{child}_rowid_list = {self}.get_{parent}_{child}_rowids({parent}_rowid_list, qreq_=qreq_, ensure=False)</span>
<span class="sd">    {child}_rowid_list = ut.filter_Nones(_{child}_rowid_list)</span>
<span class="sd">    {self}.delete_{child}({child}_rowid_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="n">Tdeleter_pc_depenant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@deleter</span>
<span class="sd">    #@cache_invalidator({TABLE})</span>
<span class="sd">    def delete_{parent}_{child}({self}, {parent}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        deletes {tbl} from the database</span>

<span class="sd">        Tdeleter_native_tbl</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if utool.VERBOSE:</span>
<span class="sd">            print(&#39;[{self}] deleting %d {tbl} rows&#39; % len({tbl}_rowid_list))</span>
<span class="sd">        _{child}_rowid_list = {self}.get_{parent}_{child}_rowids({parent}_rowid_list, qreq_=qreq_, ensure=False)</span>
<span class="sd">        {child}_rowid_list = ut.filter_Nones(_{child}_rowid_list)</span>
<span class="sd">        {self}.delete_{child}({child}_rowid_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="n">Tdeleter_native_tbl</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@deleter</span>
<span class="sd">    #@cache_invalidator({TABLE})</span>
<span class="sd">    def delete_{tbl}({self}, {tbl}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        deletes {tbl} from the database</span>

<span class="sd">        Tdeleter_native_tbl</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if utool.VERBOSE:</span>
<span class="sd">            print(&#39;[{self}] deleting %d {tbl} rows&#39; % len({tbl}_rowid_list))</span>
<span class="sd">        # Delete any dependants</span>
<span class="sd">        {delete_pc_dependant_lines}</span>
<span class="sd">        # Delete relationships</span>
<span class="sd">        {self}.delete_{tbl}_relations({tbl}_rowid_list)</span>
<span class="sd">        # Delete self</span>
<span class="sd">        {self}.{dbself}.delete_rowids({TABLE}, {tbl}_rowid_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c"># ========</span>
<span class="c"># UNFINISHED</span>
<span class="c"># ========</span>


<span class="c"># eg. get_chip_sizes</span>
<span class="n">Tgetter_native_multicolumn</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@getter</span>
<span class="sd">    def get_{tbl}_{multicol}({self}, {tbl}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Returns zipped tuple of information from {multicol} columns</span>

<span class="sd">        Tgetter_native_multicolumn</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {multicol}_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {multicol}_list  = {self}.dbcache.get({TABLE}, ({MULTI_COLNAMES},), {tbl}_rowid_list)</span>
<span class="sd">        return {multicol}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">Tsetter_native_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@setter</span>
<span class="sd">    def set_{tbl}_{colname}({self}, {tbl}_rowid_list, val_list):</span>
<span class="sd">        pass</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">Tsetter_native_multicolumn</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    def set_{tbl}_{multicolname}({self}, {tbl}_rowid_list, vals_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Tsetter_native_multicolumn</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        pass</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tdeleter_table_relation</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@deleter</span>
<span class="sd">    def delete_{tbl}_relations({self}, {tbl}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot; Deletes the relationship between an {tbl} row and a label &quot;&quot;&quot;</span>
<span class="sd">        {relation}_rowids_list = {self}.get_{tbl}_{relation}_rowids({tbl}_rowid_list)</span>
<span class="sd">        {relation}_rowid_list = utool.flatten({relation}_rowids_list)</span>
<span class="sd">        {self}.db.delete_rowids({RELATION_TABLE}, {relation}_rowid_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="n">Tadder_relationship</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    #@adder</span>
<span class="sd">    def add_image_relationship({self}, gid_list, eid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Adds a relationship between an image and and encounter</span>

<span class="sd">        Tadder_relationship</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = (&#39;image_rowid&#39;, &#39;encounter_rowid&#39;,)</span>
<span class="sd">        params_iter = list(zip(gid_list, eid_list))</span>
<span class="sd">        get_rowid_from_superkey = {self}.get_egr_rowid_from_superkey</span>
<span class="sd">        superkey_paramx = (0, 1)</span>
<span class="sd">        egrid_list = {self}.db.add_cleanly(EG_RELATION_TABLE, colnames, params_iter,</span>
<span class="sd">                                        get_rowid_from_superkey, superkey_paramx)</span>
<span class="sd">        return egrid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">s/ibs/{self}/gc</span>
<span class="sd">s/db/{dbself}/gc</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../ibeis.html" >ibeis</a> &raquo;</li>
          <li><a href="../control.html" >ibeis.control</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jon Crall.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>