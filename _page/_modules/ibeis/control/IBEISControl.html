<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ibeis.control.IBEISControl &mdash; ibeis 0.1.0.dev1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ibeis 0.1.0.dev1 documentation" href="../../../index.html" />
    <link rel="up" title="ibeis.control" href="../control.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../ibeis.html" >ibeis</a> &raquo;</li>
          <li><a href="../control.html" accesskey="U">ibeis.control</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ibeis.control.IBEISControl</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module Licence and docstring</span>

<span class="sd">Algorithm logic does not live here.</span>
<span class="sd">This file defines the data architecture of IBEIS</span>
<span class="sd">This file should only define: iders, adders, setters, getters, deleter</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c"># TODO: rename annotation annotations</span>
<span class="c"># TODO: make all names consistent</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="c"># Python</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">exists</span>
<span class="c"># UTool</span>
<span class="kn">import</span> <span class="nn">utool</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
<span class="c"># IBEIS</span>
<span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">params</span>
<span class="kn">from</span> <span class="nn">ibeis.constants</span> <span class="kn">import</span> <span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">LBLANNOT_TABLE</span><span class="p">,</span>
                             <span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="n">EG_RELATION_TABLE</span><span class="p">,</span>
                             <span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">GL_RELATION_TABLE</span><span class="p">,</span>
                             <span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="n">LBLIMAGE_TABLE</span><span class="p">,</span>
                             <span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="n">LBLTYPE_TABLE</span><span class="p">,</span>
                             <span class="n">METADATA_TABLE</span><span class="p">,</span> <span class="n">VERSIONS_TABLE</span><span class="p">,</span> <span class="n">__STR__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ibeis.control.accessor_decors</span> <span class="kn">import</span> <span class="p">(</span><span class="n">adder</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="n">getter_1toM</span><span class="p">,</span>
                                           <span class="n">getter_1to1</span><span class="p">,</span> <span class="n">ider</span><span class="p">,</span> <span class="n">deleter</span><span class="p">,</span>
                                           <span class="n">default_decorator</span><span class="p">,</span> <span class="n">cache_getter</span><span class="p">,</span>
                                           <span class="n">cache_invalidator</span><span class="p">,</span> <span class="n">init_tablecache</span><span class="p">)</span>
<span class="c"># Inject utool functions</span>
<span class="p">(</span><span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[ibs]&#39;</span><span class="p">)</span>


<span class="n">IMPORTUPFRONT</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">if</span> <span class="n">IMPORTUPFRONT</span><span class="p">:</span>
    <span class="c">#from ibeis.model.detect import randomforest  # NOQA</span>
    <span class="k">pass</span>


<span class="n">__ALL_CONTROLLERS__</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># Global variable containing all created controllers</span>
<span class="n">__IBEIS_CONTROLLER_CACHE__</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="new_IBEISController"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.new_IBEISController">[docs]</a><span class="k">def</span> <span class="nf">new_IBEISController</span><span class="p">(</span><span class="n">dbdir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wbaddr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">__IBEIS_CONTROLLER_CACHE__</span>
    <span class="k">if</span> <span class="n">dbdir</span> <span class="ow">in</span> <span class="n">__IBEIS_CONTROLLER_CACHE__</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[new_IBEISController] returning cached controller&#39;</span><span class="p">)</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">__IBEIS_CONTROLLER_CACHE__</span><span class="p">[</span><span class="n">dbdir</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ibs</span> <span class="o">=</span> <span class="n">IBEISController</span><span class="p">(</span><span class="n">dbdir</span><span class="o">=</span><span class="n">dbdir</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">,</span> <span class="n">wbaddr</span><span class="o">=</span><span class="n">wbaddr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">__IBEIS_CONTROLLER_CACHE__</span><span class="p">[</span><span class="n">dbdir</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibs</span>
    <span class="k">return</span> <span class="n">ibs</span>

</div>
<span class="nd">@atexit.register</span>
<span class="k">def</span> <span class="nf">__cleanup</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; prevents flann errors (not for cleaning up individual objects) &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">__ALL_CONTROLLERS__</span>
    <span class="k">global</span> <span class="n">__IBEIS_CONTROLLER_CACHE__</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">__ALL_CONTROLLERS__</span>
        <span class="k">del</span> <span class="n">__IBEIS_CONTROLLER_CACHE__</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># IBEIS CONTROLLER</span>
<span class="c">#-----------------</span>

<div class="viewcode-block" id="IBEISController"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController">[docs]</a><span class="k">class</span> <span class="nc">IBEISController</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IBEISController docstring</span>

<span class="sd">    chip  - cropped region of interest in an image, maps to one animal</span>
<span class="sd">    cid   - chip unique id</span>
<span class="sd">    gid   - image unique id (could just be the relative file path)</span>
<span class="sd">    name  - name unique id</span>
<span class="sd">    eid   - encounter unique id</span>
<span class="sd">    aid   - region of interest unique id</span>
<span class="sd">    annotation   - region of interest for a chip</span>
<span class="sd">    theta - angle of rotation for a chip</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># use this in controller cython</span>
    <span class="c"># Available in Python-space:</span>
    <span class="c">#property period:</span>
    <span class="c">#    def __get__(self):</span>
    <span class="c">#        return 1.0 / self.freq</span>
    <span class="c">#    def __set__(self, value):</span>
    <span class="c">#        self.freq = 1.0 / value</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#-------------------------------</span>
    <span class="c"># --- CONSTRUCTOR / PRIVATES ---</span>
    <span class="c">#-------------------------------</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">dbdir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wbaddr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a new IBEIS Controller associated with one database &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs.__init__] new IBEISController&#39;</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">table_cache</span> <span class="o">=</span> <span class="n">init_tablecache</span><span class="p">()</span>
        <span class="c"># observer_weakref_list keeps track of the guibacks connected to this controller</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">observer_weakref_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_injections</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_dirs</span><span class="p">(</span><span class="n">dbdir</span><span class="o">=</span><span class="n">dbdir</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="c"># _init_wb will do nothing if no wildbook address is specified</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_wb</span><span class="p">(</span><span class="n">wbaddr</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_sql</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_config</span><span class="p">()</span>
        <span class="c"># an dict to hack in temporary state</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">temporary_state</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">ibs</span><span class="o">.</span><span class="n">register_controller</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_injections</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Injects code from development modules into the controller</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#from ibeis.controller import ibeis_contoller_autogen_funcs</span>
        <span class="c">#ibsfuncs.inject_ibeis(ibs)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">inject_instance</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">classtype</span><span class="o">=</span><span class="s">&#39;IBEISController&#39;</span><span class="p">)</span>  <span class="c"># ibsfuncs key</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">inject_instance</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">classtype</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;IBEISController&#39;</span><span class="p">,</span> <span class="s">&#39;autogen&#39;</span><span class="p">),</span>
                               <span class="n">allow_override</span><span class="o">=</span><span class="s">&#39;override+warn&#39;</span><span class="p">)</span>   <span class="c"># autogenerated key</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;ISSUE WHEN INJECTING AUTOGENERATED FUNCTIONS&#39;</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">inject_instance</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">classtype</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;IBEISController&#39;</span><span class="p">,</span> <span class="s">&#39;manual&#39;</span><span class="p">),</span>
                               <span class="n">allow_override</span><span class="o">=</span><span class="s">&#39;override+warn&#39;</span><span class="p">)</span>   <span class="c"># autogenerated key</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;ISSUE WHEN INJECTING MANUAL FUNCTIONS&#39;</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># We should probably not implement __del__</span>
    <span class="c"># see: https://docs.python.org/2/reference/datamodel.html#object.__del__</span>
    <span class="c">#def __del__(ibs):</span>
    <span class="c">#    ibs.cleanup()</span>

<div class="viewcode-block" id="IBEISController.rrr"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.rrr">[docs]</a>    <span class="k">def</span> <span class="nf">rrr</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">IBEISControl</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">unregister_controller</span><span class="p">()</span>
        <span class="n">IBEISControl</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;reloading IBEISControl&#39;</span><span class="p">)</span>
        <span class="c">#ibsfuncs.inject_ibeis(ibs)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">inject_instance</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">classtype</span><span class="o">=</span><span class="s">&#39;IBEISController&#39;</span><span class="p">)</span>  <span class="c"># ibsfuncs key</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">inject_instance</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">classtype</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;IBEISController&#39;</span><span class="p">,</span> <span class="s">&#39;autogen&#39;</span><span class="p">),</span>
                               <span class="n">allow_override</span><span class="o">=</span><span class="s">&#39;override+warn&#39;</span><span class="p">)</span>   <span class="c"># autogenerated key</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;ISSUE WHEN INJECTING AUTOGENERATED FUNCTIONS&#39;</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">reload_class_methods</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">IBEISControl</span><span class="o">.</span><span class="n">IBEISController</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">register_controller</span><span class="p">()</span>

    <span class="c"># ------------</span>
    <span class="c"># SELF REGISTRATION</span>
    <span class="c"># ------------</span>
</div>
<div class="viewcode-block" id="IBEISController.register_controller"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.register_controller">[docs]</a>    <span class="k">def</span> <span class="nf">register_controller</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; registers controller with global list &quot;&quot;&quot;</span>
        <span class="n">ibs_weakref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="n">__ALL_CONTROLLERS__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ibs_weakref</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.unregister_controller"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.unregister_controller">[docs]</a>    <span class="k">def</span> <span class="nf">unregister_controller</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="n">ibs_weakref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">__ALL_CONTROLLERS__</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ibs_weakref</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c"># ------------</span>
    <span class="c"># OBSERVER REGISTRATION</span>
    <span class="c"># ------------</span>
</div>
<div class="viewcode-block" id="IBEISController.cleanup"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; call on del? &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs.cleanup] Observers (if any) notified [controller killed]&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">observer_weakref</span> <span class="ow">in</span> <span class="n">ibs</span><span class="o">.</span><span class="n">observer_weakref_list</span><span class="p">:</span>
            <span class="n">observer_weakref</span><span class="p">()</span><span class="o">.</span><span class="n">notify_controller_killed</span><span class="p">()</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.register_observer"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.register_observer">[docs]</a>    <span class="k">def</span> <span class="nf">register_observer</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">observer</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[register_observer] Observer registered: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">observer</span><span class="p">)</span>
        <span class="n">observer_weakref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">observer_weakref_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observer_weakref</span><span class="p">)</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.remove_observer"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.remove_observer">[docs]</a>    <span class="k">def</span> <span class="nf">remove_observer</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">observer</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[remove_observer] Observer removed: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">observer</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">observer_weakref_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.notify_observers"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.notify_observers">[docs]</a>    <span class="k">def</span> <span class="nf">notify_observers</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[notify_observers] Observers (if any) notified&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">observer_weakref</span> <span class="ow">in</span> <span class="n">ibs</span><span class="o">.</span><span class="n">observer_weakref_list</span><span class="p">:</span>
            <span class="n">observer_weakref</span><span class="p">()</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="c"># ------------</span>
</div>
    <span class="nd">@default_decorator</span>
    <span class="k">def</span> <span class="nf">_init_wb</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">wbaddr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wbaddr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c">#TODO: Clean this up to use like utool and such</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wbaddr</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">MissingSchema</span> <span class="k">as</span> <span class="n">msa</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs._init_wb] Invalid URL: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">wbaddr</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">msa</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">coe</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs._init_wb] Could not connect to Wildbook server at </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">wbaddr</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">coe</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">wbaddr</span> <span class="o">=</span> <span class="n">wbaddr</span>

    <span class="nd">@default_decorator</span>
    <span class="k">def</span> <span class="nf">_init_dirs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">dbdir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="s">&#39;testdb_1&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s">&#39;~/ibeis_workdir&#39;</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define ibs directories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ensure</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">utool</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs._init_dirs] ibs.dbdir = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dbdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dbdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utool</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">dbdir</span><span class="p">)</span>
            <span class="n">workdir</span><span class="p">,</span> <span class="n">dbname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">dbdir</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">workdir</span>  <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span>
        <span class="n">PATH_NAMES</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">PATH_NAMES</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">sqldb_fname</span> <span class="o">=</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">sqldb</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">sqldbcache_fname</span> <span class="o">=</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">sqldbcache</span>

        <span class="c"># Make sure you are not nesting databases</span>
        <span class="k">assert</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">_ibsdb</span> <span class="o">!=</span> <span class="n">utool</span><span class="o">.</span><span class="n">dirsplit</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">workdir</span><span class="p">),</span> \
            <span class="s">&#39;cannot work in _ibsdb internals&#39;</span>
        <span class="k">assert</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">_ibsdb</span> <span class="o">!=</span> <span class="n">dbname</span><span class="p">,</span>\
            <span class="s">&#39;cannot create db in _ibsdb internals&#39;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbdir</span>    <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbname</span><span class="p">)</span>
        <span class="c"># All internal paths live in &lt;dbdir&gt;/_ibsdb</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span>      <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">dbdir</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">trashdir</span>    <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">dbdir</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">trashdir</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span>    <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">backupdir</span>   <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">backups</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">chipdir</span>     <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">chips</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">imgdir</span>      <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
        <span class="c"># All computed dirs live in &lt;dbdir&gt;/_ibsdb/_ibeis_cache</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">thumb_dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">thumbs</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">flanndir</span>    <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">flann</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">qresdir</span>     <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">qres</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">bigcachedir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">bigcache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">ensure_directories</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">dbdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;must specify database directory&#39;</span>

<div class="viewcode-block" id="IBEISController.ensure_directories"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.ensure_directories">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_directories</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure the core directores for the controller exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_verbose</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span>    <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">backupdir</span><span class="p">,</span>   <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>     <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">imgdir</span><span class="p">,</span>      <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">chipdir</span><span class="p">,</span>     <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">flanndir</span><span class="p">,</span>    <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">qresdir</span><span class="p">,</span>     <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">bigcachedir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">thumb_dpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">_verbose</span><span class="p">)</span>
</div>
    <span class="nd">@default_decorator</span>
    <span class="k">def</span> <span class="nf">_init_sql</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load or create sql database &quot;&quot;&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_sqldb</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_sqldbcache</span><span class="p">()</span>
        <span class="c"># ibs.db.dump_schema()</span>
        <span class="c"># ibs.db.dump()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">UNKNOWN_LBLANNOT_ROWID</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># ADD TO CONSTANTS</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIG_SUFFIX</span> <span class="o">=</span> <span class="s">&#39;MANUAL_CONFIG&#39;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIGID</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIG_SUFFIX</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">ibeis.dev</span> <span class="kn">import</span> <span class="n">duct_tape</span>  <span class="c"># NOQA</span>
        <span class="c"># duct_tape.fix_compname_configs(ibs)</span>
        <span class="c"># duct_tape.remove_database_slag(ibs)</span>
        <span class="c"># duct_tape.fix_nulled_viewpoints(ibs)</span>
        <span class="n">lbltype_names</span>    <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KEY_DEFAULTS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">lbltype_defaults</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KEY_DEFAULTS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">lbltype_ids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_lbltype</span><span class="p">(</span><span class="n">lbltype_names</span><span class="p">,</span> <span class="n">lbltype_defaults</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lbltype_names</span><span class="p">,</span> <span class="n">lbltype_ids</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_init_sqldb</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">_sql_helpers</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">SQLDatabaseControl</span> <span class="k">as</span> <span class="n">sqldbc</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">DB_SCHEMA</span>
        <span class="c"># Before load, ensure database has been backed up for the day</span>
        <span class="n">_sql_helpers</span><span class="o">.</span><span class="n">ensure_daily_database_backup</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_ibsdir</span><span class="p">(),</span> <span class="n">ibs</span><span class="o">.</span><span class="n">sqldb_fname</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">backupdir</span><span class="p">)</span>
        <span class="c"># IBEIS SQL State Database</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db_version_expected</span> <span class="o">=</span> <span class="s">&#39;1.1.1&#39;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">sqldbc</span><span class="o">.</span><span class="n">SQLDatabaseController</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_ibsdir</span><span class="p">(),</span> <span class="n">ibs</span><span class="o">.</span><span class="n">sqldb_fname</span><span class="p">,</span>
                                              <span class="n">text_factory</span><span class="o">=</span><span class="n">__STR__</span><span class="p">,</span>
                                              <span class="n">inmemory</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># Ensure correct schema versions</span>
        <span class="n">_sql_helpers</span><span class="o">.</span><span class="n">ensure_correct_version</span><span class="p">(</span>
            <span class="n">ibs</span><span class="p">,</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="p">,</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">db_version_expected</span><span class="p">,</span>
            <span class="n">DB_SCHEMA</span><span class="p">,</span>
            <span class="n">autogenerate</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dump_autogen_schema</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_sqldbcache</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Need to reinit this sometimes if cache is ever deleted &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">_sql_helpers</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">SQLDatabaseControl</span> <span class="k">as</span> <span class="n">sqldbc</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">DBCACHE_SCHEMA</span>
        <span class="c"># IBEIS SQL Features &amp; Chips database</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache_version_expected</span> <span class="o">=</span> <span class="s">&#39;1.0.3&#39;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span> <span class="o">=</span> <span class="n">sqldbc</span><span class="o">.</span><span class="n">SQLDatabaseController</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="n">ibs</span><span class="o">.</span><span class="n">sqldbcache_fname</span><span class="p">,</span> <span class="n">text_factory</span><span class="o">=</span><span class="n">__STR__</span><span class="p">)</span>
        <span class="n">_sql_helpers</span><span class="o">.</span><span class="n">ensure_correct_version</span><span class="p">(</span>
            <span class="n">ibs</span><span class="p">,</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="p">,</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache_version_expected</span><span class="p">,</span>
            <span class="n">DBCACHE_SCHEMA</span><span class="p">,</span>
            <span class="n">dobackup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>  <span class="c"># Everything in dbcache can be regenerated.</span>
            <span class="n">autogenerate</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dump_autogen_schema</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_close_sqldbcache</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.clone_handle"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.clone_handle">[docs]</a>    <span class="k">def</span> <span class="nf">clone_handle</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ibs2</span> <span class="o">=</span> <span class="n">IBEISController</span><span class="p">(</span><span class="n">dbdir</span><span class="o">=</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_dbdir</span><span class="p">(),</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ibs2</span><span class="o">.</span><span class="n">update_query_cfg</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c">#if ibs.qreq is not None:</span>
        <span class="c">#    ibs2._prep_qreq(ibs.qreq.qaids, ibs.qreq.daids)</span>
        <span class="k">return</span> <span class="n">ibs2</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.backup_database"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.backup_database">[docs]</a>    <span class="k">def</span> <span class="nf">backup_database</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">_sql_helpers</span>
        <span class="n">_sql_helpers</span><span class="o">.</span><span class="n">database_backup</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_ibsdir</span><span class="p">(),</span> <span class="n">ibs</span><span class="o">.</span><span class="n">sqldb_fname</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">backupdir</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#--------------</span>
    <span class="c"># --- DIRS ----</span>
    <span class="c">#--------------</span>
</div>
<div class="viewcode-block" id="IBEISController.get_dbname"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_dbname">[docs]</a>    <span class="k">def</span> <span class="nf">get_dbname</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database name &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbname</span>
</div>
<div class="viewcode-block" id="IBEISController.get_dbdir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_dbdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_dbdir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database dir with ibs internal directory &quot;&quot;&quot;</span>
        <span class="c">#return join(ibs.workdir, ibs.dbname)</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbdir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_trashdir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_trashdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_trashdir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">trashdir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_ibsdir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_ibsdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_ibsdir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): ibs internal directory &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span>
</div>
<div class="viewcode-block" id="IBEISController.get_fig_dir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_fig_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_fig_dir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): ibs internal directory &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">_ibsdb</span><span class="p">,</span> <span class="s">&#39;figures&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.get_imgdir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_imgdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_imgdir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): ibs internal directory &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">imgdir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_thumbdir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_thumbdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_thumbdir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database directory where thumbnails are cached &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">thumb_dpath</span>
</div>
<div class="viewcode-block" id="IBEISController.get_workdir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_workdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_workdir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): directory where databases are saved to &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">workdir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_cachedir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_cachedir">[docs]</a>    <span class="k">def</span> <span class="nf">get_cachedir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database directory of all cached files &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_detectimg_cachedir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_detectimg_cachedir">[docs]</a>    <span class="k">def</span> <span class="nf">get_detectimg_cachedir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database directory of image resized for detections &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">PATH_NAMES</span><span class="o">.</span><span class="n">detectimg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.get_flann_cachedir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_flann_cachedir">[docs]</a>    <span class="k">def</span> <span class="nf">get_flann_cachedir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database directory where the FLANN KD-Tree is stored &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">flanndir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_qres_cachedir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_qres_cachedir">[docs]</a>    <span class="k">def</span> <span class="nf">get_qres_cachedir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database directory where query results are stored &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">qresdir</span>
</div>
<div class="viewcode-block" id="IBEISController.get_big_cachedir"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_big_cachedir">[docs]</a>    <span class="k">def</span> <span class="nf">get_big_cachedir</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): database directory where aggregate results are stored &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">bigcachedir</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#----------------</span>
    <span class="c"># --- Configs ---</span>
    <span class="c">#----------------</span>
</div>
    <span class="k">def</span> <span class="nf">_init_config</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loads the database&#39;s algorithm configuration &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model</span> <span class="kn">import</span> <span class="n">Config</span>
        <span class="c"># Always a fresh object</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">GenericConfig</span><span class="p">(</span><span class="s">&#39;cfg&#39;</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">dbdir</span><span class="p">,</span> <span class="s">&#39;cfg&#39;</span><span class="p">))</span>
        <span class="c"># TODO: update cfgs between versions</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Use pref cache</span>
            <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">is_developer</span><span class="p">()</span> <span class="ow">or</span> <span class="n">utool</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">((</span><span class="s">&#39;--nocache-pref&#39;</span><span class="p">,)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">NOT_QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] successfully loaded config&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c"># Totally new completely default preferences</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">_default_config</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_default_config</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resets the databases&#39;s algorithm configuration &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model</span> <span class="kn">import</span> <span class="n">Config</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">utool</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] building default config&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
            <span class="c"># Sometimes a fresh object</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">GenericConfig</span><span class="p">(</span><span class="s">&#39;cfg&#39;</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">dbdir</span><span class="p">,</span> <span class="s">&#39;cfg&#39;</span><span class="p">))</span>
        <span class="n">query_cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">default_query_cfg</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_query_cfg</span><span class="p">(</span><span class="n">query_cfg</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">enc_cfg</span>     <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">EncounterConfig</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span>  <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">DetectionConfig</span><span class="p">()</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span>   <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">OtherConfig</span><span class="p">()</span>

        <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_database_species</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># try to be intelligent about the default speceis</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.set_query_cfg"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_query_cfg">[docs]</a>    <span class="k">def</span> <span class="nf">set_query_cfg</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">query_cfg</span><span class="p">):</span>
        <span class="c">#if ibs.qreq is not None:</span>
        <span class="c">#    ibs.qreq.set_cfg(query_cfg)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span> <span class="o">=</span> <span class="n">query_cfg</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">featweight_cfg</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">_featweight_cfg</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">feat_cfg</span>       <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">_featweight_cfg</span><span class="o">.</span><span class="n">_feat_cfg</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">chip_cfg</span>       <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">_featweight_cfg</span><span class="o">.</span><span class="n">_feat_cfg</span><span class="o">.</span><span class="n">_chip_cfg</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.update_query_cfg"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.update_query_cfg">[docs]</a>    <span class="k">def</span> <span class="nf">update_query_cfg</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates query config only. Configs needs a restructure very badly &quot;&quot;&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">update_query_cfg</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">featweight_cfg</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">_featweight_cfg</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">feat_cfg</span>       <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">_featweight_cfg</span><span class="o">.</span><span class="n">_feat_cfg</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">chip_cfg</span>       <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">_featweight_cfg</span><span class="o">.</span><span class="n">_feat_cfg</span><span class="o">.</span><span class="n">_chip_cfg</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.get_chip_config_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_config_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_config_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; # FIXME: Configs are still handled poorly</span>

<span class="sd">        This method deviates from the rest of the controller methods because it</span>
<span class="sd">        always returns a scalar instead of a list. I&#39;m still not sure how to</span>
<span class="sd">        make it more ibeisy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chip_cfg_suffix</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">chip_cfg</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">()</span>
        <span class="n">chip_cfg_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">chip_cfg_suffix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chip_cfg_rowid</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.get_feat_config_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_feat_config_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_feat_config_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the feature configuration id based on the cfgstr</span>
<span class="sd">        defined by ibs.cfg.feat_cfg.get_cfgstr()</span>

<span class="sd">        # FIXME: Configs are still handled poorly</span>
<span class="sd">        used in ibeis.model.preproc.preproc_feats in the param</span>
<span class="sd">        generator. (that should probably be moved into the controller)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feat_cfg_suffix</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">feat_cfg</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">()</span>
        <span class="n">feat_cfg_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">feat_cfg_suffix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feat_cfg_rowid</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.get_query_config_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_query_config_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_query_config_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; # FIXME: Configs are still handled poorly &quot;&quot;&quot;</span>
        <span class="n">query_cfg_suffix</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">()</span>
        <span class="n">query_cfg_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">query_cfg_suffix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query_cfg_rowid</span>

    <span class="c">#@default_decorator</span>
    <span class="c">#def get_qreq_rowid(ibs):</span>
    <span class="c">#    &quot;&quot;&quot; # FIXME: Configs are still handled poorly &quot;&quot;&quot;</span>
    <span class="c">#    assert ibs.qres is not None</span>
    <span class="c">#    qreq_rowid = ibs.qreq.get_cfgstr()</span>
    <span class="c">#    return qreq_rowid</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#-------------</span>
    <span class="c"># --- INFO ---</span>
    <span class="c">#-------------</span>
</div>
<div class="viewcode-block" id="IBEISController.get_num_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_num_images">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Number of valid images &quot;&quot;&quot;</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.get_num_annotations"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_num_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_annotations</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Number of valid annotations &quot;&quot;&quot;</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.get_num_names"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_num_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_names</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Number of valid name (subset of lblannot) &quot;&quot;&quot;</span>
        <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_nids</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#---------------</span>
    <span class="c"># --- IDERS ---</span>
    <span class="c">#---------------</span>

    <span class="c"># Standard</span>

    <span class="c"># Internal</span>
</div>
    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_contrib_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  all unfiltered contrib_rowid (contributor rowid) &quot;&quot;&quot;</span>
        <span class="n">all_contrib_rowids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_contrib_rowids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  all unfiltered gids (image rowids) &quot;&quot;&quot;</span>
        <span class="n">all_gids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_gids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  all unfiltered aids (annotation rowids) &quot;&quot;&quot;</span>
        <span class="n">all_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_aids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_eids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  all unfiltered eids (encounter rowids) &quot;&quot;&quot;</span>
        <span class="n">all_eids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_eids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_cids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): unfiltered cids (computed chip rowids) for every</span>
<span class="sd">        configuration (YOU PROBABLY SHOULD NOT USE THIS) &quot;&quot;&quot;</span>
        <span class="n">all_cids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_cids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_fids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): unfiltered fids (computed feature rowids) for every</span>
<span class="sd">        configuration (YOU PROBABLY SHOULD NOT USE THIS)&quot;&quot;&quot;</span>
        <span class="n">all_fids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_fids</span>

    <span class="n">_get_all_feat_rowids</span> <span class="o">=</span> <span class="n">_get_all_fids</span>
    <span class="n">_get_all_chip_rowids</span> <span class="o">=</span> <span class="n">_get_all_cids</span>
    <span class="n">_get_all_annot_rowids</span> <span class="o">=</span> <span class="n">_get_all_aids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_known_lblannot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): all nids of known animals</span>
<span class="sd">            (does not include unknown names) &quot;&quot;&quot;</span>
        <span class="n">all_known_lblannot_rowids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids_where</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="s">&#39;lbltype_rowid=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">],))</span>
        <span class="k">return</span> <span class="n">all_known_lblannot_rowids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_lblannot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="n">all_lblannot_rowids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_lblannot_rowids</span>

    <span class="c">#@ider</span>
    <span class="c">#def _get_all_alr_rowids(ibs):</span>
    <span class="c">#    all_alr_rowids = ibs.db.get_all_rowids(AL_RELATION_TABLE)</span>
    <span class="c">#    return all_alr_rowids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_known_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): all nids of known animals</span>
<span class="sd">            (does not include unknown names) &quot;&quot;&quot;</span>
        <span class="n">all_known_nids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_known_lblannot_rowids</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_known_nids</span>

    <span class="nd">@ider</span>
    <span class="k">def</span> <span class="nf">_get_all_known_species_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): all nids of known animals</span>
<span class="sd">            (does not include unknown names) &quot;&quot;&quot;</span>
        <span class="n">all_known_species_rowids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_known_lblannot_rowids</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_known_species_rowids</span>

    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_contrib_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_contrib_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_contrib_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  list of all contributor ids &quot;&quot;&quot;</span>
        <span class="n">contrib_rowids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_contrib_rowids</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">contrib_rowids_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">require_unixtime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reviewed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_gids</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_gids</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">require_unixtime</span><span class="p">:</span>
            <span class="c"># Remove images without timestamps</span>
            <span class="n">unixtime_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_unixtime</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">isvalid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">unixtime</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">unixtime</span> <span class="ow">in</span> <span class="n">unixtime_list</span><span class="p">]</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">isvalid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reviewed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">reviewed_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_reviewed</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">isvalid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">reviewed</span> <span class="o">==</span> <span class="n">flag</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">reviewed_list</span><span class="p">]</span>
            <span class="n">gid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">isvalid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_eids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_eids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_eids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">min_num_gids</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  list of all encounter ids &quot;&quot;&quot;</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_eids</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">min_num_gids</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_gids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_num_gids</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">num_gids</span> <span class="o">&gt;=</span> <span class="n">min_num_gids</span> <span class="k">for</span> <span class="n">num_gids</span> <span class="ow">in</span> <span class="n">num_gids_list</span><span class="p">]</span>
            <span class="n">eid_list</span>  <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">eid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_exemplar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  a list of valid ANNOTATION unique ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">is_exemplar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Optimization Hack</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids_where</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="s">&#39;annot_exemplar_flag=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">is_exemplar</span><span class="p">,))</span>
            <span class="k">return</span> <span class="n">aid_list</span>
        <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_aids</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># HACK: Check to see if you want the</span>
            <span class="c"># exemplar &quot;encounter&quot; (image group)</span>
            <span class="n">enctext</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_enctext</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enctext</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">EXEMPLAR_ENCTEXT</span><span class="p">:</span>
                <span class="n">is_exemplar</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_aids</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_exemplar</span><span class="p">:</span>
            <span class="n">flag_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_exemplar_flag</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_nids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filter_empty</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): all valid names with at least one animal</span>
<span class="sd">            (does not include unknown names) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_known_nids</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_nids</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
        <span class="n">nRois_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_num_annotations</span><span class="p">(</span><span class="n">_nid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filter_empty</span><span class="p">:</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">nid</span> <span class="k">for</span> <span class="n">nid</span><span class="p">,</span> <span class="n">nRois</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_nid_list</span><span class="p">,</span> <span class="n">nRois_list</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nRois</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">_nid_list</span>
        <span class="k">return</span> <span class="n">nid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_invalid_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_invalid_nids">[docs]</a>    <span class="k">def</span> <span class="nf">get_invalid_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): all names without any animals (does not include unknown names) &quot;&quot;&quot;</span>
        <span class="n">_nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_get_all_known_nids</span><span class="p">()</span>
        <span class="n">nRois_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_num_annotations</span><span class="p">(</span><span class="n">_nid_list</span><span class="p">)</span>
        <span class="n">nid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">nid</span> <span class="k">for</span> <span class="n">nid</span><span class="p">,</span> <span class="n">nRois</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_nid_list</span><span class="p">,</span> <span class="n">nRois_list</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nRois</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_cids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_cids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_cids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Valid chip rowids of the current configuration &quot;&quot;&quot;</span>
        <span class="c"># FIXME: configids need reworking</span>
        <span class="n">chip_config_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_config_rowid</span><span class="p">()</span>
        <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get_all_rowids_where</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="s">&#39;config_rowid=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">chip_config_rowid</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">cid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_fids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_fids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_fids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Valid feature rowids of the current configuration &quot;&quot;&quot;</span>
        <span class="c"># FIXME: configids need reworking</span>
        <span class="n">feat_config_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_feat_config_rowid</span><span class="p">()</span>
        <span class="n">fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get_all_rowids_where</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="s">&#39;config_rowid=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">feat_config_rowid</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">fid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_valid_configids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_valid_configids">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_configids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_all_rowids</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#---------------</span>
    <span class="c"># --- ADDERS ---</span>
    <span class="c">#---------------</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_metadata"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">add_metadata</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">metadata_key_list</span><span class="p">,</span> <span class="n">metadata_value_list</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds metadata</span>

<span class="sd">        Returns:</span>
<span class="sd">            metadata_rowid_list (list): metadata rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] adding </span><span class="si">%d</span><span class="s"> metadata&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata_key_list</span><span class="p">))</span>
        <span class="c"># Add encounter text names to database</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;metadata_key&#39;</span><span class="p">,</span> <span class="s">&#39;metadata_value&#39;</span><span class="p">]</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">metadata_key_list</span><span class="p">,</span> <span class="n">metadata_value_list</span><span class="p">)</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_metadata_rowid_from_metadata_key</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="p">(</span><span class="n">db</span><span class="p">,))</span>
        <span class="n">metadata_rowid_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">METADATA_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata_rowid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_contributors"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_contributors">[docs]</a>    <span class="k">def</span> <span class="nf">add_contributors</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">uuid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name_first_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name_last_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">loc_city_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">loc_state_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">loc_country_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">loc_zip_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">notes_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a list of contributors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            contrib_id_list (list): contributor rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="k">def</span> <span class="nf">_valid_zip</span><span class="p">(</span><span class="n">_zip</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;00000&#39;</span><span class="p">):</span>
            <span class="n">_zip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_zip</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_zip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">_zip</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">_zip</span>
            <span class="k">return</span> <span class="n">default</span>

        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] adding </span><span class="si">%d</span><span class="s"> encounters&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">))</span>
        <span class="c"># Add contributors to database</span>
        <span class="k">if</span> <span class="n">name_first_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name_first_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name_last_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name_last_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loc_city_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">loc_city_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loc_state_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">loc_state_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loc_country_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">loc_country_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loc_zip_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">loc_zip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">notes_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">notes_list</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;Created </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">))]</span>

        <span class="n">loc_zip_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_valid_zip</span><span class="p">(</span><span class="n">_zip</span><span class="p">)</span> <span class="k">for</span> <span class="n">_zip</span> <span class="ow">in</span> <span class="n">loc_zip_list</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">uuid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_list</span><span class="p">))]</span>

        <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;contributor_uuid&#39;</span><span class="p">,</span> <span class="s">&#39;contributor_tag&#39;</span><span class="p">,</span> <span class="s">&#39;contributor_name_first&#39;</span><span class="p">,</span>
                    <span class="s">&#39;contributor_name_last&#39;</span><span class="p">,</span> <span class="s">&#39;contributor_location_city&#39;</span><span class="p">,</span>
                    <span class="s">&#39;contributor_location_state&#39;</span><span class="p">,</span> <span class="s">&#39;contributor_location_country&#39;</span><span class="p">,</span>
                    <span class="s">&#39;contributor_location_zip&#39;</span><span class="p">,</span> <span class="s">&#39;contributor_note&#39;</span><span class="p">]</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">name_first_list</span><span class="p">,</span>
                          <span class="n">name_last_list</span><span class="p">,</span> <span class="n">loc_city_list</span><span class="p">,</span> <span class="n">loc_state_list</span><span class="p">,</span>
                          <span class="n">loc_country_list</span><span class="p">,</span> <span class="n">loc_zip_list</span><span class="p">,</span> <span class="n">notes_list</span><span class="p">)</span>

        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_rowid_from_uuid</span>
        <span class="n">contrib_id_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_id_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_images">[docs]</a>    <span class="k">def</span> <span class="nf">add_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gpath_list</span><span class="p">,</span> <span class="n">params_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">as_annots</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a list of image paths to the database.</span>

<span class="sd">        Initially we set the image_uri to exactely the given gpath.</span>
<span class="sd">        Later we change the uri, but keeping it the same here lets</span>
<span class="sd">        us process images asychronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            gpath_list (list): list of image paths to add</span>
<span class="sd">            params_list (list): metadata list for corresponding images that can either be</span>
<span class="sd">                specified outright or can be parsed from the image data directly if None</span>
<span class="sd">            as_annots (bool): if True, an annotation is automatically added for the entire</span>
<span class="sd">                image</span>

<span class="sd">        Returns:</span>
<span class="sd">            gid_list (list of rowids): gids are image rowids</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.all_imports import *  # NOQA  # doctest.SKIP</span>
<span class="sd">            &gt;&gt;&gt; gpath_list = grabdata.get_test_gpaths(ndata=7) + [&#39;doesnotexist.jpg&#39;]</span>
<span class="sd">            &gt;&gt;&gt; ibs.add_images(gpath_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] add_images&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] len(gpath_list) = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">))</span>
        <span class="c">#print(&#39;[ibs] gpath_list = %r&#39; % (gpath_list,))</span>
        <span class="c"># Processing an image might fail, yeilding a None instead of a tup</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_image</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">ensure_unix_gpaths</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Create param_iter</span>
            <span class="n">params_list</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">preproc_image</span><span class="o">.</span><span class="n">add_images_params_gen</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">))</span>
        <span class="c"># Error reporting</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39; ! Failed reading gpath=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gpath</span><span class="p">,)</span> <span class="k">for</span> <span class="p">(</span><span class="n">gpath</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
             <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">,</span> <span class="n">params_list</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">]))</span>
        <span class="c"># Add any unadded images</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;image_uuid&#39;</span><span class="p">,</span> <span class="s">&#39;image_uri&#39;</span><span class="p">,</span> <span class="s">&#39;image_original_name&#39;</span><span class="p">,</span>
                    <span class="s">&#39;image_ext&#39;</span><span class="p">,</span> <span class="s">&#39;image_width&#39;</span><span class="p">,</span> <span class="s">&#39;image_height&#39;</span><span class="p">,</span>
                    <span class="s">&#39;image_time_posix&#39;</span><span class="p">,</span> <span class="s">&#39;image_gps_lat&#39;</span><span class="p">,</span>
                    <span class="s">&#39;image_gps_lon&#39;</span><span class="p">,</span> <span class="s">&#39;image_note&#39;</span><span class="p">,)</span>
        <span class="c"># &lt;DEBUG&gt;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="n">uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">params_list</span><span class="p">]</span>
            <span class="n">gid_list_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">)</span>
            <span class="n">valid_gids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
            <span class="n">valid_uuids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">valid_gids</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[preadd] uuid / gid_ = &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">gid_list_</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[preadd] valid uuid / gid = &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">valid_uuids</span><span class="p">,</span> <span class="n">valid_gids</span><span class="p">)))</span>
        <span class="c"># &lt;/DEBUG&gt;</span>
        <span class="c"># Execute SQL Add</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">duplicates_exist</span><span class="p">(</span><span class="n">gid_list</span><span class="p">):</span>
            <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">guuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">gext_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_exts</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">debug_duplicate_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">gpath_list</span><span class="p">,</span> <span class="n">guuid_list</span><span class="p">,</span> <span class="n">gext_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="n">uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">params_list</span><span class="p">]</span>
            <span class="n">gid_list_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">)</span>
            <span class="n">valid_gids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
            <span class="n">valid_uuids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">valid_gids</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[postadd] uuid / gid_ = &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">gid_list_</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[postadd] uuid / gid = &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[postadd] valid uuid / gid = &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">valid_uuids</span><span class="p">,</span> <span class="n">valid_gids</span><span class="p">)))</span>

        <span class="c">#ibs.cfg.other_cfg.ensure_attr(&#39;auto_localize&#39;, True)</span>
        <span class="k">if</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">auto_localize</span><span class="p">:</span>
            <span class="c"># Move to ibeis database local cache</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">localize_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">as_annots</span><span class="p">:</span>
            <span class="c"># Add succesfull imports as annotations</span>
            <span class="n">isnone_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">]</span>
            <span class="n">gid_list_</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">isnone_list</span><span class="p">)</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">use_images_as_annotations</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] added </span><span class="si">%d</span><span class="s"> annotations&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">),))</span>
        <span class="k">return</span> <span class="n">gid_list</span>
</div>
<div class="viewcode-block" id="IBEISController.localize_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.localize_images">[docs]</a>    <span class="k">def</span> <span class="nf">localize_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the images into the ibeis image cache.</span>
<span class="sd">        Images are renamed to img_uuid.ext</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gid_list_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: you are localizing all gids&#39;</span><span class="p">)</span>
            <span class="n">gid_list_</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
        <span class="n">isnone_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list_</span><span class="p">]</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">unique_keep_order2</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">gid_list_</span><span class="p">,</span> <span class="n">isnone_list</span><span class="p">))</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">guuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">gext_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_exts</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="c"># Build list of image names based on uuid in the ibeis imgdir</span>
        <span class="n">guuid_strs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">guuid</span><span class="p">)</span> <span class="k">for</span> <span class="n">guuid</span> <span class="ow">in</span> <span class="n">guuid_list</span><span class="p">)</span>
        <span class="n">loc_gname_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">guuid</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="p">(</span><span class="n">guuid</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">guuid_strs</span><span class="p">,</span> <span class="n">gext_list</span><span class="p">)]</span>
        <span class="n">loc_gpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">imgdir</span><span class="p">,</span> <span class="n">gname</span><span class="p">)</span> <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">loc_gname_list</span><span class="p">]</span>
        <span class="c"># Copy images to local directory</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">copy_list</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">,</span> <span class="n">loc_gpath_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Localizing Images: &#39;</span><span class="p">)</span>
        <span class="c"># Update database uris</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_uris</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">loc_gname_list</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="n">loc_gpath_list</span><span class="p">)),</span> <span class="s">&#39;not all images copied&#39;</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_encounters"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_encounters">[docs]</a>    <span class="k">def</span> <span class="nf">add_encounters</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">enctext_list</span><span class="p">,</span> <span class="n">encounter_uuid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">notes_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a list of encounters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            eid_list (list): added encounter rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] adding </span><span class="si">%d</span><span class="s"> encounters&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">))</span>
        <span class="c"># Add encounter text names to database</span>
        <span class="k">if</span> <span class="n">notes_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">notes_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encounter_uuid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">encounter_uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">config_rowid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIGID</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;encounter_text&#39;</span><span class="p">,</span> <span class="s">&#39;encounter_uuid&#39;</span><span class="p">,</span> <span class="s">&#39;config_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;encounter_note&#39;</span><span class="p">]</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">,</span> <span class="n">encounter_uuid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">notes_list</span><span class="p">)</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_eids_from_text</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_annots"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_annots">[docs]</a>    <span class="k">def</span> <span class="nf">add_annots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">bbox_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">theta_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">species_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">detect_confidence_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">notes_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">vert_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">annotation_uuid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">viewpoint_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">quiet_delete_thumbs</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an annotation to images</span>

<span class="sd">        Args:</span>
<span class="sd">            gid_list (list of rowids): image rowids to add annotation to</span>
<span class="sd">            bbox_list (list of [x, y, w, h]): bounding boxes for each image (optional). Supply Verts instead</span>
<span class="sd">            theta_list (list of float): orientations of annotations</span>
<span class="sd">            vert_list (list of lists):  alternative to bounding box</span>

<span class="sd">        Returns:</span>
<span class="sd">             list: aid_list a list of annotation rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">vtool</span> <span class="kn">import</span> <span class="n">geometry</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] adding annotations&#39;</span><span class="p">)</span>
        <span class="c"># Prepare the SQL input</span>
        <span class="k">assert</span> <span class="n">name_list</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">nid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;cannot specify both names and nids&#39;</span>
        <span class="c"># For import only, we can specify both by setting import_override to True</span>
        <span class="k">assert</span> <span class="nb">bool</span><span class="p">(</span><span class="n">bbox_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">vert_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">),</span> <span class="s">&#39;must specify exactly one of bbox_list or vert_list&#39;</span>

        <span class="k">if</span> <span class="n">theta_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">theta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">name_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_names</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detect_confidence_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">detect_confidence_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">notes_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">notes_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">vert_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">vert_list</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">verts_list_from_bboxes_list</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bbox_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bbox_list</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">bboxes_from_vert_list</span><span class="p">(</span><span class="n">vert_list</span><span class="p">)</span>

        <span class="n">len_bbox</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span>
        <span class="n">len_vert</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vert_list</span><span class="p">)</span>
        <span class="n">len_gid</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">len_notes</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">notes_list</span><span class="p">)</span>
        <span class="n">len_theta</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta_list</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">len_vert</span> <span class="o">==</span> <span class="n">len_bbox</span><span class="p">,</span> <span class="s">&#39;bbox and verts are not of same size&#39;</span>
            <span class="k">assert</span> <span class="n">len_gid</span>  <span class="o">==</span> <span class="n">len_bbox</span><span class="p">,</span> <span class="s">&#39;bbox and gid are not of same size&#39;</span>
            <span class="k">assert</span> <span class="n">len_gid</span>  <span class="o">==</span> <span class="n">len_theta</span><span class="p">,</span> <span class="s">&#39;bbox and gid are not of same size&#39;</span>
            <span class="k">assert</span> <span class="n">len_notes</span> <span class="o">==</span> <span class="n">len_gid</span><span class="p">,</span> <span class="s">&#39;notes and gids are not of same size&#39;</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;len_vert&#39;</span><span class="p">,</span> <span class="s">&#39;len_gid&#39;</span><span class="p">,</span> <span class="s">&#39;len_bbox&#39;</span>
                                        <span class="s">&#39;len_theta&#39;</span><span class="p">,</span> <span class="s">&#39;len_notes&#39;</span><span class="p">])</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># nothing is being added</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] WARNING: 0 annotations are beign added!&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">dict_str</span><span class="p">(</span><span class="nb">locals</span><span class="p">()))</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c"># Build ~~deterministic?~~ random and unique ANNOTATION ids</span>
        <span class="n">image_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="c">#annotation_uuid_list = ibsfuncs.make_annotation_uuids(image_uuid_list, bbox_list,</span>
        <span class="c">#                                                      theta_list, deterministic=False)</span>
        <span class="k">if</span> <span class="n">annotation_uuid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">annotation_uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_uuid_list</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">viewpoint_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">viewpoint_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_uuid_list</span><span class="p">)</span>
        <span class="n">nVert_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span> <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="n">vert_list</span><span class="p">]</span>
        <span class="n">vertstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">__STR__</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span> <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="n">vert_list</span><span class="p">]</span>
        <span class="n">xtl_list</span><span class="p">,</span> <span class="n">ytl_list</span><span class="p">,</span> <span class="n">width_list</span><span class="p">,</span> <span class="n">height_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bbox_list</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nVert_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertstr_list</span><span class="p">)</span>
        <span class="c"># Define arguments to insert</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_uuid&#39;</span><span class="p">,</span> <span class="s">&#39;image_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;annot_xtl&#39;</span><span class="p">,</span> <span class="s">&#39;annot_ytl&#39;</span><span class="p">,</span>
                    <span class="s">&#39;annot_width&#39;</span><span class="p">,</span> <span class="s">&#39;annot_height&#39;</span><span class="p">,</span> <span class="s">&#39;annot_theta&#39;</span><span class="p">,</span> <span class="s">&#39;annot_num_verts&#39;</span><span class="p">,</span>
                    <span class="s">&#39;annot_verts&#39;</span><span class="p">,</span> <span class="s">&#39;annot_viewpoint&#39;</span><span class="p">,</span> <span class="s">&#39;annot_detect_confidence&#39;</span><span class="p">,</span>
                    <span class="s">&#39;annot_note&#39;</span><span class="p">,)</span>

        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">annotation_uuid_list</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">xtl_list</span><span class="p">,</span> <span class="n">ytl_list</span><span class="p">,</span>
                                <span class="n">width_list</span><span class="p">,</span> <span class="n">height_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">nVert_list</span><span class="p">,</span>
                                <span class="n">vertstr_list</span><span class="p">,</span> <span class="n">viewpoint_list</span><span class="p">,</span> <span class="n">detect_confidence_list</span><span class="p">,</span>
                                <span class="n">notes_list</span><span class="p">))</span>
        <span class="c">#utool.embed()</span>

        <span class="c"># Execute add ANNOTATIONs SQL</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_aids_from_uuid</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">species_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">]</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_species</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">)</span>

        <span class="c"># Also need to populate annotation_lblannot_relationship table</span>
        <span class="k">if</span> <span class="n">nid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">alrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_annot_relationship</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">alrid_list</span>
        <span class="c">#print(&#39;alrid_list = %r&#39; % (alrid_list,))</span>
        <span class="c"># Invalidate image thumbnails, quiet_delete_thumbs causes no output on deletion from utool</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_image_thumbs</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet_delete_thumbs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aid_list</span>

    <span class="c">#@adder</span>
    <span class="c"># DEPRICATE</span>
    <span class="c">#def add_annot_names(ibs, aid_list, name_list=None, nid_list=None):</span>
    <span class="c">#    &quot;&quot;&quot; Sets names/nids of a list of annotations.</span>
    <span class="c">#    Convenience function for add_annot_relationship&quot;&quot;&quot;</span>
    <span class="c">#    assert name_list is None or nid_list is None, (</span>
    <span class="c">#        &#39;can only specify one type of name values (nid or name) not both&#39;)</span>
    <span class="c">#    if nid_list is None:</span>
    <span class="c">#        assert name_list is not None</span>
    <span class="c">#        # Convert names into nids</span>
    <span class="c">#        nid_list = ibs.add_names(name_list)</span>
    <span class="c">#    ibs.add_annot_relationship(aid_list, nid_list)</span>

    <span class="c"># Internal</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_version"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_version">[docs]</a>    <span class="k">def</span> <span class="nf">add_version</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">versiontext_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds an algorithm / actor configuration as a string &quot;&quot;&quot;</span>
        <span class="c"># FIXME: Configs are still handled poorly</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">versiontext</span><span class="p">,)</span> <span class="k">for</span> <span class="n">versiontext</span> <span class="ow">in</span> <span class="n">versiontext_list</span><span class="p">)</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_version_rowid_from_superkey</span>
        <span class="n">versionid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">VERSIONS_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;version_text&#39;</span><span class="p">,),</span>
                                            <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">versionid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_config"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_config">[docs]</a>    <span class="k">def</span> <span class="nf">add_config</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cfgsuffix_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds an algorithm / actor configuration as a string &quot;&quot;&quot;</span>
        <span class="c"># FIXME: Configs are still handled poorly. This function is an ensure</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">suffix</span><span class="p">,)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">cfgsuffix_list</span><span class="p">)</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_config_rowid_from_suffix</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_suffix&#39;</span><span class="p">,),</span>
                                               <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contrib_rowid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">set_config_contributor_rowid</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_chips"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_chips">[docs]</a>    <span class="k">def</span> <span class="nf">add_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        FIXME: This is a dirty dirty function</span>
<span class="sd">        Adds chip data to the ANNOTATION. (does not create ANNOTATIONs. first use add_annots</span>
<span class="sd">        and then pass them here to ensure chips are computed) &quot;&quot;&quot;</span>
        <span class="c"># Ensure must be false, otherwise an infinite loop occurs</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_chip</span>
        <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">dirty_aids</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">get_dirty_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirty_aids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utool</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] adding chips&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># FIXME: Cant be lazy until chip config / delete issue is fixed</span>
                <span class="n">preproc_chip</span><span class="o">.</span><span class="n">compute_and_write_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
                <span class="c">#preproc_chip.compute_and_write_chips_lazy(ibs, aid_list)</span>
                <span class="n">params_iter</span> <span class="o">=</span> <span class="n">preproc_chip</span><span class="o">.</span><span class="n">add_chips_params_gen</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">dirty_aids</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;[!ibs.add_chips]&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[!ibs.add_chips] &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">list_dbgstr</span><span class="p">(</span><span class="s">&#39;aid_list&#39;</span><span class="p">))</span>
                <span class="k">raise</span>
            <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;config_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;chip_uri&#39;</span><span class="p">,</span> <span class="s">&#39;chip_width&#39;</span><span class="p">,</span> <span class="s">&#39;chip_height&#39;</span><span class="p">,)</span>
            <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_feats"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_feats">[docs]</a>    <span class="k">def</span> <span class="nf">add_feats</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Computes the features for every chip without them &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_feat</span>
        <span class="n">fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_fids</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">dirty_cids</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">get_dirty_items</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirty_cids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] adding </span><span class="si">%d</span><span class="s"> / </span><span class="si">%d</span><span class="s"> features&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dirty_cids</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)))</span>
            <span class="n">params_iter</span> <span class="o">=</span> <span class="n">preproc_feat</span><span class="o">.</span><span class="n">add_feat_params_gen</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">dirty_cids</span><span class="p">)</span>
            <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;chip_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;config_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;feature_num_feats&#39;</span><span class="p">,</span> <span class="s">&#39;feature_keypoints&#39;</span><span class="p">,</span>
                        <span class="s">&#39;feature_vecs&#39;</span><span class="p">)</span>
            <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_fids</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">get_rowid_from_superkey</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fid_list</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#----------------</span>
    <span class="c"># --- SETTERS ---</span>
    <span class="c">#----------------</span>

    <span class="c"># SETTERS::METADATA</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_metadata_value"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_metadata_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_metadata_value</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">metadata_key_list</span><span class="p">,</span> <span class="n">metadata_value_list</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets metadata key, value pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># Unwrap tuple, required by @setter decorator</span>
        <span class="n">metadata_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_metadata_rowid_from_metadata_key</span><span class="p">(</span><span class="n">metadata_key_list</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">metadata_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">metadata_rowid</span> <span class="ow">in</span> <span class="n">metadata_rowid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">metadata_value</span><span class="p">,)</span> <span class="k">for</span> <span class="n">metadata_value</span> <span class="ow">in</span> <span class="n">metadata_value_list</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">METADATA_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;metadata_value&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.set_database_version"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_database_version">[docs]</a>    <span class="k">def</span> <span class="nf">set_database_version</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the specified database&#39;s version from the controller</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set_db_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="c"># SETTERS::CONTRIBUTORS</span>
</div>
<div class="viewcode-block" id="IBEISController.set_config_contributor_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_config_contributor_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">set_config_contributor_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the config&#39;s contributor rowid &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">config_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">config_rowid</span> <span class="ow">in</span> <span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">contrib_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">contrib_rowid</span> <span class="ow">in</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.set_config_contributor_unassigned"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_config_contributor_unassigned">[docs]</a>    <span class="k">def</span> <span class="nf">set_config_contributor_unassigned</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid</span><span class="p">):</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_configids</span><span class="p">()</span>
        <span class="n">contrib_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_config_contributor_rowid</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="n">unassigned_config_rowid_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">config_rowid</span>
            <span class="k">for</span> <span class="n">config_rowid</span><span class="p">,</span> <span class="n">_contrib_rowid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_contrib_rowid</span> <span class="ow">is</span> <span class="bp">None</span>
        <span class="p">]</span>
        <span class="n">contrib_rowid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">contrib_rowid</span><span class="p">])</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">unassigned_config_rowid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_config_contributor_rowid</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.set_image_contributor_unassigned"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_contributor_unassigned">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_contributor_unassigned</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid</span><span class="p">):</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">()</span>
        <span class="n">contrib_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_contributor_rowid</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">unassigned_gid_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">gid</span>
            <span class="k">for</span> <span class="n">gid</span><span class="p">,</span> <span class="n">_contrib_rowid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_contrib_rowid</span> <span class="ow">is</span> <span class="bp">None</span>
        <span class="p">]</span>
        <span class="n">contrib_rowid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">contrib_rowid</span><span class="p">])</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">unassigned_gid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_contributor_rowid</span><span class="p">(</span><span class="n">unassigned_gid_list</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.ensure_encounter_configs_populated"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.ensure_encounter_configs_populated">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_encounter_configs_populated</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_eids</span><span class="p">()</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_config</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
        <span class="n">unassigned_eid_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">eid</span>
            <span class="k">for</span> <span class="n">eid</span><span class="p">,</span> <span class="n">config_rowid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">eid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">config_rowid</span> <span class="ow">is</span> <span class="bp">None</span>
        <span class="p">]</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">eid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">unassigned_eid_list</span><span class="p">)</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIGID</span><span class="p">])</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">unassigned_eid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">config_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">config_rowid</span> <span class="ow">in</span> <span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>

    <span class="c"># SETTERS::IMAGE</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_uris"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_uris">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_uris</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">new_gpath_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the image URIs to a new local path.</span>
<span class="sd">        This is used when localizing or unlocalizing images.</span>
<span class="sd">        An absolute path can either be on this machine or on the cloud</span>
<span class="sd">        A relative path is relative to the ibeis image cache on this machine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">new_gpath</span><span class="p">,)</span> <span class="k">for</span> <span class="n">new_gpath</span> <span class="ow">in</span> <span class="n">new_gpath_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_uri&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_contributor_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_contributor_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_contributor_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">contributor_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the image contributor rowid &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">contrib_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">contrib_rowid</span> <span class="ow">in</span> <span class="n">contributor_rowid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_reviewed"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_reviewed">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_reviewed</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">reviewed_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the image all instances found bit &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">reviewed</span><span class="p">,)</span> <span class="k">for</span> <span class="n">reviewed</span> <span class="ow">in</span> <span class="n">reviewed_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_toggle_reviewed&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_enabled"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_enabled</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">enabled_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the image all instances found bit &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">enabled</span><span class="p">,)</span> <span class="k">for</span> <span class="n">enabled</span> <span class="ow">in</span> <span class="n">enabled_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_toggle_enabled&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_notes">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">notes_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the image all instances found bit &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">notes</span><span class="p">,)</span> <span class="k">for</span> <span class="n">notes</span> <span class="ow">in</span> <span class="n">notes_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_note&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_unixtime"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_unixtime">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_unixtime</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">unixtime_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the image unixtime (does not modify exif yet) &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">unixtime</span><span class="p">,)</span> <span class="k">for</span> <span class="n">unixtime</span> <span class="ow">in</span> <span class="n">unixtime_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_time_posix&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_enctext"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_enctext">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_enctext</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">enctext_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the encoutertext of each image &quot;&quot;&quot;</span>
        <span class="c"># FIXME: Slow and weird</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] setting </span><span class="si">%r</span><span class="s"> image encounter ids (from text)&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_encounters</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_eids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_eids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_eids">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_eids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the encoutertext of each image &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] setting </span><span class="si">%r</span><span class="s"> image encounter ids&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">egrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_image_relationship</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">egrid_list</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_image_gps"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_image_gps">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_gps</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">gps_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lat_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lon_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; see get_image_gps for how the gps_list should look.</span>
<span class="sd">            lat and lon should be given in degrees &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gps_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">lat_list</span> <span class="ow">is</span> <span class="bp">None</span>
            <span class="k">assert</span> <span class="n">lon_list</span> <span class="ow">is</span> <span class="bp">None</span>
            <span class="n">lat_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">gps_list</span><span class="p">]</span>
            <span class="n">lon_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">gps_list</span><span class="p">]</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;image_gps_lat&#39;</span><span class="p">,</span> <span class="s">&#39;image_gps_lon&#39;</span><span class="p">,)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">)</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>

    <span class="c"># SETTERS::ANNOTATION</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_exemplar_flag"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_exemplar_flag">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_exemplar_flag</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets if an annotation is an exemplar &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">flag</span><span class="p">,)</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flag_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_exemplar_flag&#39;</span><span class="p">,),</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_parent_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_parent_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_parent_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">parent_aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the annotation&#39;s parent aid &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">parent_aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">parent_aid</span> <span class="ow">in</span> <span class="n">parent_aid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_parent_rowid&#39;</span><span class="p">,),</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_bboxes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_bboxes">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_bboxes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">delete_thumbs</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets bboxes of a list of annotations by aid,</span>

<span class="sd">        Args:</span>
<span class="sd">            aid_list (list of rowids): list of annotation rowids</span>
<span class="sd">            bbox_list (list of (x, y, w, h)): new bounding boxes for each aid</span>

<span class="sd">        Note:</span>
<span class="sd">            set_annot_bboxes is a proxy for set_annot_verts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">vtool</span> <span class="kn">import</span> <span class="n">geometry</span>
        <span class="c"># changing the bboxes also changes the bounding polygon</span>
        <span class="n">vert_list</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">verts_list_from_bboxes_list</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span>
        <span class="c"># naively overwrite the bounding polygon with a rectangle - for now trust the user!</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_verts</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">vert_list</span><span class="p">,</span> <span class="n">delete_thumbs</span><span class="o">=</span><span class="n">delete_thumbs</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_thetas"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_thetas">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_thetas</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">theta_list</span><span class="p">,</span> <span class="n">delete_thumbs</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets thetas of a list of chips by aid &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">theta</span><span class="p">,)</span> <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">theta_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_theta&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_thumbs</span><span class="p">:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_chips</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>  <span class="c"># Changing theta redefines the chips</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_verts"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_verts">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_verts</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">verts_list</span><span class="p">,</span> <span class="n">delete_thumbs</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the vertices [(x, y), ...] of a list of chips by aid &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">vtool</span> <span class="kn">import</span> <span class="n">geometry</span>
        <span class="n">nInput</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="c"># Compute data to set</span>
        <span class="n">num_verts_list</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">verts_list</span><span class="p">))</span>
        <span class="n">verts_as_strings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">__STR__</span><span class="p">,</span> <span class="n">verts_list</span><span class="p">))</span>
        <span class="n">id_iter1</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="c"># also need to set the internal number of vertices</span>
        <span class="n">val_iter1</span> <span class="o">=</span> <span class="p">((</span><span class="n">num_verts</span><span class="p">,</span> <span class="n">verts</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">num_verts</span><span class="p">,</span> <span class="n">verts</span><span class="p">)</span>
                     <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">num_verts_list</span><span class="p">,</span> <span class="n">verts_as_strings</span><span class="p">))</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_num_verts&#39;</span><span class="p">,</span> <span class="s">&#39;annot_verts&#39;</span><span class="p">,)</span>
        <span class="c"># SET VERTS in ANNOTATION_TABLE</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">val_iter1</span><span class="p">,</span> <span class="n">id_iter1</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="c"># changing the vertices also changes the bounding boxes</span>
        <span class="n">bbox_list</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">bboxes_from_vert_list</span><span class="p">(</span><span class="n">verts_list</span><span class="p">)</span>      <span class="c"># new bboxes</span>
        <span class="n">xtl_list</span><span class="p">,</span> <span class="n">ytl_list</span><span class="p">,</span> <span class="n">width_list</span><span class="p">,</span> <span class="n">height_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bbox_list</span><span class="p">))</span>
        <span class="n">val_iter2</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xtl_list</span><span class="p">,</span> <span class="n">ytl_list</span><span class="p">,</span> <span class="n">width_list</span><span class="p">,</span> <span class="n">height_list</span><span class="p">)</span>
        <span class="n">id_iter2</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_xtl&#39;</span><span class="p">,</span> <span class="s">&#39;annot_ytl&#39;</span><span class="p">,</span> <span class="s">&#39;annot_width&#39;</span><span class="p">,</span> <span class="s">&#39;annot_height&#39;</span><span class="p">,)</span>
        <span class="c"># SET BBOX in ANNOTATION_TABLE</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">val_iter2</span><span class="p">,</span> <span class="n">id_iter2</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_thumbs</span><span class="p">:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_chips</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>  <span class="c"># INVALIDATE THUMBNAILS</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_viewpoint"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_viewpoint">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_viewpoint</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">viewpoint_list</span><span class="p">,</span> <span class="n">convert_radians</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the vertices [(x, y), ...] of a list of chips by aid &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
        <span class="k">def</span> <span class="nf">deg_to_rad</span><span class="p">(</span><span class="n">degree</span><span class="p">):</span>
            <span class="n">degree</span> <span class="o">%=</span> <span class="mf">360.0</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">degree</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">convert_radians</span><span class="p">:</span>
            <span class="n">viewpoint_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">viewpoint</span><span class="p">)</span> <span class="k">for</span> <span class="n">viewpoint</span> <span class="ow">in</span> <span class="n">viewpoint_list</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">viewpoint</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="ow">or</span> <span class="n">viewpoint</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">viewpoint</span> <span class="ow">in</span> <span class="n">viewpoint_list</span><span class="p">])</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">viewpoint</span><span class="p">,</span> <span class="p">)</span> <span class="k">for</span> <span class="n">viewpoint</span> <span class="ow">in</span> <span class="n">viewpoint_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_viewpoint&#39;</span><span class="p">,),</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_detect_confidence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_detect_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_detect_confidence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets annotation notes &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">confidence</span><span class="p">,)</span> <span class="k">for</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="n">confidence_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_detect_confidence&#39;</span><span class="p">,),</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_notes">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">notes_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets annotation notes &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">notes</span><span class="p">,)</span> <span class="k">for</span> <span class="n">notes</span> <span class="ow">in</span> <span class="n">notes_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_note&#39;</span><span class="p">,),</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>

    <span class="c"># SETTERS::ENCOUNTER</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_encounter_enctext"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_encounter_enctext">[docs]</a>    <span class="k">def</span> <span class="nf">set_encounter_enctext</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">names_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets names of encounters (groups of animals) &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">eid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">eid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">names</span><span class="p">,)</span> <span class="k">for</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">names_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;encounter_text&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#----------------</span>
    <span class="c"># --- GETTERS ---</span>
    <span class="c">#----------------</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_metadata_value"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_metadata_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_metadata_value</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">metadata_key_list</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">metadata_key</span><span class="p">,)</span> <span class="k">for</span> <span class="n">metadata_key</span> <span class="ow">in</span> <span class="n">metadata_key_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;metadata_key=?&#39;</span>
        <span class="c"># list of relationships for each image</span>
        <span class="n">metadata_value_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">METADATA_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;metadata_value&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata_value_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_metadata_rowid_from_metadata_key"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_metadata_rowid_from_metadata_key">[docs]</a>    <span class="k">def</span> <span class="nf">get_metadata_rowid_from_metadata_key</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">metadata_key_list</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># Unwrap tuple, required by @getter_1to1 decorator</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">metadata_key</span><span class="p">,)</span> <span class="k">for</span> <span class="n">metadata_key</span> <span class="ow">in</span> <span class="n">metadata_key_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;metadata_key=?&#39;</span>
        <span class="c"># list of relationships for each image</span>
        <span class="n">metadata_rowid_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">METADATA_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;metadata_rowid&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata_rowid_list</span>
</div>
    <span class="nd">@ider</span>
<div class="viewcode-block" id="IBEISController.get_database_version"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_database_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_database_version</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets the specified database version from the controller &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">get_db_version</span><span class="p">()</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::IMAGE_TABLE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_images">[docs]</a>    <span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of images in numpy matrix form by gid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">vtool</span> <span class="kn">import</span> <span class="n">image</span> <span class="k">as</span> <span class="n">gtool</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">image_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gtool</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">gpath</span> <span class="ow">in</span> <span class="n">gpath_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">image_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_thumbtup"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_thumbtup">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_thumbtup</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): tuple of image paths, thumb paths, bboxes and thetas &quot;&quot;&quot;</span>
        <span class="c"># print(&#39;gid_list = %r&#39; % (gid_list,))</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">bboxes_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_bboxes</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="n">thetas_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_thetas</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="n">thumb_gpaths</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_thumbpath</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
        <span class="n">image_paths</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">gsize_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_sizes</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">thumbtup_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">thumb_gpaths</span><span class="p">,</span> <span class="n">image_paths</span><span class="p">,</span> <span class="n">gsize_list</span><span class="p">,</span> <span class="n">bboxes_list</span><span class="p">,</span> <span class="n">thetas_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">thumbtup_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_thumbpath"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_thumbpath">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_thumbpath</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the thumbnail path of each gid &quot;&quot;&quot;</span>
        <span class="n">thumb_dpath</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">thumb_dpath</span>
        <span class="n">img_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">thumb_suffix</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumbsize</span><span class="p">)</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">IMAGE_THUMB_SUFFIX</span>
        <span class="n">thumbpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">thumb_dpath</span><span class="p">,</span> <span class="n">__STR__</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span> <span class="o">+</span> <span class="n">thumb_suffix</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="n">img_uuid_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">thumbpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_uuids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_uuids">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_uuids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image uuids by gid &quot;&quot;&quot;</span>
        <span class="n">image_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_uuid&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_uuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_contributor_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_contributor_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_contributor_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image&#39; contributor rowids by gid &quot;&quot;&quot;</span>
        <span class="n">contrib_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_exts"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_exts">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_exts</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image uuids by gid &quot;&quot;&quot;</span>
        <span class="n">image_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_ext&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_uuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_uris"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_uris">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_uris</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image uris relative to the image dir by gid &quot;&quot;&quot;</span>
        <span class="n">uri_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_uri&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uri_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_gids_from_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_gids_from_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_gids_from_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of original image names &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,),</span> <span class="n">uuid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;image_uuid&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gid_list</span>
</div>
    <span class="n">get_image_rowid_from_uuid</span> <span class="o">=</span> <span class="n">get_image_gids_from_uuid</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_paths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_paths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image absolute paths to img_dir &quot;&quot;&quot;</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="s">&#39;gid_list&#39;</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;gid_list&#39;</span><span class="p">])</span>
        <span class="n">uri_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uris</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="c"># Images should never have null uris</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">uri_list</span><span class="p">,</span> <span class="s">&#39;uri_list&#39;</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;uri_list&#39;</span><span class="p">,</span> <span class="s">&#39;gid_list&#39;</span><span class="p">])</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">imgdir</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span> <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">uri_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">gpath_list</span>

    <span class="c"># TODO make this actually return a uri format</span></div>
    <span class="n">get_image_absolute_uri</span> <span class="o">=</span> <span class="n">get_image_paths</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_detectpaths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_detectpaths">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_detectpaths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image paths resized to a constant area for detection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_detectimg</span>
        <span class="n">new_gfpath_list</span> <span class="o">=</span> <span class="n">preproc_detectimg</span><span class="o">.</span><span class="n">compute_and_write_detectimg_lazy</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_gfpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_gnames"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_gnames">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_gnames</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of original image names &quot;&quot;&quot;</span>
        <span class="n">gname_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_original_name&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gname_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_sizes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_sizes">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_sizes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of (width, height) tuples &quot;&quot;&quot;</span>
        <span class="n">gsize_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_width&#39;</span><span class="p">,</span> <span class="s">&#39;image_height&#39;</span><span class="p">),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gsize_list</span>
</div>
    <span class="nd">@utool.accepts_numpy</span>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_unixtime"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_unixtime">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_unixtime</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of times that the images were taken by gid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): -1 if no timedata exists for a given gid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_time_posix&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_gps"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_gps">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_gps</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            gps_list (list): -1 if no timedata exists for a given gid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gps_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_gps_lat&#39;</span><span class="p">,</span> <span class="s">&#39;image_gps_lon&#39;</span><span class="p">),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gps_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_lat"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_lat">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_lat</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="n">lat_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_gps_lat&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lat_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_lon"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_lon">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_lon</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="n">lon_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_gps_lon&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lon_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_enabled"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_enabled</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): &quot;Image Enabled&quot; flag, true if the image is enabled &quot;&quot;&quot;</span>
        <span class="n">enabled_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_toggle_enabled&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enabled_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_reviewed"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_reviewed">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_reviewed</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): &quot;All Instances Found&quot; flag, true if all objects of interest</span>
<span class="sd">        (animals) have an ANNOTATION in the image &quot;&quot;&quot;</span>
        <span class="n">reviewed_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_toggle_reviewed&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reviewed_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_detect_confidence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_detect_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_detect_confidence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): image detection confidence as the max of ANNOTATION confidences &quot;&quot;&quot;</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">confs_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_detect_confidence</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="n">maxconf_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">confs</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">confs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">confs</span> <span class="ow">in</span> <span class="n">confs_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">maxconf_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_notes">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): image notes &quot;&quot;&quot;</span>
        <span class="n">notes_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_note&#39;</span><span class="p">,),</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">notes_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_nids">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the name ids associated with an image id &quot;&quot;&quot;</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">nids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aids_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_image_eids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_eids">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_eids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of encounter ids for each image by gid &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">,)</span>
        <span class="n">eids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span>
                               <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_image_enctext"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_enctext">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_enctext</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of enctexts for each image by gid &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">eids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_eids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">enctext_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_enctext</span><span class="p">,</span> <span class="n">eids_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enctext_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_image_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of aids for each image by gid &quot;&quot;&quot;</span>
        <span class="c"># print(&#39;gid_list = %r&#39; % (gid_list,))</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,)</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span>
                               <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#print(&#39;aids_list = %r&#39; % (aids_list,))</span>
        <span class="k">return</span> <span class="n">aids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_num_annotations"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_num_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_num_annotations</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the number of chips in each image &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)))</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_image_egrids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_egrids">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_egrids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  a list of encounter-image-relationship rowids for each imageid &quot;&quot;&quot;</span>
        <span class="c"># TODO: Group type</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;image_rowid=?&#39;</span>
        <span class="c"># list of relationships for each image</span>
        <span class="n">egrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;egr_rowid&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">egrids_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::ANNOTATION_TABLE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_exemplar_flag"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_exemplar_flag">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_exemplar_flag</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="n">annotation_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_exemplar_flag&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annotation_uuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_uuids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_uuids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_uuids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image uuids by gid &quot;&quot;&quot;</span>
        <span class="n">annotation_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_uuid&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annotation_uuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_parent_aid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_parent_aid">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_parent_aid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of image uuids by gid &quot;&quot;&quot;</span>
        <span class="n">annotation_parent_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_parent_rowid&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annotation_parent_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_aids_from_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_aids_from_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_aids_from_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">uuid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of original image names &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,),</span> <span class="n">uuid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;annot_uuid&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aids_list</span>
</div>
    <span class="n">get_annot_rowid_from_uuid</span> <span class="o">=</span> <span class="n">get_annot_aids_from_uuid</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_detect_confidence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_detect_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_detect_confidence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list confidences that the annotations is a valid detection &quot;&quot;&quot;</span>
        <span class="n">annotation_detect_confidence_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_detect_confidence&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annotation_detect_confidence_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_notes">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            annotation_notes_list (list): a list of annotation notes &quot;&quot;&quot;</span>
        <span class="n">annotation_notes_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_note&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annotation_notes_list</span>
</div>
    <span class="nd">@utool.accepts_numpy</span>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_bboxes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_bboxes">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_bboxes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bbox_list (list):  annotation bounding boxes in image space &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_xtl&#39;</span><span class="p">,</span> <span class="s">&#39;annot_ytl&#39;</span><span class="p">,</span> <span class="s">&#39;annot_width&#39;</span><span class="p">,</span> <span class="s">&#39;annot_height&#39;</span><span class="p">,)</span>
        <span class="n">bbox_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bbox_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_thetas"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_thetas">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_thetas</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            theta_list (list): a list of floats describing the angles of each chip &quot;&quot;&quot;</span>
        <span class="n">theta_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_theta&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">theta_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_num_verts"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_num_verts">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_num_verts</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            num_verts_list (list): the number of vertices that form the polygon of each chip &quot;&quot;&quot;</span>
        <span class="n">num_verts_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_num_verts&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num_verts_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_verts"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_verts">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_verts</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            vert_list (list): the vertices that form the polygon of each chip &quot;&quot;&quot;</span>
        <span class="n">vertstr_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_verts&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="c"># TODO: Sanatize input for eval</span>
        <span class="c">#print(&#39;vertstr_list = %r&#39; % (vertstr_list,))</span>
        <span class="n">vert_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">vertstr</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertstr</span> <span class="ow">in</span> <span class="n">vertstr_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vert_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_viewpoints"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_viewpoints">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_viewpoints</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            viewpoint_list (list): the viewpoint (in radians) for the annotation &quot;&quot;&quot;</span>
        <span class="n">viewpoint_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_viewpoint&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">viewpoint_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">viewpoint</span> <span class="k">if</span> <span class="n">viewpoint</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">viewpoint</span> <span class="ow">in</span> <span class="n">viewpoint_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">viewpoint_list</span>
</div>
    <span class="nd">@utool.accepts_numpy</span>
    <span class="nd">@getter_1to1</span>
    <span class="nd">@cache_getter</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="s">&#39;image_rowid&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.get_annot_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            gid_list (list):  annotation bounding boxes in image space &quot;&quot;&quot;</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_images">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            image_list (list): the images of each annotation &quot;&quot;&quot;</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">image_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_image_uuids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_image_uuids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_image_uuids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">image_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_uuids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_uuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_gnames"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_gnames">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_gnames</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            gname_list (list): the image names of each annotation &quot;&quot;&quot;</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">gname_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gnames</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gname_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_gpaths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_gpaths">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_gpaths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            gpath_list (list): the image names of each annotation &quot;&quot;&quot;</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="s">&#39;gid_list&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[!get_annot_gpaths] &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">list_dbgstr</span><span class="p">(</span><span class="s">&#39;aid_list&#39;</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[!get_annot_gpaths] &#39;</span> <span class="o">+</span> <span class="n">utool</span><span class="o">.</span><span class="n">list_dbgstr</span><span class="p">(</span><span class="s">&#39;gid_list&#39;</span><span class="p">))</span>
            <span class="k">raise</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">,</span> <span class="s">&#39;gpath_list&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_cids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_cids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_cids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">all_configs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># TODO: DEPRICATE IN FAVOR OF AUTOGENERATED METHOD</span>
        <span class="c"># get_annot_chip_rowids. THEN ALIAS THAT TO THIS</span>
        <span class="c"># FIXME:</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ibs</span><span class="o">.</span><span class="n">add_chips</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;[!ibs.get_annot_cids]&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[!ibs.get_annot_cids] aid_list = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid_list</span><span class="p">,))</span>
                <span class="k">raise</span>
        <span class="k">if</span> <span class="n">all_configs</span><span class="p">:</span>
            <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
            <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;chip_rowid&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">,</span>
                                       <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span>
                                       <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chip_config_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_config_rowid</span><span class="p">()</span>
            <span class="c">#print(chip_config_rowid)</span>
            <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;annot_rowid=? AND config_rowid=?&#39;</span>
            <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,</span> <span class="n">chip_config_rowid</span><span class="p">)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
            <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span>  <span class="p">(</span><span class="s">&#39;chip_rowid&#39;</span><span class="p">,),</span>
                                             <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span>
                                             <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cid_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
                <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="s">&#39;cid_list&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">valid_cids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_cids</span><span class="p">()</span>  <span class="c"># NOQA</span>
                <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Ensured cids returned None!&#39;</span><span class="p">,</span>
                              <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;aid_list&#39;</span><span class="p">,</span> <span class="s">&#39;cid_list&#39;</span><span class="p">,</span> <span class="s">&#39;valid_cids&#39;</span><span class="p">])</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">cid_list</span>
</div>
    <span class="n">get_annot_chip_rowids</span> <span class="o">=</span> <span class="n">get_annot_cids</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_chip_paths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_chip_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_chip_paths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="s">&#39;aid_list&#39;</span><span class="p">)</span>
        <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="n">chip_fpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_paths</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chip_fpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_chips"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_chips">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="s">&#39;aid_list&#39;</span><span class="p">)</span>
        <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">utool</span><span class="o">.</span><span class="n">assert_all_not_None</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="s">&#39;cid_list&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Invalid cid_list&#39;</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span>
                    <span class="s">&#39;ensure&#39;</span><span class="p">,</span> <span class="s">&#39;cid_list&#39;</span><span class="p">])</span>
                <span class="k">raise</span>
        <span class="n">chip_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chips</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chip_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_probchip_fpaths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_probchip_fpaths">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_probchip_fpaths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns paths to probability images.</span>

<span class="sd">        FIXME: this is implemented very poorly. Caches not robust. IE they are</span>
<span class="sd">        never invalidated. Not all config information is passed through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_probchip</span>
        <span class="n">probchip_fpath_list</span> <span class="o">=</span> <span class="n">preproc_probchip</span><span class="o">.</span><span class="n">compute_and_write_probchip</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">probchip_fpath_list</span>

    <span class="c">#@getter_1to1</span></div>
<div class="viewcode-block" id="IBEISController.get_annot_chip_thumbtup"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_chip_thumbtup">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_chip_thumbtup</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
        <span class="n">isiterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isiterable</span><span class="p">:</span>
            <span class="n">aid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">aid_list</span><span class="p">]</span>
        <span class="c"># HACK TO MAKE CHIPS COMPUTE</span>
        <span class="c">#cid_list = ibs.get_annot_cids(aid_list, ensure=True)  # NOQA</span>
        <span class="n">thumb_gpaths</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_thumbpath</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
        <span class="n">chip_paths</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cpaths</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">chipsize_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chipsizes</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">thumbtup_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">thumb_path</span><span class="p">,</span> <span class="n">chip_path</span><span class="p">,</span> <span class="n">chipsize</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>
                         <span class="k">for</span> <span class="p">(</span><span class="n">thumb_path</span><span class="p">,</span> <span class="n">chip_path</span><span class="p">,</span> <span class="n">chipsize</span><span class="p">)</span> <span class="ow">in</span>
                         <span class="nb">zip</span><span class="p">(</span><span class="n">thumb_gpaths</span><span class="p">,</span> <span class="n">chip_paths</span><span class="p">,</span> <span class="n">chipsize_list</span><span class="p">,)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isiterable</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">thumbtup_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">thumbtup_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_chip_thumbpath"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_chip_thumbpath">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_chip_thumbpath</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">thumbsize</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">thumb_dpath</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">thumb_dpath</span>
        <span class="n">thumb_suffix</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumbsize</span><span class="p">)</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">CHIP_THUMB_SUFFIX</span>
        <span class="n">annotation_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_uuids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">thumbpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">thumb_dpath</span><span class="p">,</span> <span class="n">__STR__</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span> <span class="o">+</span> <span class="n">thumb_suffix</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="n">annotation_uuid_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">thumbpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
    <span class="nd">@cache_getter</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="s">&#39;chipsizes&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.get_annot_chipsizes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_chipsizes">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_chipsizes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            chipsz_list (list): the imagesizes of computed annotation chips &quot;&quot;&quot;</span>
        <span class="n">cid_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="n">chipsz_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_sizes</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chipsz_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_cpaths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_cpaths">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_cpaths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just builds the filename strings based off of the current</span>
<span class="sd">        configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            cfpath_list (list): cpaths defined by ANNOTATIONs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#utool.assert_all_not_None(aid_list, &#39;aid_list&#39;)</span>
        <span class="c">#assert all([aid is not None for aid in aid_list])</span>
        <span class="c">#from ibeis.model.preproc import preproc_chip</span>
        <span class="c">#cfpath_list = preproc_chip.get_annot_cfpath_list(ibs, aid_list)</span>
        <span class="n">cid_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="n">cfpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_paths</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cfpath_list</span>

    <span class="c"># Should be the true name (and autogenerated)</span></div>
    <span class="n">get_annot_chip_fpaths</span> <span class="o">=</span> <span class="n">get_annot_cpaths</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_fids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_fids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_fids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="n">fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_fids</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fid_list</span>
</div>
    <span class="n">get_annot_feat_rowids</span> <span class="o">=</span> <span class="n">get_annot_fids</span>

    <span class="nd">@utool.accepts_numpy</span>
    <span class="nd">@getter_1toM</span>
    <span class="nd">@cache_getter</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="s">&#39;kpts&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.get_annot_kpts"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_kpts">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_kpts</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            kpts_list (list): annotation descriptor keypoints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fid_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_fids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="n">kpts_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_feat_kpts</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kpts_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_vecs"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_vecs">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_vecs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            vecs_list (list): annotation descriptor vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fid_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_fids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="n">vecs_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_feat_vecs</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vecs_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_num_feats"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_num_feats">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_num_feats</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            nFeats_list (list): num descriptors per annotation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_fids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="n">nFeats_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_num_feats</span><span class="p">(</span><span class="n">fid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nFeats_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_groundfalse"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_groundfalse">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_groundfalse</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">is_exemplar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">valid_aids</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                              <span class="n">filter_unknowns</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets all annotations with different names</span>

<span class="sd">        Returns:</span>
<span class="sd">            groundfalse_list (list): a list of aids which are known to be different for each</span>
<span class="sd">        input aid &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">valid_aids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># get all valid aids if not specified</span>
            <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">is_exemplar</span><span class="o">=</span><span class="n">is_exemplar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filter_unknowns</span><span class="p">:</span>
            <span class="c"># Remove aids which do not have a name</span>
            <span class="n">isunknown_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">is_aid_unknown</span><span class="p">(</span><span class="n">valid_aids</span><span class="p">)</span>
            <span class="n">valid_aids_</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filterfalse_items</span><span class="p">(</span><span class="n">valid_aids</span><span class="p">,</span> <span class="n">isunknown_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_aids_</span> <span class="o">=</span> <span class="n">valid_aids</span>
        <span class="c"># Build the set of groundfalse annotations</span>
        <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
        <span class="n">aids_setlist</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="n">valid_aids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">valid_aids_</span><span class="p">)</span>
        <span class="n">groundfalse_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">valid_aids</span> <span class="o">-</span> <span class="n">aids</span><span class="p">)</span> <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">aids_setlist</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">groundfalse_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_groundtruth"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_groundtruth">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_groundtruth</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">is_exemplar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">noself</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">daid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets all annotations with the same names</span>

<span class="sd">        Args:</span>
<span class="sd">            aid_list (list): list of annotation rowids to get groundtruth of</span>

<span class="sd">        Returns:</span>
<span class="sd">            groundtruth_list (list): a list of aids with the same name foreach</span>
<span class="sd">            aid in aid_list.  a set of aids belonging to the same name is called</span>
<span class="sd">            a groundtruth.  A list of these is called a groundtruth_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: Optimize</span>
        <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_exemplar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">groundtruth_list_</span> <span class="o">=</span> <span class="n">aids_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Filter out non-exemplars</span>
            <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
            <span class="n">exemplar_flags_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_exemplar_flag</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
            <span class="n">isvalids_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">flag</span> <span class="o">==</span> <span class="n">is_exemplar</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span> <span class="k">for</span> <span class="n">flags</span> <span class="ow">in</span> <span class="n">exemplar_flags_list</span><span class="p">]</span>
            <span class="n">groundtruth_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="n">isvalids</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">aids</span><span class="p">,</span> <span class="n">isvalids</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">aids_list</span><span class="p">,</span> <span class="n">isvalids_list</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">noself</span><span class="p">:</span>
            <span class="c"># Remove yourself from the set</span>
            <span class="n">groundtruth_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aids</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="n">aid</span><span class="p">})</span>
                                <span class="k">for</span> <span class="n">aids</span><span class="p">,</span> <span class="n">aid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">groundtruth_list_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">groundtruth_list</span> <span class="o">=</span> <span class="n">groundtruth_list_</span>

        <span class="k">if</span> <span class="n">daid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># filter out any groundtruth that isn&#39;t allowed</span>
            <span class="n">daid_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">daid_list</span><span class="p">)</span>
            <span class="n">groundtruth_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">daid_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aids</span><span class="p">)))</span> <span class="k">for</span> <span class="n">aids</span> <span class="ow">in</span> <span class="n">groundtruth_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">groundtruth_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_num_groundtruth"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_num_groundtruth">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_num_groundtruth</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">noself</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): number of other chips with the same name &quot;&quot;&quot;</span>
        <span class="c"># TODO: Optimize</span>
        <span class="n">nGt_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_groundtruth</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">noself</span><span class="o">=</span><span class="n">noself</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">nGt_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_has_groundtruth"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_has_groundtruth">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_has_groundtruth</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="c"># TODO: Optimize</span>
        <span class="n">numgts_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_num_groundtruth</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">has_gt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">num_gts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">num_gts</span> <span class="ow">in</span> <span class="n">numgts_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">has_gt_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::CHIP_TABLE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_chips"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chips">[docs]</a>    <span class="k">def</span> <span class="nf">get_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            chip_list (list): a list cropped images in numpy array form by their cid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_chip</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_aids</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
        <span class="n">chip_list</span> <span class="o">=</span> <span class="n">preproc_chip</span><span class="o">.</span><span class="n">compute_or_read_annotation_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="n">ensure</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chip_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_chip_detectpaths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_detectpaths">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_detectpaths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            new_gfpath_list (list): a list of image paths resized to a constant area for detection &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_detectimg</span>
        <span class="n">new_gfpath_list</span> <span class="o">=</span> <span class="n">preproc_detectimg</span><span class="o">.</span><span class="n">compute_and_write_detectchip_lazy</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_gfpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_chip_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">):</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,),</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_chip_paths"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_paths</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            chip_fpath_list (list): a list of chip paths by their aid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chip_fpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;chip_uri&#39;</span><span class="p">,),</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chip_fpath_list</span>
</div>
    <span class="nd">@getter_1to1</span>
    <span class="c">#@cache_getter(&#39;CHIP_TABLE&#39;, &#39;chip_size&#39;)</span>
<div class="viewcode-block" id="IBEISController.get_chip_sizes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_sizes">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_sizes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">):</span>
        <span class="n">chipsz_list</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;chip_width&#39;</span><span class="p">,</span> <span class="s">&#39;chip_height&#39;</span><span class="p">,),</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chipsz_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_chip_fids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_fids">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_fids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">add_feats</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
        <span class="n">feat_config_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_feat_config_rowid</span><span class="p">()</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;feature_rowid&#39;</span><span class="p">,)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;chip_rowid=? AND config_rowid=?&#39;</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">cid</span><span class="p">,</span> <span class="n">feat_config_rowid</span><span class="p">)</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="n">fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                         <span class="n">where_clause</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span>
                                         <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fid_list</span>
</div>
    <span class="n">get_chip_feat_rowids</span> <span class="o">=</span> <span class="n">get_chip_fids</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_chip_configids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_chip_configids">[docs]</a>    <span class="k">def</span> <span class="nf">get_chip_configids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">):</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">cid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::FEATURE_TABLE</span>
</div>
    <span class="nd">@getter_1toM</span>
    <span class="c">#@cache_getter(FEATURE_TABLE, &#39;feature_keypoints&#39;)</span>
<div class="viewcode-block" id="IBEISController.get_feat_kpts"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_feat_kpts">[docs]</a>    <span class="k">def</span> <span class="nf">get_feat_kpts</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            kpts_list (list): chip keypoints in [x, y, iv11, iv21, iv22, ori] format &quot;&quot;&quot;</span>
        <span class="n">kpts_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;feature_keypoints&#39;</span><span class="p">,),</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kpts_list</span>
</div>
    <span class="nd">@getter_1toM</span>
    <span class="c">#@cache_getter(FEATURE_TABLE, &#39;feature_vecs&#39;)</span>
<div class="viewcode-block" id="IBEISController.get_feat_vecs"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_feat_vecs">[docs]</a>    <span class="k">def</span> <span class="nf">get_feat_vecs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            vecs_list (list): chip SIFT descriptors &quot;&quot;&quot;</span>
        <span class="n">vecs_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;feature_vecs&#39;</span><span class="p">,),</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="n">eager</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="n">nInput</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vecs_list</span>
</div>
    <span class="nd">@getter_1to1</span>
    <span class="c">#@cache_getter(FEATURE_TABLE, &#39;feature_num_feats&#39;)</span>
<div class="viewcode-block" id="IBEISController.get_num_feats"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_num_feats">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_feats</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            nFeats_list (list): the number of keypoint / descriptor pairs &quot;&quot;&quot;</span>
        <span class="n">nFeats_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;feature_num_feats&#39;</span><span class="p">,),</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nInput</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">nFeats_list</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">nFeats</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">nFeats</span><span class="p">)</span> <span class="k">for</span> <span class="n">nFeats</span> <span class="ow">in</span> <span class="n">nFeats_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nFeats_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::CONTRIBUTOR_TABLE</span></div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_rowid_from_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_rowid_from_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_rowid_from_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_rowid_list (list):  a contributor &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">contrib_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,),</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;contributor_uuid&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_uuid_list (list):  a contributor&#39;s uuid &quot;&quot;&quot;</span>
        <span class="n">contrib_uuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_uuid&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_uuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_tag"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_tag">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_tag</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_tag_list (list):  a contributor&#39;s tag &quot;&quot;&quot;</span>
        <span class="n">contrib_tag_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_tag&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_tag_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_first_name"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_first_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_first_name</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_name_first_list (list):  a contributor&#39;s first name &quot;&quot;&quot;</span>
        <span class="n">contrib_name_first_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_name_first&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_name_first_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_last_name"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_last_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_last_name</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_name_last_list (list):  a contributor&#39;s last name &quot;&quot;&quot;</span>
        <span class="n">contrib_name_last_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_name_last&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_name_last_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_name_string"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_name_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_name_string</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">,</span> <span class="n">include_tag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_name_list (list):  a contributor&#39;s full name &quot;&quot;&quot;</span>
        <span class="n">first_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_first_name</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="n">last_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_last_name</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_tag</span><span class="p">:</span>
            <span class="n">tag_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_tag</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
            <span class="n">name_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_list</span><span class="p">,</span> <span class="n">last_list</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span>
            <span class="n">contrib_name_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">name_list</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_list</span><span class="p">,</span> <span class="n">last_list</span><span class="p">)</span>
            <span class="n">contrib_name_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="ow">in</span> <span class="n">name_list</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">contrib_name_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_city"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_city">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_city</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_city_list (list):  a contributor&#39;s location - city &quot;&quot;&quot;</span>
        <span class="n">contrib_city_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_location_city&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_city_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_state"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_state</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  a contributor&#39;s location - state &quot;&quot;&quot;</span>
        <span class="n">contrib_state_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_location_state&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_state_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_country"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_country">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_country</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_country_list (list):  a contributor&#39;s location - country &quot;&quot;&quot;</span>
        <span class="n">contrib_country_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_location_country&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_country_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_zip"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_zip">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_zip</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_zip_list (list):  a contributor&#39;s location - zip &quot;&quot;&quot;</span>
        <span class="n">contrib_zip_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_location_zip&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_zip_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_location_string"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_location_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_location_string</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_list (list):  a contributor&#39;s location &quot;&quot;&quot;</span>
        <span class="n">city_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_city</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="n">state_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_state</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="n">zip_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_zip</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="n">country_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_country</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="n">location_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">city_list</span><span class="p">,</span> <span class="n">state_list</span><span class="p">,</span> <span class="n">zip_list</span><span class="p">,</span> <span class="n">country_list</span><span class="p">)</span>
        <span class="n">contrib_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">_zip</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">city</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">_zip</span><span class="p">,</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">location_list</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">contrib_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_note"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_note">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_note</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            contrib_note_list (list):  a contributor&#39;s note &quot;&quot;&quot;</span>
        <span class="n">contrib_note_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_note&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrib_note_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_config_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_config_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_config_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            config_rowid_list (list):  config rowids for a contributor &quot;&quot;&quot;</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_eids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_eids">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_eids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            eid_list (list):  eids for a contributor &quot;&quot;&quot;</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">,),</span> <span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_contributor_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_contributor_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_contributor_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            gid_list (list):  eids for a contributor &quot;&quot;&quot;</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,),</span> <span class="n">contrib_rowid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gid_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::CONFIG_TABLE</span></div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_config_rowid_from_suffix"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_config_rowid_from_suffix">[docs]</a>    <span class="k">def</span> <span class="nf">get_config_rowid_from_suffix</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cfgsuffix_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets an algorithm configuration as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># FIXME: This is causing a crash when converting old hotspotter databses.</span>
        <span class="c"># probably because the superkey changed</span>
        <span class="c"># SEE DBSchema.</span>

        <span class="c"># TODO: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">cfgsuffix_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;config_suffix&#39;</span><span class="p">)</span>

        <span class="c"># executeone always returns a list</span>
        <span class="c">#if config_rowid_list is not None and len(config_rowid_list) == 1:</span>
        <span class="c">#    config_rowid_list = config_rowid_list[0]</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>
</div>
<div class="viewcode-block" id="IBEISController.ensure_config_rowid_from_suffix"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.ensure_config_rowid_from_suffix">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_config_rowid_from_suffix</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cfgsuffix_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alias for adder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># FIXME: cfgsuffix should be renamed cfgstr? cfgtext?</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">cfgsuffix_list</span><span class="p">)</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_config_contributor_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_config_contributor_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_config_contributor_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            cfgsuffix_list (list):  contributor&#39;s rowid for algorithm configs &quot;&quot;&quot;</span>
        <span class="n">cfgsuffix_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;contributor_rowid&#39;</span><span class="p">,),</span> <span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cfgsuffix_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_config_suffixes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_config_suffixes">[docs]</a>    <span class="k">def</span> <span class="nf">get_config_suffixes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            cfgsuffix_list (list):  suffixes for algorithm configs &quot;&quot;&quot;</span>
        <span class="n">cfgsuffix_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_suffix&#39;</span><span class="p">,),</span> <span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cfgsuffix_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::ENCOUNTER</span></div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_encounter_num_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_num_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_num_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            nGids_list (list): number of images in each encounter &quot;&quot;&quot;</span>
        <span class="n">nGids_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_gids</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">nGids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_encounter_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            aids_list (list):  a list of list of aids in each encounter &quot;&quot;&quot;</span>
        <span class="n">gids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_gids</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">aids_list_</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">,</span> <span class="n">gids_list</span><span class="p">)</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">,</span> <span class="n">aids_list_</span><span class="p">))</span>
        <span class="c">#print(&#39;get_encounter_aids&#39;)</span>
        <span class="c">#print(&#39;eid_list = %r&#39; % (eid_list,))</span>
        <span class="c">#print(&#39;gids_list = %r&#39; % (gids_list,))</span>
        <span class="c">#print(&#39;aids_list_ = %r&#39; % (aids_list_,))</span>
        <span class="c">#print(&#39;aids_list = %r&#39; % (aids_list,))</span>
        <span class="k">return</span> <span class="n">aids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_encounter_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            gids_list (list):  a list of list of gids in each encounter &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">gids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,),</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#print(&#39;get_encounter_gids&#39;)</span>
        <span class="c">#print(&#39;eid_list = %r&#39; % (eid_list,))</span>
        <span class="c">#print(&#39;gids_list = %r&#39; % (gids_list,))</span>
        <span class="k">return</span> <span class="n">gids_list</span>

    <span class="c"># @getter_1to1</span></div>
<div class="viewcode-block" id="IBEISController.get_encounter_egrids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_egrids">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_egrids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">gid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># WEIRD FUNCTION FIXME</span>
        <span class="k">assert</span> <span class="n">eid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">gid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Either eid_list or gid_list must be None&quot;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  a list of encounter-image-relationship rowids for each encouterid &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">eid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">gid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># TODO: Group type</span>
            <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">eid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">eid_list</span><span class="p">)</span>
            <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;encounter_rowid=?&#39;</span>
            <span class="c"># list of relationships for each encounter</span>
            <span class="n">egrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;egr_rowid&#39;</span><span class="p">,),</span>
                                           <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">eid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># TODO: Group type</span>
            <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
            <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;image_rowid=?&#39;</span>
            <span class="c"># list of relationships for each encounter</span>
            <span class="n">egrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;egr_rowid&#39;</span><span class="p">,),</span>
                                           <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: Group type</span>
            <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">eid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">eid</span><span class="p">,</span> <span class="n">gid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">eid_list</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">))</span>
            <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;encounter_rowid=? AND image_rowid=?&#39;</span>
            <span class="c"># list of relationships for each encounter</span>
            <span class="n">egrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;egr_rowid&#39;</span><span class="p">,),</span>
                                           <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">egrids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_encounter_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_nids">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  a list of list of nids in each encounter &quot;&quot;&quot;</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_aids</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">nids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_lblannot_rowids_oftype</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">,</span>
                                        <span class="n">_lbltype</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
        <span class="n">nids_list_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">nid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">nids</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">nids</span> <span class="ow">in</span> <span class="n">nids_list</span><span class="p">]</span>

        <span class="n">nids_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">unique_ordered</span><span class="p">,</span> <span class="n">nids_list_</span><span class="p">))</span>
        <span class="c">#print(&#39;get_encounter_nids&#39;)</span>
        <span class="c">#print(&#39;eid_list = %r&#39; % (eid_list,))</span>
        <span class="c">#print(&#39;aids_list = %r&#39; % (aids_list,))</span>
        <span class="c">#print(&#39;nids_list_ = %r&#39; % (nids_list_,))</span>
        <span class="c">#print(&#39;nids_list = %r&#39; % (nids_list,))</span>
        <span class="k">return</span> <span class="n">nids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_encounter_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): encounter_uuid of each eid in eid_list &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">encuuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;encounter_uuid&#39;</span><span class="p">,),</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">)</span>
        <span class="c">#enctext_list = list(map(__STR__, enctext_list))</span>
        <span class="k">return</span> <span class="n">encuuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_encounter_config"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_config">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_config</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): config_rowid of each eid in eid_list &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">)</span>
        <span class="c">#enctext_list = list(map(__STR__, enctext_list))</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_encounter_enctext"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_enctext">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_enctext</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): encounter_text of each eid in eid_list &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">enctext_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;encounter_text&#39;</span><span class="p">,),</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">)</span>
        <span class="c">#enctext_list = list(map(__STR__, enctext_list))</span>
        <span class="k">return</span> <span class="n">enctext_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_encounter_eids_from_text"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_eids_from_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_eids_from_text</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">enctext_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): a list of eids corresponding to each encounter enctext</span>
<span class="sd">        #FIXME: make new naming scheme for non-primary-key-getters</span>
<span class="sd">        get_encounter_eids_from_text_from_text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">add_encounters</span><span class="p">(</span><span class="n">enctext_list</span><span class="p">)</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">,),</span> <span class="n">enctext_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_text&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_encounter_note"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_encounter_note">[docs]</a>    <span class="k">def</span> <span class="nf">get_encounter_note</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): encounter_note of each eid in eid_list &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="n">encnote_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;encounter_note&#39;</span><span class="p">,),</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">)</span>
        <span class="c">#enctext_list = list(map(__STR__, enctext_list))</span>
        <span class="k">return</span> <span class="n">encnote_list</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#-----------------</span>
    <span class="c"># --- DELETERS ---</span>
    <span class="c">#-----------------</span>
</div>
    <span class="nd">@deleter</span>
    <span class="nd">@cache_invalidator</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.delete_annots"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annots">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes annotations from the database &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> annotations&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">))</span>
        <span class="c"># Delete chips and features first</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_chips</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">ANNOTATION_TABLE</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_relations</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_images">[docs]</a>    <span class="k">def</span> <span class="nf">delete_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes images from the database that belong to gids&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> images&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="c"># Move images to trash before deleting them. #</span>
        <span class="c"># TODO: only move localized images</span>
        <span class="c"># TODO: ensure there are no name conflicts when using the original names</span>
        <span class="n">gpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_paths</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">gname_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_gnames</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">ext_list</span>   <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_exts</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">trash_dir</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_trashdir</span><span class="p">()</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">trash_dir</span><span class="p">)</span>
        <span class="n">gpath_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">trash_dir</span><span class="p">,</span> <span class="n">gname</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">gname</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="ow">in</span>
                       <span class="nb">zip</span><span class="p">(</span><span class="n">gname_list</span><span class="p">,</span> <span class="n">ext_list</span><span class="p">)]</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">copy_list</span><span class="p">(</span><span class="n">gpath_list</span><span class="p">,</span> <span class="n">gpath_list2</span><span class="p">)</span>
        <span class="c">#utool.view_directory(trash_dir)</span>

        <span class="c"># Delete annotations first</span>
        <span class="n">aid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_image_aids</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annots</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">IMAGE_TABLE</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="c">#egrid_list = utool.flatten(ibs.get_image_egrids(gid_list))</span>
        <span class="c">#ibs.db.delete_rowids(EG_RELATION_TABLE, egrid_list)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;image_rowid&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
    <span class="nd">@cache_invalidator</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.delete_features"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_features">[docs]</a>    <span class="k">def</span> <span class="nf">delete_features</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes images from the database that belong to fids&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> features&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">fid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">FEATURE_TABLE</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_configs"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_configs">[docs]</a>    <span class="k">def</span> <span class="nf">delete_configs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes images from the database that belong to fids&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> configs&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_contributors"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_contributors">[docs]</a>    <span class="k">def</span> <span class="nf">delete_contributors</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes contributors from the database and all information associated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> contributors&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">))</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_config_rowids</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">))</span>
        <span class="c"># Delete configs</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_configs</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="c"># Delete encounters</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_eids</span><span class="p">()</span>
        <span class="n">eid_config_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_config</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
        <span class="n">valid_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">config_rowid_list</span> <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">eid_config_list</span> <span class="p">]</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">eid_list</span><span class="p">,</span> <span class="n">valid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_encounters</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
        <span class="c"># Delete images</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_contributor_gids</span><span class="p">(</span><span class="n">contrib_rowid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_images</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="c"># Delete contributors</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">CONTRIBUTOR_TABLE</span><span class="p">,</span> <span class="n">contrib_rowid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_annot_chips"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annot_chips">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annot_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clears annotation data but does not remove the annotation &quot;&quot;&quot;</span>
        <span class="n">_cid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_cids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">cid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span><span class="n">_cid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_chips</span><span class="p">(</span><span class="n">cid_list</span><span class="p">)</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_image_thumbs</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>  <span class="c"># why is this done here?</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_chip_thumbs</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_image_thumbs"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_image_thumbs">[docs]</a>    <span class="k">def</span> <span class="nf">delete_image_thumbs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes image thumbnails from disk &quot;&quot;&quot;</span>
        <span class="c"># print(&#39;gid_list = %r&#39; % (gid_list,))</span>
        <span class="n">thumbpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_image_thumbpath</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">remove_file_list</span><span class="p">(</span><span class="n">thumbpath_list</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_annot_chip_thumbs"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annot_chip_thumbs">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annot_chip_thumbs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes chip thumbnails from disk &quot;&quot;&quot;</span>
        <span class="n">thumbpath_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_chip_thumbpath</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">remove_file_list</span><span class="p">(</span><span class="n">thumbpath_list</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
    <span class="nd">@cache_invalidator</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.delete_chips"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_chips">[docs]</a>    <span class="k">def</span> <span class="nf">delete_chips</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes images from the database that belong to gids&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_chip</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> annotation-chips&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cid_list</span><span class="p">))</span>
        <span class="c"># Delete chip-images from disk</span>
        <span class="c">#preproc_chip.delete_chips(ibs, cid_list, verbose=verbose)</span>
        <span class="n">preproc_chip</span><span class="o">.</span><span class="n">on_delete</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c"># Delete chip features from sql</span>
        <span class="n">_fid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_chip_fids</span><span class="p">(</span><span class="n">cid_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">fid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span><span class="n">_fid_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_features</span><span class="p">(</span><span class="n">fid_list</span><span class="p">)</span>
        <span class="c"># Delete chips from sql</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">dbcache</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">CHIP_TABLE</span><span class="p">,</span> <span class="n">cid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_encounters"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_encounters">[docs]</a>    <span class="k">def</span> <span class="nf">delete_encounters</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes encounters (images are not effected) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> encounters&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">eid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">ENCOUNTER_TABLE</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">)</span>
        <span class="c"># Optimization hack, less SQL calls</span>
        <span class="c">#egrid_list = utool.flatten(ibs.get_encounter_egrids(eid_list=eid_list))</span>
        <span class="c">#ibs.db.delete_rowids(EG_RELATION_TABLE, egrid_list)</span>
        <span class="c">#ibs.db.delete(EG_RELATION_TABLE, eid_list, id_colname=&#39;encounter_rowid&#39;)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">unrelate_encounter_from_images</span><span class="p">(</span><span class="n">eid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.unrelate_encounter_from_images"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.unrelate_encounter_from_images">[docs]</a>    <span class="k">def</span> <span class="nf">unrelate_encounter_from_images</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes relationship between input encounters and all images &quot;&quot;&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;encounter_rowid&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.unrelate_image_from_encounter"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.unrelate_image_from_encounter">[docs]</a>    <span class="k">def</span> <span class="nf">unrelate_image_from_encounter</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes relationship between input images and all encounters &quot;&quot;&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;image_rowid&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_image_eids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_image_eids">[docs]</a>    <span class="k">def</span> <span class="nf">delete_image_eids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="c"># WHAT IS THIS FUNCTION? FIXME CALLS WEIRD FUNCTION</span>
        <span class="sd">&quot;&quot;&quot; Sets the encoutertext of each image &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%r</span><span class="s"> image</span><span class="se">\&#39;</span><span class="s">s encounter ids&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">egrid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_egrids</span><span class="p">(</span><span class="n">eid_list</span><span class="o">=</span><span class="n">eid_list</span><span class="p">,</span> <span class="n">gid_list</span><span class="o">=</span><span class="n">gid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">egrid_list</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#----------------</span>
    <span class="c"># --- WRITERS ---</span>
    <span class="c">#----------------</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.export_to_wildbook"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.export_to_wildbook">[docs]</a>    <span class="k">def</span> <span class="nf">export_to_wildbook</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Exports identified chips to wildbook &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ibeis.dbio.export_wb</span> <span class="kn">as</span> <span class="nn">wb</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] exporting to wildbook&#39;</span><span class="p">)</span>
        <span class="n">eid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_eids</span><span class="p">()</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&quot;http://127.0.0.1:8080/wildbook-4.1.0-RELEASE&quot;</span>
        <span class="c">#addr = &quot;http://tomcat:tomcat123@127.0.0.1:8080/wildbook-5.0.0-EXPERIMENTAL&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">_init_wb</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">export_ibeis_to_wildbook</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">)</span>
        <span class="c">#raise NotImplementedError()</span>
        <span class="c"># compute encounters</span>
        <span class="c"># get encounters by id</span>
        <span class="c"># get ANNOTATIONs by encounter id</span>
        <span class="c"># submit requests to wildbook</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#-----------------------------</span>
    <span class="c"># --- ENCOUNTER CLUSTERING ---</span>
    <span class="c">#-----------------------------</span>

    <span class="c">#@default_decorator</span></div>
    <span class="nd">@utool.indent_func</span><span class="p">(</span><span class="s">&#39;[ibs.compute_encounters]&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="IBEISController.compute_encounters"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.compute_encounters">[docs]</a>    <span class="k">def</span> <span class="nf">compute_encounters</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clusters images into encounters &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.preproc</span> <span class="kn">import</span> <span class="n">preproc_encounter</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] Computing and adding encounters.&#39;</span><span class="p">)</span>
        <span class="n">gid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_gids</span><span class="p">(</span><span class="n">require_unixtime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reviewed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">enctext_list</span><span class="p">,</span> <span class="n">flat_gids</span> <span class="o">=</span> <span class="n">preproc_encounter</span><span class="o">.</span><span class="n">ibeis_compute_encounters</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] Finished computing, about to add encounter.&#39;</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_image_enctext</span><span class="p">(</span><span class="n">flat_gids</span><span class="p">,</span> <span class="n">enctext_list</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] Finished computing and adding encounters.&#39;</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#------------------</span>
    <span class="c"># --- DETECTION ---</span>
    <span class="c">#------------------</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.detect_existence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.detect_existence">[docs]</a>    <span class="k">def</span> <span class="nf">detect_existence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Detects the probability of animal existence in each image &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.detect</span> <span class="kn">import</span> <span class="n">randomforest</span>  <span class="c"># NOQ</span>
        <span class="n">probexist_list</span> <span class="o">=</span> <span class="n">randomforest</span><span class="o">.</span><span class="n">detect_existence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># Return for user inspection</span>
        <span class="k">return</span> <span class="n">probexist_list</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.detect_random_forest"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.detect_random_forest">[docs]</a>    <span class="k">def</span> <span class="nf">detect_random_forest</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs animal detection in each image &quot;&quot;&quot;</span>
        <span class="c"># TODO: Return confidence here as well</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] detecting using random forests&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.detect</span> <span class="kn">import</span> <span class="n">randomforest</span>  <span class="c"># NOQ</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">tic</span><span class="p">()</span>
        <span class="n">detect_gen</span> <span class="o">=</span> <span class="n">randomforest</span><span class="o">.</span><span class="n">ibeis_generate_image_detections</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">detected_gid_list</span><span class="p">,</span> <span class="n">detected_bbox_list</span><span class="p">,</span> <span class="n">detected_confidence_list</span><span class="p">,</span> <span class="n">detected_img_confs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">ensure_attr</span><span class="p">(</span><span class="s">&#39;detect_add_after&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ADD_AFTER_THRESHOLD</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">other_cfg</span><span class="o">.</span><span class="n">detect_add_after</span>

        <span class="k">def</span> <span class="nf">commit_detections</span><span class="p">(</span><span class="n">detected_gids</span><span class="p">,</span> <span class="n">detected_bboxes</span><span class="p">,</span> <span class="n">detected_confidences</span><span class="p">,</span> <span class="n">img_confs</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; helper to commit detections on the fly &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detected_gids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">notes_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;rfdetect&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detected_gid_list</span><span class="p">))]</span>
            <span class="c"># Ideally, species will come from the detector with confidences that actually mean something</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">detect_cfg</span><span class="o">.</span><span class="n">species</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">notes_list</span><span class="p">)</span>
            <span class="n">ibs</span><span class="o">.</span><span class="n">add_annots</span><span class="p">(</span><span class="n">detected_gids</span><span class="p">,</span> <span class="n">detected_bboxes</span><span class="p">,</span>
                                <span class="n">notes_list</span><span class="o">=</span><span class="n">notes_list</span><span class="p">,</span>
                                <span class="n">species_list</span><span class="o">=</span><span class="n">species_list</span><span class="p">,</span>
                                <span class="n">detect_confidence_list</span><span class="o">=</span><span class="n">detected_confidences</span><span class="p">)</span>

        <span class="c"># Adding new detections on the fly as they are generated</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">confidence</span><span class="p">,</span> <span class="n">img_conf</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">detect_gen</span><span class="p">):</span>
            <span class="n">detected_gid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="n">detected_bbox_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
            <span class="n">detected_confidence_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
            <span class="n">detected_img_confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_conf</span><span class="p">)</span>
            <span class="c"># Save detections as we go, then reset lists</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detected_gid_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ADD_AFTER_THRESHOLD</span><span class="p">:</span>
                <span class="n">commit_detections</span><span class="p">(</span><span class="n">detected_gid_list</span><span class="p">,</span>
                                  <span class="n">detected_bbox_list</span><span class="p">,</span>
                                  <span class="n">detected_confidence_list</span><span class="p">,</span>
                                  <span class="n">detected_img_confs</span><span class="p">)</span>
                <span class="n">detected_gid_list</span>  <span class="o">=</span> <span class="p">[]</span>
                <span class="n">detected_bbox_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">detected_confidence_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">detected_img_confs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Save any leftover detections</span>
        <span class="n">commit_detections</span><span class="p">(</span>  <span class="n">detected_gid_list</span><span class="p">,</span>
                            <span class="n">detected_bbox_list</span><span class="p">,</span>
                            <span class="n">detected_confidence_list</span><span class="p">,</span>
                            <span class="n">detected_img_confs</span><span class="p">)</span>
        <span class="n">tt_total</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">toc</span><span class="p">(</span><span class="n">tt</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] finshed detecting, took </span><span class="si">%.2f</span><span class="s"> seconds (avg. </span><span class="si">%.2f</span><span class="s"> seconds per image)&#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">tt_total</span><span class="p">,</span> <span class="n">tt_total</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] finshed detecting&#39;</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#-----------------------</span>
    <span class="c"># --- IDENTIFICATION ---</span>
    <span class="c">#-----------------------</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.get_recognition_database_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_recognition_database_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_recognition_database_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DEPRECATE or refactor</span>

<span class="sd">        Returns:</span>
<span class="sd">            daid_list (list): testing recognition database annotations &quot;&quot;&quot;</span>
        <span class="c"># TODO: Depricate, use exemplars instead</span>
        <span class="k">if</span> <span class="s">&#39;daid_list&#39;</span> <span class="ow">in</span> <span class="n">ibs</span><span class="o">.</span><span class="n">temporary_state</span><span class="p">:</span>
            <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">temporary_state</span><span class="p">[</span><span class="s">&#39;daid_list&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">daid_list</span>

    <span class="c">#@default_decorator</span>
    <span class="c">#def _init_query_requestor(ibs):</span>
    <span class="c">#from ibeis.model.hots import match_chips3 as mc3</span>
    <span class="c">#from ibeis.model.hots import hots_query_request</span>
    <span class="c">#    # DEPRICATE</span>
    <span class="c">#    # Create query request object</span>
    <span class="c">#    ibs.qreq = hots_query_request.QueryRequest(ibs.qresdir, ibs.bigcachedir)</span>
    <span class="c">#    ibs.qreq.set_cfg(ibs.cfg.query_cfg)</span>

    <span class="c">#@default_decorator</span>
    <span class="c">#def _prep_qreq(ibs, qaid_list, daid_list, **kwargs):</span>
    <span class="c">#    # DEPRICATE</span>
    <span class="c">#    if ibs.qreq is None:</span>
    <span class="c">#        ibs._init_query_requestor()</span>
    <span class="c">#    qreq = mc3.prep_query_request(qreq=ibs.qreq,</span>
    <span class="c">#                                  qaids=qaid_list,</span>
    <span class="c">#                                  daids=daid_list,</span>
    <span class="c">#                                  query_cfg=ibs.cfg.query_cfg,</span>
    <span class="c">#                                  **kwargs)</span>
    <span class="c">#    return qreq</span>

    <span class="c">#@default_decorator</span>
    <span class="c">#def _query_chips3(ibs, qaid_list, daid_list, safe=True,</span>
    <span class="c">#                  use_cache=mc3.USE_CACHE,</span>
    <span class="c">#                  use_bigcache=mc3.USE_BIGCACHE,</span>
    <span class="c">#                  **kwargs):</span>
    <span class="c">#    # DEPRICATE</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    qaid_list - query chip ids</span>
    <span class="c">#    daid_list - database chip ids</span>
    <span class="c">#    kwargs modify query_cfg</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    qreq = ibs._prep_qreq(qaid_list, daid_list, **kwargs)</span>
    <span class="c">#    # TODO: Except query error</span>
    <span class="c">#    # NOTE: maybe kwargs should not be passed here, or the previous</span>
    <span class="c">#    # kwargs should become querycfgkw</span>
    <span class="c">#    process_qreqkw = {</span>
    <span class="c">#        &#39;safe&#39;         : safe,</span>
    <span class="c">#        &#39;use_cache&#39;    : use_cache,</span>
    <span class="c">#        &#39;use_bigcache&#39; : use_bigcache,</span>
    <span class="c">#    }</span>
    <span class="c">#    qaid2_qres = mc3.process_query_request(ibs, qreq, **process_qreqkw)</span>
    <span class="c">#    return qaid2_qres</span>
</div>
    <span class="k">def</span> <span class="nf">_query_chips4</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">use_bigcache</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">return_request</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">custom_qparams</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.all_imports import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; qaid_list = [1]</span>
<span class="sd">            &gt;&gt;&gt; daid_list = [1, 2, 3, 4, 5]</span>
<span class="sd">            &gt;&gt;&gt; mc3.USE_CACHE = False</span>
<span class="sd">            &gt;&gt;&gt; mc4.USE_CACHE = False</span>
<span class="sd">            &gt;&gt;&gt; ibs = ibeis.test_main(db=&#39;testdb1&#39;)  #doctest: +ELLIPSIS</span>
<span class="sd">            &gt;&gt;&gt; qres1 = ibs._query_chips3(qaid_list, daid_list, use_cache=False)[1]</span>
<span class="sd">            &gt;&gt;&gt; qres2 = ibs._query_chips4(qaid_list, daid_list, use_cache=False)[1]</span>
<span class="sd">            &gt;&gt;&gt; qreq_ = mc4.get_ibeis_query_request(ibs, qaid_list, daid_list)</span>
<span class="sd">            &gt;&gt;&gt; qreq_.load_indexer(ibs)</span>
<span class="sd">            &gt;&gt;&gt; qreq_.load_query_vectors(ibs)</span>
<span class="sd">            &gt;&gt;&gt; qreq = ibs.qreq</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">match_chips4</span> <span class="k">as</span> <span class="n">mc4</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">daid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;there are no database chips&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;there are no query chips&#39;</span>
        <span class="k">if</span> <span class="n">return_request</span><span class="p">:</span>
            <span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">mc4</span><span class="o">.</span><span class="n">submit_query_request</span><span class="p">(</span>
                <span class="n">ibs</span><span class="p">,</span>  <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">use_bigcache</span><span class="p">,</span>
                <span class="n">return_request</span><span class="p">,</span> <span class="n">custom_qparams</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">mc4</span><span class="o">.</span><span class="n">submit_query_request</span><span class="p">(</span>
                <span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">use_bigcache</span><span class="p">,</span> <span class="n">return_request</span><span class="p">,</span>
                <span class="n">custom_qparams</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">qaid2_qres</span>

    <span class="c">#_query_chips = _query_chips3</span>
    <span class="n">_query_chips</span> <span class="o">=</span> <span class="n">_query_chips4</span>

    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.query_encounter"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.query_encounter">[docs]</a>    <span class="k">def</span> <span class="nf">query_encounter</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; _query_chips wrapper &quot;&quot;&quot;</span>
        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_encounter_aids</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>  <span class="c"># encounter database chips</span>
        <span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">qres</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">qaid2_qres</span><span class="p">):</span>
            <span class="n">qres</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="n">eid</span>
        <span class="k">return</span> <span class="n">qaid2_qres</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.query_exemplars"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.query_exemplars">[docs]</a>    <span class="k">def</span> <span class="nf">query_exemplars</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Queries vs the exemplars &quot;&quot;&quot;</span>
        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">is_exemplar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">daid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;there are no exemplars&#39;</span>
        <span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qaid2_qres</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.query_all"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.query_all">[docs]</a>    <span class="k">def</span> <span class="nf">query_all</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Queries vs the exemplars &quot;&quot;&quot;</span>
        <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
        <span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qaid2_qres</span>

    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#--------------</span>
    <span class="c"># --- MISC ---</span>
    <span class="c">#--------------</span>
    <span class="c"># See ibeis/ibsfuncs.py</span>
    <span class="c"># there is some sneaky stuff happening there</span>

    <span class="c"># Hacky code for rosemary</span>
    <span class="c"># DO NOT USE ANYWHERE ELSE IN CONTROLLER</span>

    <span class="c">#--------------</span>
    <span class="c"># IN QUESTION</span>
    <span class="c">#--------------</span>

    <span class="c"># SETTERS::ALR</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_alr_lblannot_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_alr_lblannot_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">set_alr_lblannot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Associates whatever annotation is at row(alrid) with a new</span>
<span class="sd">        lblannot_rowid. (effectively changes the label value of the rowid)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">alrid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">alrid</span> <span class="ow">in</span> <span class="n">alrid_list</span><span class="p">)</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">lblannot_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">lblannot_rowid</span> <span class="ow">in</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lblannot_rowid&#39;</span><span class="p">,)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_alr_confidence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_alr_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">set_alr_confidence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">,</span> <span class="n">confidence_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets annotation-lblannot-relationship confidence &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">alrid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">alrid</span> <span class="ow">in</span> <span class="n">alrid_list</span><span class="p">)</span>
        <span class="n">val_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">confidence</span><span class="p">,)</span> <span class="k">for</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="n">confidence_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;alr_confidence&#39;</span><span class="p">,)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">val_iter</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>

    <span class="c"># ADDERS::GLR</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_image_relationship_one"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_image_relationship_one">[docs]</a>    <span class="k">def</span> <span class="nf">add_image_relationship_one</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                    <span class="n">glr_confidence_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a relationship between images and lblimages</span>
<span class="sd">            (imageations and labels of imageations) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config_rowid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIGID</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glr_confidence_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">glr_confidence_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gid_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;lblimage_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;config_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;glr_confidence&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">glr_confidence_list</span><span class="p">))</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_glrid_from_superkey</span>
        <span class="n">superkey_paramx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c"># TODO HAVE SQL GIVE YOU THESE NUMBERS</span>
        <span class="n">glrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                        <span class="n">get_rowid_from_superkey</span><span class="p">,</span> <span class="n">superkey_paramx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">glrid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_image_relationship"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_image_relationship">[docs]</a>    <span class="k">def</span> <span class="nf">add_image_relationship</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a relationship between an image and and encounter &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;encounter_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">))</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_egr_rowid_from_superkey</span>
        <span class="n">superkey_paramx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">egrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                        <span class="n">get_rowid_from_superkey</span><span class="p">,</span> <span class="n">superkey_paramx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">egrid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_glrid_from_superkey"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_glrid_from_superkey">[docs]</a>    <span class="k">def</span> <span class="nf">get_glrid_from_superkey</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            gid_list (list): list of image row-ids</span>
<span class="sd">            lblimage_rowid_list (list): list of lblimage row-ids</span>
<span class="sd">            config_rowid_list (list): list of config row-ids</span>
<span class="sd">        Returns:</span>
<span class="sd">            glrid_list (list): image-label relationship id list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;image_rowid=? AND lblimage_rowid=? AND config_rowid=?&#39;</span>
        <span class="n">glrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">glrid_list</span>

    <span class="c"># ADDERS::ALR</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_annot_relationship"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_annot_relationship">[docs]</a>    <span class="k">def</span> <span class="nf">add_annot_relationship</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                    <span class="n">alr_confidence_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a relationship between annots and lblannots</span>
<span class="sd">            (annotations and labels of annotations) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config_rowid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIGID</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alr_confidence_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">alr_confidence_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;lblannot_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;config_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;alr_confidence&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">alr_confidence_list</span><span class="p">))</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_alrid_from_superkey</span>
        <span class="n">superkey_paramx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c"># TODO HAVE SQL GIVE YOU THESE NUMBERS</span>
        <span class="n">alrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                        <span class="n">get_rowid_from_superkey</span><span class="p">,</span> <span class="n">superkey_paramx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alrid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_alrid_from_superkey"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_alrid_from_superkey">[docs]</a>    <span class="k">def</span> <span class="nf">get_alrid_from_superkey</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            aid_list (list): list of annotation row-ids</span>
<span class="sd">            lblannot_rowid_list (list): list of lblannot row-ids</span>
<span class="sd">            config_rowid_list (list): list of config row-ids</span>
<span class="sd">        Returns:</span>
<span class="sd">            alrid_list (list): annot-label relationship id list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">config_rowid_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;annot_rowid=? AND lblannot_rowid=? AND config_rowid=?&#39;</span>
        <span class="n">alrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alrid_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::ALR</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_alr_confidence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_alr_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">get_alr_confidence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            alrid_list (list of rowids): annot + label relationship rows</span>
<span class="sd">        Returns:</span>
<span class="sd">            alr_confidence_list (list of rowids): confidence in an annotation relationship</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alr_confidence_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;alr_confidence&#39;</span><span class="p">,),</span> <span class="n">alrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alr_confidence_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_alr_lblannot_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_alr_lblannot_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_alr_lblannot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            alrid_list (list of rowids): annot + label relationship rows</span>
<span class="sd">        Returns:</span>
<span class="sd">            lblannot_rowids_list (list of rowids): label rowids (of annotations)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lblannot_rowids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblannot_rowid&#39;</span><span class="p">,),</span> <span class="n">alrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_alr_annot_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_alr_annot_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_alr_annot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            alrid_list (list of rowids): annot + label relationship rows</span>
<span class="sd">        get the annot_rowid belonging to each relationship &quot;&quot;&quot;</span>
        <span class="n">annot_rowids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,),</span> <span class="n">alrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annot_rowids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_alr_config_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_alr_config_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_alr_config_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            alrid_list (list of rowids): annot + label relationship rows</span>
<span class="sd">        Returns:</span>
<span class="sd">            config_rowid_list (list): config_rowid in an annotation relationship</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">alrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::GLR</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_glr_confidence"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_glr_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">get_glr_confidence</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">glrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  confidence in an image relationship &quot;&quot;&quot;</span>
        <span class="n">glr_confidence_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;glr_confidence&#39;</span><span class="p">,),</span> <span class="n">glrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">glr_confidence_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_glr_lblimage_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_glr_lblimage_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_glr_lblimage_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">glrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the lblimage_rowid belonging to each relationship &quot;&quot;&quot;</span>
        <span class="n">lblimage_rowids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblimage_rowid&#39;</span><span class="p">,),</span> <span class="n">glrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimage_rowids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_glr_image_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_glr_image_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_glr_image_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">glrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the image_rowid belonging to each relationship &quot;&quot;&quot;</span>
        <span class="n">image_rowids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,),</span> <span class="n">glrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_rowids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_glr_config_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_glr_config_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_glr_config_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">glrid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  config_rowid in an image relationship &quot;&quot;&quot;</span>
        <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;config_rowid&#39;</span><span class="p">,),</span> <span class="n">glrid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_rowid_list</span>

    <span class="c"># ADDERS::IMAGE-&gt;ENCOUNTER</span>

    <span class="c"># SETTERS::LBLANNOT(NAME)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_name_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_name_notes">[docs]</a>    <span class="k">def</span> <span class="nf">set_name_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">notes_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets notes of names (groups of animals) &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_lblannot_rowids_are_type</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">])</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_lblannot_notes</span><span class="p">(</span><span class="n">nid_list</span><span class="p">,</span> <span class="n">notes_list</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_name_names"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_name_names">[docs]</a>    <span class="k">def</span> <span class="nf">set_name_names</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">name_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Changes the name text. Does not affect the animals of this name.</span>
<span class="sd">        Effectively an alias.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_valid_names</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_lblannot_rowids_are_type</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">])</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_lblannot_values</span><span class="p">(</span><span class="n">nid_list</span><span class="p">,</span> <span class="n">name_list</span><span class="p">)</span>

    <span class="c"># SETTERS::LBLANNOT</span>
</div>
<div class="viewcode-block" id="IBEISController.set_lblannot_values"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_lblannot_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_lblannot_values</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates the value for lblannots. Note this change applies to</span>
<span class="sd">        all annotations related to this lblannot_rowid &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">rowid</span> <span class="ow">in</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">value</span><span class="p">,)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblannot_value&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.set_lblannot_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_lblannot_notes">[docs]</a>    <span class="k">def</span> <span class="nf">set_lblannot_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates the value for lblannots. Note this change applies to</span>
<span class="sd">        all annotations related to this lblannot_rowid &quot;&quot;&quot;</span>
        <span class="n">id_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">rowid</span> <span class="ow">in</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">value</span><span class="p">,)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblannot_note&#39;</span><span class="p">,),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">id_iter</span><span class="p">)</span>

    <span class="c"># SETTERS::ANNOT-&gt;LBLANNOT(NAME)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_names"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_names">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_names</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">name_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the attrlbl_value of type(INDIVIDUAL_KEY) Sets names/nids of a</span>
<span class="sd">        list of annotations.  Convenience function for</span>
<span class="sd">        set_annot_lblannot_from_value&quot;&quot;&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_lblannot_from_value</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">name_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_species"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_species">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_species</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets species/speciesids of a list of annotations.</span>
<span class="sd">        Convenience function for set_annot_lblannot_from_value &quot;&quot;&quot;</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">]</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_valid_species</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_lblannot_from_value</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_lblannot_from_value"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_lblannot_from_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_lblannot_from_value</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Associates the annot and lblannot of a specific type and value</span>
<span class="sd">        Adds the lblannot if it doesnt exist.</span>
<span class="sd">        Wrapper around convenience function for set_annot_from_lblannot_rowid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">value_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">assert</span> <span class="n">_lbltype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># a value consisting of an empty string or all spaces is set to the default</span>
        <span class="n">DEFAULT_VALUE</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KEY_DEFAULTS</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">]</span>
        <span class="n">EMPTY_KEY</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">EMPTY_KEY</span>
        <span class="c"># setting a name to DEFAULT_VALUE or EMPTY is equivalent to unnaming it</span>
        <span class="n">value_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEFAULT_VALUE</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">EMPTY_KEY</span> <span class="k">else</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">]</span>
        <span class="n">notdefault_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="o">!=</span> <span class="n">DEFAULT_VALUE</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list_</span><span class="p">]</span>
        <span class="n">aid_list_to_delete</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">get_dirty_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">notdefault_list</span><span class="p">)</span>
        <span class="c"># Set all the valid valids</span>
        <span class="n">aids_to_set</span>   <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">notdefault_list</span><span class="p">)</span>
        <span class="n">values_to_set</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">value_list_</span><span class="p">,</span> <span class="n">notdefault_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_relations_oftype</span><span class="p">(</span><span class="n">aid_list_to_delete</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">)</span>
        <span class="c"># remove the relationships that have now been unnamed</span>
        <span class="c"># Convert names into lblannot_rowid</span>
        <span class="c"># FIXME: This function should not be able to set label realationships</span>
        <span class="c"># to labels that have not been added!!</span>
        <span class="c"># This is an inefficient way of getting lblannot_rowids!</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values_to_set</span><span class="p">)</span>
        <span class="c"># auto ensure</span>
        <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_lblannots</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">values_to_set</span><span class="p">)</span>
        <span class="c"># Call set_annot_from_lblannot_rowid to finish the conditional adding</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_lblannot_from_rowid</span><span class="p">(</span><span class="n">aids_to_set</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_nids">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets names/nids of a list of annotations.</span>
<span class="sd">        Convenience function for set_annot_lblannot_from_rowid &quot;&quot;&quot;</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_lblannot_rowids_are_type</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">])</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_lblannot_from_rowid</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_speciesids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_speciesids">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_speciesids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">speciesid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets species/speciesids of a list of annotations.</span>
<span class="sd">        Convenience function for set_annot_lblannot_from_rowid&quot;&quot;&quot;</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_lblannot_rowids_are_type</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">speciesid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">])</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_lblannot_from_rowid</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">speciesid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">)</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_lblannot_from_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_lblannot_from_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_lblannot_from_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets items/lblannot_rowids of a list of annotations.&quot;&quot;&quot;</span>
        <span class="c"># Get the alrids_list for the aids, using the lbltype as a filter</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">])</span>
        <span class="c"># Find the aids which already have relationships (of _lbltype)</span>
        <span class="n">setflag_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">alrids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">alrids</span> <span class="ow">in</span> <span class="n">alrids_list</span><span class="p">]</span>
        <span class="c"># Add the relationship if it doesn&#39;t exist</span>
        <span class="n">aid_list_to_add</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">get_dirty_items</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">setflag_list</span><span class="p">)</span>
        <span class="n">lblannot_rowid_list_to_add</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">get_dirty_items</span><span class="p">(</span><span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">setflag_list</span><span class="p">)</span>
        <span class="c"># set the existing relationship if one already exists</span>
        <span class="n">alrids_list_to_set</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">alrids_list</span><span class="p">,</span> <span class="n">setflag_list</span><span class="p">)</span>
        <span class="n">lblannot_rowid_list_to_set</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">setflag_list</span><span class="p">)</span>
        <span class="c"># Assert each annot has only one relationship of this type</span>
        <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">assert_singleton_relationship</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">alrids_list_to_set</span><span class="p">)</span>
        <span class="n">alrid_list_to_set</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">alrids_list_to_set</span><span class="p">)</span>
        <span class="c"># Add the new relationships</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">add_annot_relationship</span><span class="p">(</span><span class="n">aid_list_to_add</span><span class="p">,</span> <span class="n">lblannot_rowid_list_to_add</span><span class="p">)</span>
        <span class="c"># Set the old relationships</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">set_alr_lblannot_rowids</span><span class="p">(</span><span class="n">alrid_list_to_set</span><span class="p">,</span> <span class="n">lblannot_rowid_list_to_set</span><span class="p">)</span>

    <span class="c"># ADDERS::LBLIMAGE</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_lblimages"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_lblimages">[docs]</a>    <span class="k">def</span> <span class="nf">add_lblimages</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">note_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lblimage_uuid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds new lblimages (labels of imageations)</span>
<span class="sd">        creates a new uuid for any new pair(type, value)</span>
<span class="sd">        #TODO: reverse order of rowid_list value_list in input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">note_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">note_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
        <span class="c"># Get random uuids</span>
        <span class="k">if</span> <span class="n">lblimage_uuid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lblimage_uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">))]</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lblimage_uuid&#39;</span><span class="p">,</span> <span class="s">&#39;lbltype_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;lblimage_value&#39;</span><span class="p">,</span> <span class="s">&#39;lblimage_note&#39;</span><span class="p">]</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lblimage_uuid_list</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">note_list</span><span class="p">))</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblimage_rowid_from_superkey</span>
        <span class="n">superkey_paramx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">lblimage_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                                 <span class="n">get_rowid_from_superkey</span><span class="p">,</span> <span class="n">superkey_paramx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimage_rowid_list</span>

    <span class="c"># ADDERS::LBLANNOT</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_lblannots"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_lblannots">[docs]</a>    <span class="k">def</span> <span class="nf">add_lblannots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">note_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lblannot_uuid_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds new lblannots (labels of annotations)</span>
<span class="sd">        creates a new uuid for any new pair(type, value)</span>
<span class="sd">        #TODO: reverse order of rowid_list value_list in input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">note_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">note_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
        <span class="c"># Get random uuids</span>
        <span class="k">if</span> <span class="n">lblannot_uuid_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lblannot_uuid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">))]</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lblannot_uuid&#39;</span><span class="p">,</span> <span class="s">&#39;lbltype_rowid&#39;</span><span class="p">,</span> <span class="s">&#39;lblannot_value&#39;</span><span class="p">,</span> <span class="s">&#39;lblannot_note&#39;</span><span class="p">]</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lblannot_uuid_list</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">note_list</span><span class="p">))</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_rowid_from_superkey</span>
        <span class="n">superkey_paramx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                                 <span class="n">get_rowid_from_superkey</span><span class="p">,</span> <span class="n">superkey_paramx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_names"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_names">[docs]</a>    <span class="k">def</span> <span class="nf">add_names</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">name_list</span><span class="p">,</span> <span class="n">note_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a list of names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            nid_list (list): their nids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># nid_list_ = [namenid_dict[name] for name in name_list_]</span>
        <span class="c"># ibsfuncs.assert_valid_names(name_list)</span>
        <span class="c"># All names are individuals and so may safely receive the INDIVIDUAL_KEY lblannot</span>
        <span class="n">lbltype_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">]</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">lbltype_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
        <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_lblannots</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">name_list</span><span class="p">,</span> <span class="n">note_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nid_list</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_species"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_species">[docs]</a>    <span class="k">def</span> <span class="nf">add_species</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">note_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a list of species.</span>

<span class="sd">        Returns:</span>
<span class="sd">            speciesid_list (list): species rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">]</span>
        <span class="n">lbltype_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">]</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">lbltype_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">)</span>
        <span class="n">speciesid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_lblannots</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">note_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">speciesid_list</span>

    <span class="c"># INVESTIGATE::adders</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_lbltype"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_lbltype">[docs]</a>    <span class="k">def</span> <span class="nf">add_lbltype</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">text_list</span><span class="p">,</span> <span class="n">default_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a label type and its default value</span>
<span class="sd">        Should only be called at the begining of the program.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">text_list</span><span class="p">,</span> <span class="n">default_list</span><span class="p">)</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lbltype_text&#39;</span><span class="p">,</span> <span class="s">&#39;lbltype_default&#39;</span><span class="p">,)</span>
        <span class="n">get_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lbltype_rowid_from_text</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add_cleanly</span><span class="p">(</span><span class="n">LBLTYPE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span>
                                                <span class="n">get_rowid_from_superkey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbltype_rowid_list</span>

    <span class="c"># INVEST::getters</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_image_glrids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_image_glrids">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_glrids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">configid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; FIXME: __name__</span>
<span class="sd">        Get all the relationship ids belonging to the input images</span>
<span class="sd">        if lblimage lbltype is specified the relationship ids are filtered to</span>
<span class="sd">        be only of a specific lbltype/category/type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">configid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">MANUAL_CONFIGID</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">gid</span><span class="p">,</span> <span class="n">configid</span><span class="p">)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gid_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;image_rowid=? AND config_rowid=?&#39;</span>
        <span class="n">glrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;glr_rowid&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span>
                                       <span class="n">where_clause</span><span class="o">=</span><span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># assert all([x &gt; 0 for x in map(len, alrids_list)]), &#39;annotations must have at least one relationship&#39;</span>
        <span class="k">return</span> <span class="n">glrids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_alrids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_alrids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_alrids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">configid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; FIXME: __name__</span>
<span class="sd">        Get all the relationship ids belonging to the input annotations</span>
<span class="sd">        if lblannot lbltype is specified the relationship ids are filtered to</span>
<span class="sd">        be only of a specific lbltype/category/type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;alr_rowid&#39;</span><span class="p">,),</span> <span class="n">aid_list</span><span class="p">,</span>
                                     <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">aid</span><span class="p">,</span> <span class="n">configid</span><span class="p">)</span> <span class="k">for</span> <span class="n">aid</span> <span class="ow">in</span> <span class="n">aid_list</span><span class="p">)</span>
            <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;annot_rowid=? AND config_rowid=?&#39;</span>
            <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;alr_rowid&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span>
                                           <span class="n">where_clause</span><span class="o">=</span><span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># assert all([x &gt; 0 for x in map(len, alrids_list)]), &#39;annotations must have at least one relationship&#39;</span>
        <span class="k">return</span> <span class="n">alrids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_alrids_oftype"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_alrids_oftype">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_alrids_oftype</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">lbltype_rowid</span><span class="p">,</span> <span class="n">configid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the relationship ids belonging to the input annotations where the</span>
<span class="sd">        relationship ids are filtered to be only of a specific lbltype/category/type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">configid</span><span class="o">=</span><span class="n">configid</span><span class="p">)</span>
        <span class="c"># Get lblannot_rowid of each relationship</span>
        <span class="n">lblannot_rowids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_alr_lblannot_rowids</span><span class="p">,</span> <span class="n">alrids_list</span><span class="p">)</span>
        <span class="c"># Get the type of each lblannot</span>
        <span class="n">lbltype_rowids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_lbltypes_rowids</span><span class="p">,</span> <span class="n">lblannot_rowids_list</span><span class="p">)</span>
        <span class="c"># only want the nids of individuals, not species, for example</span>
        <span class="n">valids_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">typeid</span> <span class="o">==</span> <span class="n">lbltype_rowid</span> <span class="k">for</span> <span class="n">typeid</span> <span class="ow">in</span> <span class="n">rowids</span><span class="p">]</span> <span class="k">for</span> <span class="n">rowids</span> <span class="ow">in</span> <span class="n">lbltype_rowids_list</span><span class="p">]</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">alrids</span><span class="p">,</span> <span class="n">valids</span><span class="p">)</span> <span class="k">for</span> <span class="n">alrids</span><span class="p">,</span> <span class="n">valids</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alrids_list</span><span class="p">,</span> <span class="n">valids_list</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">configid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">resolution_func_first</span><span class="p">(</span><span class="n">alrid_list</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span> <span class="n">alrid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>

            <span class="k">def</span> <span class="nf">resolution_func_lowest_config</span><span class="p">(</span><span class="n">alrid_list</span><span class="p">):</span>
                <span class="n">config_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_alr_config</span><span class="p">(</span><span class="n">alrid_list</span><span class="p">)</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">config_rowid_list</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">)))</span>
                <span class="k">return</span> <span class="p">[</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>

            <span class="n">alrids_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">resolution_func_first</span><span class="p">(</span><span class="n">alrid_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alrid_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span>
                <span class="n">alrid_list</span>
                <span class="k">for</span> <span class="n">alrid_list</span> <span class="ow">in</span> <span class="n">alrids_list</span>
            <span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">alrid_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">alrid_list</span> <span class="ow">in</span> <span class="n">alrids_list</span><span class="p">]),</span>\
            <span class="p">(</span><span class="s">&quot;More than one type per lbltype.  ALRIDS: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alrids_list</span><span class="p">)</span> <span class="o">+</span>
             <span class="s">&quot;, ROW: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lbltype_rowid</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, KEYS:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">alrids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_lblannot_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_lblannot_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_lblannot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the name id of each annotation. &quot;&quot;&quot;</span>
        <span class="c"># Get all the annotation lblannot relationships</span>
        <span class="c"># filter out only the ones which specify names</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">lblannot_rowids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_alr_lblannot_rowids</span><span class="p">,</span> <span class="n">alrids_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_annot_lblannot_rowids_oftype"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_lblannot_rowids_oftype">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_lblannot_rowids_oftype</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the name id of each annotation. &quot;&quot;&quot;</span>
        <span class="c"># Get all the annotation lblannot relationships</span>
        <span class="c"># filter out only the ones which specify names</span>
        <span class="k">assert</span> <span class="n">_lbltype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;should be using lbltype_rowids anyway&#39;</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">])</span>
        <span class="n">lblannot_rowids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_alr_lblannot_rowids</span><span class="p">,</span> <span class="n">alrids_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowids_list</span>
</div>
    <span class="nd">@utool.accepts_numpy</span>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_nids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">distinguish_unknowns</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the name id of each annotation. &quot;&quot;&quot;</span>
        <span class="c"># Get all the annotation lblannot relationships</span>
        <span class="c"># filter out only the ones which specify names</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">])</span>
        <span class="n">lblannot_rowids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_alr_lblannot_rowids</span><span class="p">,</span> <span class="n">alrids_list</span><span class="p">)</span>
        <span class="c"># Get a single nid from the list of lblannot_rowids of type INDIVIDUAL</span>
        <span class="c"># TODO: get index of highest confidence name</span>
        <span class="n">nid_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">lblannot_rowids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lblannot_rowids</span><span class="p">)</span> <span class="k">else</span> <span class="n">ibs</span><span class="o">.</span><span class="n">UNKNOWN_LBLANNOT_ROWID</span> <span class="k">for</span>
                     <span class="n">lblannot_rowids</span> <span class="ow">in</span> <span class="n">lblannot_rowids_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">distinguish_unknowns</span><span class="p">:</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">aid</span> <span class="k">if</span> <span class="n">nid</span> <span class="o">==</span> <span class="n">ibs</span><span class="o">.</span><span class="n">UNKNOWN_LBLANNOT_ROWID</span> <span class="k">else</span> <span class="n">nid</span>
                        <span class="k">for</span> <span class="n">nid</span><span class="p">,</span> <span class="n">aid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nid_list_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">nid_list_</span>
        <span class="k">return</span> <span class="n">nid_list</span>

    <span class="c"># DELTERS</span>
</div>
    <span class="nd">@deleter</span>
    <span class="c">#@cache_invalidator(LBLANNOT_TABLE)</span>
<div class="viewcode-block" id="IBEISController.delete_names"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_names">[docs]</a>    <span class="k">def</span> <span class="nf">delete_names</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes names from the database (CAREFUL. YOU PROBABLY DO NOT WANT</span>
<span class="sd">        TO USE THIS ENSURE THAT NONE OF THE NIDS HAVE ANNOTATION_TABLE) &quot;&quot;&quot;</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_lblannots</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_lblannots"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_lblannots">[docs]</a>    <span class="k">def</span> <span class="nf">delete_lblannots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deletes lblannots from the database &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utool</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ibs] deleting </span><span class="si">%d</span><span class="s"> lblannots&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">lblannot_rowid_list</span><span class="p">))</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_annot_relations_oftype"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annot_relations_oftype">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annot_relations_oftype</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes the relationship between an annotation and a label &quot;&quot;&quot;</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">])</span>
        <span class="n">alrid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">alrids_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_annot_relations"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annot_relations">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annot_relations</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes the relationship between an annotation and a label &quot;&quot;&quot;</span>
        <span class="n">alrids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_alrids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">alrid_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">alrids_list</span><span class="p">)</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">delete_rowids</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="n">alrid_list</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_annot_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annot_nids">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annot_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes nids of a list of annotations &quot;&quot;&quot;</span>
        <span class="c"># FIXME: This should be implicit by setting the anotation name to the</span>
        <span class="c"># unknown name</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_relations_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
</div>
    <span class="nd">@deleter</span>
<div class="viewcode-block" id="IBEISController.delete_annot_speciesids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.delete_annot_speciesids">[docs]</a>    <span class="k">def</span> <span class="nf">delete_annot_speciesids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes nids of a list of annotations &quot;&quot;&quot;</span>
        <span class="c"># FIXME: This should be implicit by setting the anotation name to the</span>
        <span class="c"># unknown species</span>
        <span class="n">ibs</span><span class="o">.</span><span class="n">delete_annot_relations_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">)</span>

    <span class="c"># MORE GETTERS</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_lblannot_value_of_lbltype"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_lblannot_value_of_lbltype">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_lblannot_value_of_lbltype</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">,</span> <span class="n">lblannot_value_getter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            lblannot_value_list (list): a list of strings [&#39;fred&#39;, &#39;sue&#39;, ...] for each chip</span>
<span class="sd">            identifying the animal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lbltype_dict_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_lblannot_rowids_oftype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">)</span>
        <span class="n">DEFAULT_VALUE</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KEY_DEFAULTS</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">]</span>
        <span class="c"># FIXME: Use filters and unflat maps</span>
        <span class="n">lblannot_value_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">lblannot_value_getter</span><span class="p">(</span><span class="n">lblannot_rowids</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lblannot_rowids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">DEFAULT_VALUE</span>
                               <span class="k">for</span> <span class="n">lblannot_rowids</span> <span class="ow">in</span> <span class="n">lbltype_dict_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">lblannot_value_list</span>
</div>
<div class="viewcode-block" id="IBEISController.get_annot_class_labels"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_class_labels">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_class_labels</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list of tuples: identifying animal name and viewpoint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_nids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">view_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">]</span>
        <span class="n">classlabel_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">name_list</span><span class="p">,</span> <span class="n">view_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">classlabel_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_names"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_names</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            name_list (list):</span>
<span class="sd">                a list of strings [&#39;fred&#39;, &#39;sue&#39;, ...] for each annotation</span>
<span class="sd">                identifying the individual</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="n">name_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_lblannot_value_of_lbltype</span><span class="p">(</span>
            <span class="n">aid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_species"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_species">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_species</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            species_list (list): a list of strings [&#39;plains_zebra&#39;,</span>
<span class="sd">            &#39;grevys_zebra&#39;, ...] for each annotation</span>
<span class="sd">            identifying the species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_lblannot_value_of_lbltype</span><span class="p">(</span>
            <span class="n">aid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_species</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">species_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::EG_RELATION_TABLE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_egr_rowid_from_superkey"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_egr_rowid_from_superkey">[docs]</a>    <span class="k">def</span> <span class="nf">get_egr_rowid_from_superkey</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            egrid_list (list):  eg-relate-ids from info constrained to be unique (eid, gid) &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gid_list</span><span class="p">,</span> <span class="n">eid_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;image_rowid=? AND encounter_rowid=?&#39;</span>
        <span class="n">egrid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">EG_RELATION_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">egrid_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::LBLTYPE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lbltype_rowid_from_text"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lbltype_rowid_from_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_lbltype_rowid_from_text</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">text_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            lbltype_rowid (list): lbltype_rowid where the lbltype_text is given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># FIXME: MAKE SQL-METHOD FOR NON-ROWID GETTERS</span>
        <span class="c"># FIXME: Use unique SUPERKEYS instead of specifying id_colname</span>
        <span class="n">lbltype_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLTYPE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lbltype_rowid&#39;</span><span class="p">,),</span> <span class="n">text_list</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="s">&#39;lbltype_text&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbltype_rowid</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lbltype_default"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lbltype_default">[docs]</a>    <span class="k">def</span> <span class="nf">get_lbltype_default</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">):</span>
        <span class="n">lbltype_default_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLTYPE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lbltype_default&#39;</span><span class="p">,),</span> <span class="n">lbltype_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbltype_default_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lbltype_text"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lbltype_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_lbltype_text</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">):</span>
        <span class="n">lbltype_text_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLTYPE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lbltype_text&#39;</span><span class="p">,),</span> <span class="n">lbltype_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbltype_text_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::LBLIMAGE_TABLE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_rowid_from_superkey"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_rowid_from_superkey">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_rowid_from_superkey</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  lblimage_rowid_list from the superkey (lbltype, value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lblimage_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;lbltype_rowid=? AND lblimage_value=?&#39;</span>
        <span class="n">lblimage_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimage_rowid_list</span>
</div>
    <span class="n">get_lblimage_rowid_from_typevaltup</span> <span class="o">=</span> <span class="n">get_lblimage_rowid_from_superkey</span>

    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_rowid_from_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_rowid_from_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_rowid_from_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblimage_uuid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  lblimage_rowid_list from the superkey (lbltype, value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lblimage_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="n">lblimage_uuid_list</span>
        <span class="n">id_colname</span> <span class="o">=</span> <span class="s">&#39;lblimage_uuid&#39;</span>
        <span class="n">lblimage_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="n">id_colname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimage_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_uuids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_uuids">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_uuids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">):</span>
        <span class="n">lblimageuuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblimage_uuid&#39;</span><span class="p">,),</span> <span class="n">lblimage_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimageuuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_lbltypes_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_lbltypes_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_lbltypes_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">):</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lbltype_rowid&#39;</span><span class="p">,),</span> <span class="n">lblimage_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbltype_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_notes">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">):</span>
        <span class="n">lblimagenotes_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblimage_note&#39;</span><span class="p">,),</span> <span class="n">lblimage_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimagenotes_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_values"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_values</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): text lblimages &quot;&quot;&quot;</span>
        <span class="c">#TODO: Remove keyword argument</span>
        <span class="c">#ibsfuncs.assert_lblimage_rowids_are_type(ibs, lblimage_rowid_list,  ibs.lbltype_ids[_lbltype])</span>
        <span class="n">lblimage_value_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLIMAGE_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblimage_value&#39;</span><span class="p">,),</span> <span class="n">lblimage_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblimage_value_list</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.get_lblimage_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblimage_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblimage_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblimage_rowid_list</span><span class="p">):</span>
        <span class="c">#verbose = len(lblimage_rowid_list) &gt; 20</span>
        <span class="c"># TODO: Optimize IF POSSIBLE</span>
        <span class="c"># FIXME: SLOW</span>
        <span class="c">#if verbose:</span>
        <span class="c">#    print(utool.get_caller_name(N=list(range(0, 20))))</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;lblimage_rowid=?&#39;</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lblimage_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">lblimage_rowid</span> <span class="ow">in</span> <span class="n">lblimage_rowid_list</span><span class="p">]</span>
        <span class="n">gids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">GL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;image_rowid&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span>
                                     <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gids_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::LBLANNOT_TABLE</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_rowid_from_superkey"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_rowid_from_superkey">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_rowid_from_superkey</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  lblannot_rowid_list from the superkey (lbltype, value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lblannot_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">)</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;lbltype_rowid=? AND lblannot_value=?&#39;</span>
        <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_rowid_from_uuid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_rowid_from_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_rowid_from_uuid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_uuid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        UNSAFE</span>

<span class="sd">        Returns:</span>
<span class="sd">            lblannot_rowid_list from the superkey (lbltype, value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;CALL TO get_lblannot_rowid_from_uuid IS UNSAFE.  USE get_lblannot_rowid_from_superkey&quot;</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lblannot_rowid&#39;</span><span class="p">,)</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="n">lblannot_uuid_list</span>
        <span class="n">id_colname</span> <span class="o">=</span> <span class="s">&#39;lblannot_uuid&#39;</span>
        <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">params_iter</span><span class="p">,</span> <span class="n">id_colname</span><span class="o">=</span><span class="n">id_colname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_uuids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_uuids">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_uuids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">):</span>
        <span class="n">lblannotuuid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblannot_uuid&#39;</span><span class="p">,),</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannotuuid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_lbltypes_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_lbltypes_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_lbltypes_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">):</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lbltype_rowid&#39;</span><span class="p">,),</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbltype_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_notes">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">):</span>
        <span class="n">lblannotnotes_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblannot_note&#39;</span><span class="p">,),</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannotnotes_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_values"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_values</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            text lblannots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#TODO: Remove keyword argument</span>
        <span class="c">#ibsfuncs.assert_lblannot_rowids_are_type(ibs, lblannot_rowid_list,  ibs.lbltype_ids[_lbltype])</span>
        <span class="n">lblannot_value_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LBLANNOT_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;lblannot_value&#39;</span><span class="p">,),</span> <span class="n">lblannot_rowid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_value_list</span>
</div>
    <span class="nd">@default_decorator</span>
<div class="viewcode-block" id="IBEISController.get_lblannot_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_lblannot_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_lblannot_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">lblannot_rowid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get annotation rowids of labels. There may be more than one annotation</span>
<span class="sd">        per label.</span>

<span class="sd">        Args:</span>
<span class="sd">            lblannot_rowid_list (list): of lblannot (labels of annotations) rowids</span>

<span class="sd">        Returns:</span>
<span class="sd">            aids_list (list): of lists annotation rowids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#verbose = len(lblannot_rowid_list) &gt; 20</span>
        <span class="c"># TODO: Optimize IF POSSIBLE</span>
        <span class="c"># FIXME: SLOW</span>
        <span class="c">#if verbose:</span>
        <span class="c">#    print(utool.get_caller_name(N=list(range(0, 20))))</span>
        <span class="n">where_clause</span> <span class="o">=</span> <span class="s">&#39;lblannot_rowid=?&#39;</span>
        <span class="n">params_iter</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lblannot_rowid</span><span class="p">,)</span> <span class="k">for</span> <span class="n">lblannot_rowid</span> <span class="ow">in</span> <span class="n">lblannot_rowid_list</span><span class="p">]</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_where</span><span class="p">(</span><span class="n">AL_RELATION_TABLE</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;annot_rowid&#39;</span><span class="p">,),</span> <span class="n">params_iter</span><span class="p">,</span>
                                     <span class="n">where_clause</span><span class="p">,</span> <span class="n">unpack_scalars</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aids_list</span>

    <span class="c">#</span>
    <span class="c"># GETTERS::LBLANNOTS_SUBSET</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_species"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_species">[docs]</a>    <span class="k">def</span> <span class="nf">get_species</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">speciesid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            species_list (list of text): text names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_values</span><span class="p">(</span><span class="n">speciesid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">species_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_name_nids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_nids">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_nids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">name_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            nid_list (list): Creates one if it doesnt exist &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_names</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nid_list</span>
        <span class="n">lbltype_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">]</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">lbltype_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
        <span class="n">nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_rowid_from_superkey</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">name_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_species_lblannot_rowid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_species_lblannot_rowid">[docs]</a>    <span class="k">def</span> <span class="nf">get_species_lblannot_rowid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">species_list</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_species_lblannot_rowid</span>

<span class="sd">        Returns:</span>
<span class="sd">            species_rowid_list (list): Creates one if it doesnt exist</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.control.IBEISControl import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import ibeis</span>
<span class="sd">            &gt;&gt;&gt; import utool</span>
<span class="sd">            &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; species_list = [u&#39;jaguar&#39;, u&#39;zebra_plains&#39;,</span>
<span class="sd">            ...                 u&#39;zebra_plains&#39;,&#39;____&#39;, u&#39;zebra_grevys&#39;,</span>
<span class="sd">            ...                 &#39;____&#39;, u&#39;zebra_grevys&#39;,</span>
<span class="sd">            ...                 u&#39;bear_polar&#39;, u&#39;bear_polar&#39;, &#39;TYPO&#39;, &#39;____&#39;]</span>
<span class="sd">            &gt;&gt;&gt; ensure = False</span>
<span class="sd">            &gt;&gt;&gt; species_rowid_list = ibs.get_species_lblannot_rowid(species_list, ensure)</span>
<span class="sd">            &gt;&gt;&gt; print(utool.list_str(list(zip(species_list, species_rowid_list))))</span>
<span class="sd">            &gt;&gt;&gt; ensure = True</span>
<span class="sd">            &gt;&gt;&gt; species_rowid_list = ibs.get_species_lblannot_rowid(species_list, ensure)</span>
<span class="sd">            &gt;&gt;&gt; print(utool.list_str(list(zip(species_list, species_rowid_list))))</span>
<span class="sd">            &gt;&gt;&gt; ibs.print_lblannot_table()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_species</span><span class="p">(</span><span class="n">species_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbltype_rowid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">SPECIES_KEY</span><span class="p">]</span>
            <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">lbltype_rowid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">)</span>
            <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_rowid_from_superkey</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">species_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowid_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_name_text"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_text</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): text names &quot;&quot;&quot;</span>
        <span class="c"># TODO:</span>
        <span class="c"># Change the temporary negative indexes back to the unknown NID for the</span>
        <span class="c"># SQL query. Then augment the lblannot list to distinguish unknown lblannots</span>
        <span class="n">name_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_values</span><span class="p">(</span><span class="n">nid_list</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_name_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">,</span> <span class="n">enable_unknown_fix</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            aids_list (list):  a list of list of aids in each name</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; from ibeis.control.IBEISControl import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; import ibeis</span>
<span class="sd">            &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; # Map annotations to name ids</span>
<span class="sd">            &gt;&gt;&gt; aid_list = ibs.get_valid_aids()</span>
<span class="sd">            &gt;&gt;&gt; nid_list = ibs.get_annot_nids(aid_list)</span>
<span class="sd">            &gt;&gt;&gt; # Get annotation ids for each name</span>
<span class="sd">            &gt;&gt;&gt; aids_list = ibs.get_name_aids(nid_list)</span>
<span class="sd">            &gt;&gt;&gt; # Run Assertion Test</span>
<span class="sd">            &gt;&gt;&gt; groupid2_items = ut.group_items(aids_list, nid_list)</span>
<span class="sd">            &gt;&gt;&gt; grouped_items = list(six.itervalues(groupid2_items))</span>
<span class="sd">            &gt;&gt;&gt; passed_iter = map(ut.list_allsame, grouped_items)</span>
<span class="sd">            &gt;&gt;&gt; passed_list = list(passed_iter)</span>
<span class="sd">            &gt;&gt;&gt; assert all(passed_list), &#39;problem in get_name_aids&#39;</span>
<span class="sd">            &gt;&gt;&gt; # Print gropued items</span>
<span class="sd">            &gt;&gt;&gt; print(ut.dict_str(groupid2_items, newlines=False))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: Optimize</span>
        <span class="n">nid_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">UNKNOWN_LBLANNOT_ROWID</span> <span class="k">if</span> <span class="n">nid</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">nid</span> <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">nid_list</span><span class="p">]</span>
        <span class="c">#ibsfuncs.assert_lblannot_rowids_are_type(ibs, nid_list_, ibs.lbltype_ids[constants.INDIVIDUAL_KEY])</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_aids</span><span class="p">(</span><span class="n">nid_list_</span><span class="p">)</span>
        <span class="c"># TODO: QUESTION: Should negative nids return the empty list</span>
        <span class="c"># when asked for their member aids? Because we know that it should be</span>
        <span class="c"># the negated nid and have 1 member. Here is code to fix it if we should</span>
        <span class="k">if</span> <span class="n">enable_unknown_fix</span><span class="p">:</span>
            <span class="n">aids_list</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="n">nid</span><span class="p">]</span> <span class="k">if</span> <span class="n">nid</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">aids</span> <span class="k">for</span> <span class="n">nid</span><span class="p">,</span> <span class="n">aids</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nid_list</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">aids_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_name_exemplar_aids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_exemplar_aids">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_exemplar_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  a list of list of cids in each name &quot;&quot;&quot;</span>
        <span class="n">nid_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">UNKNOWN_LBLANNOT_ROWID</span> <span class="k">if</span> <span class="n">nid</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">nid</span> <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">nid_list</span><span class="p">]</span>
        <span class="c">#ibsfuncs.assert_lblannot_rowids_are_type(ibs, nid_list_, ibs.lbltype_ids[constants.INDIVIDUAL_KEY])</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_aids</span><span class="p">(</span><span class="n">nid_list_</span><span class="p">)</span>
        <span class="n">flags_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_exemplar_flag</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="n">exemplar_aids_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">utool</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">aids</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span> <span class="k">for</span> <span class="n">aids</span><span class="p">,</span> <span class="n">flags</span> <span class="ow">in</span>
                              <span class="nb">zip</span><span class="p">(</span><span class="n">aids_list</span><span class="p">,</span> <span class="n">flags_list</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">exemplar_aids_list</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_name_num_annotations"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_num_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_num_annotations</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  the number of annotations for each name &quot;&quot;&quot;</span>
        <span class="c"># TODO: Optimize</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)))</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_name_num_exemplar_annotations"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_num_exemplar_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_num_exemplar_annotations</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list):  the number of annotations, which are exemplars for each name &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_exemplar_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)))</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_name_notes"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_notes">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_notes</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): name notes &quot;&quot;&quot;</span>
        <span class="n">notes_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_notes</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">notes_list</span>
</div>
    <span class="nd">@getter_1toM</span>
<div class="viewcode-block" id="IBEISController.get_name_gids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_name_gids">[docs]</a>    <span class="k">def</span> <span class="nf">get_name_gids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">nid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): the image ids associated with name ids&quot;&quot;&quot;</span>
        <span class="c"># TODO: Optimize</span>
        <span class="n">aids_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_name_aids</span><span class="p">(</span><span class="n">nid_list</span><span class="p">)</span>
        <span class="n">gids_list</span> <span class="o">=</span> <span class="n">ibsfuncs</span><span class="o">.</span><span class="n">unflat_map</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_gids</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gids_list</span>

    <span class="c">## NEW</span>
</div>
    <span class="nd">@getter_1to1</span>
<div class="viewcode-block" id="IBEISController.get_annot_meta_lblannot_rowids"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_meta_lblannot_rowids">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_meta_lblannot_rowids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; ugg &quot;&quot;&quot;</span>
        <span class="c">#get_lblannot_values</span>
        <span class="n">getter</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_lblannot_values</span><span class="p">,</span> <span class="n">_lbltype</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">INDIVIDUAL_KEY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_lblannot_value_of_lbltype</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">,</span> <span class="n">getter</span><span class="p">)</span>
</div>
    <span class="nd">@adder</span>
<div class="viewcode-block" id="IBEISController.add_meta_lblannots"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.add_meta_lblannots">[docs]</a>    <span class="k">def</span> <span class="nf">add_meta_lblannots</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">note_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">_lbltype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; docstr &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_lbltype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;bad lbltype&#39;</span>
        <span class="n">lbltype_rowid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ibs</span><span class="o">.</span><span class="n">lbltype_ids</span><span class="p">[</span><span class="n">_lbltype</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
        <span class="n">lblannot_rowid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">add_lblannots</span><span class="p">(</span><span class="n">lbltype_rowid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">note_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lblannot_rowid_list</span>
</div>
    <span class="nd">@setter</span>
<div class="viewcode-block" id="IBEISController.set_annot_meta_lblannot_values"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.set_annot_meta_lblannot_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_annot_meta_lblannot_values</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; docstr &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ibs</span><span class="o">.</span><span class="n">set_annot_lblannot_from_value</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">_lbltype</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IBEISController.get_annot_rowid_hashid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_rowid_hashid">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_rowid_hashid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;_AIDS&#39;</span><span class="p">):</span>
        <span class="n">aids_hashid</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">hashstr_arr</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aids_hashid</span>
</div>
<div class="viewcode-block" id="IBEISController.get_annot_uuid_hashid"><a class="viewcode-back" href="../../../ibeis.control.html#ibeis.control.IBEISControl.IBEISController.get_annot_uuid_hashid">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot_uuid_hashid</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;_UUIDS&#39;</span><span class="p">):</span>
        <span class="n">uuid_list</span>    <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_uuids</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
        <span class="n">uuui_hashid</span>  <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">hashstr_arr</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uuui_hashid</span>
</div></div>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">To Regenerate Templated Funcs:</span>

<span class="sd">python ibeis/control/templates.py</span>
<span class="sd">python ibeis/control/templates.py --dump-autogen-controller</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c"># Import modules which define injectable functions</span>
<span class="c"># Older manual ibeiscontrol functions</span>
<span class="kn">from</span> <span class="nn">ibeis</span> <span class="kn">import</span> <span class="n">ibsfuncs</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">_autogen_ibeiscontrol_funcs</span>  <span class="c"># NOQA</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;cannot import autogen funcs&#39;</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">raise</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--notstrict&#39;</span><span class="p">):</span>
        <span class="k">raise</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ibeis.control</span> <span class="kn">import</span> <span class="n">manual_ibeiscontrol_funcs</span>  <span class="c"># NOQA</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;cannot import manual funcs&#39;</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">raise</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../ibeis.html" >ibeis</a> &raquo;</li>
          <li><a href="../control.html" >ibeis.control</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jon Crall.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>