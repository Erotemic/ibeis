

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibeis.templates.template_definitions &mdash; ibeis 1.4.4 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ibeis 1.4.4 documentation" href="../../../index.html"/>
        <link rel="up" title="ibeis.templates" href="../templates.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="fa fa-home"> ibeis</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ibeis.html">ibeis package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.__main__">ibeis.__main__ module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.all_imports">ibeis.all_imports module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.constants">ibeis.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.ibsfuncs">ibeis.ibsfuncs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.main_module">ibeis.main_module module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.params">ibeis.params module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis.species">ibeis.species module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibeis.html#module-ibeis">Module contents</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ibeis</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../ibeis.html">ibeis</a> &raquo;</li>
      
          <li><a href="../templates.html">ibeis.templates</a> &raquo;</li>
      
    <li>ibeis.templates.template_definitions</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for ibeis.templates.template_definitions</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TODO:</span>
<span class="sd">    I&#39;ve decided that I dont like the plural function names.</span>
<span class="sd">    We will move to singular function names.</span>

<span class="sd">CommandLine:</span>
<span class="sd">    # Regenerate command</span>
<span class="sd">    python -m ibeis.templates.template_generator</span>
<span class="sd">    python ibeis/templates/template_generator.py --dump-autogen-controller</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- HEADER ---</span>
<span class="c">#-----------------</span>


<span class="n">Theader_ibeiscontrol</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # -*- coding: utf-8 -*-</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    Autogenerated IBEISController functions</span>

<span class="sd">    TemplateInfo:</span>
<span class="sd">        autogen_time = {timestamp}</span>
<span class="sd">        autogen_key = {autogen_key}</span>

<span class="sd">    ToRegenerate:</span>
<span class="sd">        # REM python -m ibeis.templates.template_generator --key {autogen_key}</span>
<span class="sd">        # REM python -m ibeis.templates.template_generator --key {autogen_key} --write</span>
<span class="sd">        python -m ibeis.templates.template_generator {argv_tail_str1}</span>
<span class="sd">        python -m ibeis.templates.template_generator {argv_tail_str2}</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    from __future__ import absolute_import, division, print_function</span>
<span class="sd">    import functools  # NOQA</span>
<span class="sd">    import six  # NOQA</span>
<span class="sd">    from six.moves import map, range, zip  # NOQA</span>
<span class="sd">    from ibeis import constants as const</span>
<span class="sd">    # REM dont circular import</span>
<span class="sd">    # REM from ibeis.control.IBEISControl import IBEISController</span>
<span class="sd">    import utool as ut</span>
<span class="sd">    from ibeis.control import controller_inject</span>
<span class="sd">    from ibeis.control import accessor_decors  # NOQA</span>
<span class="sd">    print, print_, printDBG, rrr, profile = ut.inject(__name__, &#39;[autogen_{autogen_key}]&#39;)</span>

<span class="sd">    # Create dectorator to inject functions in this module into the IBEISController</span>
<span class="sd">    CLASS_INJECT_KEY, register_ibs_method = controller_inject.make_ibs_register_decorator(__name__)</span>


<span class="sd">    register_api   = controller_inject.get_ibeis_flask_api(__name__)</span>
<span class="sd">    register_route = controller_inject.get_ibeis_flask_route(__name__)</span>


<span class="sd">    # REM def get_autogen_testdata():</span>
<span class="sd">    def testdata_ibs(defaultdb=&#39;testdb1&#39;):</span>
<span class="sd">        import ibeis</span>
<span class="sd">        ibs = ibeis.opendb(defaultdb=defaultdb)</span>
<span class="sd">        config2_ = None  # qreq_.qparams</span>
<span class="sd">        return ibs, config2_</span>

<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- ADDERS ---</span>
<span class="c">#-----------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CommandLine:</span>
<span class="sd">    python -c &quot;import utool as ut; ut.write_modscript_alias(&#39;Tgen.sh&#39;, &#39;ibeis.templates.template_generator&#39;)&quot;</span>
<span class="sd">    sh Tgen.sh --key chip --Tcfg with_setters=False with_getters=False  with_adders=True</span>
<span class="sd">    sh Tgen.sh --key feat --Tcfg with_setters=False with_getters=False  with_adders=True</span>
<span class="sd">    sh Tgen.sh --key featweight --Tcfg with_setters=False with_getters=False  with_adders=True</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">Tadder_pl_dependant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @adder</span>
<span class="sd">    def add_{parent}_{leaf}({self}, {parent}_rowid_list, config2_=None, verbose=not ut.QUIET, return_num_dirty=False):</span>
<span class="sd">        &quot;&quot;&quot; {parent}.{leaf}.add({parent}_rowid_list)</span>

<span class="sd">        CRITICAL FUNCTION MUST EXIST FOR ALL DEPENDANTS</span>
<span class="sd">        Adds / ensures / computes a dependant property</span>

<span class="sd">        Args:</span>
<span class="sd">             {parent}_rowid_list</span>

<span class="sd">        Returns:</span>
<span class="sd">            returns {leaf}_rowid_list of added (or already existing {leaf}s)</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tadder_pl_dependant</span>
<span class="sd">            parent = {parent}</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Example0:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            # REM &gt;&gt;&gt; {root}_rowid_list = {self}._get_all_{root}_rowids()[:2]</span>
<span class="sd">            # REM HACK</span>
<span class="sd">            &gt;&gt;&gt; from ibeis import constants as const</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}.get_valid_{root}_rowids(species=const.Species.ZEB_PLAIN)[:2]</span>
<span class="sd">            &gt;&gt;&gt; if &#39;{root}&#39; != &#39;{parent}&#39;:</span>
<span class="sd">            ...     {parent}_rowid_list = {self}.get_{root}_{parent}_rowid({root}_rowid_list, config2_=config2_, ensure=True)</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = {self}.add_{parent}_{leaf}({parent}_rowid_list, config2_=config2_)</span>
<span class="sd">            &gt;&gt;&gt; assert len({leaf}_rowid_list) == len({parent}_rowid_list)</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_all_not_None({leaf}_rowid_list)</span>

<span class="sd">        Example1:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs(&#39;PZ_MTEST&#39;)</span>
<span class="sd">            &gt;&gt;&gt; from ibeis import constants as const</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}.get_valid_{root}_rowids(species=const.Species.ZEB_PLAIN)[0:7]</span>
<span class="sd">            &gt;&gt;&gt; if &#39;{root}&#39; != &#39;{parent}&#39;:</span>
<span class="sd">            ...     {parent}_rowid_list = {self}.get_{root}_{parent}_rowid({root}_rowid_list, config2_=config2_, ensure=True)</span>
<span class="sd">            &gt;&gt;&gt; sub_{parent}_rowid_list1 = {parent}_rowid_list[0:6]</span>
<span class="sd">            &gt;&gt;&gt; sub_{parent}_rowid_list2 = {parent}_rowid_list[5:7]</span>
<span class="sd">            &gt;&gt;&gt; sub_{parent}_rowid_list3 = {parent}_rowid_list[0:7]</span>
<span class="sd">            &gt;&gt;&gt; sub_{leaf}_rowid_list1 = {self}.get_{parent}_{leaf}_rowid(sub_{parent}_rowid_list1, config2_=config2_, ensure=True)</span>
<span class="sd">            &gt;&gt;&gt; {self}.get_{parent}_{leaf}_rowid(sub_{parent}_rowid_list1, config2_=config2_, ensure=True)</span>
<span class="sd">            &gt;&gt;&gt; sub_{leaf}_rowid_list1, num_dirty0 = {self}.add_{parent}_{leaf}(sub_{parent}_rowid_list1, config2_=config2_, return_num_dirty=True)</span>
<span class="sd">            &gt;&gt;&gt; assert num_dirty0 == 0</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_all_not_None(sub_{leaf}_rowid_list1)</span>
<span class="sd">            &gt;&gt;&gt; {self}.delete_{parent}_{leaf}(sub_{parent}_rowid_list2)</span>
<span class="sd">            &gt;&gt;&gt; #{self}.delete_{parent}_{leaf}(sub_{parent}_rowid_list2)?</span>
<span class="sd">            &gt;&gt;&gt; sub_{leaf}_rowid_list3 = {self}.get_{parent}_{leaf}_rowid(sub_{parent}_rowid_list3, config2_=config2_, ensure=False)</span>
<span class="sd">            &gt;&gt;&gt; # Only the last two should be None</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_all_not_None(sub_{leaf}_rowid_list3[0:5], &#39;sub_{leaf}_rowid_list3[0:5])&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_eq(sub_{leaf}_rowid_list3[5:7], [None, None])</span>
<span class="sd">            &gt;&gt;&gt; sub_{leaf}_rowid_list3_ensured, num_dirty1 = {self}.add_{parent}_{leaf}(sub_{parent}_rowid_list3, config2_=config2_,  return_num_dirty=True)</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_eq(num_dirty1, 2, &#39;Only two params should have been computed here&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_all_not_None(sub_{leaf}_rowid_list3_ensured)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        #REM raise NotImplementedError(&#39;this code is a stub, you must populate it&#39;)</span>
<span class="sd">        from ibeis.model.preproc import preproc_{leaf}</span>
<span class="sd">        ut.assert_all_not_None({parent}_rowid_list, &#39; {parent}_rowid_list&#39;)</span>
<span class="sd">        # Get requested configuration id</span>
<span class="sd">        config_rowid = {self}.get_{leaf}_config_rowid(config2_=config2_)</span>
<span class="sd">        # Find leaf rowids that need to be computed</span>
<span class="sd">        initial_{leaf}_rowid_list = get_{parent}_{leaf}_rowids_({self}, {parent}_rowid_list, config2_=config2_)</span>
<span class="sd">        # Get corresponding &quot;dirty&quot; parent rowids</span>
<span class="sd">        isdirty_list = ut.flag_None_items(initial_{leaf}_rowid_list)</span>
<span class="sd">        dirty_{parent}_rowid_list = ut.filter_items({parent}_rowid_list, isdirty_list)</span>
<span class="sd">        num_dirty = len(dirty_{parent}_rowid_list)</span>
<span class="sd">        num_total = len({parent}_rowid_list)</span>
<span class="sd">        if num_dirty &gt; 0:</span>
<span class="sd">            if verbose:</span>
<span class="sd">                fmtstr = &#39;[add_{parent}_{leaf}s] adding %d / %d new {leaf} for config_rowid=%r&#39;</span>
<span class="sd">                print(fmtstr % (num_dirty, num_total, config_rowid))</span>
<span class="sd">            # Dependant columns do not need true from_superkey getters.</span>
<span class="sd">            # We can use the Tgetter_pl_dependant_rowids_ instead</span>
<span class="sd">            get_rowid_from_superkey = functools.partial({self}.get_{parent}_{leaf}_rowids_, config2_=config2_)</span>
<span class="sd">            # REM proptup_gen = preproc_{leaf}.add_{leaf}_params_gen({self}, {parent}_rowid_list)</span>
<span class="sd">            proptup_gen = preproc_{leaf}.generate_{leaf}_properties({self}, dirty_{parent}_rowid_list, config2_=config2_)</span>
<span class="sd">            dirty_params_iter = (</span>
<span class="sd">                ({parent}_rowid, config_rowid, {leaf_other_propnames})</span>
<span class="sd">                for {parent}_rowid, ({leaf_other_propnames},) in</span>
<span class="sd">                zip(dirty_{parent}_rowid_list, proptup_gen)</span>
<span class="sd">            )</span>
<span class="sd">            colnames = {nonprimary_leaf_colnames}</span>
<span class="sd">            #{leaf}_rowid_list = {self}.{dbself}.add_cleanly({LEAF_TABLE}, colnames, dirty_params_iter, get_rowid_from_superkey)</span>
<span class="sd">            {self}.{dbself}._add({LEAF_TABLE}, colnames, dirty_params_iter)</span>
<span class="sd">            # Now that the dirty params are added get the correct order of rowids</span>
<span class="sd">            {leaf}_rowid_list = get_rowid_from_superkey({parent}_rowid_list)</span>
<span class="sd">        else:</span>
<span class="sd">            {leaf}_rowid_list = initial_{leaf}_rowid_list</span>
<span class="sd">        if return_num_dirty:</span>
<span class="sd">            return {leaf}_rowid_list, num_dirty</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="n">Tadder_native</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @adder</span>
<span class="sd">    def add_{tbl}({self}, {allcol_sig}):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            returns {tbl}_rowid_list of added (or already existing {tbl}s)</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tadder_native</span>
<span class="sd">            tbl = {tbl}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # WORK IN PROGRESS</span>
<span class="sd">        colnames = ({allCOLNAMES},)</span>
<span class="sd">        {null_checks}</span>
<span class="sd">        params_iter = (</span>
<span class="sd">            ({allcol_items},)</span>
<span class="sd">            for ({allcol_items},) in</span>
<span class="sd">            zip({allcol_args})</span>
<span class="sd">        )</span>
<span class="sd">        get_rowid_from_superkey = {self}.get_{tbl}_rowid_from_superkey</span>
<span class="sd">        # FIXME: encode superkey paramx</span>
<span class="sd">        superkey_paramx = (0, 1)</span>
<span class="sd">        {tbl}_rowid_list = {self}.{dbself}.add_cleanly({TABLE}, colnames, params_iter, get_rowid_from_superkey, superkey_paramx)</span>
<span class="sd">        return {tbl}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="n">Tadder_rl_dependant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @adder</span>
<span class="sd">    def add_{root}_{leaf}({self}, {root}_rowid_list, config2_=None):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_rowid_list &lt;- {root}.{leaf}.ensure({root}_rowid_list)</span>

<span class="sd">        Adds / ensures / computes a dependant property (convinience)</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list</span>

<span class="sd">        Returns:</span>
<span class="sd">            {leaf}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tadder_rl_dependant</span>
<span class="sd">            root = {root}</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}._get_all_{root}_rowids()[:2]</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = {self}.add_{root}_{leaf}({root}_rowid_list, config2_=config2_)</span>
<span class="sd">            &gt;&gt;&gt; assert len({leaf}_rowid_list) == len({root}_rowid_list)</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_all_not_None({leaf}_rowid_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {leaf_parent}_rowid_list = {self}.get_{root}_{leaf_parent}_rowid({root}_rowid_list, config2_=config2_, ensure=True)</span>
<span class="sd">        {leaf}_rowid_list = add_{leaf_parent}_{leaf}({self}, {leaf_parent}_rowid_list, config2_=config2_)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- CONFIG ---</span>
<span class="c">#-----------------</span>

<span class="n">Tcfg_rowid_getter</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @ider</span>
<span class="sd">    def get_{leaf}_config_rowid({self}, config2_=None):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_cfg_rowid = {leaf}.config_rowid()</span>

<span class="sd">        returns config_rowid of the current configuration</span>
<span class="sd">        Config rowids are always ensured</span>

<span class="sd">        Returns:</span>
<span class="sd">            {leaf}_cfg_rowid</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tcfg_rowid_getter</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_cfg_rowid = {self}.get_{leaf}_config_rowid()</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if config2_ is not None:</span>
<span class="sd">            #{leaf}_cfg_suffix = config2_.qparams.{leaf}_cfgstr</span>
<span class="sd">            {leaf}_cfg_suffix = config2_.get(&#39;{leaf}_cfgstr&#39;)</span>
<span class="sd">            assert {leaf}_cfg_suffix is not None</span>
<span class="sd">            # TODO store config_rowid in qparams</span>
<span class="sd">        else:</span>
<span class="sd">            {leaf}_cfg_suffix = {self}.cfg.{leaf}_cfg.get_cfgstr()</span>
<span class="sd">        {leaf}_cfg_rowid = {self}.add_config({leaf}_cfg_suffix)</span>
<span class="sd">        return {leaf}_cfg_rowid</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- DELETERS ---</span>
<span class="c">#-----------------</span>

<span class="c"># DELETER LINES</span>
<span class="n">Tline_pc_dependant_delete</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    _{child}_rowid_list = get_{parent}_{child}_rowids_({self}, {parent}_rowid_list, config2_=config2_)</span>
<span class="sd">    {child}_rowid_list = ut.filter_Nones(_{child}_rowid_list)</span>
<span class="sd">    {self}.delete_{child}({child}_rowid_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c"># DELETER RL_DEPEND</span>
<span class="c">#{pc_dependant_delete_lines}</span>
<span class="n">Tdeleter_rl_depenant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @deleter</span>
<span class="sd">    # REM @cache_invalidator({ROOT_TABLE})</span>
<span class="sd">    def delete_{root}_{leaf}({self}, {root}_rowid_list, config2_=None):</span>
<span class="sd">        &quot;&quot;&quot; {root}.{leaf}.delete({root}_rowid_list)</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tdeleter_rl_depenant</span>
<span class="sd">            root = {root}</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}._get_all_{root}_rowids()[:1]</span>
<span class="sd">            &gt;&gt;&gt; # Ensure there are  some leafs to delete</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = ibs.get_{root}_{leaf}_rowid({root}_rowid_list, config2_=config2_, ensure=True)</span>
<span class="sd">            &gt;&gt;&gt; num_deleted1 = {self}.delete_{root}_{leaf}({root}_rowid_list, config2_=config2_)</span>
<span class="sd">            &gt;&gt;&gt; num_deleted2 = {self}.delete_{root}_{leaf}({root}_rowid_list, config2_=config2_)</span>
<span class="sd">            &gt;&gt;&gt; # The first delete should remove everything</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_eq(num_deleted1, len({leaf}_rowid_list))</span>
<span class="sd">            &gt;&gt;&gt; # The second delete should have removed nothing</span>
<span class="sd">            &gt;&gt;&gt; ut.assert_eq(num_deleted2, 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if ut.VERBOSE:</span>
<span class="sd">            print(&#39;[{self}] deleting %d {root}s leaf nodes&#39; % len({root}_rowid_list))</span>
<span class="sd">        # Delete any dependants</span>
<span class="sd">        _{leaf}_rowid_list = {self}.get_{root}_{leaf}_rowid({root}_rowid_list, config2_=config2_, ensure=False)</span>
<span class="sd">        {leaf}_rowid_list = ut.filter_Nones(_{leaf}_rowid_list)</span>
<span class="sd">        num_deleted = {self}.delete_{leaf}({leaf}_rowid_list)</span>
<span class="sd">        return num_deleted</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c"># DELETER RL_DEPEND</span>
<span class="c">#pluralize?</span>
<span class="c">#{pc_dependant_delete_lines}</span>
<span class="n">Tdeleter_pl_depenant</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @deleter</span>
<span class="sd">    # REM @cache_invalidator({ROOT_TABLE})</span>
<span class="sd">    def delete_{parent}_{leaf}({self}, {parent}_rowid_list, config2_=None):</span>
<span class="sd">        &quot;&quot;&quot; {parent}.{leaf}.delete({parent}_rowid_list)</span>

<span class="sd">        Args:</span>
<span class="sd">            {parent}_rowid_list</span>

<span class="sd">        Returns:</span>
<span class="sd">             int: num_deleted</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tdeleter_rl_depenant</span>
<span class="sd">            parent = {parent}</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {parent}_rowid_list = {self}._get_all_{parent}_rowids()[:2]</span>
<span class="sd">            &gt;&gt;&gt; {self}.delete_{parent}_{leaf}({parent}_rowid_list, config2_=config2_)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if ut.VERBOSE:</span>
<span class="sd">            print(&#39;[{self}] deleting %d {parent}s leaf nodes&#39; % len({parent}_rowid_list))</span>
<span class="sd">        # Delete any dependants</span>
<span class="sd">        _{leaf}_rowid_list = {self}.get_{parent}_{leaf}_rowid({parent}_rowid_list, config2_=config2_, ensure=False)</span>
<span class="sd">        {leaf}_rowid_list = ut.filter_Nones(_{leaf}_rowid_list)</span>
<span class="sd">        num_deleted = {self}.delete_{leaf}({leaf}_rowid_list)</span>
<span class="sd">        return num_deleted</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c"># DELETER NATIVE</span>
<span class="n">Tdeleter_native_tbl</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @deleter</span>
<span class="sd">    # REM @cache_invalidator({TABLE})</span>
<span class="sd">    def delete_{tbl}({self}, {tbl}_rowid_list, config2_=None):</span>
<span class="sd">        &quot;&quot;&quot; {tbl}.delete({tbl}_rowid_list)</span>

<span class="sd">        delete {tbl} rows</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: num_deleted</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tdeleter_native_tbl</span>
<span class="sd">            tbl = {tbl}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {tbl}_rowid_list = {self}._get_all_{tbl}_rowids()[:2]</span>
<span class="sd">            &gt;&gt;&gt; num_deleted = {self}.delete_{tbl}({tbl}_rowid_list)</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;num_deleted = %r&#39; % (num_deleted,))</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        #from ibeis.model.preproc import preproc_{tbl}</span>
<span class="sd">        {Tdeleter_native_tbl_import}</span>
<span class="sd">        if ut.VERBOSE:</span>
<span class="sd">            print(&#39;[{self}] deleting %d {tbl} rows&#39; % len({tbl}_rowid_list))</span>
<span class="sd">        # Prepare: Delete externally stored data (if any)</span>
<span class="sd">        #preproc_{tbl}.on_delete({self}, {tbl}_rowid_list, config2_=config2_)</span>
<span class="sd">        {Tdeleter_native_tbl_on_delete}</span>
<span class="sd">        # Finalize: Delete self</span>
<span class="sd">        {self}.{dbself}.delete_rowids({TABLE}, {tbl}_rowid_list)</span>
<span class="sd">        num_deleted = len(ut.filter_Nones({tbl}_rowid_list))</span>
<span class="sd">        return num_deleted</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- IDERS ---</span>
<span class="c">#-----------------</span>


<span class="n">Tider_all_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @ider</span>
<span class="sd">    def _get_all_{tbl}_rowids({self}):</span>
<span class="sd">        &quot;&quot;&quot; all_{tbl}_rowids &lt;- {tbl}.get_all_rowids()</span>

<span class="sd">        Returns:</span>
<span class="sd">            list_ (list): unfiltered {tbl}_rowids</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tider_all_rowids</span>
<span class="sd">            tbl = {tbl}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {self}._get_all_{tbl}_rowids()</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        all_{tbl}_rowids = {self}.{dbself}.get_all_rowids({TABLE})</span>
<span class="sd">        return all_{tbl}_rowids</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c"># RL IDER ALL ROWID</span>
<span class="n">Tider_rl_dependant_all_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{root}_{leaf}_all_rowids({self}, {root}_rowid_list, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_rowid_list &lt;- {root}.{leaf}.all_rowids([{root}_rowid_list])</span>

<span class="sd">        Gets {leaf} rowids of {root} under the current state configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {leaf}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tider_rl_dependant_all_rowids</span>
<span class="sd">            root = {root}</span>
<span class="sd">            leaf = {leaf}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # FIXME: broken</span>
<span class="sd">        colnames = ({LEAF_PARENT}_ROWID,)</span>
<span class="sd">        {leaf}_rowid_list = {self}.{dbself}.get(</span>
<span class="sd">            {LEAF_TABLE}, colnames, {root}_rowid_list,</span>
<span class="sd">            id_colname={ROOT}_ROWID, eager=eager, nInput=nInput)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- GETTERS ---</span>
<span class="c">#-----------------</span>

<span class="c"># LINES GETTER</span>
<span class="n">Tline_pc_dependant_rowid</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    {child}_rowid_list = {self}.get_{parent}_{child}_rowid({parent}_rowid_list, config2_=config2_, ensure=ensure)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="c"># RL GETTER MULTICOLUMN</span>
<span class="n">Tgetter_rl_pclines_dependant_multicolumn</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{root}_{multicol}({self}, {root}_rowid_list, config2_=None, ensure=True):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_rowid_list &lt;- {root}.{leaf}.{multicol}s[{root}_rowid_list]</span>

<span class="sd">        Get {col} data of the {root} table using the dependant {leaf} table</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {col}_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_rl_pclines_dependant_column</span>
<span class="sd">            root = {root}</span>
<span class="sd">            col  = {col}</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}._get_all_{root}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; {multicol}_list = {self}.get_{root}_{multicol}({root}_rowid_list, config2_=config2_)</span>
<span class="sd">            &gt;&gt;&gt; assert len({multicol}_list) == len({root}_rowid_list)</span>

<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # REM Get leaf rowids</span>
<span class="sd">        {pc_dependant_rowid_lines}</span>
<span class="sd">        # REM Get col values</span>
<span class="sd">        {multicol}_list = {self}.get_{leaf}_{multicol}({leaf}_rowid_list)</span>
<span class="sd">        return {multicol}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c"># NATIVE MULTICOLUMN GETTER</span>
<span class="c"># eg. get_chip_sizes</span>
<span class="n">Tgetter_native_multicolumn</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{tbl}_{multicol}({self}, {tbl}_rowid_list, eager=True):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Returns zipped tuple of information from {multicol} columns</span>

<span class="sd">        Tgetter_native_multicolumn</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {multicol}_list</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {tbl}_rowid_list = {self}._get_all_{tbl}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; ensure = False</span>
<span class="sd">            &gt;&gt;&gt; {multicol}_list = {self}.get_{tbl}_{multicol}({tbl}_rowid_list, eager=eager)</span>
<span class="sd">            &gt;&gt;&gt; assert len({tbl}_rowid_list) == len({multicol}_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        id_iter = {tbl}_rowid_list</span>
<span class="sd">        colnames = {MULTICOLNAMES}</span>
<span class="sd">        {multicol}_list  = {self}.{dbself}.get({TABLE}, colnames, id_iter, id_colname=&#39;rowid&#39;, eager=eager)</span>
<span class="sd">        return {multicol}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c"># RL GETTER COLUMN</span>
<span class="n">Tgetter_rl_pclines_dependant_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{root}_{col}({self}, {root}_rowid_list, config2_=None, ensure=True):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_rowid_list &lt;- {root}.{leaf}.{col}s[{root}_rowid_list]</span>

<span class="sd">        Get {col} data of the {root} table using the dependant {leaf} table</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {col}_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_rl_pclines_dependant_column</span>
<span class="sd">            root = {root}</span>
<span class="sd">            col  = {col}</span>
<span class="sd">            leaf = {leaf}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # REM Get leaf rowids</span>
<span class="sd">        {pc_dependant_rowid_lines}</span>
<span class="sd">        # REM Get col values</span>
<span class="sd">        {col}_list = {self}.get_{leaf}_{col}({leaf}_rowid_list)</span>
<span class="sd">        return {col}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c"># NATIVE COLUMN GETTER</span>
<span class="n">Tgetter_table_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{tbl}_{col}({self}, {tbl}_rowid_list, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot; {col}_list &lt;- {tbl}.{col}[{tbl}_rowid_list]</span>

<span class="sd">        gets data from the &quot;native&quot; column &quot;{col}&quot; in the &quot;{tbl}&quot; table</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {col}_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_table_column</span>
<span class="sd">            col = {col}</span>
<span class="sd">            tbl = {tbl}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {tbl}_rowid_list = {self}._get_all_{tbl}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; eager = True</span>
<span class="sd">            &gt;&gt;&gt; {col}_list = {self}.get_{tbl}_{col}({tbl}_rowid_list, eager=eager)</span>
<span class="sd">            &gt;&gt;&gt; assert len({tbl}_rowid_list) == len({col}_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        id_iter = {tbl}_rowid_list</span>
<span class="sd">        colnames = ({COLNAME},)</span>
<span class="sd">        {col}_list = {self}.{dbself}.get({TABLE}, colnames, id_iter, id_colname=&#39;rowid&#39;, eager=eager, nInput=nInput)</span>
<span class="sd">        return {col}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tgetter_extern</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{tbl}_{externcol}({self}, {tbl}_rowid_list, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot; {externcol}_list &lt;- {tbl}.{externcol}[{tbl}_rowid_list]</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {externcol}_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_extern</span>
<span class="sd">            tbl = {tbl}</span>
<span class="sd">            externtbl = {externtbl}</span>
<span class="sd">            externcol = {externcol}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {tbl}_rowid_list = {self}._get_all_{tbl}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; eager = True</span>
<span class="sd">            &gt;&gt;&gt; {externcol}_list = {self}.get_{tbl}_{externcol}({tbl}_rowid_list, eager=eager)</span>
<span class="sd">            &gt;&gt;&gt; assert len({tbl}_rowid_list) == len({externcol}_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {externtbl}_rowid_list = {self}.get_{tbl}_{externtbl}_rowid({tbl}_rowid_list, eager=eager, nInput=nInput)</span>
<span class="sd">        {externcol}_list = {self}.get_{externtbl}_{externcol}({externtbl}_rowid_list, eager=eager, nInput=nInput)</span>
<span class="sd">        return {externcol}_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c"># RL GETTER ROWID</span>
<span class="n">Tgetter_rl_dependant_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{root}_{leaf}_rowid({self}, {root}_rowid_list, config2_=None, ensure=True, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_rowid_list &lt;- {root}.{leaf}.rowids[{root}_rowid_list]</span>

<span class="sd">        Get {leaf} rowids of {root} under the current state configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            {root}_rowid_list (list):</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {leaf}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_rl_dependant_rowids</span>
<span class="sd">            root        = {root}</span>
<span class="sd">            leaf_parent = {leaf_parent}</span>
<span class="sd">            leaf        = {leaf}</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {root}_rowid_list = {self}._get_all_{root}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list1 = {self}.get_{root}_{leaf}_rowid({root}_rowid_list, config2_, ensure=False)</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list2 = {self}.get_{root}_{leaf}_rowid({root}_rowid_list, config2_, ensure=True)</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list3 = {self}.get_{root}_{leaf}_rowid({root}_rowid_list, config2_, ensure=False)</span>
<span class="sd">            &gt;&gt;&gt; print({leaf}_rowid_list1)</span>
<span class="sd">            &gt;&gt;&gt; print({leaf}_rowid_list2)</span>
<span class="sd">            &gt;&gt;&gt; print({leaf}_rowid_list3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        # REM if ensure:</span>
<span class="sd">        # REM    # Ensuring dependant columns is equivalent to adding cleanly</span>
<span class="sd">        # REM    return {self}.add_{root}_{leaf}({root}_rowid_list, config2_=config2_)</span>
<span class="sd">        # REM else:</span>
<span class="sd">        # Get leaf_parent rowids</span>
<span class="sd">        {leaf_parent}_rowid_list = {self}.get_{root}_{leaf_parent}_rowid({root}_rowid_list, config2_=config2_, ensure=ensure)</span>
<span class="sd">        {leaf}_rowid_list = get_{leaf_parent}_{leaf}_rowid({self}, {leaf_parent}_rowid_list, config2_=config2_, ensure=ensure)</span>
<span class="sd">        # REM colnames = ({LEAF}_ROWID,)</span>
<span class="sd">        # REM config_rowid = {self}.get_{leaf}_config_rowid(config2_=config2_)</span>
<span class="sd">        # REM andwhere_colnames = ({LEAF_PARENT}_ROWID, CONFIG_ROWID,)</span>
<span class="sd">        # REM params_iter = [({leaf_parent}_rowid, config_rowid,) for {leaf_parent}_rowid in {leaf_parent}_rowid_list]</span>
<span class="sd">        # REM {leaf}_rowid_list = {self}.{dbself}.get_where2(</span>
<span class="sd">        # REM   {LEAF_TABLE}, colnames, params_iter, andwhere_colnames, eager=eager, nInput=nInput)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c"># PL GETTER ROWID WITHOUT ENSURE</span>
<span class="n">Tgetter_pl_dependant_rowids_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{parent}_{leaf}_rowids_({self}, {parent}_rowid_list, config2_=None, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        equivalent to get_{parent}_{leaf}_rowids_ except ensure is constrained</span>
<span class="sd">        to be False.</span>

<span class="sd">        Also you save a stack frame because get_{parent}_{leaf}_rowids just</span>
<span class="sd">        calls this function if ensure is False</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_pl_dependant_rowids_</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = ({LEAF}_ROWID,)</span>
<span class="sd">        config_rowid = {self}.get_{leaf}_config_rowid(config2_=config2_)</span>
<span class="sd">        andwhere_colnames = ({PARENT}_ROWID, CONFIG_ROWID,)</span>
<span class="sd">        params_iter = (({parent}_rowid, config_rowid,) for {parent}_rowid in {parent}_rowid_list)</span>
<span class="sd">        {leaf}_rowid_list = {self}.{dbself}.get_where2(</span>
<span class="sd">            {LEAF_TABLE}, colnames, params_iter, andwhere_colnames, eager=eager, nInput=nInput)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c"># PL GETTER ROWID WITH ENSURE</span>
<span class="n">Tgetter_pl_dependant_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{parent}_{leaf}_rowid({self}, {parent}_rowid_list, config2_=None, ensure=True, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot; {leaf}_rowid_list &lt;- {parent}.{leaf}.rowids[{parent}_rowid_list]</span>

<span class="sd">        get {leaf} rowids of {parent} under the current state configuration</span>
<span class="sd">        if ensure is True, this function is equivalent to add_{parent}_{leaf}s</span>

<span class="sd">        Args:</span>
<span class="sd">            {parent}_rowid_list (list):</span>
<span class="sd">            ensure (bool): default false</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: {leaf}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_pl_dependant_rowids</span>
<span class="sd">            parent = {parent}</span>
<span class="sd">            leaf = {leaf}</span>

<span class="sd">        Timeit:</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; # Test to see if there is any overhead to injected vs native functions</span>
<span class="sd">            &gt;&gt;&gt; %timeit get_{parent}_{leaf}_rowid({self}, {parent}_rowid_list)</span>
<span class="sd">            &gt;&gt;&gt; %timeit {self}.get_{parent}_{leaf}_rowid({parent}_rowid_list)</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {parent}_rowid_list = {self}._get_all_{parent}_rowids()</span>
<span class="sd">            &gt;&gt;&gt; ensure = False</span>
<span class="sd">            &gt;&gt;&gt; {leaf}_rowid_list = {self}.get_{parent}_{leaf}_rowid({parent}_rowid_list, config2_, ensure)</span>
<span class="sd">            &gt;&gt;&gt; assert len({leaf}_rowid_list) == len({parent}_rowid_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if ensure:</span>
<span class="sd">            {leaf}_rowid_list = add_{parent}_{leaf}({self}, {parent}_rowid_list, config2_=config2_)</span>
<span class="sd">        else:</span>
<span class="sd">            {leaf}_rowid_list = get_{parent}_{leaf}_rowids_(</span>
<span class="sd">                {self}, {parent}_rowid_list, config2_=config2_, eager=eager, nInput=nInput)</span>
<span class="sd">        return {leaf}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c"># NATIVE FROMSUPERKEY ROWID GETTER</span>
<span class="c">#id_iter = (({tbl}_rowid,) for {tbl}_rowid in {tbl}_rowid_list)</span>
<span class="n">Tgetter_native_rowid_from_superkey</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @getter</span>
<span class="sd">    def get_{tbl}_rowid_from_superkey({self}, {superkey_args}, eager=True, nInput=None):</span>
<span class="sd">        &quot;&quot;&quot; {tbl}_rowid_list &lt;- {tbl}[{superkey_args}]</span>

<span class="sd">        Args:</span>
<span class="sd">            superkey lists: {superkey_args}</span>

<span class="sd">        Returns:</span>
<span class="sd">            {tbl}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_native_rowid_from_superkey</span>
<span class="sd">            tbl = {tbl}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = ({TBL}_ROWID,)</span>
<span class="sd">        # FIXME: col_rowid is not correct</span>
<span class="sd">        params_iter = zip({superkey_args})</span>
<span class="sd">        andwhere_colnames = [{superkey_COLNAMES}]</span>
<span class="sd">        {tbl}_rowid_list = {self}.{dbself}.get_where2(</span>
<span class="sd">            {TABLE}, colnames, params_iter, andwhere_colnames, eager=eager, nInput=nInput)</span>
<span class="sd">        return {tbl}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- SETTERS ---</span>
<span class="c">#-----------------</span>


<span class="c"># NATIVE COL SETTER</span>
<span class="n">Tsetter_native_column</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @setter</span>
<span class="sd">    def set_{tbl}_{col}({self}, {tbl}_rowid_list, {col}_list, duplicate_behavior=&#39;error&#39;):</span>
<span class="sd">        &quot;&quot;&quot; {col}_list -&gt; {tbl}.{col}[{tbl}_rowid_list]</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list</span>
<span class="sd">            {col}_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tsetter_native_column</span>
<span class="sd">            tbl = {tbl}</span>
<span class="sd">            col = {col}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        id_iter = {tbl}_rowid_list</span>
<span class="sd">        colnames = ({COLNAME},)</span>
<span class="sd">        {self}.{dbself}.set({TABLE}, colnames, {col}_list, id_iter, duplicate_behavior=duplicate_behavior)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="n">Tsetter_native_multicolumn</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    def set_{tbl}_{multicol}({self}, {tbl}_rowid_list, {multicol}_list, duplicate_behavior=&#39;error&#39;):</span>
<span class="sd">        &quot;&quot;&quot; {multicol}_list -&gt; {tbl}.{multicol}[{tbl}_rowid_list]</span>

<span class="sd">        Tsetter_native_multicolumn</span>

<span class="sd">        Args:</span>
<span class="sd">            {tbl}_rowid_list (list):</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from {autogen_modname} import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; {self}, config2_ = testdata_ibs()</span>
<span class="sd">            &gt;&gt;&gt; {multicol}_list = get_{tbl}_{multicol}({self}, {tbl}_rowid_list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        id_iter = {tbl}_rowid_list</span>
<span class="sd">        colnames = {MULTICOLNAMES}</span>
<span class="sd">        {self}.{dbself}.set({TABLE}, colnames,  {multicol}_list, id_iter, duplicate_behavior=duplicate_behavior)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-------------------------------</span>
<span class="c"># --- UNFINISHED AND DEFERRED ---</span>
<span class="c">#-------------------------------</span>


<span class="n">Tdeleter_table1_relation</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @deleter</span>
<span class="sd">    def delete_{tbl1}_{relation_tbl}_relation({self}, {tbl1}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Deletes the relationship between an {tbl1} and {tbl2}</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tdeleter_relationship</span>
<span class="sd">            tbl = {relation_tbl}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {relation_tbl}_rowids_list = {self}.get_{tbl1}_{relation_tbl}_rowid({tbl1}_rowid_list)</span>
<span class="sd">        {relation_tbl}_rowid_list = ut.flatten({relation_tbl}_rowids_list)</span>
<span class="sd">        {self}.{dbself}.delete_rowids({RELATION_TABLE}, {relation_tbl}_rowid_list)</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>


<span class="n">Tgetter_table1_rowids</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @deleter</span>
<span class="sd">    def get_{tbl1}_{relation_tbl}_rowid({self}, {tbl1}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list of lists: {relation_tbl}_rowids_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tgetter_relationship</span>
<span class="sd">            tbl = {relation_tbl}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = (&#39;{relation_tbl}_rowid&#39;,)</span>
<span class="sd">        params_iter = {tbl1}_rowid_list</span>
<span class="sd">        where_clause = &#39;{tbl2}_rowid=?&#39;</span>
<span class="sd">        {relation_tbl}_rowids_list = ibs.db.get_where({RELATION_TABLE}, colnames, params_iter,</span>
<span class="sd">                                      where_clause, unpack_scalars=False)</span>
<span class="sd">        return {relation_tbl}_rowids_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="n">Tadder_relationship</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    # REM @adder</span>
<span class="sd">    def add_{relation_tbl}_{tbl1}_{tbl2}_relation({self}, {tbl1}_rowid_list, {tbl2}_rowid_list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Adds a relationship between an image and encounter</span>

<span class="sd">        Returns:</span>
<span class="sd">            {relation_tbl}_rowid_list</span>

<span class="sd">        TemplateInfo:</span>
<span class="sd">            Tadder_relationship</span>
<span class="sd">            tbl = {relation_tbl}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        colnames = (&#39;{tbl1}_rowid&#39;, &#39;{tbl2}_rowid&#39;,)</span>
<span class="sd">        params_iter = list(zip({tbl1}_rowid_list, {tbl2}_rowid_list))</span>
<span class="sd">        get_rowid_from_superkey = {self}.get_{relation_tbl}_rowid_from_superkey</span>
<span class="sd">        superkey_paramx = (0, 1)</span>
<span class="sd">        {relation_tbl}_rowid_list = {self}.{dbself}.add_cleanly(</span>
<span class="sd">            {RELATION_TABLE}, colnames, params_iter, get_rowid_from_superkey, superkey_paramx)</span>
<span class="sd">        return {relation_tbl}_rowid_list</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>


<span class="c">#</span>
<span class="c">#</span>
<span class="c">#-----------------</span>
<span class="c"># --- FOOTER ---</span>
<span class="c">#-----------------</span>


<span class="n">Tfooter_ibeiscontrol</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
    <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">    # STARTBLOCK</span>
<span class="sd">    if __name__ == &#39;__main__&#39;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        {main_docstr_body}</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        import multiprocessing</span>
<span class="sd">        multiprocessing.freeze_support()</span>
<span class="sd">        import utool as ut</span>
<span class="sd">        ut.doctest_funcs()</span>
<span class="sd">    # ENDBLOCK</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jon Crall.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.4.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>