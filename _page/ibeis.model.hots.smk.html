<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ibeis.model.hots.smk package &mdash; ibeis 0.1.0.dev1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ibeis 0.1.0.dev1 documentation" href="index.html" />
    <link rel="up" title="ibeis.model.hots package" href="ibeis.model.hots.html" />
    <link rel="next" title="ibeis.model.preproc package" href="ibeis.model.preproc.html" />
    <link rel="prev" title="ibeis.model.hots package" href="ibeis.model.hots.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ibeis.model.preproc.html" title="ibeis.model.preproc package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ibeis.model.hots.html" title="ibeis.model.hots package"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="ibeis.html" >ibeis package</a> &raquo;</li>
          <li><a href="ibeis.model.html" >ibeis.model package</a> &raquo;</li>
          <li><a href="ibeis.model.hots.html" accesskey="U">ibeis.model.hots package</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ibeis-model-hots-smk-package">
<h1>ibeis.model.hots.smk package<a class="headerlink" href="#ibeis-model-hots-smk-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="ibeis-model-hots-smk-grave-module">
<h2>ibeis.model.hots.smk._grave module<a class="headerlink" href="#ibeis-model-hots-smk-grave-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ibeis.model.hots.smk.smk_core">
<span id="ibeis-model-hots-smk-smk-core-module"></span><h2>ibeis.model.hots.smk.smk_core module<a class="headerlink" href="#module-ibeis.model.hots.smk.smk_core" title="Permalink to this headline">¶</a></h2>
<p>smk core</p>
<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.accumulate_scores">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">accumulate_scores</tt><big>(</big><em>dscores_list</em>, <em>daids_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#accumulate_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.accumulate_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>helper</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.aggregate_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">aggregate_rvecs</tt><big>(</big><em>rvecs</em>, <em>maws</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#aggregate_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.aggregate_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for compute_agg_rvecs
.. rubric:: Example</p>
<p>#&gt;&gt;&gt; rvecs = (hstypes.RVEC_MAX * np.random.rand(4, 4)).astype(hstypes.RVEC_TYPE)
&gt;&gt;&gt; from ibeis.model.hots.smk.smk_core import *  # NOQA
&gt;&gt;&gt; rvecs = (hstypes.RVEC_MAX * np.random.rand(4, 128)).astype(hstypes.RVEC_TYPE)
&gt;&gt;&gt; maws  = (np.random.rand(rvecs.shape[0])).astype(hstypes.FLOAT_TYPE)</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.build_correspondences">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">build_correspondences</tt><big>(</big><em>sparse_list</em>, <em>qfxs_list</em>, <em>dfxs_list</em>, <em>daids_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#build_correspondences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.build_correspondences" title="Permalink to this definition">¶</a></dt>
<dd><p>helper
these list comprehensions replace the prevous for loop
they still need to be optimized a little bit (and made clearer)
can probably unnest the list comprehensions as well</p>
<dl class="docutils">
<dt>Legacy::</dt>
<dd><dl class="first docutils">
<dt>def old_build_correspondences(sparse_list, qfxs_list, dfxs_list, daids_list):</dt>
<dd><p class="first"><a href="#id1"><span class="problematic" id="id2">fm_nestlist_</span></a> = []
<a href="#id3"><span class="problematic" id="id4">fs_nestlist_</span></a> = []
<a href="#id5"><span class="problematic" id="id6">daid_nestlist_</span></a> = []
for scores, qfxs, dfxs, daids in zip(sparse_list, qfxs_list, dfxs_list, daids_list):</p>
<blockquote>
<div><dl class="docutils">
<dt>for rx, cx, score in zip(scores.row, scores.col, scores.data):</dt>
<dd>_fm = tuple(product(qfxs[rx], dfxs[cx]))
_fs = [score / len(_fm)] * len(_fm)
_daid = [daids[cx]] * len(_fm)
<a href="#id7"><span class="problematic" id="id8">fm_nestlist_</span></a>.append(_fm)
<a href="#id9"><span class="problematic" id="id10">fs_nestlist_</span></a>.append(_fs)
<a href="#id11"><span class="problematic" id="id12">daid_nestlist_</span></a>.append(_daid)</dd>
</dl>
</div></blockquote>
<p class="last">return <a href="#id13"><span class="problematic" id="id14">fm_nestlist_</span></a>, <a href="#id15"><span class="problematic" id="id16">fs_nestlist_</span></a>, <a href="#id17"><span class="problematic" id="id18">daid_nestlist_</span></a></p>
</dd>
</dl>
<p><a href="#id19"><span class="problematic" id="id20">oldtup_</span></a> = old_build_correspondences(sparse_list, qfxs_list, dfxs_list, daids_list)
<a href="#id21"><span class="problematic" id="id22">fm_nestlist_</span></a>, <a href="#id23"><span class="problematic" id="id24">fs_nestlist_</span></a>, <a href="#id25"><span class="problematic" id="id26">daid_nestlist_</span></a> = <a href="#id27"><span class="problematic" id="id28">oldtup_</span></a>
<a href="#id29"><span class="problematic" id="id30">newtup_</span></a> = build_correspondences(sparse_list, qfxs_list, dfxs_list, daids_list)
fm_nestlist, fs_nestlist, daid_nestlist = <a href="#id31"><span class="problematic" id="id32">newtup_</span></a></p>
<p>assert fm_nestlist == <a href="#id33"><span class="problematic" id="id34">fm_nestlist_</span></a>
assert fs_nestlist == <a href="#id35"><span class="problematic" id="id36">fs_nestlist_</span></a>
assert daid_nestlist == <a href="#id37"><span class="problematic" id="id38">daid_nestlist_</span></a></p>
<p>47ms
%timeit build_correspondences(sparse_list, qfxs_list, dfxs_list, daids_list)</p>
<p class="last">59ms
%timeit old_build_correspondences(sparse_list, qfxs_list, dfxs_list, daids_list)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.build_daid2_chipmatch2">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">build_daid2_chipmatch2</tt><big>(</big><em>invindex</em>, <em>common_wxs</em>, <em>wx2_qaids</em>, <em>wx2_qfxs</em>, <em>scores_list</em>, <em>daids_list</em>, <em>query_sccw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#build_daid2_chipmatch2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.build_daid2_chipmatch2" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds explicit chipmatches that the rest of the pipeline plays nice with</p>
<dl class="docutils">
<dt>Notation:</dt>
<dd><p class="first">An explicit chipmatch is a tuple (fm, fs, fk) feature_matches,
feature_scores, and feature_ranks.</p>
<p>Let N be the number of matches</p>
<p>A feature match, fm{shape=(N, 2), dtype=int32}, is an array where the first
column corresponds to query_feature_indexes (qfx) and the second column
corresponds to database_feature_indexes (dfx).</p>
<p>A feature score, fs{shape=(N,), dtype=float64} is an array of scores</p>
<p class="last">A feature rank, fk{shape=(N,), dtype=int16} is an array of ranks</p>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>daid2_chipmatch</strong> &#8211;
(daid2_fm, daid2_fs, daid2_fk)
Return Format:<div class="highlight-python"><div class="highlight"><pre>daid2_fm (dict): {daid: fm, ...}
daid2_fs (dict): {daid: fs, ...}
daid2_fk (dict): {daid: fk, ...}
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_core</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qindex</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_match_kernel_L2</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span> <span class="o">=</span> <span class="n">qindex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_alpha</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_alpha</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_thresh</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withinfo</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># takes an 11s vs 2s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">withinfo</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">retL1</span> <span class="o">=</span>  <span class="n">match_kernel_L1</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">daid2_totalscore</span><span class="p">,</span> <span class="n">common_wxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">,</span> <span class="n">daid_agg_keys</span><span class="p">,)</span>  <span class="o">=</span> <span class="n">retL1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_chipmatch_old</span> <span class="o">=</span> <span class="n">build_daid2_chipmatch2</span><span class="p">(</span><span class="n">invindex</span><span class="p">,</span> <span class="n">common_wxs</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_chipmatch_new</span> <span class="o">=</span> <span class="n">build_daid2_chipmatch3</span><span class="p">(</span><span class="n">invindex</span><span class="p">,</span> <span class="n">common_wxs</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">is_dicteq</span><span class="p">(</span><span class="n">daid2_chipmatch_old</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">daid2_chipmatch_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">is_dicteq</span><span class="p">(</span><span class="n">daid2_chipmatch_old</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">daid2_chipmatch_new</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">is_dicteq</span><span class="p">(</span><span class="n">daid2_chipmatch_old</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="n">daid2_chipmatch_new</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>%timeit build_daid2_chipmatch2(invindex, common_wxs, wx2_qaids, wx2_qfxs, scores_list, daids_list, query_sccw)
%timeit build_daid2_chipmatch3(invindex, common_wxs, wx2_qaids, wx2_qfxs, scores_list, daids_list, query_sccw)</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.build_daid2_chipmatch3">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">build_daid2_chipmatch3</tt><big>(</big><em>invindex</em>, <em>common_wxs</em>, <em>wx2_qfxs</em>, <em>scores_list</em>, <em>daids_list</em>, <em>query_sccw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#build_daid2_chipmatch3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.build_daid2_chipmatch3" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_core</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qindex</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_match_kernel_L2</span><span class="p">(</span><span class="n">aggregate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span> <span class="o">=</span> <span class="n">qindex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_alpha</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_alpha</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_thresh</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withinfo</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># takes an 11s vs 2s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">withinfo</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">retL1</span> <span class="o">=</span>  <span class="n">match_kernel_L1</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">daid2_totalscore</span><span class="p">,</span> <span class="n">common_wxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">,</span> <span class="n">daid_agg_keys</span><span class="p">,)</span>  <span class="o">=</span> <span class="n">retL1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_chipmatch_new</span> <span class="o">=</span> <span class="n">build_daid2_chipmatch3</span><span class="p">(</span><span class="n">invindex</span><span class="p">,</span> <span class="n">common_wxs</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_chipmatch_old</span> <span class="o">=</span> <span class="n">build_daid2_chipmatch2</span><span class="p">(</span><span class="n">invindex</span><span class="p">,</span> <span class="n">common_wxs</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">is_dicteq</span><span class="p">(</span><span class="n">daid2_chipmatch_old</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">daid2_chipmatch_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">is_dicteq</span><span class="p">(</span><span class="n">daid2_chipmatch_old</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">daid2_chipmatch_new</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">is_dicteq</span><span class="p">(</span><span class="n">daid2_chipmatch_old</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">daid2_chipmatch_new</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Notation::</dt>
<dd>The Format of Feature Index Lists are:
fxs_list ~ [ ... list_per_word ... ]
list_per_word ~ [ ... list_per_rvec ... ]
list_per_rvec ~ [ features contributing to rvec (only one if agg=False)]</dd>
<dt>CommandLine::</dt>
<dd>python dev.py -t smk0 &#8211;allgt &#8211;db GZ_ALL &#8211;index 2:5
python dev.py -t smk &#8211;allgt &#8211;db PZ_Mothers &#8211;index 1:3 &#8211;noqcache &#8211;va &#8211;vf</dd>
<dt>Timeit:</dt>
<dd><p class="first">num_matches = sum(map(len, daid_nestlist))</p>
<p>%timeit np.array(list(utool.iflatten(daid_nestlist)), dtype=hstypes.INDEX_TYPE)
%timeit num_matches = sum(map(len, daid_nestlist))
%timeit np.fromiter(utool.iflatten(daid_nestlist), hstypes.INDEX_TYPE, num_matches)</p>
<p>This function is still a tiny bit slower than the other one.
There are probably faster ways to do a few things</p>
<p class="last">%timeit build_daid2_chipmatch2(invindex, common_wxs, wx2_qfxs, scores_list, daids_list, query_sccw)
%timeit build_daid2_chipmatch3(invindex, common_wxs, wx2_qfxs, scores_list, daids_list, query_sccw)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.compress_normvec">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">compress_normvec</tt><big>(</big><em>arr_float</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.compress_normvec" title="Permalink to this definition">¶</a></dt>
<dd><p>compresses 8 or 4 bytes of information into 2 bytes
Assumes RVEC_TYPE is float16</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.compress_normvec_float16">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">compress_normvec_float16</tt><big>(</big><em>arr_float</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#compress_normvec_float16"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.compress_normvec_float16" title="Permalink to this definition">¶</a></dt>
<dd><p>compresses 8 or 4 bytes of information into 2 bytes
Assumes RVEC_TYPE is float16</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.compute_agg_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">compute_agg_rvecs</tt><big>(</big><em>rvecs_list</em>, <em>idxs_list</em>, <em>aids_list</em>, <em>maws_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#compute_agg_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.compute_agg_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Sums and normalizes all rvecs that belong to the same word and the same
annotation id</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_core</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span><span class="p">,</span> <span class="n">wx_sublist</span><span class="p">,</span> <span class="n">aids_list</span><span class="p">,</span> <span class="n">idxs_list</span><span class="p">,</span> <span class="n">idx2_vec</span><span class="p">,</span> <span class="n">maws_list</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_nonagg_rvec</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs_list</span> <span class="o">=</span> <span class="n">compute_nonagg_rvecs</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">wx_sublist</span><span class="p">,</span> <span class="n">idxs_list</span><span class="p">,</span> <span class="n">idx2_vec</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.compute_nonagg_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">compute_nonagg_rvecs</tt><big>(</big><em>words</em>, <em>wx2_idxs</em>, <em>idx2_vec</em>, <em>wx_sublist</em>, <em>idxs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#compute_nonagg_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.compute_nonagg_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>helper</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.flatten_correspondences">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">flatten_correspondences</tt><big>(</big><em>fm_nestlist</em>, <em>fs_nestlist</em>, <em>daid_nestlist</em>, <em>query_sccw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#flatten_correspondences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.flatten_correspondences" title="Permalink to this definition">¶</a></dt>
<dd><p>helper</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.get_norm_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">get_norm_rvecs</tt><big>(</big><em>vecs</em>, <em>word</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#get_norm_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.get_norm_rvecs" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<p>The case where vecs != words
&gt;&gt;&gt; from ibeis.model.hots.smk.smk_core import *  # NOQA
&gt;&gt;&gt; vecs = (hstypes.VEC_MAX * np.random.rand(4, 128)).astype(hstypes.VEC_TYPE)
&gt;&gt;&gt; word = (hstypes.VEC_MAX * np.random.rand(1, 128)).astype(hstypes.VEC_TYPE)</p>
<dl class="docutils">
<dt>Example2:</dt>
<dd>The case where vecs == words
&gt;&gt;&gt; from ibeis.model.hots.smk.smk_core import *  # NOQA
&gt;&gt;&gt; vecs = (hstypes.VEC_MAX * np.random.rand(4, 128)).astype(hstypes.VEC_TYPE)
&gt;&gt;&gt; word = vecs[1]</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.group_correspondences">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">group_correspondences</tt><big>(</big><em>all_matches</em>, <em>all_scores</em>, <em>all_daids</em>, <em>daid2_sccw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#group_correspondences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.group_correspondences" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.match_kernel_L0">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">match_kernel_L0</tt><big>(</big><em>qrvecs_list</em>, <em>drvecs_list</em>, <em>qmaws_list</em>, <em>dmaws_list</em>, <em>smk_alpha</em>, <em>smk_thresh</em>, <em>idf_list</em>, <em>daids_list</em>, <em>daid2_sccw</em>, <em>query_sccw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#match_kernel_L0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.match_kernel_L0" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes smk kernels</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_core</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_debug</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">core1</span><span class="p">,</span> <span class="n">core2</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_match_kernel_L0</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">daid2_sccw</span> <span class="o">=</span> <span class="n">core1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">drvecs_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">dmaws_list</span><span class="p">,</span> <span class="n">idf_list</span> <span class="o">=</span> <span class="n">core2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_sccw</span><span class="p">,</span> <span class="n">qaids_list</span> <span class="o">=</span> <span class="n">extra</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">retL0</span> <span class="o">=</span> <span class="n">match_kernel_L0</span><span class="p">(</span><span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">drvecs_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">dmaws_list</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">,</span> <span class="n">daids_list</span><span class="p">,</span> <span class="n">daid2_sccw</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Test Asymetric Matching</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">daid2_totalscore</span><span class="p">,</span> <span class="n">scores_list</span><span class="p">,</span> <span class="n">daid_agg_keys</span><span class="p">,)</span> <span class="o">=</span> <span class="n">retL0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">daid2_totalscore</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="go">0.336434201301</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Test Self Consistency</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qret</span> <span class="o">=</span> <span class="n">match_kernel_L0</span><span class="p">(</span><span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">,</span> <span class="n">qaids_list</span><span class="p">,</span> <span class="n">qaid2_sccw</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qaid2_totalscore</span><span class="p">,</span> <span class="n">qscores_list</span><span class="p">,</span> <span class="n">qaid_agg_keys</span><span class="p">,)</span> <span class="o">=</span> <span class="n">qret</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qaid2_totalscore</span><span class="p">[</span><span class="mi">42</span><span class="p">])</span>
<span class="go">1.0000000000000007</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.match_kernel_L1">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">match_kernel_L1</tt><big>(</big><em>wx2_qrvecs</em>, <em>wx2_qmaws</em>, <em>wx2_qfxs</em>, <em>query_sccw</em>, <em>invindex</em>, <em>qparams</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#match_kernel_L1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.match_kernel_L1" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds up information and does verbosity before going to L0</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.match_kernel_L2">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">match_kernel_L2</tt><big>(</big><em>wx2_qrvecs</em>, <em>wx2_qmaws</em>, <em>wx2_qfxs</em>, <em>query_sccw</em>, <em>invindex</em>, <em>qparams</em>, <em>withinfo=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#match_kernel_L2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.match_kernel_L2" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_core</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qindex</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_match_kernel_L2</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span> <span class="o">=</span> <span class="n">qindex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_alpha</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_alpha</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_thresh</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withinfo</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># takes an 11s vs 2s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">argsL2</span> <span class="o">=</span> <span class="p">(</span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">withinfo</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_debug</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_debug</span><span class="o">.</span><span class="n">invindex_dbgstr</span><span class="p">(</span><span class="n">invindex</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_totalscore</span><span class="p">,</span> <span class="n">daid2_wx2_scoremat</span> <span class="o">=</span> <span class="n">match_kernel_L2</span><span class="p">(</span><span class="o">*</span><span class="n">argsL2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.mem_arange">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">mem_arange</tt><big>(</big><em>num</em>, <em>cache={}</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#mem_arange"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.mem_arange" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.mem_meshgrid">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">mem_meshgrid</tt><big>(</big><em>wrange</em>, <em>hrange</em>, <em>cache={}</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#mem_meshgrid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.mem_meshgrid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.normalize_vecs_inplace">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">normalize_vecs_inplace</tt><big>(</big><em>vecs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#normalize_vecs_inplace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.normalize_vecs_inplace" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_core.sccw_summation">
<tt class="descclassname">ibeis.model.hots.smk.smk_core.</tt><tt class="descname">sccw_summation</tt><big>(</big><em>rvecs_list</em>, <em>idf_list</em>, <em>maws_list</em>, <em>smk_alpha</em>, <em>smk_thresh</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_core.html#sccw_summation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_core.sccw_summation" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gamma from &#8220;To Aggregate or not to aggregate&#8221;. Every component in
each list is with repsect to a different word.</p>
<p>scc = self consistency criterion
It is a scalar which ensure K(X, X) = 1</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>rvecs_list</strong> (<em>list of ndarrays</em>) &#8211; residual vectors for every word</li>
<li><strong>idf_list</strong> (<em>list of floats</em>) &#8211; idf weight for each word</li>
<li><strong>maws_list</strong> (<em>list of ndarrays</em>) &#8211; multi-assign weights for each word for each residual vector</li>
<li><strong>smk_alpha</strong> (<em>float</em>) &#8211; selectivity power</li>
<li><strong>smk_thresh</strong> (<em>float</em>) &#8211; selectivity threshold</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">sccw self-consistency-criterion weight</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Math:</dt>
<dd>begin{equation}
gamma(X) = (sum_{c in C} w_c M(X_c, X_c))^{-.5}
end{equation}</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_core</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idf_list</span><span class="p">,</span> <span class="n">rvecs_list</span><span class="p">,</span> <span class="n">maws_list</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testsdata_sccw_sum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qmaws_list</span> <span class="o">=</span> <span class="n">dmaws_list</span> <span class="o">=</span> <span class="n">maws_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">drvecs_list</span> <span class="o">=</span> <span class="n">qrvecs_list</span> <span class="o">=</span> <span class="n">rvecs_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scoremat</span> <span class="o">=</span> <span class="n">sccw_summation</span><span class="p">(</span><span class="n">rvecs_list</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">,</span> <span class="n">maws_list</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">scoremat</span><span class="p">)</span>
<span class="go">0.0201041835751</span>
</pre></div>
</div>
<p>0.0384477314197</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>qrvecs_list = drvecs_list = rvecs_list</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.smk.smk_debug">
<span id="ibeis-model-hots-smk-smk-debug-module"></span><h2>ibeis.model.hots.smk.smk_debug module<a class="headerlink" href="#module-ibeis.model.hots.smk.smk_debug" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.assert_single_assigned_maws">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">assert_single_assigned_maws</tt><big>(</big><em>maws_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#assert_single_assigned_maws"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.assert_single_assigned_maws" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_daid2_chipmatch">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_daid2_chipmatch</tt><big>(</big><em>daid2_chipmatch</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_daid2_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_daid2_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_daid2_sccw">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_daid2_sccw</tt><big>(</big><em>daid2_sccw</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_daid2_sccw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_daid2_sccw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_data_smksumm">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_data_smksumm</tt><big>(</big><em>aididf_list</em>, <em>aidrvecs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_data_smksumm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_data_smksumm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_dtype">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_dtype</tt><big>(</big><em>annots_df</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_dtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_dtype" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annots_df</span> <span class="o">=</span> <span class="n">make_annot_df</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_invindex">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_invindex</tt><big>(</big><em>invindex</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_invindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_invindex" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_index</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">taids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">nWords</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_dataframe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span> <span class="o">=</span> <span class="n">smk_index</span><span class="o">.</span><span class="n">learn_visual_words</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">taids</span><span class="p">,</span> <span class="n">nWords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qparams</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invindex</span> <span class="o">=</span> <span class="n">smk_index</span><span class="o">.</span><span class="n">index_data_annots</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">qparams</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_invindex_wx2">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_invindex_wx2</tt><big>(</big><em>invindex</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_invindex_wx2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_invindex_wx2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_qaid2_chipmatch">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_qaid2_chipmatch</tt><big>(</big><em>qaid2_chipmatch</em>, <em>qaids</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_qaid2_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_qaid2_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_rvecs_list_eq">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_rvecs_list_eq</tt><big>(</big><em>rvecs_list</em>, <em>rvecs_list2</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_rvecs_list_eq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_rvecs_list_eq" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs_list</span> <span class="o">=</span> <span class="n">smk_core</span><span class="o">.</span><span class="n">compute_nonagg_rvecs</span><span class="p">(</span><span class="o">*</span><span class="n">_args1</span><span class="p">)</span>  <span class="c"># 125 ms</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rvecs_list2</span> <span class="o">=</span> <span class="n">smk_speed</span><span class="o">.</span><span class="n">compute_nonagg_residuals_forloop</span><span class="p">(</span><span class="o">*</span><span class="n">_args1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_wx2">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_wx2</tt><big>(</big><em>words=None</em>, <em>wx2_rvecs=None</em>, <em>wx2_aids=None</em>, <em>wx2_fxs=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_wx2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_wx2" title="Permalink to this definition">¶</a></dt>
<dd><p>provides debug info for mappings from word indexes to values</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_wx2_idxs">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_wx2_idxs</tt><big>(</big><em>wx2_idxs</em>, <em>nWords</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_wx2_idxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_wx2_idxs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_wx2_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_wx2_rvecs</tt><big>(</big><em>wx2_rvecs</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_wx2_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_wx2_rvecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.check_wx2_rvecs2">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">check_wx2_rvecs2</tt><big>(</big><em>invindex</em>, <em>wx2_rvecs=None</em>, <em>wx2_idxs=None</em>, <em>idx2_vec=None</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#check_wx2_rvecs2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.check_wx2_rvecs2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.dbstr_qindex">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">dbstr_qindex</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#dbstr_qindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.dbstr_qindex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.dictinfo">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">dictinfo</tt><big>(</big><em>dict_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#dictinfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.dictinfo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.display_info">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">display_info</tt><big>(</big><em>ibs</em>, <em>invindex</em>, <em>annots_df</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#display_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.display_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.dump_word_patches">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">dump_word_patches</tt><big>(</big><em>ibs</em>, <em>invindex</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#dump_word_patches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.dump_word_patches" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="go">#&gt;&gt;&gt; tup = smk_debug.testdata_raw_internals0(db=&#39;GZ_ALL&#39;, nWords=64000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals0</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;GZ_ALL&#39;</span><span class="p">,</span> <span class="n">nWords</span><span class="o">=</span><span class="mi">64000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_data_internals_</span><span class="p">(</span><span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.get_cached_vocabs">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">get_cached_vocabs</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#get_cached_vocabs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.get_cached_vocabs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.get_test_float_norm_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">get_test_float_norm_rvecs</tt><big>(</big><em>num=1000</em>, <em>dim=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#get_test_float_norm_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.get_test_float_norm_rvecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.get_test_maws">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">get_test_maws</tt><big>(</big><em>rvecs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#get_test_maws"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.get_test_maws" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.get_test_rvecs">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">get_test_rvecs</tt><big>(</big><em>num=1000</em>, <em>dim=None</em>, <em>nanrows=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#get_test_rvecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.get_test_rvecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.invindex_dbgstr">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">invindex_dbgstr</tt><big>(</big><em>invindex</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#invindex_dbgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.invindex_dbgstr" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span> <span class="o">=</span> <span class="n">testdata_raw_internals0</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invindex_dbgstr</span><span class="p">(</span><span class="n">invindex</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.main">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">main</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#main"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.main" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.query_smk_test">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">query_smk_test</tt><big>(</big><em>annots_df</em>, <em>invindex</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#query_smk_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.query_smk_test" title="Permalink to this definition">¶</a></dt>
<dd><p>ibeis interface
.. rubric:: Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_match</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_internals_full</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_</span> <span class="o">=</span> <span class="n">smk_match</span><span class="o">.</span><span class="n">query_smk</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Dev::</dt>
<dd>qres = qaid2_qres_[qaids[0]]
fig = qres.show_top(ibs)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.sift_stats">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">sift_stats</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#sift_stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.sift_stats" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.test_sccw_cache">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">test_sccw_cache</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#test_sccw_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.test_sccw_cache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_apply_weights">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_apply_weights</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_apply_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_apply_weights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_dataframe">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_dataframe</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_dataframe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_dataframe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_ibeis">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_ibeis</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_ibeis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_ibeis" title="Permalink to this definition">¶</a></dt>
<dd><p>Step 1</p>
<p>builds ibs for testing</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_ibeis2">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_ibeis2</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_ibeis2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_ibeis2" title="Permalink to this definition">¶</a></dt>
<dd><p>Step 2</p>
<p>selects training and test set</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_internals_full">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_internals_full</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_internals_full"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_internals_full" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_match_kernel_L0">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_match_kernel_L0</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_match_kernel_L0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_match_kernel_L0" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_match_kernel_L2">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_match_kernel_L2</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_match_kernel_L2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_match_kernel_L2" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_nonagg_rvec">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_nonagg_rvec</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_nonagg_rvec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_nonagg_rvec" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_printops">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_printops</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_printops"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_printops" title="Permalink to this definition">¶</a></dt>
<dd><p>test print options. doesnt take up too much screen</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_query_repr">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_query_repr</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_query_repr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_query_repr" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_raw_internals0">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_raw_internals0</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_raw_internals0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_raw_internals0" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_raw_internals1">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_raw_internals1</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_raw_internals1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_raw_internals1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_raw_internals1_5">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_raw_internals1_5</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_raw_internals1_5"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_raw_internals1_5" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_raw_internals2">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_raw_internals2</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_raw_internals2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_raw_internals2" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_selectivity_function">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_selectivity_function</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_selectivity_function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_selectivity_function" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_similarity_function">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_similarity_function</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_similarity_function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_similarity_function" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testdata_words">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testdata_words</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testdata_words"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testdata_words" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.testsdata_sccw_sum">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">testsdata_sccw_sum</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#testsdata_sccw_sum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.testsdata_sccw_sum" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.vector_normal_stats">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">vector_normal_stats</tt><big>(</big><em>vectors</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#vector_normal_stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.vector_normal_stats" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.vector_stats">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">vector_stats</tt><big>(</big><em>vectors</em>, <em>name</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#vector_stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.vector_stats" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.view_vocabs">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">view_vocabs</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#view_vocabs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.view_vocabs" title="Permalink to this definition">¶</a></dt>
<dd><p>looks in vocab cachedir and prints info / vizualizes the vocabs</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_debug.wx_len_stats">
<tt class="descclassname">ibeis.model.hots.smk.smk_debug.</tt><tt class="descname">wx_len_stats</tt><big>(</big><em>wx2_xxx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_debug.html#wx_len_stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_debug.wx_len_stats" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_debug</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">taids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">nWords</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_dataframe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">query_request</span><span class="o">.</span><span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qparams</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invindex</span> <span class="o">=</span> <span class="n">index_data_annots</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span> <span class="o">=</span> <span class="n">new_qindex</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">dict_str</span><span class="p">(</span><span class="n">wx2_rvecs_stats</span><span class="p">(</span><span class="n">wx2_qrvecs</span><span class="p">)))</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.smk.smk_index">
<span id="ibeis-model-hots-smk-smk-index-module"></span><h2>ibeis.model.hots.smk.smk_index module<a class="headerlink" href="#module-ibeis.model.hots.smk.smk_index" title="Permalink to this headline">¶</a></h2>
<p>smk_index
This module contains functions for the SelectiveMatchKernels&#8217;s inverted index.</p>
<dl class="docutils">
<dt>TODO::</dt>
<dd><ul class="first last simple">
<li>Test suit 1000k images</li>
<li>Extend for SMK with labels</li>
<li>Test get numbers and refine</li>
<li>Extrnal keypoint specific weighting</li>
</ul>
</dd>
</dl>
<dl class="class">
<dt id="ibeis.model.hots.smk.smk_index.DataFrameProxy">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">DataFrameProxy</tt><big>(</big><em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#DataFrameProxy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.DataFrameProxy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>pandas is actually really slow. This class emulates it so
I don&#8217;t have to change my function calls, but without all the slowness.</p>
</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">InvertedIndex</tt><big>(</big><em>invindex</em>, <em>words</em>, <em>wordflann</em>, <em>idx2_vec</em>, <em>idx2_aid</em>, <em>idx2_fx</em>, <em>daids</em>, <em>daid2_label</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#InvertedIndex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>Stores inverted index state information
(mapping from words to database aids and fxs_list)</p>
<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_dvec">
<tt class="descname">idx2_dvec</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_dvec" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray[S x DIM]</em></p>
<p>stacked index -&gt; descriptor vector (currently sift)</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_daid">
<tt class="descname">idx2_daid</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_daid" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray[S x 1]</em></p>
<p>stacked index -&gt; annot id</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_dfx">
<tt class="descname">idx2_dfx</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_dfx" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray[S x 1]</em></p>
<p>stacked index -&gt; feature index (wrt daid)</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_fweight">
<tt class="descname">idx2_fweight</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_fweight" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray[S x 1]</em></p>
<p>stacked index -&gt; feature weight</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_wxs">
<tt class="descname">idx2_wxs</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.idx2_wxs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>list</em></p>
<p>stacked index -&gt; word indexes (jagged)</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.words">
<tt class="descname">words</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.words" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray[C x DIM]</em></p>
<p>visual word centroids</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wordflann">
<tt class="descname">wordflann</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wordflann" title="Permalink to this definition">¶</a></dt>
<dd><p><em>FLANN</em></p>
<p>FLANN search structure</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_idxs">
<tt class="descname">wx2_idxs</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_idxs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of lists of ndarrays</em></p>
<p>word index -&gt; stacked indexes</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_fxs">
<tt class="descname">wx2_fxs</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_fxs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of lists of ndarrays</em></p>
<p>word index -&gt; aggregate feature indexes</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_aids">
<tt class="descname">wx2_aids</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_aids" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of ndarrays[N_c x 1]</em></p>
<p>word index -&gt; aggregate aids</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_drvecs">
<tt class="descname">wx2_drvecs</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_drvecs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of ndarrays[N_c x DIM]</em></p>
<p>word index -&gt; residual vectors</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_idf">
<tt class="descname">wx2_idf</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_idf" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of ndarrays[N_c x 1]</em></p>
<p>word index -&gt; idf (wx normalizer)</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_maws">
<tt class="descname">wx2_maws</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.wx2_maws" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of ndarrays[N_c x 1]</em></p>
<p>word index -&gt; multi-assign weights</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.daids">
<tt class="descname">daids</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.daids" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray</em></p>
<p>indexed annotation ids</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.daid2_sccw">
<tt class="descname">daid2_sccw</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.daid2_sccw" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of floats</em></p>
<p>daid -&gt; sccw (daid self-consistency weight)</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.InvertedIndex.daid2_label">
<tt class="descname">daid2_label</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.InvertedIndex.daid2_label" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dict of tuples</em></p>
<p>daid -&gt; label (name, view)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.smk.smk_index.LazyGetter">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">LazyGetter</tt><big>(</big><em>getter_func</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#LazyGetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.LazyGetter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">QueryIndex</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>QueryIndex(wx2_qrvecs, wx2_maws, wx2_qaids, wx2_qfxs, query_sccw)</p>
<dl class="method">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.query_sccw">
<tt class="descname">query_sccw</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.query_sccw" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.wx2_maws">
<tt class="descname">wx2_maws</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.wx2_maws" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.wx2_qaids">
<tt class="descname">wx2_qaids</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.wx2_qaids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.wx2_qfxs">
<tt class="descname">wx2_qfxs</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.wx2_qfxs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.smk.smk_index.QueryIndex.wx2_qrvecs">
<tt class="descname">wx2_qrvecs</tt><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.QueryIndex.wx2_qrvecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.assign_to_words_">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">assign_to_words_</tt><big>(</big><em>wordflann</em>, <em>words</em>, <em>idx2_vec</em>, <em>nAssign</em>, <em>massign_alpha</em>, <em>massign_sigma</em>, <em>massign_equal_weights</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#assign_to_words_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.assign_to_words_" title="Permalink to this definition">¶</a></dt>
<dd><p>Assigns descriptor-vectors to nearest word.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>wordflann</strong> (<em>FLANN</em>) &#8211; nearest neighbor index over words</li>
<li><strong>words</strong> (<em>ndarray</em>) &#8211; vocabulary words</li>
<li><strong>idx2_vec</strong> (<em>ndarray</em>) &#8211; descriptors to assign</li>
<li><strong>nAssign</strong> (<em>int</em>) &#8211; number of words to assign each descriptor to</li>
<li><strong>massign_alpha</strong> (<em>float</em>) &#8211; multiple-assignment ratio threshold</li>
<li><strong>massign_sigma</strong> (<em>float</em>) &#8211; multiple-assignment gaussian variance</li>
<li><strong>massign_equal_weights</strong> (<em>bool</em>) &#8211; assign equal weight to all multiassigned words</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>inverted index, multi-assigned weights, and forward index
formated as:</p>
<div class="highlight-python"><div class="highlight"><pre>* wx2_idxs - word index   -&gt; vector indexes
* wx2_maws - word index   -&gt; multi-assignment weights
* idf2_wxs - vector index -&gt; assigned word indexes
</pre></div>
</div>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals0</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span>  <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">words</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wordflann</span> <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">wordflann</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_vec</span>  <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_dvec</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nAssign</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">nAssign</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_alpha</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">massign_alpha</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_sigma</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">massign_sigma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massign_equal_weights</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">massign_equal_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_dbargs</span> <span class="o">=</span> <span class="n">wordflann</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">idx2_vec</span><span class="p">,</span> <span class="n">nAssign</span><span class="p">,</span> <span class="n">massign_alpha</span><span class="p">,</span> <span class="n">massign_sigma</span><span class="p">,</span> <span class="n">massign_equal_weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_idxs</span><span class="p">,</span> <span class="n">wx2_maws</span><span class="p">,</span> <span class="n">idx2_wxs</span> <span class="o">=</span> <span class="n">assign_to_words_</span><span class="p">(</span><span class="o">*</span><span class="n">_dbargs</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_data_internals_">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_data_internals_</tt><big>(</big><em>invindex</em>, <em>qparams</em>, <em>memtrack=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_data_internals_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_data_internals_" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: Move to module that uses smk_index</p>
<p>Builds each of the inverted index internals.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals0</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_data_internals_</span><span class="p">(</span><span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>idx2_vec = idx2_dvec
wx2_maws = _wx2_maws  # NOQA</dd>
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool
utool.rrrr()
print(utool.make_default_docstr(<a href="#id39"><span class="problematic" id="id40">smk_index.compute_data_internals_</span></a>))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_data_sccw_">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_data_sccw_</tt><big>(</big><em>idx2_daid</em>, <em>wx2_rvecs</em>, <em>wx2_aids</em>, <em>wx2_idf</em>, <em>wx2_maws</em>, <em>smk_alpha</em>, <em>smk_thresh</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_data_sccw_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_data_sccw_" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes sccw normalization scalar for the database annotations.
This is gamma from the SMK paper.
sccw is a self consistency critiron weight &#8212; a scalar which ensures
the score of K(X, X) = 1</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">daid2_sccw</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">wx2_idxs</span><span class="p">,</span> <span class="n">wx2_idf</span><span class="p">,</span> <span class="n">wx2_rvecs</span><span class="p">,</span> <span class="n">wx2_aids</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals2</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_alpha</span>  <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_alpha</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_thresh</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">smk_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_daid</span>  <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_daid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_idf</span>    <span class="o">=</span> <span class="n">wx2_idf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span>      <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">daids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_sccw</span> <span class="o">=</span> <span class="n">compute_data_sccw_</span><span class="p">(</span><span class="n">idx2_daid</span><span class="p">,</span> <span class="n">wx2_rvecs</span><span class="p">,</span> <span class="n">wx2_aids</span><span class="p">,</span> <span class="n">wx2_idf</span><span class="p">,</span> <span class="n">wx2_maws</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool; print(utool.make_default_docstr(<a href="#id41"><span class="problematic" id="id42">smk_index.compute_data_sccw_</span></a>))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_idf_label1">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_idf_label1</tt><big>(</big><em>aids_list</em>, <em>daid2_label</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_idf_label1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_idf_label1" title="Permalink to this definition">¶</a></dt>
<dd><p>One of our idf extensions
&gt;&gt;&gt; from ibeis.model.hots.smk.smk_index import *  # NOQA
&gt;&gt;&gt; from ibeis.model.hots.smk import smk_debug
&gt;&gt;&gt; ibs, annots_df, daids, qaids, invindex, wx2_idxs = smk_debug.testdata_raw_internals1()
&gt;&gt;&gt; wx_series = np.arange(len(invindex.words))
&gt;&gt;&gt; idx2_aid = invindex.idx2_daid
&gt;&gt;&gt; daid2_label = invindex.daid2_label
&gt;&gt;&gt; _ = helper_idf_wordgroup(wx2_idxs, idx2_aid, wx_series)
&gt;&gt;&gt; idxs_list, aids_list = _
&gt;&gt;&gt; wx2_idf = compute_word_idf_(wx_series, wx2_idxs, idx2_aid, daids)</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_idf_orig">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_idf_orig</tt><big>(</big><em>aids_list</em>, <em>daids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_idf_orig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_idf_orig" title="Permalink to this definition">¶</a></dt>
<dd><p>The standard tried and true idf measure</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_multiassign_weights_">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_multiassign_weights_</tt><big>(</big><em>_idx2_wx</em>, <em>_idx2_wdist</em>, <em>massign_alpha</em>, <em>massign_sigma</em>, <em>massign_equal_weights</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_multiassign_weights_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_multiassign_weights_" title="Permalink to this definition">¶</a></dt>
<dd><p>Multi Assignment Filtering from Improving Bag of Features</p>
<blockquote>
<div>vectors weight 1</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(idx2_wxs, idx2_maws)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p class="rubric">References</p>
<p>(Improving Bag of Features)
<a class="reference external" href="http://lear.inrialpes.fr/pubs/2010/JDS10a/jegou_improvingbof_preprint.pdf">http://lear.inrialpes.fr/pubs/2010/JDS10a/jegou_improvingbof_preprint.pdf</a></p>
<p>(Lost in Quantization)
<a class="reference external" href="http://www.robots.ox.ac.uk/~vgg/publications/papers/philbin08.ps.gz">http://www.robots.ox.ac.uk/~vgg/publications/papers/philbin08.ps.gz</a></p>
<p>(A Context Dissimilarity Measure for Accurate and Efficient Image Search)
<a class="reference external" href="https://lear.inrialpes.fr/pubs/2007/JHS07/jegou_cdm.pdf">https://lear.inrialpes.fr/pubs/2007/JHS07/jegou_cdm.pdf</a></p>
<p class="rubric">Notes</p>
<p>sigma values from cite{philbin_lost08}
(70 ** 2) ~= 5000,
(80 ** 2) ~= 6250,
(86 ** 2) ~= 7500,</p>
<dl class="docutils">
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool; print(utool.make_default_docstr(<a href="#id43"><span class="problematic" id="id44">smk_index.compute_multiassign_weights_</span></a>))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_negentropy_names">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_negentropy_names</tt><big>(</big><em>aids_list</em>, <em>daid2_label</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_negentropy_names"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_negentropy_names" title="Permalink to this definition">¶</a></dt>
<dd><p>One of our idf extensions
Word weighting based on the negative entropy over all names of p(n_i | word)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>negentropy_list</strong> &#8211;
idf-like weighting for each word based on the negative entropy</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray[float32]</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">wx2_idxs</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals1</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invindex</span><span class="o">.</span><span class="n">words</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_aid</span> <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_daid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_label</span> <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">daid2_label</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">helper_idf_wordgroup</span><span class="p">(</span><span class="n">wx2_idxs</span><span class="p">,</span> <span class="n">idx2_aid</span><span class="p">,</span> <span class="n">wx_series</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idxs_list</span><span class="p">,</span> <span class="n">aids_list</span> <span class="o">=</span> <span class="n">_</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Math::</dt>
<dd><p class="first">p(n_i | word) = sum_{lbl in L_i} p(lbl | word)</p>
<p>p(lbl | word) = frac{p(word | lbl) p(lbl)}{p(word)}</p>
<p>p(word) = sum_{lbl&#8217; in L} p(word | lbl&#8217;) p(lbl&#8217;)</p>
<p>p(word | lbl) = NumAnnotOfLabelWithWord / NumAnnotWithLabel =
frac{sum_{X in DB_lbl} b(word, X)}{card{DB_lbl}}</p>
<p>h(n_i | word) = -sum_{i=1}^N p(n_i | word) log p(n_i | word)</p>
<p class="last">word_weight = log(N) - h(n | word)</p>
</dd>
<dt>CommandLine:</dt>
<dd>python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL
python dev.py -t smk5 &#8211;allgt &#8211;db GZ_ALL</dd>
<dt>Auto:</dt>
<dd>python -c &#8220;import utool; utool.print_auto_docstr(&#8216;ibeis.model.hots.smk.smk_index&#8217;, &#8216;compute_negentropy_names&#8217;)&#8221;</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_residuals_">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_residuals_</tt><big>(</big><em>words</em>, <em>wx2_idxs</em>, <em>wx2_maws</em>, <em>idx2_vec</em>, <em>idx2_aid</em>, <em>idx2_fx</em>, <em>aggregate</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_residuals_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_residuals_" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes residual vectors based on worwx2_fxs d assignments
returns mapping from word index to a set of residual vectors</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><dl class="docutils">
<dt>(wx2_rvecs, wx2_aids, wx2_fxs, wx2_maws) formatted as::</dt>
<dd><ul class="first last simple">
<li>wx2_rvecs - [ ... [ rvec_i1, ...,  rvec_Mi ]_i ... ]</li>
<li>wx2_aids  - [ ... [  aid_i1, ...,   aid_Mi ]_i ... ]</li>
<li>wx2_fxs   - [ ... [[fxs]_i1, ..., [fxs]_Mi ]_i ... ]</li>
</ul>
</dd>
</dl>
<p>For every word:</p>
<div class="highlight-python"><div class="highlight"><pre>* list of aggvecs
* For every aggvec:
    * one parent aid, if aggregate is False: assert isunique(aids)
    * list of parent fxs, if aggregate is True: assert len(fxs) == 1
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">wx2_idxs</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals1</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span>     <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">words</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_aid</span>  <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_daid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_fx</span>   <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_dfx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_vec</span>  <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_dvec</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aggregate</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span><span class="o">.</span><span class="n">aggregate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_rvecs</span><span class="p">,</span> <span class="n">wx2_aids</span><span class="p">,</span> <span class="n">wx2_fxs</span><span class="p">,</span> <span class="n">wx2_maws</span> <span class="o">=</span> <span class="n">compute_residuals_</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">wx2_idxs</span><span class="p">,</span> <span class="n">wx2_maws</span><span class="p">,</span> <span class="n">idx2_vec</span><span class="p">,</span> <span class="n">idx2_aid</span><span class="p">,</span> <span class="n">idx2_fx</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool; print(utool.make_default_docstr(<a href="#id45"><span class="problematic" id="id46">smk_index.compute_residuals_</span></a>))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.compute_word_idf_">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">compute_word_idf_</tt><big>(</big><em>wx_series</em>, <em>wx2_idxs</em>, <em>idx2_aid</em>, <em>daids</em>, <em>daid2_label=None</em>, <em>vocab_weighting='idf'</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#compute_word_idf_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.compute_word_idf_" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the inverse-document-frequency weighting for each word</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">wx2_idf</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">wx2_idxs</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_raw_internals1</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invindex</span><span class="o">.</span><span class="n">words</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx2_aid</span> <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">idx2_daid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_label</span> <span class="o">=</span> <span class="n">invindex</span><span class="o">.</span><span class="n">daid2_label</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wx2_idf</span> <span class="o">=</span> <span class="n">compute_word_idf_</span><span class="p">(</span><span class="n">wx_series</span><span class="p">,</span> <span class="n">wx2_idxs</span><span class="p">,</span> <span class="n">idx2_aid</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">wx2_idf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(8000,)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>#&gt;&gt;&gt; wx2_idxs = invindex.wx2_idxs</dd>
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool; print(utool.make_default_docstr(<a href="#id47"><span class="problematic" id="id48">smk_index.compute_word_idf_</span></a>))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.helper_aggregate_residuals">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">helper_aggregate_residuals</tt><big>(</big><em>rvecs_list</em>, <em>idxs_list</em>, <em>aids_list</em>, <em>idx2_fx</em>, <em>wx_sublist</em>, <em>wx2_maws</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#helper_aggregate_residuals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.helper_aggregate_residuals" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function: Aggregate over words of the same aid</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.helper_idf_wordgroup">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">helper_idf_wordgroup</tt><big>(</big><em>wx2_idxs</em>, <em>idx2_aid</em>, <em>wx_series</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#helper_idf_wordgroup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.helper_idf_wordgroup" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.index_data_annots">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">index_data_annots</tt><big>(</big><em>annots_df</em>, <em>daids</em>, <em>words</em>, <em>qparams</em>, <em>with_internals=True</em>, <em>memtrack=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#index_data_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.index_data_annots" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: Move to module that uses smk_index</p>
<p>Builds the initial inverted index from a dataframe, daids, and words.
Optionally builds the internals of the inverted structure</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">invindex</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_words</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qparams</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_internals</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invindex</span> <span class="o">=</span> <span class="n">index_data_annots</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">qparams</span><span class="p">,</span> <span class="n">with_internals</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>#&gt;&gt;&gt; print(utool.hashstr(repr(list(invindex.__dict__.values()))))
#v8+i5i8+55j0swio</dd>
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool
utool.rrrr()
print(utool.make_default_docstr(smk_index.index_data_annots))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.learn_visual_words">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">learn_visual_words</tt><big>(</big><em>annots_df</em>, <em>taids</em>, <em>nWords</em>, <em>use_cache=True</em>, <em>memtrack=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#learn_visual_words"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.learn_visual_words" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes and caches visual words</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">words</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">taids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">nWords</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_dataframe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">words</span> <span class="o">=</span> <span class="n">learn_visual_words</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">taids</span><span class="p">,</span> <span class="n">nWords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(8000, 128)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool
argdoc = utool.make_default_docstr(smk_index.learn_visual_words)
print(argdoc)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.make_annot_df">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">make_annot_df</tt><big>(</big><em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#make_annot_df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.make_annot_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a pandas like DataFrame interface to an IBEISController</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">annots_df</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_ibeis</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">annots_df</span> <span class="o">=</span> <span class="n">make_annot_df</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">hashstr</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">annots_df</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
<span class="go">j12n+x93m4c!4un3</span>
</pre></div>
</div>
<p>#&gt;&gt;&gt; from ibeis.model.hots.smk import smk_debug
#&gt;&gt;&gt; smk_debug.rrr()
#&gt;&gt;&gt; smk_debug.check_dtype(annots_df)</p>
<dl class="docutils">
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool
argdoc = utool.make_default_docstr(smk_index.make_annot_df)
print(argdoc)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_index.new_qindex">
<tt class="descclassname">ibeis.model.hots.smk.smk_index.</tt><tt class="descname">new_qindex</tt><big>(</big><em>annots_df</em>, <em>qaid</em>, <em>invindex</em>, <em>qparams</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_index.html#new_qindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_index.new_qindex" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: Move to module that uses smk_index</p>
<p>Gets query read for computations</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>annots_df</strong> (<em>DataFrameProxy</em>) &#8211; pandas-like data interface</li>
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation id</li>
<li><strong>invindex</strong> (<em>InvertedIndex</em>) &#8211; inverted index object</li>
<li><strong>qparams</strong> (<em>QueryParams</em>) &#8211; query parameters object</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">named tuple containing query information</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">qindex</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">invindex</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_query_repr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qparams</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">smk_cfg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qindex</span> <span class="o">=</span> <span class="n">new_qindex</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">wx2_qrvecs</span><span class="p">,</span> <span class="n">wx2_qmaws</span><span class="p">,</span> <span class="n">wx2_qaids</span><span class="p">,</span> <span class="n">wx2_qfxs</span><span class="p">,</span> <span class="n">query_sccw</span><span class="p">)</span> <span class="o">=</span> <span class="n">qindex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">check_wx2_rvecs</span><span class="p">(</span><span class="n">wx2_qrvecs</span><span class="p">),</span> <span class="s">&#39;has nan&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">invindex_dbgstr</span><span class="o">.</span><span class="n">invindex_dbgstr</span><span class="p">(</span><span class="n">invindex</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore::</dt>
<dd>idx2_vec = qfx2_vec
idx2_aid = qfx2_aid
idx2_fx  = qfx2_qfx
wx2_idxs = _wx2_qfxs
wx2_maws = _wx2_maws</dd>
<dt>Auto:</dt>
<dd>from ibeis.model.hots.smk import smk_index
import utool
utool.rrrr()
print(utool.make_default_docstr(smk_index.new_qindex))</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.smk.smk_internal">
<span id="ibeis-model-hots-smk-smk-internal-module"></span><h2>ibeis.model.hots.smk.smk_internal module<a class="headerlink" href="#module-ibeis.model.hots.smk.smk_internal" title="Permalink to this headline">¶</a></h2>
<p>The real core of the smk_algorithm
The smk_core module was getting crowded so I made smk_internal</p>
<dl class="function">
<dt id="ibeis.model.hots.smk.smk_internal.apply_weights">
<tt class="descclassname">ibeis.model.hots.smk.smk_internal.</tt><tt class="descname">apply_weights</tt><big>(</big><em>simmat_list</em>, <em>qmaws_list</em>, <em>dmaws_list</em>, <em>idf_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_internal.html#apply_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_internal.apply_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Applys multi-assign weights and idf weights to rvec similarty matrices</p>
<p>TODO: Maybe should apply the sccw weights too?</p>
<p>Accounts for rvecs being stored as int8&#8217;s</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_internal</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simmat_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">dmaws_list</span><span class="p">,</span> <span class="n">idf_list</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_apply_weights</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wsim_list</span> <span class="o">=</span> <span class="n">apply_weights</span><span class="p">(</span><span class="n">simmat_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">dmaws_list</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_internal.score_matches">
<tt class="descclassname">ibeis.model.hots.smk.smk_internal.</tt><tt class="descname">score_matches</tt><big>(</big><em>qrvecs_list</em>, <em>drvecs_list</em>, <em>qmaws_list</em>, <em>dmaws_list</em>, <em>smk_alpha</em>, <em>smk_thresh</em>, <em>idf_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_internal.html#score_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_internal.score_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Similarity + Selectivity: M(X_c, Y_c)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qrvecs_list</strong> &#8211; query vectors for each word</li>
<li><strong>drvecs_list</strong> &#8211; database vectors for each word</li>
<li><strong>qmaws_list</strong> &#8211; multi assigned weights for each query word</li>
<li><strong>dmaws_list</strong> &#8211; multi assigned weights for each database word</li>
<li><strong>smk_alpha</strong> &#8211; selectivity power</li>
<li><strong>smk_thresh</strong> &#8211; selectivity smk_thresh</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">score matrix</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_internal</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_alpha</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_thresh</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qrvecs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">smk_debug</span><span class="o">.</span><span class="n">get_test_rvecs</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">drvecs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">smk_debug</span><span class="o">.</span><span class="n">get_test_rvecs</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qmaws_list</span>  <span class="o">=</span> <span class="p">[</span><span class="n">smk_debug</span><span class="o">.</span><span class="n">get_test_maws</span><span class="p">(</span><span class="n">rvecs</span><span class="p">)</span> <span class="k">for</span> <span class="n">rvecs</span> <span class="ow">in</span> <span class="n">qrvecs_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dmaws_list</span>  <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rvecs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">hstypes</span><span class="o">.</span><span class="n">FLOAT_TYPE</span><span class="p">)</span> <span class="k">for</span> <span class="n">rvecs</span> <span class="ow">in</span> <span class="n">qrvecs_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idf_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">qrvecs_list</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scores_list</span> <span class="o">=</span> <span class="n">score_matches</span><span class="p">(</span><span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">drvecs_list</span><span class="p">,</span> <span class="n">qmaws_list</span><span class="p">,</span> <span class="n">dmaws_list</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span><span class="p">,</span> <span class="n">idf_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_internal.selectivity_function">
<tt class="descclassname">ibeis.model.hots.smk.smk_internal.</tt><tt class="descname">selectivity_function</tt><big>(</big><em>wsim_list</em>, <em>smk_alpha</em>, <em>smk_thresh</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_internal.html#selectivity_function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_internal.selectivity_function" title="Permalink to this definition">¶</a></dt>
<dd><p>Selectivity function - sigma from SMK paper rscore = residual score</p>
<blockquote>
<div><p>Downweights weak matches using power law normalization and thresholds
anybody that is too weak</p>
<dl class="docutils">
<dt>Example:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">smk_debug</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wsim_list</span><span class="p">,</span> <span class="n">smk_alpha</span><span class="p">,</span> <span class="n">smk_thresh</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_selectivity_function</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt>Timeits:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utool</span><span class="o">.</span><span class="n">util_dev</span><span class="o">.</span><span class="n">rrr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setup</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;&#39;&#39;</span>
<span class="go">        import numpy as np</span>
<span class="go">        import scipy.sparse as spsparse</span>
<span class="go">        from ibeis.model.hots.smk import smk_debug</span>
<span class="go">        np.random.seed(0)</span>
<span class="go">        wsim_list, smk_alpha, smk_thresh = smk_debug.testdata_selectivity_function()</span>
<span class="go">        scores_iter = [</span>
<span class="go">            np.multiply(np.sign(mawmat), np.power(np.abs(mawmat), smk_alpha))</span>
<span class="go">            for mawmat in wsim_list</span>
<span class="go">        ]</span>
<span class="go">        &#39;&#39;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt_list</span> <span class="o">=</span> <span class="n">utool</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;&#39;&#39;</span>
<span class="go">        scores_list0 = [np.multiply(scores, np.greater(scores, smk_thresh)) for scores in scores_iter]</span>
<span class="go">        scores_list1 = [spsparse.coo_matrix(np.multiply(scores, np.greater(scores, smk_thresh))) for scores in scores_iter]</span>
<span class="go">        scores_list2 = [spsparse.dok_matrix(np.multiply(scores, np.greater(scores, smk_thresh))) for scores in scores_iter]</span>
<span class="go">        scores_list3 = [spsparse.lil_matrix(np.multiply(scores, np.greater(scores, smk_thresh))) for scores in scores_iter]</span>
<span class="go">        &#39;&#39;&#39;</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span>
</pre></div>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>&#8216;)</dt>
<dd><div class="first highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">utool</span><span class="o">.</span><span class="n">util_dev</span><span class="o">.</span><span class="n">timeit_compare</span><span class="p">(</span><span class="n">stmt_list</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1E4</span><span class="p">))</span>
</pre></div>
</div>
<p class="last">scores0 = scores_list0[-1]
scores1 = scores_list1[-1]
scores2 = scores_list2[-1]
scores3 = scores_list3[-1]
%timeit scores0.sum()
%timeit scores1.sum()
%timeit scores2.sum()
%timeit scores3.sum()</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_internal.similarity_function">
<tt class="descclassname">ibeis.model.hots.smk.smk_internal.</tt><tt class="descname">similarity_function</tt><big>(</big><em>qrvecs_list</em>, <em>drvecs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_internal.html#similarity_function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_internal.similarity_function" title="Permalink to this definition">¶</a></dt>
<dd><p>Phi dot product. Accounts for NaN residual vectors
qrvecs_list list of rvecs for each word</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_internal</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">drvecs_list</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_similarity_function</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simmat_list</span> <span class="o">=</span> <span class="n">similarity_function</span><span class="p">(</span><span class="n">qrvecs_list</span><span class="p">,</span> <span class="n">drvecs_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.smk.smk_match">
<span id="ibeis-model-hots-smk-smk-match-module"></span><h2>ibeis.model.hots.smk.smk_match module<a class="headerlink" href="#module-ibeis.model.hots.smk.smk_match" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.smk.smk_match.execute_smk_L3">
<tt class="descclassname">ibeis.model.hots.smk.smk_match.</tt><tt class="descname">execute_smk_L3</tt><big>(</big><em>annots_df</em>, <em>qaid</em>, <em>invindex</em>, <em>qparams</em>, <em>withinfo=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_match.html#execute_smk_L3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_match.execute_smk_L3" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a single smk query</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_match</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_internals_full</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qparams</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withinfo</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_totalscore</span><span class="p">,</span> <span class="n">daid2_chipmatch</span> <span class="o">=</span> <span class="n">execute_smk_L3</span><span class="p">(</span><span class="n">annots_df</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qparams</span><span class="p">,</span> <span class="n">withinfo</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_match.execute_smk_L4">
<tt class="descclassname">ibeis.model.hots.smk.smk_match.</tt><tt class="descname">execute_smk_L4</tt><big>(</big><em>annots_df</em>, <em>qaids</em>, <em>invindex</em>, <em>qparams</em>, <em>withinfo</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_match.html#execute_smk_L4"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_match.execute_smk_L4" title="Permalink to this definition">¶</a></dt>
<dd><p>Loop over execute_smk_L3</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python dev.py -t smk &#8211;allgt &#8211;db PZ_Mothers &#8211;index 1:3 &#8211;noqcache &#8211;va &#8211;vf</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_match.execute_smk_L5">
<tt class="descclassname">ibeis.model.hots.smk.smk_match.</tt><tt class="descname">execute_smk_L5</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_match.html#execute_smk_L5"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_match.execute_smk_L5" title="Permalink to this definition">¶</a></dt>
<dd><p>ibeis query interface</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk.smk_match</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_match</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.smk</span> <span class="kn">import</span> <span class="n">smk_debug</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">annots_df</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">invindex</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">smk_debug</span><span class="o">.</span><span class="n">testdata_internals_full</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_scores</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">smk_match</span><span class="o">.</span><span class="n">execute_smk_L5</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Dev::</dt>
<dd>from ibeis.model.hots import pipeline
filt2_meta = {}
# Get both spatial verified and not
<a href="#id49"><span class="problematic" id="id50">qaid2_chipmatch_FILT_</span></a> = qaid2_chipmatch
<a href="#id51"><span class="problematic" id="id52">qaid2_chipmatch_SVER_</span></a> = pipeline.spatial_verification(<a href="#id53"><span class="problematic" id="id54">qaid2_chipmatch_FILT_</span></a>, <a href="#id55"><span class="problematic" id="id56">qreq_</span></a>)
<a href="#id57"><span class="problematic" id="id58">qaid2_qres_FILT_</span></a> = pipeline.chipmatch_to_resdict(<a href="#id59"><span class="problematic" id="id60">qaid2_chipmatch_FILT_</span></a>, filt2_meta, <a href="#id61"><span class="problematic" id="id62">qreq_</span></a>)
<a href="#id63"><span class="problematic" id="id64">qaid2_qres_SVER_</span></a> = pipeline.chipmatch_to_resdict(<a href="#id65"><span class="problematic" id="id66">qaid2_chipmatch_SVER_</span></a>, filt2_meta, <a href="#id67"><span class="problematic" id="id68">qreq_</span></a>)
qres_FILT = qaid2_qres_FILT_[qaids[0]]
qres_SVER = qaid2_qres_SVER_[qaids[0]]
fig1 = qres_FILT.show_top(ibs, fnum=1, figtitle=&#8217;filt&#8217;)
fig2 = qres_SVER.show_top(ibs, fnum=2, figtitle=&#8217;sver&#8217;)
fig1.show()
fig2.show()</dd>
<dt>CommandLine::</dt>
<dd><p class="first">python -m memory_profiler dev.py &#8211;db PZ_Mothers -t smk2 &#8211;allgt &#8211;index 0
python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL
python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL
python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL &#8211;index 2:10 &#8211;vf &#8211;va
python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL &#8211;index 2:10 &#8211;vf &#8211;va &#8211;print-cfgstr
python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL &#8211;index 2:20 &#8211;vf &#8211;va
python dev.py -t smk2 &#8211;allgt &#8211;db GZ_ALL &#8211;noqcache &#8211;index 2:20 &#8211;va &#8211;vf
python dev.py -t smk2 &#8211;allgt &#8211;db PZ_Master0 &amp;&amp; python dev.py -t smk3 &#8211;allgt &#8211;db PZ_Master0
python dev.py -t smk2 &#8211;allgt &#8211;db PZ_Master0 &#8211;index 2:10 &#8211;va
python dev.py -t smk2 &#8211;allgt &#8211;db PZ_Mothers &#8211;index 20:30
python dev.py -t smk2 &#8211;allgt &#8211;db PZ_Mothers &#8211;noqcache &#8211;index 18:20 &#8211;super-strict &#8211;va
python dev.py -t smk2 &#8211;db PZ_Master0 &#8211;qaid 7199 &#8211;va &#8211;quality &#8211;vf &#8211;noqcache
python dev.py -t smk3 &#8211;allgt &#8211;db GZ_ALL &#8211;index 2:10 &#8211;vf &#8211;va
python dev.py -t smk5 &#8211;allgt &#8211;db PZ_Master0 &#8211;noqcache ; python dev.py -t smk5 &#8211;allgt &#8211;db GZ_ALL &#8211;noqcache
python dev.py -t smkd &#8211;allgt &#8211;db PZ_Mothers &#8211;index 1:3 &#8211;va &#8211;quality &#8211;vf &#8211;noqcache</p>
<p class="last">python dev.py -t smk_8k &#8211;allgt &#8211;db PZ_Mothers &#8211;index 20:30 &#8211;va &#8211;vf
python dev.py -t smk_8k &#8211;allgt &#8211;db PZ_Mothers &#8211;index 20:30 &#8211;echo-hardcase
python dev.py -t smk_8k &#8211;allgt &#8211;db PZ_Mothers &#8211;index 20:30 &#8211;vh
python dev.py -t smk_8k_compare &#8211;allgt &#8211;db PZ_Mothers &#8211;index 20:30 &#8211;view-hard</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.smk_match.prepare_qreq">
<tt class="descclassname">ibeis.model.hots.smk.smk_match.</tt><tt class="descname">prepare_qreq</tt><big>(</big><em>qreq_</em>, <em>annots_df</em>, <em>memtrack</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk/smk_match.html#prepare_qreq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.smk_match.prepare_qreq" title="Permalink to this definition">¶</a></dt>
<dd><p>Called if pipeline did not setup qreq correctly</p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.smk">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ibeis.model.hots.smk" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.smk.reload_subs">
<tt class="descclassname">ibeis.model.hots.smk.</tt><tt class="descname">reload_subs</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/smk.html#reload_subs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.smk.reload_subs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads smk and submodules</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.smk.rrrr">
<tt class="descclassname">ibeis.model.hots.smk.</tt><tt class="descname">rrrr</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.smk.rrrr" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads smk and submodules</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ibeis.model.hots.smk package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#ibeis-model-hots-smk-grave-module">ibeis.model.hots.smk._grave module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.smk.smk_core">ibeis.model.hots.smk.smk_core module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.smk.smk_debug">ibeis.model.hots.smk.smk_debug module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.smk.smk_index">ibeis.model.hots.smk.smk_index module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.smk.smk_internal">ibeis.model.hots.smk.smk_internal module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.smk.smk_match">ibeis.model.hots.smk.smk_match module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.smk">Module contents</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ibeis.model.hots.html"
                        title="previous chapter">ibeis.model.hots package</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ibeis.model.preproc.html"
                        title="next chapter">ibeis.model.preproc package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ibeis.model.hots.smk.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ibeis.model.preproc.html" title="ibeis.model.preproc package"
             >next</a> |</li>
        <li class="right" >
          <a href="ibeis.model.hots.html" title="ibeis.model.hots package"
             >previous</a> |</li>
        <li><a href="index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="ibeis.html" >ibeis package</a> &raquo;</li>
          <li><a href="ibeis.model.html" >ibeis.model package</a> &raquo;</li>
          <li><a href="ibeis.model.hots.html" >ibeis.model.hots package</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jon Crall.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>