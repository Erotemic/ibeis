<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ibeis.model.hots package &mdash; ibeis 0.1.0.dev1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ibeis 0.1.0.dev1 documentation" href="index.html" />
    <link rel="up" title="ibeis.model package" href="ibeis.model.html" />
    <link rel="next" title="ibeis.model.hots.smk package" href="ibeis.model.hots.smk.html" />
    <link rel="prev" title="ibeis.model.detect package" href="ibeis.model.detect.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ibeis.model.hots.smk.html" title="ibeis.model.hots.smk package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ibeis.model.detect.html" title="ibeis.model.detect package"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="ibeis.html" >ibeis package</a> &raquo;</li>
          <li><a href="ibeis.model.html" accesskey="U">ibeis.model package</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ibeis-model-hots-package">
<h1>ibeis.model.hots package<a class="headerlink" href="#ibeis-model-hots-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="ibeis.model.hots.smk.html">ibeis.model.hots.smk package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_core">ibeis.model.hots.smk.smk_core module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_debug">ibeis.model.hots.smk.smk_debug module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_index">ibeis.model.hots.smk.smk_index module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_match">ibeis.model.hots.smk.smk_match module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_plots">ibeis.model.hots.smk.smk_plots module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_repr">ibeis.model.hots.smk.smk_repr module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_residuals">ibeis.model.hots.smk.smk_residuals module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.smk_scoring">ibeis.model.hots.smk.smk_scoring module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk.tmp">ibeis.model.hots.smk.tmp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibeis.model.hots.smk.html#module-ibeis.model.hots.smk">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ibeis.model.hots._neighbor_experiment">
<span id="ibeis-model-hots-neighbor-experiment-module"></span><h2>ibeis.model.hots._neighbor_experiment module<a class="headerlink" href="#module-ibeis.model.hots._neighbor_experiment" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots._neighbor_experiment.augment_nnindexer_experiment">
<tt class="descclassname">ibeis.model.hots._neighbor_experiment.</tt><tt class="descname">augment_nnindexer_experiment</tt><big>(</big><em>update=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_neighbor_experiment.html#augment_nnindexer_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._neighbor_experiment.augment_nnindexer_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>python -c &#8220;import utool; print(utool.auto_docstr(&#8216;ibeis.model.hots.neighbor_index&#8217;, &#8216;augment_nnindexer_experiment&#8217;))&#8221;</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>utprof.py -m ibeis.model.hots.neighbor_index &#8211;test-augment_nnindexer_experiment
python -m ibeis.model.hots.neighbor_index &#8211;test-augment_nnindexer_experiment</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--show&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">update</span> <span class="o">=</span> <span class="n">show</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">augment_nnindexer_experiment</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">show</span><span class="p">:</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="gp">... </span>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._neighbor_experiment.flann_add_time_experiment">
<tt class="descclassname">ibeis.model.hots._neighbor_experiment.</tt><tt class="descname">flann_add_time_experiment</tt><big>(</big><em>update=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_neighbor_experiment.html#flann_add_time_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._neighbor_experiment.flann_add_time_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>builds plot of number of annotations vs indexer build time.</p>
<p>TODO: time experiment</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-flann_add_time_experiment
utprof.py -m ibeis.model.hots.neighbor_index &#8211;test-flann_add_time_experiment</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#ibs = ibeis.opendb(&#39;PZ_MTEST&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">update</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">flann_add_time_experiment</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">#&gt;&gt;&gt; ibeis.main_loop({&#39;ibs&#39;: ibs, &#39;back&#39;: None})</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._neighbor_experiment.subindexer_time_experiment">
<tt class="descclassname">ibeis.model.hots._neighbor_experiment.</tt><tt class="descname">subindexer_time_experiment</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_neighbor_experiment.html#subindexer_time_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._neighbor_experiment.subindexer_time_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>builds plot of number of annotations vs indexer build time.</p>
<p>TODO: time experiment</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._neighbor_experiment.test_incremental_add">
<tt class="descclassname">ibeis.model.hots._neighbor_experiment.</tt><tt class="descname">test_incremental_add</tt><big>(</big><em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_neighbor_experiment.html#test_incremental_add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._neighbor_experiment.test_incremental_add" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-test_incremental_add</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">test_incremental_add</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots._pipeline_helpers">
<span id="ibeis-model-hots-pipeline-helpers-module"></span><h2>ibeis.model.hots._pipeline_helpers module<a class="headerlink" href="#module-ibeis.model.hots._pipeline_helpers" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots._pipeline_helpers.assert_qaid2_chipmatch">
<tt class="descclassname">ibeis.model.hots._pipeline_helpers.</tt><tt class="descname">assert_qaid2_chipmatch</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatch</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_pipeline_helpers.html#assert_qaid2_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._pipeline_helpers.assert_qaid2_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs consistency check</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._pipeline_helpers.get_pipeline_testdata">
<tt class="descclassname">ibeis.model.hots._pipeline_helpers.</tt><tt class="descname">get_pipeline_testdata</tt><big>(</big><em>dbname=None</em>, <em>cfgdict={}</em>, <em>qaid_list=None</em>, <em>daid_list=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_pipeline_helpers.html#get_pipeline_testdata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._pipeline_helpers.get_pipeline_testdata" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">_pipeline_helpers</span> <span class="k">as</span> <span class="n">plh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pipeline_root</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">,</span> <span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._pipeline_helpers.identity_filter">
<tt class="descclassname">ibeis.model.hots._pipeline_helpers.</tt><tt class="descname">identity_filter</tt><big>(</big><em>qreq_</em>, <em>qaid2_nns</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_pipeline_helpers.html#identity_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._pipeline_helpers.identity_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>testing function returns unfiltered nearest neighbors
this does check that you are not matching yourself</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._pipeline_helpers.print_nearest_neighbor_assignments">
<tt class="descclassname">ibeis.model.hots._pipeline_helpers.</tt><tt class="descname">print_nearest_neighbor_assignments</tt><big>(</big><em>qvecs_list</em>, <em>nns_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_pipeline_helpers.html#print_nearest_neighbor_assignments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._pipeline_helpers.print_nearest_neighbor_assignments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots._pipeline_helpers.testrun_pipeline_upto">
<tt class="descclassname">ibeis.model.hots._pipeline_helpers.</tt><tt class="descname">testrun_pipeline_upto</tt><big>(</big><em>qreq_</em>, <em>stop_node=None</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/_pipeline_helpers.html#testrun_pipeline_upto"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots._pipeline_helpers.testrun_pipeline_upto" title="Permalink to this definition">¶</a></dt>
<dd><p>convinience: runs pipeline for tests
this should mirror request_ibeis_query_L0</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_func_sourcecode</span><span class="p">(</span><span class="n">request_ibeis_query_L0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stripsource</span> <span class="o">=</span> <span class="n">source</span><span class="p">[:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stripsource</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">strip_line_comments</span><span class="p">(</span><span class="n">stripsource</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">triplequote1</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">TRIPLE_DOUBLE_QUOTE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">triplequote2</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">TRIPLE_SINGLE_QUOTE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docstr_regex1</span> <span class="o">=</span> <span class="s">&#39;r?&#39;</span> <span class="o">+</span> <span class="n">triplequote1</span> <span class="o">+</span> <span class="s">&#39;.* + &#39;</span> <span class="o">+</span> <span class="n">triplequote1</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docstr_regex2</span> <span class="o">=</span> <span class="s">&#39;r?&#39;</span> <span class="o">+</span> <span class="n">triplequote2</span> <span class="o">+</span> <span class="s">&#39;.* + &#39;</span> <span class="o">+</span> <span class="n">triplequote2</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stripsource</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">regex_replace</span><span class="p">(</span><span class="n">docstr_regex1</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">stripsource</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stripsource</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">regex_replace</span><span class="p">(</span><span class="n">docstr_regex2</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">stripsource</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stripsource</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">strip_line_comments</span><span class="p">(</span><span class="n">stripsource</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">stripsource</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.automated_helpers">
<span id="ibeis-model-hots-automated-helpers-module"></span><h2>ibeis.model.hots.automated_helpers module<a class="headerlink" href="#module-ibeis.model.hots.automated_helpers" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Idea:</dt>
<dd>what about the probability of a descriptor match being a score like in SIFT.
we can learn that too.</dd>
<dt>Have:</dt>
<dd><ul class="first simple">
<li>semantic and visual uuids</li>
<li>Test that accepts unknown annotations one at a time and
for each runs query, makes decision about name, and executes decision.</li>
<li>As a placeholder for exemplar decisions  an exemplar is added if
number of exemplars per name is less than threshold.</li>
<li>vs-one reranking query mode</li>
<li>test harness but start with larger test set</li>
<li>vs-one score normalizer ~~/ score normalizer for different values of K * / different params~~
vs-many score normalization doesnt actually matter. We just need the ranking.</li>
<li>need to add in the multi-indexer code into the pipeline. Need to
decide which subindexers to load given a set of daids</li>
<li>need to use set query as an exemplar if its vs-one reranking scores
are below a threshold</li>
<li>flip the vsone ratio score so its &lt; .8 rather than &gt; 1.2 or whatever</li>
<li>start from nothing and let the system make the first few decisions correctly</li>
<li>tell me the correct answer in the automated test</li>
<li>turn on multi-indexing. (should just work..., probably bugs though. Just need to throw the switch)</li>
<li>paramater to only add exemplar if post-normlized score is above a threshold</li>
<li>ensure vsone ratio test is happening correctly</li>
<li>normalization gets a cfgstr based on the query</li>
<li>need to allow for scores to be un-invalidatd post spatial verification
e.g. when the first match initially is invalidated through
spatial verification but the next matches survive.</li>
<li>keep distinctiveness weights from vsmany for vsone weighting
basically involves keeping weights from different filters and not
aggregating match weights until the end.</li>
<li>Put test query mode into the main application and work on the interface for it.</li>
<li>add matches to multiple animals (merge)</li>
<li>update normalizer (have setup the datastructure to allow for it need to integrate it seemlessly)</li>
<li>score normalization update. on add the new support data, reapply bayes</li>
</ul>
<blockquote>
<div>rule, and save to the current cache for a given algorithm configuration.</div></blockquote>
<ul class="last simple">
<li>spawn background process to reindex chunks of data</li>
</ul>
</dd>
<dt>TODO:</dt>
<dd><ul class="first last simple">
<li>Improve vsone scoring.</li>
<li>test case where there is a 360 view that is linkable from the tests case</li>
<li>~~Remember name_confidence of decisions for manual review~~ Defer</li>
</ul>
</dd>
</dl>
<p>Tasks:</p>
<blockquote>
<div><dl class="docutils">
<dt>Algorithm::</dt>
<dd><blockquote class="first">
<div><ul>
<li><dl class="first docutils">
<dt>Incremental query needs to handle</dt>
<dd><ul class="first last">
<li><p class="first">test mode and live mode</p>
</li>
<li><p class="first">normalizer update</p>
</li>
<li><p class="first">use correct distinctivenes score in vsone</p>
</li>
<li><dl class="first docutils">
<dt>tested application of distinctiveness, foreground, ratio,</dt>
<dd><p class="first last">spatial_verification, vsone verification, and score
normalization.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Mathematically formal description of the space of choices</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>getting the proability of each choice will give us a much better</dt>
<dd><p class="first last">confidence measure for our decision. An example of a probability
partition might be .2 - merge with rank1.  .2 merge with rank 2, .5
merge with rank1 and rank2, .1 others</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Improved automated exemplar decision mechanism</p>
</li>
<li><p class="first">Improved automated name decision mechanism</p>
</li>
</ul>
</div></blockquote>
<dl class="last docutils">
<dt>SQL::</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>New Image Columns</dt>
<dd><ul class="first last simple">
<li>image_posix_timedelta</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New Name Columns</dt>
<dd><ul class="first last simple">
<li>name_temp_flag</li>
<li>name_alias_text</li>
<li>name_uuid</li>
<li>name_visual_uuid</li>
<li>name_member_annot_rowids_evalstr</li>
<li>name_member_num_annot_rowids</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New Encounter Columns</dt>
<dd><ul class="first last simple">
<li>encounter_start_time</li>
<li>encounter_end_time</li>
<li>encounter_lat</li>
<li>encounter_lon</li>
<li>encounter_processed_flag</li>
<li>encounter_shipped_flag</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd>
<dt>Decision UIs::</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Query versus top N results</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>ability to draw an undirected edge between the query and any number of</dt>
<dd><p class="first last">results. ie create a match any of the top results</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>a match to more than one results should by default merge the two names</dt>
<dd><p class="first last">(this involves a name enhancement subtask). trigger a split / merge dialog</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Is Exemplar</dt>
<dd><ul class="first last simple">
<li>allows for user to set the exemplars for a given name</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Name Progress</dt>
<dd><ul class="first last simple">
<li>Shows the current name matching progress</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Split</dt>
<dd><ul class="first last simple">
<li>Allows a user to split off some images from a name into a new name
or some other name.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Merge</dt>
<dd><ul class="first last simple">
<li>Allows a user to join two names.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>GUI::</dt>
<dd><ul class="first last">
<li><p class="first">NameTree needs to not refresh unless absolutely necessary</p>
</li>
<li><p class="first">Time Sync</p>
</li>
<li><p class="first">Encounter metadata sync from the SMART</p>
</li>
<li><dl class="first docutils">
<dt>Hide shipped encounters</dt>
<dd><ul class="first last simple">
<li>put flag to turn them on</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Mark processed encounters</p>
</li>
<li><dl class="first docutils">
<dt>Gui naturally ensures that all annotations in the query belong</dt>
<dd><p class="first last">to the same species</p>
</dd>
</dl>
</li>
<li><p class="first">Garbage collection function that removes all non-exemplar
information from encounters that have been shipped.</p>
</li>
<li><p class="first">Spawn process that reindexes large chunks of descriptors as the
database grows.</p>
</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p>LONG TERM TASKS:</p>
<blockquote>
<div><dl class="docutils">
<dt>Architecture:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Pipeline needs</dt>
<dd><ul class="first last simple">
<li>DEFER: a move from dict based representation to list based</li>
<li>DEFER: spatial verification cyth speedup</li>
<li>DEFER: nearest neighbor (based on visual uuid caching) caching</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Controller:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>LONGTERM: AutogenController</dt>
<dd><ul class="first last simple">
<li>register data convertors for verts / other eval columns. Make
several convertors standard and we can tag those columns to
autogenerate their functions.</li>
<li>be able to mark a column as determined by the aggregate of other
columns. Then the data is either generated on the fly, or it is
cached and the necessary book-keeping functions are
autogenerated.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Decision UIs::</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Is Exemplar</dt>
<dd><ul class="first last simple">
<li>LONG TERM: it would be cool if they were visualized by using
networkx or some gephi like program and clustered by match score.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.add_annot_chunk">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">add_annot_chunk</tt><big>(</big><em>ibs_gt</em>, <em>ibs2</em>, <em>aids_chunk1</em>, <em>aid1_to_aid2</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#add_annot_chunk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.add_annot_chunk" title="Permalink to this definition">¶</a></dt>
<dd><p>adds annotations to the tempoarary database and prevents duplicate
additions.</p>
<p>aids_chunk1 = aid_list1</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">aids_chunk2</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.annot_testdb_consistency_checks">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">annot_testdb_consistency_checks</tt><big>(</big><em>ibs_gt</em>, <em>ibs2</em>, <em>aid_list1</em>, <em>aid_list2</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#annot_testdb_consistency_checks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.annot_testdb_consistency_checks" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.assert_testdb_annot_consistency">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">assert_testdb_annot_consistency</tt><big>(</big><em>ibs_gt</em>, <em>ibs2</em>, <em>aid_list1</em>, <em>aid_list2</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#assert_testdb_annot_consistency"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.assert_testdb_annot_consistency" title="Permalink to this definition">¶</a></dt>
<dd><p>just tests uuids</p>
<dl class="docutils">
<dt>if anything goes wrong this should fix it:</dt>
<dd>from ibeis import ibsfuncs
aid_list1 = ibs_gt.get_valid_aids()
ibs_gt.update_annot_visual_uuids(aid_list1)
ibs2.update_annot_visual_uuids(aid_list2)
ibsfuncs.fix_remove_visual_dupliate_annotations(ibs_gt)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.check_results">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">check_results</tt><big>(</big><em>ibs_gt</em>, <em>ibs2</em>, <em>aid1_to_aid2</em>, <em>aids_list1_</em>, <em>incinfo</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#check_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.check_results" title="Permalink to this definition">¶</a></dt>
<dd><p>reports how well the incremental query ran when the oracle was calling the
shots.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.ensure_testdb_clean_data">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">ensure_testdb_clean_data</tt><big>(</big><em>ibs_gt</em>, <em>ibs2</em>, <em>aid_list1</em>, <em>aid_list2</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#ensure_testdb_clean_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.ensure_testdb_clean_data" title="Permalink to this definition">¶</a></dt>
<dd><p>removes previously set names and exemplars</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.interactive_commandline_prompt">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">interactive_commandline_prompt</tt><big>(</big><em>msg</em>, <em>decisiontype</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#interactive_commandline_prompt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.interactive_commandline_prompt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.make_incremental_test_database">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">make_incremental_test_database</tt><big>(</big><em>ibs_gt</em>, <em>aid_list1</em>, <em>reset</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#make_incremental_test_database"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.make_incremental_test_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes test database. adds image and annotations but does not transfer names.
if reset is true the new database is gaurenteed to be built from a fresh
start.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reset</strong> (<em>bool</em>) &#8211; if True the test database is completely rebuilt</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">ibs2</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">IBEISController</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_helpers.setup_incremental_test">
<tt class="descclassname">ibeis.model.hots.automated_helpers.</tt><tt class="descname">setup_incremental_test</tt><big>(</big><em>ibs_gt</em>, <em>clear_names=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_helpers.html#setup_incremental_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_helpers.setup_incremental_test" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m ibeis.model.hots.automated_helpers &#8211;test-setup_incremental_test:0</p>
<p class="last">python dev.py -t custom &#8211;cfg codename:vsone_unnorm &#8211;db PZ_MTEST &#8211;allgt &#8211;vf &#8211;va
python dev.py -t custom &#8211;cfg codename:vsone_unnorm &#8211;db PZ_MTEST &#8211;allgt &#8211;vf &#8211;va &#8211;index 0 4 8 &#8211;verbose</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_helpers</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span> <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs_gt</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs2</span><span class="p">,</span> <span class="n">aid_list1</span><span class="p">,</span> <span class="n">aid1_to_aid2</span> <span class="o">=</span> <span class="n">setup_incremental_test</span><span class="p">(</span><span class="n">ibs_gt</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_helpers</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs_gt</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;GZ_ALL&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs2</span><span class="p">,</span> <span class="n">aid_list1</span><span class="p">,</span> <span class="n">aid1_to_aid2</span> <span class="o">=</span> <span class="n">setup_incremental_test</span><span class="p">(</span><span class="n">ibs_gt</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.automated_matcher">
<span id="ibeis-model-hots-automated-matcher-module"></span><h2>ibeis.model.hots.automated_matcher module<a class="headerlink" href="#module-ibeis.model.hots.automated_matcher" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -c &#8220;import utool as ut; ut.write_modscript_alias(&#8216;Tinc.sh&#8217;, &#8216;ibeis.model.hots.qt_inc_automatch&#8217;)&#8221;</p>
<p>sh Tinc.sh &#8211;test-test_inc_query:0
sh Tinc.sh &#8211;test-test_inc_query:1
sh Tinc.sh &#8211;test-test_inc_query:2
sh Tinc.sh &#8211;test-test_inc_query:3 &#8211;num-initial 5000</p>
<p class="last">python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0</p>
</dd>
</dl>
<dl class="class">
<dt id="ibeis.model.hots.automated_matcher.Metatup">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">Metatup</tt><a class="headerlink" href="#ibeis.model.hots.automated_matcher.Metatup" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>Metatup(ibs_gt, aid1_to_aid2)</p>
<dl class="method">
<dt id="ibeis.model.hots.automated_matcher.Metatup.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.automated_matcher.Metatup.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.automated_matcher.Metatup.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.automated_matcher.Metatup.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.automated_matcher.Metatup.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.automated_matcher.Metatup.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.automated_matcher.Metatup.aid1_to_aid2">
<tt class="descname">aid1_to_aid2</tt><a class="headerlink" href="#ibeis.model.hots.automated_matcher.Metatup.aid1_to_aid2" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.automated_matcher.Metatup.ibs_gt">
<tt class="descname">ibs_gt</tt><a class="headerlink" href="#ibeis.model.hots.automated_matcher.Metatup.ibs_gt" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.exec_exemplar_decision_and_continue">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">exec_exemplar_decision_and_continue</tt><big>(</big><em>exemplar_decision</em>, <em>ibs</em>, <em>qres</em>, <em>qreq_</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#exec_exemplar_decision_and_continue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.exec_exemplar_decision_and_continue" title="Permalink to this definition">¶</a></dt>
<dd><p>DECISION STEP 4)</p>
<p>The exemplar decision in the previous step is executed.  The persistant
vsmany query request is updated if needbe and the execution continues.
(currently to the end of this iteration)</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.exec_name_decision_and_continue">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">exec_name_decision_and_continue</tt><big>(</big><em>chosen_names</em>, <em>ibs</em>, <em>qres</em>, <em>qreq_</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#exec_name_decision_and_continue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.exec_name_decision_and_continue" title="Permalink to this definition">¶</a></dt>
<dd><p>DECISION STEP 2)</p>
<p>The name decision from the previous step is executed and the score
normalizer is updated. Then execution continues to the exemplar decision
step.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.generate_incremental_queries">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">generate_incremental_queries</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#generate_incremental_queries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.generate_incremental_queries" title="Permalink to this definition">¶</a></dt>
<dd><p>qt entry point. generates query results for the qt harness to process.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-generate_incremental_queries</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span> <span class="o">=</span> <span class="n">testdata_automatch</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generate_incremental_queries</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.generate_subquery_steps">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">generate_subquery_steps</tt><big>(</big><em>ibs</em>, <em>qaid_chunk</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#generate_subquery_steps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.generate_subquery_steps" title="Permalink to this definition">¶</a></dt>
<dd><p>Generats query results for the qt harness to then send into the next
decision steps.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-generate_subquery_steps</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span> <span class="o">=</span> <span class="n">testdata_automatch</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generate_subquery_steps</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.run_until_exemplar_decision_signal">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">run_until_exemplar_decision_signal</tt><big>(</big><em>ibs</em>, <em>qres</em>, <em>qreq_</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#run_until_exemplar_decision_signal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.run_until_exemplar_decision_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>DECISION STEP 3)</p>
<p>Either the system or the user decides if the query should be added to the
database as an exemplar.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.run_until_finish">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">run_until_finish</tt><big>(</big><em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#run_until_finish"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.run_until_finish" title="Permalink to this definition">¶</a></dt>
<dd><p>DECISION STEP 5)</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.run_until_name_decision_signal">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">run_until_name_decision_signal</tt><big>(</big><em>ibs</em>, <em>qres</em>, <em>qreq_</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#run_until_name_decision_signal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.run_until_name_decision_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>DECISION STEP 1)</p>
<p>Either the system or the user makes a decision about the name of the query
annotation.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-run_until_name_decision_signal</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span> <span class="o">=</span> <span class="n">testdata_automatch</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemplar_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">is_exemplar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">incinfo</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span> <span class="o">=</span> <span class="n">generate_subquery_steps</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span><span class="p">,</span> <span class="n">incinfo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">item</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">incinfo</span> <span class="o">=</span> <span class="n">item</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">run_until_name_decision_signal</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">incinfo</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore::</dt>
<dd>qres.ishow_top(ibs, sidebyside=False, show_query=True)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.test_generate_incremental_queries">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">test_generate_incremental_queries</tt><big>(</big><em>ibs_gt</em>, <em>ibs</em>, <em>aid_list1</em>, <em>aid1_to_aid2</em>, <em>num_initial=0</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#test_generate_incremental_queries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.test_generate_incremental_queries" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds and queries new annotations one at a time with oracle guidance</p>
<p>ibs1 is ibs_gt
ibs2 is ibs</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.testdata_automatch">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">testdata_automatch</tt><big>(</big><em>dbname=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#testdata_automatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.testdata_automatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_matcher.update_normalizer">
<tt class="descclassname">ibeis.model.hots.automated_matcher.</tt><tt class="descname">update_normalizer</tt><big>(</big><em>ibs</em>, <em>qres</em>, <em>qreq_</em>, <em>chosen_names</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_matcher.html#update_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_matcher.update_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>adds new support data to the current normalizer</p>
<p>FIXME: a miss-save in vim will trigger module unloading</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(tp_rawscore, tn_rawscore)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-update_normalizer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span> <span class="o">=</span> <span class="n">testdata_automatch</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemplar_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">is_exemplar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">incinfo</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span> <span class="o">=</span> <span class="n">generate_subquery_steps</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_chunk</span><span class="p">,</span> <span class="n">incinfo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">item</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">incinfo</span> <span class="o">=</span> <span class="n">item</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chosen_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;easy&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">update_normalizer</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">chosen_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">tp_rawscore</span><span class="p">,</span> <span class="n">tn_rawscore</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.automated_oracle">
<span id="ibeis-model-hots-automated-oracle-module"></span><h2>ibeis.model.hots.automated_oracle module<a class="headerlink" href="#module-ibeis.model.hots.automated_oracle" title="Permalink to this headline">¶</a></h2>
<p>module for making the correct automatic decisions in incremental tests</p>
<dl class="function">
<dt id="ibeis.model.hots.automated_oracle.get_oracle_name_decision">
<tt class="descclassname">ibeis.model.hots.automated_oracle.</tt><tt class="descname">get_oracle_name_decision</tt><big>(</big><em>metatup</em>, <em>ibs</em>, <em>qaid</em>, <em>choicetup</em>, <em>oracle_method=1</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_oracle.html#get_oracle_name_decision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_oracle.get_oracle_name_decision" title="Permalink to this definition">¶</a></dt>
<dd><p>Find what the correct decision should be ibs is the database we are working
with ibs_gt has pristine groundtruth</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_oracle.get_oracle_name_suggestion">
<tt class="descclassname">ibeis.model.hots.automated_oracle.</tt><tt class="descname">get_oracle_name_suggestion</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>choicetup</em>, <em>metatup</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_oracle.html#get_oracle_name_suggestion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_oracle.get_oracle_name_suggestion" title="Permalink to this definition">¶</a></dt>
<dd><p>main entry point for the oracle</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_oracle.oracle_method1">
<tt class="descclassname">ibeis.model.hots.automated_oracle.</tt><tt class="descname">oracle_method1</tt><big>(</big><em>ibs_gt</em>, <em>ibs</em>, <em>qnid1</em>, <em>aid_list2</em>, <em>aid2_to_aid1</em>, <em>sorted_nids</em>, <em>MAX_LOOK</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_oracle.html#oracle_method1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_oracle.oracle_method1" title="Permalink to this definition">¶</a></dt>
<dd><p>METHOD 1: MAKE BEST DECISION FROM GIVEN INFORMATION</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.automated_oracle.oracle_method2">
<tt class="descclassname">ibeis.model.hots.automated_oracle.</tt><tt class="descname">oracle_method2</tt><big>(</big><em>ibs_gt</em>, <em>qnid1</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/automated_oracle.html#oracle_method2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.automated_oracle.oracle_method2" title="Permalink to this definition">¶</a></dt>
<dd><p>METHOD 2: MAKE THE ABSOLUTE CORRECT DECISION REGARDLESS OF RESULT</p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.devcases">
<span id="ibeis-model-hots-devcases-module"></span><h2>ibeis.model.hots.devcases module<a class="headerlink" href="#module-ibeis.model.hots.devcases" title="Permalink to this headline">¶</a></h2>
<p>development module storing my &#8220;development state&#8221;</p>
<dl class="docutils">
<dt>TODO:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>figure out what packages I use have lisencing issues.</dt>
<dd><ul class="first last simple">
<li>Reimplement them or work around them.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="ibeis.model.hots.devcases.find_close_incorrect_match">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">find_close_incorrect_match</tt><big>(</big><em>ibs</em>, <em>qaids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#find_close_incorrect_match"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.find_close_incorrect_match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.devcases.get_dev_test_fpaths">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">get_dev_test_fpaths</tt><big>(</big><em>index</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#get_dev_test_fpaths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.get_dev_test_fpaths" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.devcases.get_gzall_small_test">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">get_gzall_small_test</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#get_gzall_small_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.get_gzall_small_test" title="Permalink to this definition">¶</a></dt>
<dd><p>ibs.get_annot_visual_uuids([qaid, aid])</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.devcases.load_gztest">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">load_gztest</tt><big>(</big><em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#load_gztest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.load_gztest" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-load_gztest</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.devcases</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;GZ_ALL&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.devcases.myquery">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">myquery</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#myquery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.myquery" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>BUG::</dt>
<dd><p class="first">THERE IS A BUG SOMEWHERE: HOW IS THIS POSSIBLE?
if everything is weightd ) how di the true positive even get a score
while the true negative did not
qres_copy.filtkey_list = [&#8216;ratio&#8217;, &#8216;fg&#8217;, &#8216;homogerr&#8217;, &#8216;distinctiveness&#8217;]
CORRECT STATS
{</p>
<blockquote>
<div>&#8216;max&#8217;  : [0.832, 0.968, 0.604, 0.000],
&#8216;min&#8217;  : [0.376, 0.524, 0.000, 0.000],
&#8216;mean&#8217; : [0.561, 0.924, 0.217, 0.000],
&#8216;std&#8217;  : [0.114, 0.072, 0.205, 0.000],
&#8216;nMin&#8217; : [1, 1, 1, 51],
&#8216;nMax&#8217; : [1, 1, 1, 1],
&#8216;shape&#8217;: (52, 4),</div></blockquote>
<p>}
INCORRECT STATS
{</p>
<blockquote>
<div>&#8216;max&#8217;  : [0.759, 0.963, 0.264, 0.000],
&#8216;min&#8217;  : [0.379, 0.823, 0.000, 0.000],
&#8216;mean&#8217; : [0.506, 0.915, 0.056, 0.000],
&#8216;std&#8217;  : [0.125, 0.039, 0.078, 0.000],
&#8216;nMin&#8217; : [1, 1, 1, 24],
&#8216;nMax&#8217; : [1, 1, 1, 1],
&#8216;shape&#8217;: (26, 4),</div></blockquote>
<dl class="last docutils">
<dt>#   score_diff,  tp_score,  tn_score,       p,   K,  clip_fraction,  fg_power,  homogerr_power</dt>
<dd>0.494,     0.494,     0.000,  73.000,   2,          0.500,     0.100,          10.000</dd>
</dl>
</dd>
</dl>
<p>see how seperability changes as we very things</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.devcases &#8211;test-myquery
python -m ibeis.model.hots.devcases &#8211;test-myquery &#8211;show &#8211;index 0
python -m ibeis.model.hots.devcases &#8211;test-myquery &#8211;show &#8211;index 1
python -m ibeis.model.hots.devcases &#8211;test-myquery &#8211;show &#8211;index 2</dd>
</dl>
<p class="rubric">References</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Pareto_distribution">http://en.wikipedia.org/wiki/Pareto_distribution</a> &lt;- look into</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.devcases</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">dev_ipython_copypaster</span><span class="p">(</span><span class="n">myquery</span><span class="p">)</span> <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">inIPython</span><span class="p">()</span> <span class="k">else</span> <span class="n">myquery</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.devcases.show_power_law_plots">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">show_power_law_plots</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#show_power_law_plots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.show_power_law_plots" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.devcases &#8211;test-show_power_law_plots &#8211;show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#%pylab qt4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.devcases</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_power_law_plots</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.devcases.testdata_my_exmaples">
<tt class="descclassname">ibeis.model.hots.devcases.</tt><tt class="descname">testdata_my_exmaples</tt><big>(</big><em>index</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/devcases.html#testdata_my_exmaples"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.devcases.testdata_my_exmaples" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.devcases</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.distinctiveness_normalizer">
<span id="ibeis-model-hots-distinctiveness-normalizer-module"></span><h2>ibeis.model.hots.distinctiveness_normalizer module<a class="headerlink" href="#module-ibeis.model.hots.distinctiveness_normalizer" title="Permalink to this headline">¶</a></h2>
<p>External mechanism for computing feature distinctiveness</p>
<p>stores some set of vectors which lose their association with
their parent.</p>
<dl class="class">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">DistinctivnessNormalizer</tt><big>(</big><em>dstcnvs_normer</em>, <em>species</em>, <em>cachedir=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">utool.util_cache.Cachable</span></tt></p>
<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.add_support">
<tt class="descname">add_support</tt><big>(</big><em>dstcnvs_normer</em>, <em>new_vecs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.add_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.add_support" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.archive">
<tt class="descname">archive</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em>, <em>overwrite=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.archive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.archive" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.ensure_flann">
<tt class="descname">ensure_flann</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.ensure_flann"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.ensure_flann" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.exists">
<tt class="descname">exists</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em>, <em>verbose=True</em>, <em>need_flann=False</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.exists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.exists" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cachedir</strong> (<em>str</em>) &#8211; cache directory</li>
<li><strong>verbose</strong> (<em>bool</em>) &#8211; verbosity flag</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">load_success</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">flag</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-exists</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">testdata_distinctiveness</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.ext">
<tt class="descname">ext</tt><em class="property"> = '.cPkl'</em><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.ext" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_cfgstr">
<tt class="descname">get_cfgstr</tt><big>(</big><em>dstcnvs_normer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_distinctiveness">
<tt class="descname">get_distinctiveness</tt><big>(</big><em>dstcnvs_normer</em>, <em>qfx2_vec</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.get_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_vec</strong> (<em>ndarray</em>) &#8211; mapping from query feature index to vec</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-get_distinctiveness</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">testdata_distinctiveness</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">qaid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_dstncvs</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">get_distinctiveness</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qfx2_dstncvs</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qfx2_dstncvs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qfx2_dstncvs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_flann_fpath">
<tt class="descname">get_flann_fpath</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.get_flann_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_flann_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_prefix">
<tt class="descname">get_prefix</tt><big>(</big><em>dstcnvs_normer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.get_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.get_prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.init_support">
<tt class="descname">init_support</tt><big>(</big><em>dstcnvs_normer</em>, <em>vecs</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.init_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.init_support" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.load">
<tt class="descname">load</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em>, <em>verbose=True</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.load_or_build_flann">
<tt class="descname">load_or_build_flann</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em>, <em>verbose=True</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.load_or_build_flann"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.load_or_build_flann" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.prefix">
<tt class="descname">prefix</tt><em class="property"> = 'distinctivness'</em><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.publish">
<tt class="descname">publish</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.publish"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.publish" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets this as the default normalizer available for download
ONLY DEVELOPERS CAN PERFORM THIS OPERATION</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-publish</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">testdata_distinctiveness</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">dstcnvs_normer</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.rebuild">
<tt class="descname">rebuild</tt><big>(</big><em>dstcnvs_normer</em>, <em>verbose=True</em>, <em>quiet=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.rebuild"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.rebuild" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.save">
<tt class="descname">save</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em>, <em>verbose=True</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.save" title="Permalink to this definition">¶</a></dt>
<dd><p>args = tuple()
kwargs = {}</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.save_flann">
<tt class="descname">save_flann</tt><big>(</big><em>dstcnvs_normer</em>, <em>cachedir=None</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#DistinctivnessNormalizer.save_flann"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.DistinctivnessNormalizer.save_flann" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.clear_distinctivness_cache">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">clear_distinctivness_cache</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#clear_distinctivness_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.clear_distinctivness_cache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.compute_distinctiveness_from_dist">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">compute_distinctiveness_from_dist</tt><big>(</big><em>norm_sqared_dist</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#compute_distinctiveness_from_dist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.compute_distinctiveness_from_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute distinctiveness from distance to K+1 nearest neighbor</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><p class="first">norm_sqared_dist = np.random.rand(1000)</p>
<p>import numexpr</p>
<p>%timeit np.divide(norm_sqared_dist, clip_fraction)
%timeit numexpr.evaluate(&#8216;norm_sqared_dist / clip_fraction&#8217;, local_dict=dict(norm_sqared_dist=norm_sqared_dist, clip_fraction=clip_fraction))
wd_cliped = np.divide(norm_sqared_dist, clip_fraction)</p>
<p>%timeit numexpr.evaluate(&#8216;wd_cliped &gt; 1.0&#8217;, local_dict=locals())
%timeit np.greater(wd_cliped, 1.0)</p>
<p>%timeit np.power(wd_cliped, p)
%timeit numexpr.evaluate(&#8216;wd_cliped ** p&#8217;, local_dict=locals())</p>
<p class="last">%timeit</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.dev_train_distinctiveness">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">dev_train_distinctiveness</tt><big>(</big><em>species=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#dev_train_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.dev_train_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-dev_train_distinctiveness
alias dev_train_distinctiveness=&#8217;python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-dev_train_distinctiveness&#8217;
dev_train_distinctiveness &#8211;species GZ &#8211;publish
dev_train_distinctiveness &#8211;species PZ &#8211;publish</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">species_code</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--species&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&#39;GZ&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">species</span> <span class="o">=</span> <span class="n">sysres</span><span class="o">.</span><span class="n">resolve_species</span><span class="p">(</span><span class="n">species_code</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dev_train_distinctiveness</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.download_baseline_distinctiveness_normalizer">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">download_baseline_distinctiveness_normalizer</tt><big>(</big><em>cachedir</em>, <em>species</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#download_baseline_distinctiveness_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.download_baseline_distinctiveness_normalizer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.list_distinctivness_cache">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">list_distinctivness_cache</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#list_distinctivness_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.list_distinctivness_cache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.list_published_distinctivness">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">list_published_distinctivness</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#list_published_distinctivness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.list_published_distinctivness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-list_published_distinctivness</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">published_fpaths</span> <span class="o">=</span> <span class="n">list_published_distinctivness</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_str</span><span class="p">(</span><span class="n">published_fpaths</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.request_ibeis_distinctiveness_normalizer">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">request_ibeis_distinctiveness_normalizer</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#request_ibeis_distinctiveness_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.request_ibeis_distinctiveness_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-request_ibeis_distinctiveness_normalizer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span> <span class="o">=</span> <span class="n">request_ibeis_distinctiveness_normalizer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">dstcnvs_normer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.request_species_distinctiveness_normalizer">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">request_species_distinctiveness_normalizer</tt><big>(</big><em>species</em>, <em>cachedir=None</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#request_species_distinctiveness_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.request_species_distinctiveness_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function to get distinctivness model independent of IBEIS.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.test_single_annot_distinctiveness_params">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">test_single_annot_distinctiveness_params</tt><big>(</big><em>ibs</em>, <em>aid</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#test_single_annot_distinctiveness_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.test_single_annot_distinctiveness_params" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-test_single_annot_distinctiveness_params &#8211;show
python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-test_single_annot_distinctiveness_params &#8211;show &#8211;db GZ_ALL</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--db&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--aid&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_single_annot_distinctiveness_params</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.testdata_distinctiveness">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">testdata_distinctiveness</tt><big>(</big><em>species=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#testdata_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.testdata_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dstcnvs_normer</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">testdata_distinctiveness</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.view_distinctiveness_model_dir">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">view_distinctiveness_model_dir</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#view_distinctiveness_model_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.view_distinctiveness_model_dir" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-view_distinctiveness_model_dir</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">view_distinctiveness_model_dir</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.distinctiveness_normalizer.view_publish_dir">
<tt class="descclassname">ibeis.model.hots.distinctiveness_normalizer.</tt><tt class="descname">view_publish_dir</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/distinctiveness_normalizer.html#view_publish_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.distinctiveness_normalizer.view_publish_dir" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.distinctiveness_normalizer &#8211;test-view_publish_dir</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.distinctiveness_normalizer</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">view_publish_dir</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.exceptions">
<span id="ibeis-model-hots-exceptions-module"></span><h2>ibeis.model.hots.exceptions module<a class="headerlink" href="#module-ibeis.model.hots.exceptions" title="Permalink to this headline">¶</a></h2>
<dl class="exception">
<dt id="ibeis.model.hots.exceptions.HotsCacheMissError">
<em class="property">exception </em><tt class="descclassname">ibeis.model.hots.exceptions.</tt><tt class="descname">HotsCacheMissError</tt><a class="reference internal" href="_modules/ibeis/model/hots/exceptions.html#HotsCacheMissError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.exceptions.HotsCacheMissError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">exceptions.Exception</span></tt></p>
</dd></dl>

<dl class="exception">
<dt id="ibeis.model.hots.exceptions.HotsNeedsRecomputeError">
<em class="property">exception </em><tt class="descclassname">ibeis.model.hots.exceptions.</tt><tt class="descname">HotsNeedsRecomputeError</tt><a class="reference internal" href="_modules/ibeis/model/hots/exceptions.html#HotsNeedsRecomputeError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.exceptions.HotsNeedsRecomputeError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">exceptions.Exception</span></tt></p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.exceptions.NoDescriptorsException">
<tt class="descclassname">ibeis.model.hots.exceptions.</tt><tt class="descname">NoDescriptorsException</tt><big>(</big><em>ibs</em>, <em>qaid</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/exceptions.html#NoDescriptorsException"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.exceptions.NoDescriptorsException" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ibeis.model.hots.exceptions.QueryException">
<em class="property">exception </em><tt class="descclassname">ibeis.model.hots.exceptions.</tt><tt class="descname">QueryException</tt><big>(</big><em>msg</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/exceptions.html#QueryException"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.exceptions.QueryException" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">exceptions.Exception</span></tt></p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.hots_query_result">
<span id="ibeis-model-hots-hots-query-result-module"></span><h2>ibeis.model.hots.hots_query_result module<a class="headerlink" href="#module-ibeis.model.hots.hots_query_result" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.model.hots.hots_query_result.QueryResult">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">QueryResult</tt><big>(</big><em>qres</em>, <em>qaid</em>, <em>qauuid</em>, <em>cfgstr</em>, <em>daids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.__eq__">
<tt class="descname">__eq__</tt><big>(</big><em>other</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.__eq__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.__eq__" title="Permalink to this definition">¶</a></dt>
<dd><p>For testing. Do not use</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.assert_self">
<tt class="descname">assert_self</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.assert_self"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.assert_self" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.cache_bytes">
<tt class="descname">cache_bytes</tt><big>(</big><em>qres</em>, <em>qresdir</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.cache_bytes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.cache_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Size of the cached query result on disk</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.dump_top_match">
<tt class="descname">dump_top_match</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.dump_top_match"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.dump_top_match" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python -m ibeis.model.hots.hots_query_result &#8211;test-dump_top_match &#8211;show &#8211;quality</p>
<p class="last">python -m ibeis.model.hots.hots_query_result &#8211;test-dump_top_match &#8211;show &#8211;dpi=160 &#8211;no-fmatches
python -m ibeis.model.hots.hots_query_result &#8211;test-dump_top_match &#8211;show &#8211;dpi=120 &#8211;no-fmatches &#8211;saveax</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.viz.viz_qres</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--dpi&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--figsize&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fpath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--fpath&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;draw_fmatches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--no-fmatches&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;vert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--vert&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;draw_border&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--draw_border&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#kwargs[&#39;saveax&#39;] = ut.get_argflag(&#39;--saveax&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;in_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--in-image&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;draw_lbl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--no-draw-lbl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">query_chips</span><span class="p">(</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span><span class="o">.</span><span class="n">dump_top_match</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_aid_ranks">
<tt class="descname">get_aid_ranks</tt><big>(</big><em>qres</em>, <em>aid_arr</em>, <em>fillvalue=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_aid_ranks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_aid_ranks" title="Permalink to this definition">¶</a></dt>
<dd><p>get ranks of annotation ids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_aid_scores">
<tt class="descname">get_aid_scores</tt><big>(</big><em>qres</em>, <em>aid_arr</em>, <em>fillvalue=None</em>, <em>rawscore=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_aid_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_aid_scores" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_aid_truth">
<tt class="descname">get_aid_truth</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>aid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_aid_truth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_aid_truth" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_aids_and_chip_scores">
<tt class="descname">get_aids_and_chip_scores</tt><big>(</big><em>qres</em>, <em>rawscore=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_aids_and_chip_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_aids_and_chip_scores" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_aids_and_scores">
<tt class="descname">get_aids_and_scores</tt><big>(</big><em>qres</em>, <em>name_scoring=False</em>, <em>ibs=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_aids_and_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_aids_and_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a chip index list and associated score list</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_average_percision">
<tt class="descname">get_average_percision</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_average_percision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_average_percision" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_best_aid_rank">
<tt class="descname">get_best_aid_rank</tt><big>(</big><em>qres</em>, <em>aids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_best_aid_rank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_best_aid_rank" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the best rank over all the input aids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_classified_pos">
<tt class="descname">get_classified_pos</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_classified_pos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_classified_pos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_daids">
<tt class="descname">get_daids</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_daids" title="Permalink to this definition">¶</a></dt>
<dd><p>returns database annotation ids this query was run with</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fk_list">
<tt class="descname">get_fk_list</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fk_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fk_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns list of fk&#8217;s wrt database annotation ids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fm_list">
<tt class="descname">get_fm_list</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fm_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fm_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns list of fm&#8217;s wrt database annotation ids</p>
<p>THIS AND OTHER ANALOGOUS FUNCS WILL BE FIRST LEVEL GETTERS
ONCE qres.aid2_xxx becomes qres.xxx_list with qres.daid_list</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fmatch_index">
<tt class="descname">get_fmatch_index</tt><big>(</big><em>qres</em>, <em>aid</em>, <em>qfx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fmatch_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fmatch_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the feature index in aid matching the query&#8217;s qfx-th feature
(if it exists)</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fname">
<tt class="descname">get_fname</tt><big>(</big><em>qres</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fname"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fname" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fpath">
<tt class="descname">get_fpath</tt><big>(</big><em>qres</em>, <em>qresdir</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fs_list">
<tt class="descname">get_fs_list</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fs_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fs_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns list of fs&#8217;s wrt database annotation ids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_fsv_list">
<tt class="descname">get_fsv_list</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_fsv_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_fsv_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns list of fsv&#8217;s wrt database annotation ids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_gf_scores">
<tt class="descname">get_gf_scores</tt><big>(</big><em>qres</em>, <em>gf_aids=None</em>, <em>ibs=None</em>, <em>return_gfaids=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_gf_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_gf_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>returns groundfalse scores</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_groundfalse_aids">
<tt class="descname">get_groundfalse_aids</tt><big>(</big><em>qres</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_groundfalse_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_groundfalse_aids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_groundtruth_aids">
<tt class="descname">get_groundtruth_aids</tt><big>(</big><em>qres</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_groundtruth_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_groundtruth_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the groundtruth with respect to what could have been matched for
this query</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_gt_ranks">
<tt class="descname">get_gt_ranks</tt><big>(</big><em>qres</em>, <em>gt_aids=None</em>, <em>ibs=None</em>, <em>return_gtaids=False</em>, <em>fillvalue=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_gt_ranks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_gt_ranks" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the 0 indexed ranking of each groundtruth chip</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_gt_scores">
<tt class="descname">get_gt_scores</tt><big>(</big><em>qres</em>, <em>gt_aids=None</em>, <em>ibs=None</em>, <em>return_gtaids=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_gt_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_gt_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>returns groundfalse scores</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_inspect_str">
<tt class="descname">get_inspect_str</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>name_scoring=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_inspect_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_inspect_str" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_interpolated_precision_vs_recall">
<tt class="descname">get_interpolated_precision_vs_recall</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_interpolated_precision_vs_recall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_interpolated_precision_vs_recall" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_match_tbldata">
<tt class="descname">get_match_tbldata</tt><big>(</big><em>qres</em>, <em>ranks_lt=6</em>, <em>name_scoring=False</em>, <em>ibs=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_match_tbldata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_match_tbldata" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns matchinfo in table format (qaids, aids, scores, ranks)</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_matching_keypoints">
<tt class="descname">get_matching_keypoints</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>aid2_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_matching_keypoints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_matching_keypoints" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_name_decisiontup">
<tt class="descname">get_name_decisiontup</tt><big>(</big><em>qres</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_name_decisiontup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_name_decisiontup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_nscoretup">
<tt class="descname">get_nscoretup</tt><big>(</big><em>qres</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_nscoretup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_nscoretup" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nscoretup</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.hots_query_result &#8211;test-get_nscoretup</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.hots_query_result</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">query_chips</span><span class="p">(</span><span class="n">qaids</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nscoretup</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_nscoretup</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscore</span><span class="p">,</span> <span class="n">sorted_aids</span><span class="p">,</span> <span class="n">sorted_scores</span><span class="p">)</span> <span class="o">=</span> <span class="n">nscoretup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nscoretup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_precision_recall_curve">
<tt class="descname">get_precision_recall_curve</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_precision_recall_curve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_precision_recall_curve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_prob_list">
<tt class="descname">get_prob_list</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_prob_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_prob_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns list of fk&#8217;s wrt database annotation ids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_qaid">
<tt class="descname">get_qaid</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_qaid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_qaid" title="Permalink to this definition">¶</a></dt>
<dd><p>returns query database annotation id</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_score_list">
<tt class="descname">get_score_list</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_score_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_score_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns list of fk&#8217;s wrt database annotation ids</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_sorted_nids_and_scores">
<tt class="descname">get_sorted_nids_and_scores</tt><big>(</big><em>qres</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_sorted_nids_and_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_sorted_nids_and_scores" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_top_aids">
<tt class="descname">get_top_aids</tt><big>(</big><em>qres</em>, <em>num=None</em>, <em>name_scoring=False</em>, <em>ibs=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_top_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_top_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a ranked list of chip indexes</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.get_worse_possible_rank">
<tt class="descname">get_worse_possible_rank</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.get_worse_possible_rank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.get_worse_possible_rank" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRICATE</p>
<p>a good non None value to use for None ranks</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.has_cache">
<tt class="descname">has_cache</tt><big>(</big><em>qres</em>, <em>qresdir</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.has_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.has_cache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.is_nsum">
<tt class="descname">is_nsum</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.is_nsum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.is_nsum" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.ishow_matches">
<tt class="descname">ishow_matches</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>aid</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.ishow_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.ishow_matches" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.ishow_top">
<tt class="descname">ishow_top</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.ishow_top"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.ishow_top" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.load">
<tt class="descname">load</tt><big>(</big><em>qres</em>, <em>qresdir</em>, <em>verbose=False</em>, <em>force_miss=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads the result from the given database</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.make_smaller_title">
<tt class="descname">make_smaller_title</tt><big>(</big><em>qres</em>, <em>remove_dsuuids=True</em>, <em>remove_chip=True</em>, <em>remove_feat=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.make_smaller_title"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.make_smaller_title" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.make_title">
<tt class="descname">make_title</tt><big>(</big><em>qres</em>, <em>pack=False</em>, <em>remove_dsuuids=False</em>, <em>remove_chip=False</em>, <em>remove_feat=False</em>, <em>textwidth=80</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.make_title"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.make_title" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.qt_inspect_gui">
<tt class="descname">qt_inspect_gui</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>ranks_lt=6</em>, <em>name_scoring=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.qt_inspect_gui"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.qt_inspect_gui" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.save">
<tt class="descname">save</tt><big>(</big><em>qres</em>, <em>qresdir</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.save" title="Permalink to this definition">¶</a></dt>
<dd><p>saves query result to directory</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.show">
<tt class="descname">show</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>type_</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.show"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.show" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.show_analysis">
<tt class="descname">show_analysis</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.show_analysis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.show_analysis" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.show_matches">
<tt class="descname">show_matches</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>aid</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.show_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.show_matches" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.show_precision_recall_curve">
<tt class="descname">show_precision_recall_curve</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em>, <em>fnum=1</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.show_precision_recall_curve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.show_precision_recall_curve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hots_query_result.QueryResult.show_top">
<tt class="descname">show_top</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#QueryResult.show_top"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.QueryResult.show_top" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.assert_qres">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">assert_qres</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#assert_qres"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.assert_qres" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.get_num_chip_matches">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">get_num_chip_matches</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#get_num_chip_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.get_num_chip_matches" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.get_num_feats_in_matches">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">get_num_feats_in_matches</tt><big>(</big><em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#get_num_feats_in_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.get_num_feats_in_matches" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.qres_get_matching_keypoints">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">qres_get_matching_keypoints</tt><big>(</big><em>qres</em>, <em>ibs</em>, <em>aid2_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#qres_get_matching_keypoints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.qres_get_matching_keypoints" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.query_result_fname">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">query_result_fname</tt><big>(</big><em>qaid</em>, <em>qauuid</em>, <em>cfgstr</em>, <em>ext='.npz'</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#query_result_fname"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.query_result_fname" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a filename for a queryresult</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation rowid</li>
<li><strong>qauuid</strong> (<em>uuid.UUID</em>) &#8211; query annotation unique universal id</li>
<li><strong>cfgstr</strong> (<em>str</em>) &#8211; query parameter configuration string</li>
<li><strong>ext</strong> (<em>str</em>) &#8211; filetype extension</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.query_result_fpath">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">query_result_fpath</tt><big>(</big><em>qresdir</em>, <em>qaid</em>, <em>qauuid</em>, <em>cfgstr</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#query_result_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.query_result_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.hots_query_result.remove_corrupted_queries">
<tt class="descclassname">ibeis.model.hots.hots_query_result.</tt><tt class="descname">remove_corrupted_queries</tt><big>(</big><em>qresdir</em>, <em>qres</em>, <em>dryrun=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/hots_query_result.html#remove_corrupted_queries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hots_query_result.remove_corrupted_queries" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.hstypes">
<span id="ibeis-model-hots-hstypes-module"></span><h2>ibeis.model.hots.hstypes module<a class="headerlink" href="#module-ibeis.model.hots.hstypes" title="Permalink to this headline">¶</a></h2>
<p>hstypes
Todo:
* SIFT: Root_SIFT -&gt; L2 normalized -&gt; Centering.
# <a class="reference external" href="http://hal.archives-ouvertes.fr/docs/00/84/07/21/PDF/RR-8325.pdf">http://hal.archives-ouvertes.fr/docs/00/84/07/21/PDF/RR-8325.pdf</a>
The devil is in the deatails
<a class="reference external" href="http://www.robots.ox.ac.uk/~vilem/bmvc2011.pdf">http://www.robots.ox.ac.uk/~vilem/bmvc2011.pdf</a>
This says dont clip, do rootsift instead
# <a class="reference external" href="http://hal.archives-ouvertes.fr/docs/00/68/81/69/PDF/hal_v1.pdf">http://hal.archives-ouvertes.fr/docs/00/68/81/69/PDF/hal_v1.pdf</a>
* Quantization of residual vectors
* Burstiness normalization for N-SMK
* Implemented A-SMK
* Incorporate Spatial Verification
* Implement correct cfgstrs based on algorithm input
for cached computations.
* Color by word
* Profile on hyrule
* Train vocab on paris
* Remove self matches.
* New SIFT parameters for pyhesaff (root, powerlaw, meanwhatever, output_dtype)</p>
<p>Issues:
* 10GB are in use when performing query on Oxford 5K
* errors when there is a word without any database vectors.
currently a weight of zero is hacked in</p>
<dl class="class">
<dt id="ibeis.model.hots.hstypes.ChipMatch">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.hstypes.</tt><tt class="descname">ChipMatch</tt><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>ChipMatch(aid2_fm, aid2_fsv, aid2_fk, aid2_score, aid2_H)</p>
<dl class="method">
<dt id="ibeis.model.hots.hstypes.ChipMatch.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hstypes.ChipMatch.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.hstypes.ChipMatch.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.ChipMatch.aid2_H">
<tt class="descname">aid2_H</tt><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.aid2_H" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.ChipMatch.aid2_fk">
<tt class="descname">aid2_fk</tt><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.aid2_fk" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.ChipMatch.aid2_fm">
<tt class="descname">aid2_fm</tt><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.aid2_fm" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.ChipMatch.aid2_fsv">
<tt class="descname">aid2_fsv</tt><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.aid2_fsv" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.ChipMatch.aid2_score">
<tt class="descname">aid2_score</tt><a class="headerlink" href="#ibeis.model.hots.hstypes.ChipMatch.aid2_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.hstypes.FiltKeys">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.hstypes.</tt><tt class="descname">FiltKeys</tt><a class="reference internal" href="_modules/ibeis/model/hots/hstypes.html#FiltKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.DIST">
<tt class="descname">DIST</tt><em class="property"> = 'dist'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.DIST" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.DISTINCTIVENESS">
<tt class="descname">DISTINCTIVENESS</tt><em class="property"> = 'distinctiveness'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.DISTINCTIVENESS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.DUPVOTE">
<tt class="descname">DUPVOTE</tt><em class="property"> = 'dupvote'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.DUPVOTE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.FG">
<tt class="descname">FG</tt><em class="property"> = 'fg'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.FG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.HOMOGERR">
<tt class="descname">HOMOGERR</tt><em class="property"> = 'homogerr'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.HOMOGERR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.LNBNN">
<tt class="descname">LNBNN</tt><em class="property"> = 'lnbnn'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.LNBNN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.hstypes.FiltKeys.RATIO">
<tt class="descname">RATIO</tt><em class="property"> = 'ratio'</em><a class="headerlink" href="#ibeis.model.hots.hstypes.FiltKeys.RATIO" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.match_chips4">
<span id="ibeis-model-hots-match-chips4-module"></span><h2>ibeis.model.hots.match_chips4 module<a class="headerlink" href="#module-ibeis.model.hots.match_chips4" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>DoctestCMD:</dt>
<dd>python -c &#8220;import doctest, ibeis; print(doctest.testmod(ibeis.model.hots.match_chips4))&#8221;</dd>
</dl>
<dl class="function">
<dt id="ibeis.model.hots.match_chips4.empty_query">
<tt class="descclassname">ibeis.model.hots.match_chips4.</tt><tt class="descname">empty_query</tt><big>(</big><em>ibs</em>, <em>qaids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/match_chips4.html#empty_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.match_chips4.empty_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Hack to give an empty query a query result object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(qaid2_qres, <a href="#id3"><span class="problematic" id="id4">qreq_</span></a>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.match_chips4 &#8211;test-empty_query
python -m ibeis.model.hots.match_chips4 &#8211;test-empty_query &#8211;show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.match_chips4</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span> <span class="o">=</span> <span class="n">empty_query</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--show&#39;</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">qres</span><span class="o">.</span><span class="n">ishow_top</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">make_figtitle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">show_query</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sidebyside</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">... </span>   <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="gp">... </span>   <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">get_top_aids</span><span class="p">()),</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.match_chips4.execute_nonvsone_query">
<tt class="descclassname">ibeis.model.hots.match_chips4.</tt><tt class="descname">execute_nonvsone_query</tt><big>(</big><em>ibs</em>, <em>qreq_</em>, <em>verbose</em>, <em>save_qcache</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/match_chips4.html#execute_nonvsone_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.match_chips4.execute_nonvsone_query" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.match_chips4.execute_query_and_save_L1">
<tt class="descclassname">ibeis.model.hots.match_chips4.</tt><tt class="descname">execute_query_and_save_L1</tt><big>(</big><em>ibs</em>, <em>qreq_</em>, <em>use_cache</em>, <em>save_qcache</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/match_chips4.html#execute_query_and_save_L1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.match_chips4.execute_query_and_save_L1" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">qaid2_qres</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.match_chips4 &#8211;test-execute_query_and_save_L1</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.match_chips4</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">pipeline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsmany&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict1</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_qcache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_hit</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qaid2_qres_hit</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.match_chips4</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">pipeline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict1</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_qcache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_hit</span> <span class="o">=</span> <span class="n">execute_query_and_save_L1</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">save_qcache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qaid2_qres_hit</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.match_chips4.execute_vsone_query">
<tt class="descclassname">ibeis.model.hots.match_chips4.</tt><tt class="descname">execute_vsone_query</tt><big>(</big><em>ibs</em>, <em>qreq_</em>, <em>verbose</em>, <em>save_qcache</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/match_chips4.html#execute_vsone_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.match_chips4.execute_vsone_query" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.match_chips4.generate_vsone_qreqs">
<tt class="descclassname">ibeis.model.hots.match_chips4.</tt><tt class="descname">generate_vsone_qreqs</tt><big>(</big><em>ibs</em>, <em>qreq_</em>, <em>qaid_list</em>, <em>chunksize</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/match_chips4.html#generate_vsone_qreqs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.match_chips4.generate_vsone_qreqs" title="Permalink to this definition">¶</a></dt>
<dd><p>helper</p>
<p>Generate vsone quries one at a time, but create shallow qreqs in chunks.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.match_chips4.submit_query_request">
<tt class="descclassname">ibeis.model.hots.match_chips4.</tt><tt class="descname">submit_query_request</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>daid_list</em>, <em>use_cache=None</em>, <em>use_bigcache=None</em>, <em>return_request=False</em>, <em>cfgdict=None</em>, <em>qreq_=None</em>, <em>verbose=False</em>, <em>save_qcache=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/match_chips4.html#submit_query_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.match_chips4.submit_query_request" title="Permalink to this definition">¶</a></dt>
<dd><p>The standard query interface.</p>
<p>TODO: rename use_cache to use_qcache</p>
<p>Checks a big cache for qaid2_qres.  If cache miss, tries to load each qres
individually.  On an individual cache miss, it preforms the query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis control object</li>
<li><strong>qaid_list</strong> (<em>list</em>) &#8211; query annotation ids</li>
<li><strong>daid_list</strong> (<em>list</em>) &#8211; database annotation ids</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>qaid2_qres</strong> &#8211;
dict of QueryResult objects</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.match_chips4 &#8211;test-submit_query_request</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.match_chips4</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_bigcache</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">submit_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">use_bigcache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">submit_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.multi_index">
<span id="ibeis-model-hots-multi-index-module"></span><h2>ibeis.model.hots.multi_index module<a class="headerlink" href="#module-ibeis.model.hots.multi_index" title="Permalink to this headline">¶</a></h2>
<p>module which uses multiple flann indexes as a way of working around adding
points to a single flann structure which seems to cause crashes.</p>
<dl class="class">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.multi_index.</tt><tt class="descname">MultiNeighborIndex</tt><big>(</big><em>mxer</em>, <em>nn_indexer_list</em>, <em>min_reindex_thresh=10</em>, <em>max_subindexers=2</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>TODO: rename to DistributedNeighborIndex</p>
<p>Generalization of a NeighborIndex
More abstract wrapper around flann</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.add_ibeis_support">
<tt class="descname">add_ibeis_support</tt><big>(</big><em>mxer</em>, <em>qreq_</em>, <em>new_aid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.add_ibeis_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.add_ibeis_support" title="Permalink to this definition">¶</a></dt>
<dd><p>Chooses indexer with smallest number of annotations and reindexes it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-add_ibeis_support</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">70</span><span class="p">:</span><span class="mi">80</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">add_ibeis_support</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">new_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.add_support">
<tt class="descname">add_support</tt><big>(</big><em>mxer</em>, <em>new_aid_list</em>, <em>new_vecs_list</em>, <em>new_fgws_list</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.add_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.add_support" title="Permalink to this definition">¶</a></dt>
<dd><p>Chooses indexer with smallest number of annotations and reindexes it.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.assert_can_add_aids">
<tt class="descname">assert_can_add_aids</tt><big>(</big><em>mxer</em>, <em>new_aid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.assert_can_add_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.assert_can_add_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Aids that are already indexed should never be added.</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><a href="#id5"><span class="problematic" id="id6">qreq_vsmany_</span></a> = ut.search_stack_for_localvar(&#8216;<a href="#id7"><span class="problematic" id="id8">qreq_vsmany_</span></a>&#8216;)
<a href="#id9"><span class="problematic" id="id10">qreq_vsmany_</span></a>.get_external_daids()
<a href="#id11"><span class="problematic" id="id12">qreq_vsmany_</span></a>.get_external_qaids()
<a href="#id13"><span class="problematic" id="id14">qreq_vsmany_</span></a>.ibs.get_annot_exemplar_flags(new_aid_list)</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_dtype">
<tt class="descname">get_dtype</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_dtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_dtype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_indexed_aids">
<tt class="descname">get_indexed_aids</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_indexed_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_indexed_aids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_multi_indexed_aids">
<tt class="descname">get_multi_indexed_aids</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_multi_indexed_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_multi_indexed_aids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_multi_num_indexed_annots">
<tt class="descname">get_multi_num_indexed_annots</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_multi_num_indexed_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_multi_num_indexed_annots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_nIndexed_list">
<tt class="descname">get_nIndexed_list</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_nIndexed_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_nIndexed_list" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a list of the number of indexed vectors in each subindexer</p>
<p>Args:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nIndexed_list</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-get_nIndexed_list</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nIndexed_list</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">get_nIndexed_list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">21384</span><span class="p">,</span> <span class="mi">15243</span><span class="p">,</span> <span class="mi">12808</span><span class="p">,</span> <span class="mi">4809</span><span class="p">,</span> <span class="mi">3542</span><span class="p">,</span> <span class="mi">2696</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">assert_almost_eq</span><span class="p">(</span><span class="n">nIndexed_list</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;error.max() = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">max</span><span class="p">(),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#np.all(ut.inbounds(nIndexed_list, low, high))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_nn_aids">
<tt class="descname">get_nn_aids</tt><big>(</big><em>mxer</em>, <em>qfx2_imx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_nn_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_nn_aids" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">qfx2_aid</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-get_nn_aids</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">qaid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_aid</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">get_nn_aids</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_groundtruth</span><span class="p">(</span><span class="n">qaid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">qfx2_aid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Make sure there are lots (like 5%) of correct matches</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask_cover</span> <span class="o">=</span> <span class="n">vt</span><span class="o">.</span><span class="n">get_covered_mask</span><span class="p">(</span><span class="n">qfx2_aid</span><span class="p">,</span> <span class="n">gt_aids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_correct</span>   <span class="o">=</span> <span class="n">mask_cover</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_incorrect</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">mask_cover</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;fraction correct = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_correct</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">num_incorrect</span><span class="p">),))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">num_correct</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="s">&#39;not enough matches to groundtruth&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_nn_featxs">
<tt class="descname">get_nn_featxs</tt><big>(</big><em>mxer</em>, <em>qfx2_imx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_nn_featxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_nn_featxs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">qfx2_fx</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-get_nn_featxs</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_fgw</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">get_nn_featxs</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">qfx2_fgw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_nn_fgws">
<tt class="descname">get_nn_fgws</tt><big>(</big><em>mxer</em>, <em>qfx2_imx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_nn_fgws"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_nn_fgws" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">qfx2_fgw</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-get_nn_fgws</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_fgw</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">get_nn_fgws</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">qfx2_fgw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.get_offsets">
<tt class="descname">get_offsets</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.get_offsets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.get_offsets" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-get_offsets</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">offset_list</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#target = np.array([15257, 12769,  4819,  3542,  2694])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">21384</span><span class="p">,</span> <span class="mi">36627</span><span class="p">,</span> <span class="mi">49435</span><span class="p">,</span> <span class="mi">54244</span><span class="p">,</span> <span class="mi">57786</span><span class="p">,</span> <span class="mi">60482</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">assert_almost_eq</span><span class="p">(</span><span class="n">offset_list</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;error.max() = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">max</span><span class="p">(),))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.iter_subindexers">
<tt class="descname">iter_subindexers</tt><big>(</big><em>mxer</em>, <em>qfx2_imx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.iter_subindexers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.iter_subindexers" title="Permalink to this definition">¶</a></dt>
<dd><p>generates subindexers, indicies, and maskss within them
that partially correspond to indicies in qfx2_imx that belong
to that subindexer</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-iter_subindexers</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1028</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">genlist_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mxer</span><span class="o">.</span><span class="n">iter_subindexers</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">covered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">nnindexer</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">genlist_</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">covered</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">idxs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">covered</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
<span class="gp">... </span>    <span class="n">covered</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">covered</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">covered</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">covered</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.knn">
<tt class="descname">knn</tt><big>(</big><em>mxer</em>, <em>qfx2_vec</em>, <em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.knn" title="Permalink to this definition">¶</a></dt>
<dd><p>Polymorphic interface to knn, but uses the multindex backend</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-knn:0</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_imx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1073</span><span class="p">,</span> <span class="mi">1079</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">mxer</span><span class="o">.</span><span class="n">get_dtype</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">qfx2_imx</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">(0, 18)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.knn2">
<tt class="descname">knn2</tt><big>(</big><em>mxer</em>, <em>qfx2_vec</em>, <em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.knn2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.knn2" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_dist_</span><span class="p">,</span> <span class="n">qfx2_idx_</span><span class="p">,</span>  <span class="n">qfx2_fx_</span><span class="p">,</span> <span class="n">qfx2_ax_</span><span class="p">,</span> <span class="n">qfx2_rankx_</span><span class="p">,</span> <span class="n">qfx2_treex_</span><span class="p">,)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">knn2</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.multi_knn">
<tt class="descname">multi_knn</tt><big>(</big><em>mxer</em>, <em>qfx2_vec</em>, <em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.multi_knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.multi_knn" title="Permalink to this definition">¶</a></dt>
<dd><p>Does a query on each of the subindexer kdtrees
returns list of the results</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx_list</span><span class="p">,</span> <span class="n">qfx2_dist_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">multi_knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">qfx2_idx_list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d1_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">shape_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d2_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">shape_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">d2_list</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">d1_list</span><span class="p">,</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.num_indexed_annots">
<tt class="descname">num_indexed_annots</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.num_indexed_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.num_indexed_annots" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">num_indexed_annots</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">59</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.num_indexed_vecs">
<tt class="descname">num_indexed_vecs</tt><big>(</big><em>mxer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#MultiNeighborIndex.num_indexed_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.num_indexed_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">testdata_mindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_indexed</span> <span class="o">=</span> <span class="n">mxer</span><span class="o">.</span><span class="n">num_indexed_vecs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">num_indexed</span><span class="p">,</span> <span class="mi">60300</span><span class="p">,</span> <span class="mi">60500</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.multi_index.MultiNeighborIndex.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.multi_index.MultiNeighborIndex.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.multi_index.group_daids_for_indexing_by_name">
<tt class="descclassname">ibeis.model.hots.multi_index.</tt><tt class="descname">group_daids_for_indexing_by_name</tt><big>(</big><em>ibs</em>, <em>daid_list</em>, <em>num_indexers=8</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#group_daids_for_indexing_by_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.group_daids_for_indexing_by_name" title="Permalink to this definition">¶</a></dt>
<dd><p>returns groups with only one annotation per name in each group</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.multi_index.request_ibeis_mindexer">
<tt class="descclassname">ibeis.model.hots.multi_index.</tt><tt class="descname">request_ibeis_mindexer</tt><big>(</big><em>qreq_</em>, <em>index_method='multi'</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#request_ibeis_mindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.request_ibeis_mindexer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.multi_index &#8211;test-request_ibeis_mindexer:2</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index_method</span> <span class="o">=</span> <span class="s">&#39;multi&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span> <span class="o">=</span> <span class="n">request_ibeis_mindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">index_method</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;PZ_Master0&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index_method</span> <span class="o">=</span> <span class="s">&#39;multi&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span> <span class="o">=</span> <span class="n">request_ibeis_mindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">index_method</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Test background reindex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.multi_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_aids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Remove all cached nnindexers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="o">.</span><span class="n">delete_flann_cachedir</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># This request should build a new nnindexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index_method</span> <span class="o">=</span> <span class="s">&#39;multi&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span> <span class="o">=</span> <span class="n">request_ibeis_mindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">index_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mxer</span><span class="o">.</span><span class="n">nn_indexer_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;one subindexer&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># The next request should trigger a background process</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># and build two subindexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index_method</span> <span class="o">=</span> <span class="s">&#39;multi&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span> <span class="o">=</span> <span class="n">request_ibeis_mindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">index_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Do some work in the foreground to ensure that it doesnt block</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># the background job</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;[FG] sleeping or doing bit compute&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Takes about 15 seconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">Timer</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">ut</span><span class="o">.</span><span class="n">enumerate_primes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">9E4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#time.sleep(10)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;[FG] done sleeping&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mxer</span><span class="o">.</span><span class="n">nn_indexer_list</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;two subindexer&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># And this shoud build just one subindexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index_method</span> <span class="o">=</span> <span class="s">&#39;multi&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mxer</span> <span class="o">=</span> <span class="n">request_ibeis_mindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">index_method</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mxer</span><span class="o">.</span><span class="n">nn_indexer_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;one big subindexer&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.multi_index.sort_along_rows">
<tt class="descclassname">ibeis.model.hots.multi_index.</tt><tt class="descname">sort_along_rows</tt><big>(</big><em>qfx2_xxx</em>, <em>qfx2_sortx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#sort_along_rows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.sort_along_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>sorts each row in qfx2_xxx with the corresponding row in qfx2_sortx</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.multi_index.testdata_mindexer">
<tt class="descclassname">ibeis.model.hots.multi_index.</tt><tt class="descname">testdata_mindexer</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/multi_index.html#testdata_mindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.multi_index.testdata_mindexer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.name_scoring">
<span id="ibeis-model-hots-name-scoring-module"></span><h2>ibeis.model.hots.name_scoring module<a class="headerlink" href="#module-ibeis.model.hots.name_scoring" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.name_scoring.</tt><tt class="descname">NameScoreTup</tt><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>NameScoreTup(sorted_nids, sorted_nscore, sorted_aids, sorted_scores)</p>
<dl class="method">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.sorted_aids">
<tt class="descname">sorted_aids</tt><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.sorted_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.sorted_nids">
<tt class="descname">sorted_nids</tt><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.sorted_nids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.sorted_nscore">
<tt class="descname">sorted_nscore</tt><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.sorted_nscore" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.name_scoring.NameScoreTup.sorted_scores">
<tt class="descname">sorted_scores</tt><a class="headerlink" href="#ibeis.model.hots.name_scoring.NameScoreTup.sorted_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.name_scoring.group_scores_by_name">
<tt class="descclassname">ibeis.model.hots.name_scoring.</tt><tt class="descname">group_scores_by_name</tt><big>(</big><em>ibs</em>, <em>aid_list</em>, <em>score_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/name_scoring.html#group_scores_by_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.name_scoring.group_scores_by_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts annotation scores to name scores</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.name_scoring &#8211;test-group_scores_by_name</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.name_scoring</span> <span class="kn">import</span> <span class="o">*</span>   <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.dev</span> <span class="kn">import</span> <span class="n">results_all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="n">daid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips4</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span> <span class="n">return_request</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">use_cache</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">save_qcache</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="n">qaid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">get_inspect_str</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">get_inspect_str</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">,</span> <span class="n">name_scoring</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid_list</span><span class="p">,</span> <span class="n">score_list</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_aids_and_scores</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nscoretup</span> <span class="o">=</span> <span class="n">group_scores_by_name</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">sorted_nids</span><span class="p">,</span> <span class="n">sorted_nscore</span><span class="p">,</span> <span class="n">sorted_aids</span><span class="p">,</span> <span class="n">sorted_scores</span><span class="p">)</span> <span class="o">=</span> <span class="n">nscoretup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">sorted_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p># TODO: this code needs a really good test case
#&gt;&gt;&gt; result = np.array_repr(sorted_nids[0:2])
#&gt;&gt;&gt; print(result)
#array([1, 5])</p>
<dl class="docutils">
<dt>Ignore::</dt>
<dd># hack in dict of Nones prob for testing
import six
qres.aid2_prob = {aid:None for aid in six.iterkeys(qres.aid2_score)}</dd>
</dl>
<p>array([ 1,  5, 26])
[2 6 5]</p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.neighbor_index">
<span id="ibeis-model-hots-neighbor-index-module"></span><h2>ibeis.model.hots.neighbor_index module<a class="headerlink" href="#module-ibeis.model.hots.neighbor_index" title="Permalink to this headline">¶</a></h2>
<p>module which handles the building and caching of individual flann indexes</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first"># Runs the incremental query test
# {0:testdb1, 1:PZ_MTEST, 2:GZ_ALL, 3:PZ_Master0}
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:1
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:2
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:3</p>
<p class="last">utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0
utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:1
utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:3</p>
</dd>
</dl>
<dl class="class">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">NeighborIndex</tt><big>(</big><em>nnindexer</em>, <em>flann_params</em>, <em>cfgstr</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>wrapper class around flann
stores flann index and data it needs to index into</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.add_support">
<tt class="descname">add_support</tt><big>(</big><em>nnindexer</em>, <em>new_aid_list</em>, <em>new_vecs_list</em>, <em>new_fgws_list</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.add_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.add_support" title="Permalink to this definition">¶</a></dt>
<dd><p>adds support data (aka data to be indexed)</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_aid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_vecs_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">new_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_fgws_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_fgweights</span><span class="p">(</span><span class="n">new_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx1</span><span class="p">,</span> <span class="n">qfx2_dist1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="o">.</span><span class="n">add_support</span><span class="p">(</span><span class="n">new_aid_list</span><span class="p">,</span> <span class="n">new_vecs_list</span><span class="p">,</span> <span class="n">new_fgws_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx2</span><span class="p">,</span> <span class="n">qfx2_dist2</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_idx2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">qfx2_idx1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.build_and_save">
<tt class="descname">build_and_save</tt><big>(</big><em>nnindexer</em>, <em>cachedir</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.build_and_save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.build_and_save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.empty_neighbors">
<tt class="descname">empty_neighbors</tt><big>(</big><em>nnindexer</em>, <em>nQfx</em>, <em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.empty_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.empty_neighbors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.ext">
<tt class="descname">ext</tt><em class="property"> = '.flann'</em><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.ext" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_cfgstr">
<tt class="descname">get_cfgstr</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>returns string which uniquely identified configuration and support data</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_dtype">
<tt class="descname">get_dtype</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_dtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_dtype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_fname">
<tt class="descname">get_fname</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_fname"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_fname" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_fpath">
<tt class="descname">get_fpath</tt><big>(</big><em>nnindexer</em>, <em>cachedir</em>, <em>cfgstr=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_fpath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_indexed_aids">
<tt class="descname">get_indexed_aids</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_indexed_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_indexed_aids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_aids">
<tt class="descname">get_nn_aids</tt><big>(</big><em>nnindexer</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_nn_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_aids" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> &#8211; (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(N x K) qfx2_fx[n][k] is the annotation id index of the
kth approximate nearest data vector</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">qfx2_aid</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">pipeline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="n">dbname</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">indexer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_neighbors</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_nnidx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">num_neighbors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_aid</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">get_nn_aids</span><span class="p">(</span><span class="n">qfx2_nnidx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qfx2_aid</span><span class="o">.</span><span class="n">shape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">(1257, 4)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_axs">
<tt class="descname">get_nn_axs</tt><big>(</big><em>nnindexer</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_nn_axs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_axs" title="Permalink to this definition">¶</a></dt>
<dd><p>gets matching internal annotation indicies</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_featxs">
<tt class="descname">get_nn_featxs</tt><big>(</big><em>nnindexer</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_nn_featxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_featxs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> &#8211; (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(N x K) qfx2_fx[n][k] is the feature index (w.r.t the
source annotation) of the kth approximate
nearest data vector</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">qfx2_fx</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_fgws">
<tt class="descname">get_nn_fgws</tt><big>(</big><em>nnindexer</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_nn_fgws"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_fgws" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> &#8211; (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(N x K) qfx2_fgw[n][k] is the annotation id index of the
kth forground weight</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">qfx2_fgw</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_nnidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_fgw</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">get_nn_fgws</span><span class="p">(</span><span class="n">qfx2_nnidx</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_vecs">
<tt class="descname">get_nn_vecs</tt><big>(</big><em>nnindexer</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_nn_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_nn_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>gets matching vectors</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.get_prefix">
<tt class="descname">get_prefix</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.get_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.get_prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.init_support">
<tt class="descname">init_support</tt><big>(</big><em>nnindexer</em>, <em>aid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.init_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.init_support" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.knn">
<tt class="descname">knn</tt><big>(</big><em>nnindexer</em>, <em>qfx2_vec</em>, <em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.knn" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the indicies and squared distance to the nearest K neighbors.
The distance is noramlized between zero and one using
VEC_PSEUDO_MAX_DISTANCE = (np.sqrt(2) * VEC_PSEUDO_MAX)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>qfx2_vec</strong> &#8211; (N x D) an array of N, D-dimensional query vectors</li>
<li><strong>K</strong> &#8211; number of approximate nearest neighbors to find</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Returns: tuple of (qfx2_idx, qfx2_dist)</dt>
<dd><dl class="first last docutils">
<dt>qfx2_idx <span class="classifier-delimiter">:</span> <span class="classifier">(N x K) qfx2_idx[n][k] is the index of the kth</span></dt>
<dd>approximate nearest data vector w.r.t qfx2_vec[n]</dd>
<dt>qfx2_dist <span class="classifier-delimiter">:</span> <span class="classifier">(N x K) qfx2_dist[n][k] is the distance to the kth</span></dt>
<dd>approximate nearest data vector w.r.t. qfx2_vec[n]
distance is normalized squared euclidean distance.</dd>
</dl>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qfx2_dist</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s">&#39;distance should be less than 1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">(1257, 2) (1257, 2)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">nnindexer</span><span class="o">.</span><span class="n">get_dtype</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnindexer</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">(0, 2) (0, 2)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.load">
<tt class="descname">load</tt><big>(</big><em>nnindexer</em>, <em>cachedir</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.load_or_build">
<tt class="descname">load_or_build</tt><big>(</big><em>nnindexer</em>, <em>cachedir</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.load_or_build"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.load_or_build" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.num_indexed_annots">
<tt class="descname">num_indexed_annots</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.num_indexed_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.num_indexed_annots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.num_indexed_vecs">
<tt class="descname">num_indexed_vecs</tt><big>(</big><em>nnindexer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.num_indexed_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.num_indexed_vecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.prefix1">
<tt class="descname">prefix1</tt><em class="property"> = 'flann'</em><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.prefix1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.reindex">
<tt class="descname">reindex</tt><big>(</big><em>nnindexer</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.reindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.reindex" title="Permalink to this definition">¶</a></dt>
<dd><p>indexes all vectors with FLANN.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.NeighborIndex.save">
<tt class="descname">save</tt><big>(</big><em>nnindexer</em>, <em>cachedir</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#NeighborIndex.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.NeighborIndex.save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">UUIDMapHyrbridCache</tt><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#UUIDMapHyrbridCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>Class that lets multiple ways of writing to the uuid_map
be swapped in and out interchangably</p>
<p>TODO: the global read / write should periodically sync itself to disk and it
should be loaded from disk initially</p>
<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.dump">
<tt class="descname">dump</tt><big>(</big><em>cachedir</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#UUIDMapHyrbridCache.dump"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.dump" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.init">
<tt class="descname">init</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#UUIDMapHyrbridCache.init"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.init" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.load">
<tt class="descname">load</tt><big>(</big><em>cachedir</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#UUIDMapHyrbridCache.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.read_uuid_map_dict">
<tt class="descname">read_uuid_map_dict</tt><big>(</big><em>uuid_map_fpath</em>, <em>min_reindex_thresh</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#UUIDMapHyrbridCache.read_uuid_map_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.read_uuid_map_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>uses in memory dictionary instead of disk</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.write_uuid_map_dict">
<tt class="descname">write_uuid_map_dict</tt><big>(</big><em>uuid_map_fpath</em>, <em>visual_uuid_list</em>, <em>daids_hashid</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#UUIDMapHyrbridCache.write_uuid_map_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.UUIDMapHyrbridCache.write_uuid_map_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>uses in memory dictionary instead of disk</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.background_flann_func">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">background_flann_func</tt><big>(</big><em>cachedir</em>, <em>aid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>flann_params</em>, <em>cfgstr</em>, <em>uuid_map_fpath</em>, <em>daids_hashid</em>, <em>visual_uuid_list</em>, <em>min_reindex_thresh</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#background_flann_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.background_flann_func" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: Duplicate code</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.build_nnindex_cfgstr">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">build_nnindex_cfgstr</tt><big>(</big><em>qreq_</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#build_nnindex_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.build_nnindex_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>builds a string that  uniquely identified an indexer built with parameters
from the input query requested and indexing descriptor from the input
annotation ids</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nnindex_cfgstr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -c &#8216;import utool; print(utool.auto_docstr(&#8220;ibeis.model.hots.neighbor_index&#8221;, &#8220;build_nnindex_cfgstr&#8221;))&#8217;
python -m ibeis.model.hots.neighbor_index &#8211;test-build_nnindex_cfgstr</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindex_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">_VUUIDS((6)fvpdb9cud49@ll@+)_FLANN(8_kdtrees)_FEATWEIGHT(ON,uselabel,rf)_FEAT(hesaff+sift_)_CHIP(sz450)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.can_request_background_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">can_request_background_nnindexer</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#can_request_background_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.can_request_background_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.check_background_process">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">check_background_process</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#check_background_process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.check_background_process" title="Permalink to this definition">¶</a></dt>
<dd><p>checks to see if the process has finished and then
writes the uuid map to disk</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.clear_memcache">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">clear_memcache</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#clear_memcache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.clear_memcache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.clear_uuid_cache">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">clear_uuid_cache</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#clear_uuid_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.clear_uuid_cache" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-clear_uuid_cache</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fgws_list</span> <span class="o">=</span> <span class="n">clear_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fgws_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.get_data_cfgstr">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">get_data_cfgstr</tt><big>(</big><em>ibs</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#get_data_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.get_data_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>part 2 data hash id</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.get_fgweights_hack">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">get_fgweights_hack</tt><big>(</big><em>qreq_</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#get_fgweights_hack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.get_fgweights_hack" title="Permalink to this definition">¶</a></dt>
<dd><p>hack to get  feature weights. returns None if feature weights are turned off
in config settings</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.get_nnindexer_uuid_map_fpath">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">get_nnindexer_uuid_map_fpath</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#get_nnindexer_uuid_map_fpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.get_nnindexer_uuid_map_fpath" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uuid_map_fpath</span> <span class="o">=</span> <span class="n">get_nnindexer_uuid_map_fpath</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">path_ndir_split</span><span class="p">(</span><span class="n">uuid_map_fpath</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">_ibeis_cache/flann/uuid_map_FLANN(8_kdtrees)_FEAT(hesaff+sift_)_CHIP(sz450).cPkl</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.group_daids_by_cached_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">group_daids_by_cached_nnindexer</tt><big>(</big><em>qreq_</em>, <em>aid_list</em>, <em>min_reindex_thresh</em>, <em>max_covers=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#group_daids_by_cached_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.group_daids_by_cached_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: This function is slow due to ibs.get_annot_aids_from_visual_uuid
282.253 seconds for 600 queries</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-group_daids_by_cached_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZEB_PLAIN</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Set the params a bit lower</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_covers</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># STEP 0: CLEAR THE CACHE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clear_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># STEP 1: ASSERT EMPTY INDEX</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result1</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[]),</span> <span class="s">&#39;pre request&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># TEST 2: SHOULD MAKE 123 COVERED</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_memcached_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result2</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="p">([],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="s">&#39;post request&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.invert_index">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">invert_index</tt><big>(</big><em>vecs_list</em>, <em>ax_list</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#invert_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.invert_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregates descriptors of input annotations and returns inverted information</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.new_neighbor_index">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">new_neighbor_index</tt><big>(</big><em>aid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>flann_params</em>, <em>cachedir</em>, <em>cfgstr</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#new_neighbor_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.new_neighbor_index" title="Permalink to this definition">¶</a></dt>
<dd><p>constructs neighbor index independent of ibeis</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nnindexer</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgstr</span> <span class="o">=</span> <span class="n">nnindex_cfgstr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cachedir</span>     <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_flann_cachedir</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flann_params</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">flann_params</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Get annot descriptors to index</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid_list</span> <span class="o">=</span> <span class="n">daid_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vecs_list</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fgws_list</span> <span class="o">=</span> <span class="n">get_fgweights_hack</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">new_neighbor_index</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">vecs_list</span><span class="p">,</span> <span class="n">fgws_list</span><span class="p">,</span> <span class="n">flann_params</span><span class="p">,</span> <span class="n">cachedir</span><span class="p">,</span> <span class="n">cfgstr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.prepare_index_data">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">prepare_index_data</tt><big>(</big><em>aid_list</em>, <em>vecs_list</em>, <em>fgws_list</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#prepare_index_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.prepare_index_data" title="Permalink to this definition">¶</a></dt>
<dd><p>flattens vecs_list and builds a reverse index from the flattened indicies
(idx) to the original aids and fxs</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.print_uuid_cache">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">print_uuid_cache</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#print_uuid_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.print_uuid_cache" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-print_uuid_cache</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;PZ_Master0&#39;</span>  <span class="c"># &#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.read_uuid_map">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">read_uuid_map</tt><big>(</big><em>uuid_map_fpath</em>, <em>min_reindex_thresh</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#read_uuid_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.read_uuid_map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.request_augmented_ibeis_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">request_augmented_ibeis_nnindexer</tt><big>(</big><em>qreq_</em>, <em>daid_list</em>, <em>verbose=True</em>, <em>use_memcache=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#request_augmented_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.request_augmented_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>DO NOT USE. THIS FUNCTION CAN CURRENTLY CAUSE A SEGFAULT</p>
<p>tries to give you an indexer for the requested daids using the least amount
of computation possible. By loading and adding to a partially build nnindex
if possible and if that fails fallbs back to request_memcache.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nnindex_cfgstr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-request_augmented_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZEB_PLAIN</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_memcache</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_covers</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># CLEAR CACHE for clean test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clear_uuid_cache</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># LOAD 3 AIDS INTO CACHE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Should fallback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_augmented_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># assert the fallback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result2</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="s">&#39;pre augment&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Should augment</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_augmented_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span> <span class="o">=</span> <span class="n">group_daids_by_cached_nnindexer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">min_reindex_thresh</span><span class="p">,</span> <span class="n">max_covers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result3</span> <span class="o">=</span> <span class="n">uncovered_aids</span><span class="p">,</span> <span class="n">covered_aids_list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">result3</span><span class="p">,</span> <span class="p">([],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]),</span> <span class="s">&#39;post augment&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Should fallback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer2</span> <span class="o">=</span> <span class="n">request_augmented_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">nnindexer</span> <span class="ow">is</span> <span class="n">nnindexer2</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.request_background_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">request_background_nnindexer</tt><big>(</big><em>qreq_</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#request_background_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.request_background_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: Duplicate code</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-request_background_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">neighbor_index</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighbor_index</span><span class="o">.</span><span class="n">request_background_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.request_diskcached_ibeis_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">request_diskcached_ibeis_nnindexer</tt><big>(</big><em>qreq_</em>, <em>daid_list</em>, <em>nnindex_cfgstr=None</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#request_diskcached_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.request_diskcached_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>builds new NeighborIndexer which will try to use a disk cached flann if
available</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nnindexer</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">NeighborIndexer</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-request_diskcached_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindex_cfgstr</span> <span class="o">=</span> <span class="n">build_nnindex_cfgstr</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_diskcached_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">nnindex_cfgstr</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.request_ibeis_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">request_ibeis_nnindexer</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em>, <em>use_memcache=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#request_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.request_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>CALLED BY QUERYREQUST::LOAD_INDEXER</p>
<p>FIXME: and use params from qparams instead of ibs.cfg
IBEIS interface into neighbor_index</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nnindexer</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">NeighborIndexer</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-request_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.request_memcached_ibeis_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">request_memcached_ibeis_nnindexer</tt><big>(</big><em>qreq_</em>, <em>daid_list</em>, <em>use_memcache=True</em>, <em>verbose=True</em>, <em>veryverbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#request_memcached_ibeis_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.request_memcached_ibeis_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p>FOR INTERNAL USE ONLY
takes custom daid list. might not be the same as what is in <a href="#id15"><span class="problematic" id="id16">qreq_</span></a></p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.neighbor_index &#8211;test-request_memcached_ibeis_nnindexer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">min_reindex_thresh</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZEB_PLAIN</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ZEB_PLAIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">daid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_memcache</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span> <span class="o">=</span> <span class="n">request_memcached_ibeis_nnindexer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">use_memcache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nnindexer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.test_nnindexer">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">test_nnindexer</tt><big>(</big><em>dbname='testdb1'</em>, <em>with_indexer=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#test_nnindexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.test_nnindexer" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.neighbor_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnindexer</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_nnindexer</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.neighbor_index.write_uuid_map">
<tt class="descclassname">ibeis.model.hots.neighbor_index.</tt><tt class="descname">write_uuid_map</tt><big>(</big><em>uuid_map_fpath</em>, <em>visual_uuid_list</em>, <em>daids_hashid</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/neighbor_index.html#write_uuid_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.neighbor_index.write_uuid_map" title="Permalink to this definition">¶</a></dt>
<dd><p>let the multi-indexer know about any big caches we&#8217;ve made multi-indexer.
Also lets nnindexer know about other prebuilt indexers so it can attempt to
just add points to them as to avoid a rebuild.</p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.nn_weights">
<span id="ibeis-model-hots-nn-weights-module"></span><h2>ibeis.model.hots.nn_weights module<a class="headerlink" href="#module-ibeis.model.hots.nn_weights" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.nn_weights.apply_normweight">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">apply_normweight</tt><big>(</big><em>normweight_fn</em>, <em>qaid</em>, <em>qfx2_idx</em>, <em>qfx2_dist</em>, <em>rule</em>, <em>K</em>, <em>Knorm</em>, <em>qreq_</em>, <em>with_metadata</em>, <em>metakey_metadata</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#apply_normweight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.apply_normweight" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>helper: applies the normalized weight function to one query annotation</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>normweight_fn (func): chosen weight function e.g. lnbnn
qaid (int): query annotation id
qfx2_idx (ndarray):
qfx2_dist (ndarray):
rule (str):
K (int):
Knorm (int):
<a href="#id17"><span class="problematic" id="id18">qreq_</span></a> (QueryRequest): hyper-parameters
with_metadata (bool):
metadata (dict):</dd>
<dt>Returns:</dt>
<dd>ndarray: qfx2_normweight</dd>
<dt>Example:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># SLOW_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;K&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s">&#39;Knorm&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;normalizer_rule&#39;</span><span class="p">:</span> <span class="s">&#39;name&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">K</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Knorm</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">lnbnn_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rule</span>  <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">normalizer_rule</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">qaid2_nns</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_metadata</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metakey_metadata</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_normweight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">apply_normweight</span><span class="p">(</span><span class="n">normweight_fn</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">qfx2_idx</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">qfx2_dist</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">Knorm</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">with_metadata</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">metakey_metadata</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Timeits:</dt>
<dd>%timeit qfx2_dist.T[0:K].T
%timeit qfx2_dist[:, 0:K]</dd>
<dt>Ignore:</dt>
<dd>print(&#8216;</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>&#8216;.join(((</dt>
<dd>&#8216;&gt;&gt;&gt; ndist = np.&#8217; + np.array_repr(ndist.T).replace(&#8216; ...,&#8217;, &#8216;&#8217;) + &#8216;.T&#8217;),
&#8216;&gt;&gt;&gt; vdist = np.&#8217; + np.array_repr(vdist.T).replace(&#8216; ...,&#8217;, &#8216;&#8217;) + &#8216;.T&#8217;)
))</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.componentwise_uint8_dot">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">componentwise_uint8_dot</tt><big>(</big><em>qfx2_qvec</em>, <em>qfx2_dvec</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#componentwise_uint8_dot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.componentwise_uint8_dot" title="Permalink to this definition">¶</a></dt>
<dd><p>a dot product is a componentwise multiplication of
two vector and then a sum. Do that for arbitary vectors.
Remember to cast uint8 to float32 and then divide by 255**2.
BUT THESE ARE SIFT DESCRIPTORS WHICH USE THE SMALL UINT8 TRICK
DIVIDE BY 512**2 instead</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.cos_match_weighter">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">cos_match_weighter</tt><big>(</big><em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#cos_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.cos_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cos_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Knorm</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">cos_weight</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;bug setting custom params cos_weight&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_cos_weight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">cos_match_weighter</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Dev::</dt>
<dd><p class="first">qnid = ibs.get_annot_name_rowids(qaid)
qfx2_nids = ibs.get_annot_name_rowids(<a href="#id19"><span class="problematic" id="id20">qreq_</span></a>.indexer.get_nn_aids(qfx2_idx.T[0:K].T))</p>
<p># remove first match
<a href="#id21"><span class="problematic" id="id22">qfx2_nids_</span></a> = qfx2_nids.T[1:].T
<a href="#id23"><span class="problematic" id="id24">qfx2_cos_</span></a>  = qfx2_cos.T[1:].T</p>
<p># flags of unverified &#8216;correct&#8217; matches
qfx2_samename = <a href="#id25"><span class="problematic" id="id26">qfx2_nids_</span></a> == qnid</p>
<dl class="last docutils">
<dt>for k in [1, None]:</dt>
<dd><dl class="first last docutils">
<dt>for alpha in [.01, .1, 1, 3, 10, 20, 50]:</dt>
<dd><p class="first">print(&#8216;&#8212;&#8212;-&#8216;)
print(&#8216;alpha = %r&#8217; % alpha)
print(&#8216;k = %r&#8217; % k)
qfx2_cosweight = np.multiply(np.sign(<a href="#id27"><span class="problematic" id="id28">qfx2_cos_</span></a>), np.power(<a href="#id29"><span class="problematic" id="id30">qfx2_cos_</span></a>, alpha))
if k is None:</p>
<blockquote>
<div>qfx2_weight = qfx2_cosweight
flag = qfx2_samename</div></blockquote>
<dl class="docutils">
<dt>else:</dt>
<dd>qfx2_weight = qfx2_cosweight.T[0:k].T
flag = qfx2_samename.T[0:k].T</dd>
</dl>
<p class="last">#print(qfx2_weight)
#print(flag)
<a href="#id31"><span class="problematic" id="id32">good_stats_</span></a> = ut.get_stats(qfx2_weight[flag])
<a href="#id33"><span class="problematic" id="id34">bad_stats_</span></a> = ut.get_stats(qfx2_weight[~flag])
print(&#8216;good_matches = &#8216; + ut.dict_str(<a href="#id35"><span class="problematic" id="id36">good_stats_</span></a>))
print(&#8216;bad_matchees = &#8216; + ut.dict_str(<a href="#id37"><span class="problematic" id="id38">bad_stats_</span></a>))
print(&#8216;diff_mean = &#8216; + str(good_stats_[&#8216;mean&#8217;] - bad_stats_[&#8216;mean&#8217;]))</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.dist_fn">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">dist_fn</tt><big>(</big><em>vdist</em>, <em>ndist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#dist_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.dist_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>just use straight up distance</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.distinctiveness_match_weighter">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">distinctiveness_match_weighter</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#distinctiveness_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.distinctiveness_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">featweight_on</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fg_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone_dist_extern_distinctiveness&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
</pre></div>
</div>
<p>TODO: finish intergration</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.dupvote_match_weighter">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">dupvote_match_weighter</tt><big>(</big><em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#dupvote_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.dupvote_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd><p>dupvotes gives duplicate name votes a weight close to 0.</p>
<p>Each query feature is only allowed to vote for each name at most once.
IE: a query feature can vote for multiple names, but it cannot vote
for the same name twice.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python dev.py &#8211;allgt -t best &#8211;db PZ_MTEST
python dev.py &#8211;allgt -t nsum &#8211;db PZ_MTEST
python dev.py &#8211;allgt -t dupvote &#8211;db PZ_MTEST</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#tup = nn_weights.testdata_nn_weights(&#39;testdb1&#39;, slice(0, 1), slice(0, 11))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;testdb1&#39;</span>  <span class="c"># &#39;GZ_ALL&#39;  # &#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Knorm</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Test Function Call</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_dupvote_weight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">dupvote_match_weighter</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Check consistency</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_dupvote_weight</span> <span class="o">=</span> <span class="n">qaid2_dupvote_weight</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flags</span> <span class="o">=</span> <span class="n">qfx2_dupvote_weight</span>  <span class="o">&gt;</span> <span class="o">.</span><span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_topnid</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">indexer</span><span class="o">.</span><span class="n">get_nn_aids</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isunique_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">isunique</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">flag</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">qfx2_topnid</span><span class="p">,</span> <span class="n">flags</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">isunique_list</span><span class="p">),</span> <span class="s">&#39;dupvote should only allow one vote per name&#39;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>./dev.py -t nsum &#8211;db GZ_ALL &#8211;show &#8211;va -w &#8211;qaid 1032
./dev.py -t nsum_nosv &#8211;db GZ_ALL &#8211;show &#8211;va -w &#8211;qaid 1032</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.fg_match_weighter">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">fg_match_weighter</tt><big>(</big><em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#fg_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.fg_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd><p>foreground feature match weighting</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">featweight_on</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fg_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">dict_str</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">featweight_on</span> <span class="o">==</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;bug setting custom params featweight_on&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">fg_weight</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;bug setting custom params fg_weight&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_fgvote_weight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">fg_match_weighter</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.get_name_normalizers">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">get_name_normalizers</tt><big>(</big><em>qaid</em>, <em>qreq_</em>, <em>K</em>, <em>Knorm</em>, <em>qfx2_idx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#get_name_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.get_name_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><p>helper: normalizers for &#8216;name&#8217; rule</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation id</li>
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">qfx2_normk</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_daids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">nn_cfg</span><span class="o">.</span><span class="n">K</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Knorm</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span><span class="o">.</span><span class="n">nn_cfg</span><span class="o">.</span><span class="n">Knorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">lnbnn_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">qaid2_nns</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_nndist</span> <span class="o">=</span> <span class="n">qfx2_dist</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">K</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.gravity_match_weighter">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">gravity_match_weighter</tt><big>(</big><em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#gravity_match_weighter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.gravity_match_weighter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.lnbnn_fn">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">lnbnn_fn</tt><big>(</big><em>vdist</em>, <em>ndist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#lnbnn_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.lnbnn_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>Locale Naive Bayes Nearest Neighbor weighting</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>  <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndist</span> <span class="o">=</span> <span class="n">ndists</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>  <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist1</span> <span class="o">=</span> <span class="n">vdist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist2</span> <span class="o">=</span> <span class="n">vdist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist3</span> <span class="o">=</span> <span class="n">vdist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist4</span> <span class="o">=</span> <span class="n">vdist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">lnbnn_fn</span><span class="p">(</span><span class="n">vdist1</span><span class="p">,</span> <span class="n">ndist</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">lnbnn_fn</span><span class="p">(</span><span class="n">vdist2</span><span class="p">,</span> <span class="n">ndist</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">lnbnn_fn</span><span class="p">(</span><span class="n">vdist3</span><span class="p">,</span> <span class="n">ndist</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">lnbnn_fn</span><span class="p">(</span><span class="n">vdist4</span><span class="p">,</span> <span class="n">ndist</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.loglnbnn_fn">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">loglnbnn_fn</tt><big>(</big><em>vdist</em>, <em>ndist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#loglnbnn_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.loglnbnn_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.logratio_fn">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">logratio_fn</tt><big>(</big><em>vdist</em>, <em>ndist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#logratio_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.logratio_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.mark_name_valid_normalizers">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">mark_name_valid_normalizers</tt><big>(</big><em>qfx2_normnid</em>, <em>qfx2_topnid</em>, <em>qnid=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#mark_name_valid_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.mark_name_valid_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><p>helper: Allows matches only to the first result of a given name</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qnid</strong> (<em>int</em>) &#8211; query name id</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">qfx2_selnorm - index of the selected normalizer for each query feature</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.nn_normalized_weight">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">nn_normalized_weight</tt><big>(</big><em>normweight_fn</em>, <em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#nn_normalized_weight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.nn_normalized_weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic function to weight nearest neighbors</p>
<p>ratio, lnbnn, and other nearest neighbor based functions use this</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>normweight_fn</strong> (<em>func</em>) &#8211; chosen weight function e.g. lnbnn</li>
<li><strong>qaid2_nns</strong> (<em>dict</em>) &#8211; query descriptor nearest neighbors and distances. qaid -&gt; (qfx2_nnx, qfx2_dist)</li>
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">qaid2_weight</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;PZ_MTEST&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_daids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">lnbnn_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_weight1</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">nn_normalized_weight</span><span class="p">(</span><span class="n">normweight_fn</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights1</span> <span class="o">=</span> <span class="n">qaid2_weight1</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn_normonly_weight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">NN_WEIGHT_FUNC_DICT</span><span class="p">[</span><span class="s">&#39;lnbnn&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_weight2</span> <span class="o">=</span> <span class="n">nn_normonly_weight</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights2</span> <span class="o">=</span> <span class="n">qaid2_weight2</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">weights1</span> <span class="o">==</span> <span class="n">weights2</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">nn_weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;PZ_MTEST&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">testdata_nn_weights</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_daids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normweight_fn</span> <span class="o">=</span> <span class="n">ratio_fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_weight1</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">nn_normalized_weight</span><span class="p">(</span><span class="n">normweight_fn</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights1</span> <span class="o">=</span> <span class="n">qaid2_weight1</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn_normonly_weight</span> <span class="o">=</span> <span class="n">nn_weights</span><span class="o">.</span><span class="n">NN_WEIGHT_FUNC_DICT</span><span class="p">[</span><span class="s">&#39;ratio&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_weight2</span> <span class="o">=</span> <span class="n">nn_normonly_weight</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights2</span> <span class="o">=</span> <span class="n">qaid2_weight2</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">weights1</span> <span class="o">==</span> <span class="n">weights2</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>#from ibeis.model.hots import neighbor_index as hsnbrx
#nnindexer = hsnbrx.request_ibeis_nnindexer(<a href="#id39"><span class="problematic" id="id40">qreq_</span></a>)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.normonly_fn">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">normonly_fn</tt><big>(</big><em>vdist</em>, <em>ndist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#normonly_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.normonly_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.ratio_fn">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">ratio_fn</tt><big>(</big><em>vdist</em>, <em>ndist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#ratio_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.ratio_fn" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vdist</strong> (<em>ndarray</em>) &#8211; voting array</li>
<li><strong>ndist</strong> (<em>ndarray</em>) &#8211; normalizing array</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">out</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">60408.</span><span class="p">,</span>   <span class="mf">61594.</span><span class="p">,</span>  <span class="mf">111387.</span><span class="p">,</span> <span class="mf">120138.</span><span class="p">,</span> <span class="mf">124307.</span><span class="p">,</span>  <span class="mf">125625.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">ratio_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_repr</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">array([[ 0.,  0.,  0.,  0.,  0.,  0.]], dtype=float32)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.nn_weights</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vdist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">79260.</span><span class="p">,</span>  <span class="mf">138617.</span><span class="p">,</span>   <span class="mf">47964.</span><span class="p">,</span>  <span class="mf">127839.</span><span class="p">,</span>  <span class="mf">123543.</span><span class="p">,</span>  <span class="mf">112204.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">83370.</span><span class="p">,</span>  <span class="mf">146245.</span><span class="p">,</span>  <span class="mf">128620.</span><span class="p">,</span>  <span class="mf">129598.</span><span class="p">,</span>  <span class="mf">126165.</span><span class="p">,</span>  <span class="mf">124761.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">ratio_fn</span><span class="p">(</span><span class="n">vdist</span><span class="p">,</span> <span class="n">ndist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_repr</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">array([[ 0.95,  0.95,  0.37,  0.99,  0.98,  0.9 ]], dtype=float32)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.test_all_normalized_weights">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">test_all_normalized_weights</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#test_all_normalized_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.test_all_normalized_weights" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_all_normalized_weights</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.nn_weights.testdata_nn_weights">
<tt class="descclassname">ibeis.model.hots.nn_weights.</tt><tt class="descname">testdata_nn_weights</tt><big>(</big><em>dbname='testdb1'</em>, <em>qaid_list=None</em>, <em>daid_list=None</em>, <em>cfgdict={}</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/nn_weights.html#testdata_nn_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.nn_weights.testdata_nn_weights" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fg_weight&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.pipeline">
<span id="ibeis-model-hots-pipeline-module"></span><h2>ibeis.model.hots.pipeline module<a class="headerlink" href="#module-ibeis.model.hots.pipeline" title="Permalink to this headline">¶</a></h2>
<p>Hotspotter pipeline module</p>
<dl class="docutils">
<dt>TODO:</dt>
<dd>We need to remove dictionaries from the pipeline
We can easily use parallel lists</dd>
</dl>
<p>Module Concepts:</p>
<div class="highlight-python"><div class="highlight"><pre>PREFIXES:
qaid2_XXX - prefix mapping query chip index to
qfx2_XXX  - prefix mapping query chip feature index to

 * nns    - a (qfx2_idx, qfx2_dist) tuple
 * nnfilts - a (qfx2_score_list, qfx2_valid_list) tuple

 * idx    - the index into the nnindexers descriptors
 * qfx    - query feature index wrt the query chip
 * dfx    - query feature index wrt the database chip
 * dist   - the distance to a corresponding feature
 * fm     - a list of featur match pairs (qfx, dfx)
 * fsv    - a score vector of a corresponding feature
 * valid  - a valid bit for a corresponding feature

PIPELINE_VARS::
qaid2_nns - maping from query chip index to nns
{
 * qfx2_idx   - ranked list of query feature indexes to database feature indexes
 * qfx2_dist - ranked list of query feature indexes to database feature indexes
}

* qaid2_norm_weight - mapping from qaid to (qfx2_normweight, qfx2_selnorm)
         = qaid2_nnfiltagg[qaid]
</pre></div>
</div>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">To see the ouput of a complete pipeline run use</p>
<p># Set to whichever database you like
python main.py &#8211;db PZ_MTEST &#8211;setdb
python main.py &#8211;db NAUT_test &#8211;setdb
python main.py &#8211;db testdb1 &#8211;setdb</p>
<p class="last"># Then run whichever configuration you like
python main.py &#8211;verbose &#8211;noqcache &#8211;cfg codename:vsone  &#8211;query 1
python main.py &#8211;verbose &#8211;noqcache &#8211;cfg codename:vsone_norm  &#8211;query 1
python main.py &#8211;verbose &#8211;noqcache &#8211;cfg codename:vsmany &#8211;query 1
python main.py &#8211;verbose &#8211;noqcache &#8211;cfg codename:vsmany_nsum  &#8211;query 1</p>
</dd>
</dl>
<dl class="function">
<dt id="ibeis.model.hots.pipeline.append_chipmatch_vsmany_nonagg">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">append_chipmatch_vsmany_nonagg</tt><big>(</big><em>valid_match_tup</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#append_chipmatch_vsmany_nonagg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.append_chipmatch_vsmany_nonagg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.append_chipmatch_vsone_nonagg">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">append_chipmatch_vsone_nonagg</tt><big>(</big><em>valid_match_tup</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#append_chipmatch_vsone_nonagg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.append_chipmatch_vsone_nonagg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.baseline_neighbor_filter">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">baseline_neighbor_filter</tt><big>(</big><em>qreq_</em>, <em>qaid2_nns</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#baseline_neighbor_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.baseline_neighbor_filter" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
<li><strong>qaid2_nns</strong> (<em>dict</em>) &#8211; maps query annotid to (qfx2_idx, qfx2_dist)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">mapping from qaid to qfx2_valid0</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">qaid2_nnvalid0</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-baseline_neighbor_filter</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>   <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="n">dbname</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;baseline_neighbor_filter&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">locals_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;qaid2_nns&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nnvalid0</span> <span class="o">=</span> <span class="n">baseline_neighbor_filter</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnvalid0</span> <span class="o">=</span> <span class="n">qaid2_nnvalid0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nnvalid0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="p">(</span>
<span class="gp">... </span>   <span class="s">&#39;first col should be all invalid because of self match&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">nnvalid0</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span>
<span class="gp">... </span>   <span class="s">&#39;second col should have some good matches&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">nnvalid0</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">1900</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
<p>Removes matches to self, the same image, or the same name.</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.build_chipmatches">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">build_chipmatches</tt><big>(</big><em>qreq_</em>, <em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qaid2_nnfilts</em>, <em>qaid2_nnfiltagg</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#build_chipmatches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.build_chipmatches" title="Permalink to this definition">¶</a></dt>
<dd><p>pipeline step 4 - builds sparse chipmatches</p>
<p>Takes the dense feature matches from query feature to (what could be any)
database features and builds sparse matching pairs for each annotation to
annotation match.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</li>
<li><strong>qaid2_nns</strong> (<em>dict</em>) &#8211; dict of assigned nearest features (only indexes are
used here)</li>
<li><strong>qaid2_nnfilts</strong> (<em>dict</em>) &#8211; nonaggregate feature scores and validities for
each feature NEW</li>
<li><strong>qaid2_nnfiltagg</strong> (<em>dict</em>) &#8211; dict of (qfx2_score, qfx2_valid) where the
scores and matches correspond to the assigned nearest features
CURRENTLY UNUSED</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>qaid2_chipmatch - mapping from qaid to chipmatch
a chipmatch is a tuple (fm, fsv, fk)</p>
<blockquote>
<div><p>fm := list of feature matchs
fsv := list of feature scores vectors
fk := list of feature ranks
H := homog or None</p>
</div></blockquote>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>The prefix <tt class="docutils literal"><span class="pre">qaid2_</span></tt> denotes a mapping where keys are query-annotation-id</p>
<p>vsmany/vsone counts here. also this is where the filter
weights and thershold are applied to the matches. Essientally
nearest neighbors are converted into weighted assignments</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>python -c &#8220;import utool; print(utool.auto_docstr(&#8216;ibeis.model.hots.pipeline&#8217;, &#8216;build_chipmatches&#8217;))&#8221;</dd>
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-build_chipmatches
python -m ibeis.model.hots.pipeline &#8211;test-build_chipmatches:0
python -m ibeis.model.hots.pipeline &#8211;test-build_chipmatches:1</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># get testdata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">testdata_build_chipmatch</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_nnfilts</span><span class="p">,</span> <span class="n">qaid2_nnfiltagg</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_daids</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;daid=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">daid</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;qaid=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qaid</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fsv</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_matches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;vsone num_matches = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">num_matches</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey_list</span> <span class="o">=</span> <span class="n">qaid2_nnfilts</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;filtkey_list = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filtkey_list</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;feat matches have 2 cols (qfx, dfx)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">),</span> <span class="s">&#39;feat score vectors have 1 col per filt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">num_matches</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;vsone nmatches out of bounds&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plh</span><span class="o">.</span><span class="n">assert_qaid2_chipmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsmany&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#cfgdict = dict(codename=&#39;vsmany_csum&#39;, dupvote_weight=&#39;0.0&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># get testdata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;build_chipmatches&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_take</span><span class="p">(</span><span class="n">locals_</span><span class="p">,</span>
<span class="gp">... </span>   <span class="p">[</span><span class="s">&#39;qaid2_nns&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnvalid0&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnfilts&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnfiltagg&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_nnfilts</span><span class="p">,</span> <span class="n">qaid2_nnfiltagg</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">build_chipmatches</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_daids</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_fm</span><span class="p">,</span> <span class="n">daid2_fsv</span><span class="p">,</span> <span class="n">daid_fk</span><span class="p">,</span> <span class="n">aid2_score</span><span class="p">,</span> <span class="n">daid2_H</span> <span class="o">=</span> <span class="n">chipmatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">daid2_fm</span><span class="p">[</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fsv</span> <span class="o">=</span> <span class="n">daid2_fsv</span><span class="p">[</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_matches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;vsmany num_matches = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">num_matches</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;fm needs 2 columns&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">num_matches</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="s">&#39;vsmany nmatches out of bounds&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plh</span><span class="o">.</span><span class="n">assert_qaid2_chipmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.chipmatch_to_resdict">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">chipmatch_to_resdict</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatch</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#chipmatch_to_resdict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.chipmatch_to_resdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a dictionary of chipmatch tuples into a dictionary of query results</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">qaid2_qres</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-chipmatch_to_resdict</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;chipmatch_to_resdict&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">chipmatch_to_resdict</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">sver_weighting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;chipmatch_to_resdict&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">chipmatch_to_resdict</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_filtkeys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">filtkey_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">num_filtkeys</span><span class="p">,</span> <span class="n">qres</span><span class="o">.</span><span class="n">aid2_fsv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">num_filtkeys</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">aid2_fsv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">115</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">aid2_fs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">qres</span><span class="o">.</span><span class="n">aid2_fsv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="s">&#39;math is broken&#39;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.filter_neighbors">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">filter_neighbors</tt><big>(</big><em>qreq_</em>, <em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>qaid2_filtweights</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#filter_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.filter_neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>converts feature weights to feature scores and validity masks</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
<li><strong>qaid2_nns</strong> (<em>dict</em>) &#8211; maps query annotid to (qfx2_idx, qfx2_dist)</li>
<li><strong>qaid2_nnvalid0</strong> (<em>dict</em>) &#8211; maps query annotid to qfx2_valid0</li>
<li><strong>qaid2_filtweights</strong> (<em>dict</em>) &#8211; mapping to weights computed by filters like
lnnbnn and ratio</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(qaid2_nnfilts, qaid2_nnfiltagg) - mappings from qaid
nnfilts is a tuple (filtkey_list, qfx2_score_list, qfx2_valid_list)
nnfiltsagg is a tuple (qfx2_score_agg, qfx2_valid_agg)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-filter_neighbors</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;filter_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">locals_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;qaid2_nns&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnvalid0&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_filtweights&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_filtweights</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Make sure internal qaids are behaving well</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">qaid2_nnvalid0</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">)),</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nnfilts</span><span class="p">,</span> <span class="n">qaid2_nnfiltagg</span> <span class="o">=</span> <span class="n">filter_neighbors</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_filtweights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Make sure we are getting expected filter scores back.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfilts</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">qaid2_nnfilts</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">,</span> <span class="n">qfx2_score_list</span><span class="p">,</span> <span class="n">qfx2_valid_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnfilts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expected_filtkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">LNBNN</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DUPVOTE</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">FG</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">,</span> <span class="n">expected_filtkeys</span><span class="p">,</span> <span class="s">&#39;bad filters&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_score_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">qfx2_score_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s">&#39;inconsistent shape&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qfx2_score_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1300</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">qfx2_valid_list</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_filtkeys</span><span class="p">),</span> <span class="s">&#39;all should be valid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.flag_impossible_votes">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">flag_impossible_votes</tt><big>(</big><em>qreq_</em>, <em>qaid</em>, <em>qfx2_nnidx</em>, <em>cant_match_self</em>, <em>cant_match_sameimg</em>, <em>cant_match_samename</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#flag_impossible_votes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.flag_impossible_votes" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags matches to self or same image</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.get_prescore_shortlist">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">get_prescore_shortlist</tt><big>(</big><em>qreq_</em>, <em>qaid</em>, <em>chipmatch</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#get_prescore_shortlist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.get_prescore_shortlist" title="Permalink to this definition">¶</a></dt>
<dd><p>computes which of the annotations should continue in the next pipeline step
based on the current score.</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;spatial_verification&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_FILT&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">topx2_aid</span><span class="p">,</span> <span class="n">nRerank</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_prescore_shortlist</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.get_sparse_matchinfo_nonagg">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">get_sparse_matchinfo_nonagg</tt><big>(</big><em>qreq_</em>, <em>qfx2_idx</em>, <em>qfx2_valid0</em>, <em>nnfilts</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#get_sparse_matchinfo_nonagg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.get_sparse_matchinfo_nonagg" title="Permalink to this definition">¶</a></dt>
<dd><p>builds sparse iterator that generates feature match pairs, scores, and ranks</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qfx2_idx</strong> (<em>ndarray[int32_t, ndims=2]</em>) &#8211; mapping from query feature index
to db neighbor index</li>
<li><strong>nnfilts</strong> (<em>tuple</em>) &#8211; (filtkey_list, qfx2_score_list, qfx2_valid_list)</li>
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">valid_match_tup</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-get_sparse_matchinfo_nonagg</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsmany&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># get testdata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">testdata_build_chipmatch</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_nnfilts</span><span class="p">,</span> <span class="n">qaid2_nnfiltagg</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_daids</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_idx</span> <span class="o">=</span> <span class="n">qaid2_nns</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_valid0</span> <span class="o">=</span> <span class="n">qaid2_nnvalid0</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfilts</span> <span class="o">=</span> <span class="n">qaid2_nnfilts</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfiltagg</span> <span class="o">=</span> <span class="n">qaid2_nnfiltagg</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">,</span> <span class="n">qfx2_score_list</span><span class="p">,</span> <span class="n">qfx2_valid_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnfilts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_score_agg</span><span class="p">,</span> <span class="n">qfx2_valid_agg</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnfiltagg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_match_tup</span> <span class="o">=</span> <span class="n">get_sparse_matchinfo_nonagg</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_valid0</span><span class="p">,</span> <span class="n">nnfilts</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">append_chipmatch_vsmany_nonagg</span><span class="p">(</span><span class="n">valid_match_tup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">daid2_fm</span><span class="p">,</span> <span class="n">daid2_fsv</span><span class="p">,</span> <span class="n">daid2_fk</span><span class="p">,</span> <span class="n">aid2_score</span><span class="p">,</span> <span class="n">aid2_H</span><span class="p">)</span> <span class="o">=</span> <span class="n">chipmatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">daid2_fm</span><span class="p">[</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fsv</span> <span class="o">=</span> <span class="n">daid2_fsv</span><span class="p">[</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fk</span> <span class="o">=</span> <span class="n">daid2_fk</span><span class="p">[</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">aid2_H</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no H yet&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;column for (qfx, dfx)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;one rank for every match&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;fk (feature rank) is 1D&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;need same num rows&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">active_filter_list</span><span class="p">),</span> <span class="s">&#39;should have col for every filter&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># get testdata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">testdata_build_chipmatch</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_nnfilts</span><span class="p">,</span> <span class="n">qaid2_nnfiltagg</span><span class="p">)</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_daids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_idx</span> <span class="o">=</span> <span class="n">qaid2_nns</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_valid0</span> <span class="o">=</span> <span class="n">qaid2_nnvalid0</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfilts</span> <span class="o">=</span> <span class="n">qaid2_nnfilts</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfiltagg</span> <span class="o">=</span> <span class="n">qaid2_nnfiltagg</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">filtkey_list</span><span class="p">,</span> <span class="n">qfx2_score_list</span><span class="p">,</span> <span class="n">qfx2_valid_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnfilts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_score_agg</span><span class="p">,</span> <span class="n">qfx2_valid_agg</span><span class="p">)</span> <span class="o">=</span> <span class="n">nnfiltagg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_match_tup</span> <span class="o">=</span> <span class="n">get_sparse_matchinfo_nonagg</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_valid0</span><span class="p">,</span> <span class="n">nnfilts</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">fsv</span><span class="p">,</span> <span class="n">fk</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span> <span class="o">=</span> <span class="n">append_chipmatch_vsone_nonagg</span><span class="p">(</span><span class="n">valid_match_tup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no H yet&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;column for (qfx, dfx)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#ut.assert_eq(fm.shape[0], fk.shape[0], &#39;one rank for every match&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#ut.assert_eq(len(fk.shape), 1, &#39;fk (feature rank) is 1D&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;need same num rows&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">active_filter_list</span><span class="p">),</span> <span class="s">&#39;should have col for every filter&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_num_feats</span><span class="p">(</span><span class="n">daid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_num_feats</span><span class="p">(</span><span class="n">qaid</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.hack_fix_dupvote_weights">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">hack_fix_dupvote_weights</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatchSV</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#hack_fix_dupvote_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.hack_fix_dupvote_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>If the one feature allowed to match to a name was removed by spatial
verification then that feature never gets to vote.</p>
<p>Maybe that is a good thing, but maybe we should try and reclaim it.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python main.py &#8211;verbose &#8211;noqcache &#8211;cfg codename:vsmany_nsum  &#8211;query 1 &#8211;db PZ_MTEST</dd>
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-hack_fix_dupvote_weights</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="n">_spatial_verification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;spatial_verification&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_FILT&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nnfilts</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_nnfilts&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dupvotex</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">listfind</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">active_filter_list</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DUPVOTE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">dupvotex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;dupvotex=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dupvotex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatchSV</span> <span class="o">=</span> <span class="n">_spatial_verification</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">before</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fsv</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">dupvotex</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gp">... </span>             <span class="k">for</span> <span class="n">fsv</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">chipmatch</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="gp">... </span>                 <span class="k">for</span> <span class="n">chipmatch</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">qaid2_chipmatchSV</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">before_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">before</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;before_sum=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">before_sum</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">before_sum</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">2200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">total_reweighted</span> <span class="o">=</span> <span class="n">hack_fix_dupvote_weights</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatchSV</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;total_reweighted=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_reweighted</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">after</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fsv</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">dupvotex</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gp">... </span>             <span class="k">for</span> <span class="n">fsv</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">chipmatch</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="gp">... </span>                 <span class="k">for</span> <span class="n">chipmatch</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">qaid2_chipmatchSV</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">after_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">after</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;after_sum=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">after_sum</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">after_sum</span> <span class="o">-</span> <span class="n">before_sum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">after_sum</span> <span class="o">&gt;=</span> <span class="n">before_sum</span><span class="p">,</span> <span class="s">&#39;sum should increase only&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">after_sum</span><span class="p">,</span> <span class="mi">1950</span><span class="p">,</span> <span class="mi">2210</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">total_reweighted</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="n">total_reweighted</span><span class="p">,</span> <span class="o">-</span><span class="mf">1E-5</span><span class="p">,</span> <span class="mf">1E-5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">total_reweighted2</span> <span class="o">=</span> <span class="n">hack_fix_dupvote_weights</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatchSV</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;total_reweighted2=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_reweighted</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">total_reweighted2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;should be 0 reweighted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.nearest_neighbors">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">nearest_neighbors</tt><big>(</big><em>qreq_</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#nearest_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.nearest_neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>Plain Nearest Neighbors</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">qaid2_nns - a dict mapping query annnotation-ids to a nearest
neighbor tuple (qfx2_idx, qfx2_dist). indexes and dist have the
shape (nDesc x K) where nDesc is the number of descriptors in the
annotation, and K is the number of approximate nearest neighbors.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-nearest_neighbors</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                            <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nns</span> <span class="o">=</span> <span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nns</span> <span class="o">=</span> <span class="n">qaid2_nns</span><span class="p">[</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">nns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Assert dictionary corresponds to internal qaids</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">qaid2_nns</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">qaids</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Assert nns tuple is valid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_inbounds</span><span class="p">(</span><span class="n">qfx2_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.new_chipmatch">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">new_chipmatch</tt><big>(</big><em>with_homog=False</em>, <em>with_score=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#new_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.new_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd><p>returns new chipmatch for a single qaid</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.precompute_topx2_dlen_sqrd">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">precompute_topx2_dlen_sqrd</tt><big>(</big><em>qreq_</em>, <em>aid2_fm</em>, <em>topx2_aid</em>, <em>topx2_kpts</em>, <em>nRerank</em>, <em>use_chip_extent</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#precompute_topx2_dlen_sqrd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.precompute_topx2_dlen_sqrd" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for spatial verification, computes the squared diagonal length of
matching chips</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">topx2_dlen_sqrd</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-precompute_topx2_dlen_sqrd</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;spatial_verification&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_FILT&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topx2_aid</span><span class="p">,</span> <span class="n">nRerank</span> <span class="o">=</span> <span class="n">get_prescore_shortlist</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">aid2_fm</span><span class="p">,</span> <span class="n">aid2_fsv</span><span class="p">,</span> <span class="n">aid2_fk</span><span class="p">,</span> <span class="n">aid2_score</span><span class="p">,</span> <span class="n">aid2_H</span><span class="p">)</span> <span class="o">=</span> <span class="n">chipmatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kpts1</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_kpts</span><span class="p">(</span><span class="n">qaid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topx2_kpts</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_kpts</span><span class="p">(</span><span class="n">topx2_aid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_chip_extent</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topx2_dlen_sqrd</span> <span class="o">=</span> <span class="n">precompute_topx2_dlen_sqrd</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">aid2_fm</span><span class="p">,</span> <span class="n">topx2_aid</span><span class="p">,</span> <span class="n">topx2_kpts</span><span class="p">,</span> <span class="n">nRerank</span><span class="p">,</span> <span class="n">use_chip_extent</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.prescore_nsum">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">prescore_nsum</tt><big>(</big><em>qreq_</em>, <em>daid2_prescore</em>, <em>nShortlist</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#prescore_nsum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.prescore_nsum" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-prescore_nsum</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum_unnorm&#39;</span><span class="p">,</span> <span class="n">index_method</span><span class="o">=</span><span class="s">&#39;single&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;spatial_verification&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_FILT&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nShortlist</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">nShortlist</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prescore_method</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">prescore_method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">prescore_method</span><span class="p">,</span> <span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="s">&#39;pipeline supposed to be nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_prescore</span> <span class="o">=</span> <span class="n">score_chipmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">,</span> <span class="n">prescore_method</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.request_ibeis_query_L0">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">request_ibeis_query_L0</tt><big>(</big><em>ibs</em>, <em>qreq_</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#request_ibeis_query_L0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.request_ibeis_query_L0" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver logic of query pipeline</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure _pipeline_helpres.testrun_pipeline_upto reflects what happens
in this function</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; IBEIS database object to be queried.
technically this object already lives inside of <a href="#id41"><span class="problematic" id="id42">qreq_</span></a>.</li>
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters. use <tt class="docutils literal"><span class="pre">ibs.new_query_request</span></tt> to create one</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(dict[int, QueryResult]): qaid2_qres maps query annotid to QueryResult</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-request_ibeis_query_L0</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># one-vs-many:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsmany&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">request_ibeis_query_L0</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">qaid2_qres</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--show&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">inIPython</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">qres</span><span class="o">.</span><span class="n">show_analysis</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">make_figtitle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">get_inspect_str</span><span class="p">())</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># one-vs-one:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs1</span><span class="p">,</span> <span class="n">qreq_1</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qreq_1</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres1</span> <span class="o">=</span> <span class="n">request_ibeis_query_L0</span><span class="p">(</span><span class="n">ibs1</span><span class="p">,</span> <span class="n">qreq_1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres1</span> <span class="o">=</span> <span class="n">qaid2_qres1</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">qaid2_qres1</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--show&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ut</span><span class="o">.</span><span class="n">inIPython</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">qres1</span><span class="o">.</span><span class="n">show_analysis</span><span class="p">(</span><span class="n">ibs1</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">make_figtitle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qres1</span><span class="o">.</span><span class="n">get_inspect_str</span><span class="p">())</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.save_resdict">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">save_resdict</tt><big>(</big><em>qreq_</em>, <em>qaid2_qres</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#save_resdict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.save_resdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves a dictionary of query results to disk</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.score_chipmatch">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">score_chipmatch</tt><big>(</big><em>qreq_</em>, <em>qaid</em>, <em>chipmatch</em>, <em>score_method</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#score_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.score_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Assigns scores to database annotation ids for a particualry query&#8217;s
chipmatch</p>
<p>DOES NOT APPLY SCORE NORMALIZATION</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</li>
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation id</li>
<li><strong>isprescore</strong> (<em>bool</em>) &#8211; flag</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">scores for each database id w.r.t. a single query</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">daid2_score</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-score_chipmatch</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_ENABLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># PRESCORE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;spatial_verification&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_FILT&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_method</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">prescore_method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_score_pre</span> <span class="o">=</span> <span class="n">score_chipmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">,</span> <span class="n">score_method</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># POSTSCORE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;chipmatch_to_resdict&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_method</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">score_method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid2_score_post</span> <span class="o">=</span> <span class="n">score_chipmatch</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">,</span> <span class="n">score_method</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.spatial_verification">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">spatial_verification</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatch</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#spatial_verification"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.spatial_verification" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dict or tuple(dict, dict)</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-spatial_verification</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;spatial_verification&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_FILT&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nnfilts</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_nnfilts&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatchSV</span> <span class="o">=</span> <span class="n">spatial_verification</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt_daids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_query_groundtruth</span><span class="p">(</span><span class="n">qaid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid</span> <span class="o">=</span> <span class="n">gt_daids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fm</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fmSV</span> <span class="o">=</span> <span class="n">qaid2_chipmatchSV</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fsv</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fsvSV</span> <span class="o">=</span> <span class="n">qaid2_chipmatchSV</span><span class="p">[</span><span class="n">qaid</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">daid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmSV</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="p">),</span> <span class="s">&#39;feature matches were not filtered&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.testdata_build_chipmatch">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">testdata_build_chipmatch</tt><big>(</big><em>dbname</em>, <em>cfgdict</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#testdata_build_chipmatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.testdata_build_chipmatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.threshold_and_scale_weights">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">threshold_and_scale_weights</tt><big>(</big><em>qreq_</em>, <em>qaid</em>, <em>qfx2_valid0</em>, <em>filt2_weights</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#threshold_and_scale_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.threshold_and_scale_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function</p>
<p>converts weights into per keypoint scores for a given filter / weight function
qfx2_score is an ndarray containing the score of individual feature matches.
qfx2_valid marks if that score will be thresholded.</p>
<p>FIXME: currently what should be called scores are called weights and visveras
maybe raw_weight and weight would be better</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation id</li>
<li><strong>qfx2_valid0</strong> (<em>ndarray</em>) &#8211; maps query feature index to K matches non-impossibility flags</li>
<li><strong>filt2_weights</strong> (<em>dict</em>) &#8211; maps filter names to qfx2_weight ndarray</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(nnfilts, nnfiltagg)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">soon nnfiltagg will not be returned</p>
</div>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-threshold_and_scale_weights:0</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;filter_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">locals_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;qaid2_nns&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnvalid0&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_filtweights&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_filtweights</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Continue with function logic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filt2_weights</span> <span class="o">=</span> <span class="n">qaid2_filtweights</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_valid0</span> <span class="o">=</span> <span class="n">qaid2_nnvalid0</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfilts</span><span class="p">,</span> <span class="n">nnfiltagg</span> <span class="o">=</span> <span class="n">threshold_and_scale_weights</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">qfx2_valid0</span><span class="p">,</span> <span class="n">filt2_weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">nnfilts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">RATIO</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">FG</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ratio_scores</span> <span class="o">=</span> <span class="n">nnfilts</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ratio_scores</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s">&#39;expected ratio scores &lt;= 1.0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ratio_scores</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s">&#39;exepcted ratio scores &gt;= 0.0&#39;</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsmany&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;filter_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">locals_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;qaid2_nns&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnvalid0&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_filtweights&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">,</span> <span class="n">qaid2_filtweights</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Continue with function logic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filt2_weights</span> <span class="o">=</span> <span class="n">qaid2_filtweights</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_valid0</span> <span class="o">=</span> <span class="n">qaid2_nnvalid0</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nnfilts</span><span class="p">,</span> <span class="n">nnfiltagg</span> <span class="o">=</span> <span class="n">threshold_and_scale_weights</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">qfx2_valid0</span><span class="p">,</span> <span class="n">filt2_weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">nnfilts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">LNBNN</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DUPVOTE</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">FG</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.try_load_resdict">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">try_load_resdict</tt><big>(</big><em>qreq_</em>, <em>force_miss=False</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#try_load_resdict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.try_load_resdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Try and load the result structures for each query.
returns a list of failed qaids</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; hyper-parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">qaid2_qres_hit</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">force_miss</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_hit</span> <span class="o">=</span> <span class="n">try_load_resdict</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">force_miss</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qaid2_qres_hit</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.vsone_reranking">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">vsone_reranking</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatch</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#vsone_reranking"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.vsone_reranking" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-vsone_reranking
python -m ibeis.model.hots.pipeline &#8211;test-vsone_reranking &#8211;show</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">vsone_reranking</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;vsone_reranking&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_SVER&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch_VSONE</span> <span class="o">=</span> <span class="n">vsone_reranking</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">show_was_requested</span><span class="p">():</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">vsone_pipeline</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c"># NOTE: the aid2_score field must have been hacked</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vsone_pipeline</span><span class="o">.</span><span class="n">show_top_chipmatches</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="s">&#39;prescore&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vsone_pipeline</span><span class="o">.</span><span class="n">show_top_chipmatches</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_chipmatch_VSONE</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;vsone-reranked&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.pipeline.weight_neighbors">
<tt class="descclassname">ibeis.model.hots.pipeline.</tt><tt class="descname">weight_neighbors</tt><big>(</big><em>qreq_</em>, <em>qaid2_nns</em>, <em>qaid2_nnvalid0</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/pipeline.html#weight_neighbors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.pipeline.weight_neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>PIPELINE NODE 3 - assigns weights to feature matches based on the active
filter list.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
<li><strong>qaid2_nns</strong> (<em>dict</em>) &#8211; maps query annotid to (qfx2_idx, qfx2_dist)</li>
<li><strong>qaid2_nnvalid0</strong> (<em>dict</em>) &#8211; maps query annotid to qfx2_valid0</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">qaid2_filtweights</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.pipeline &#8211;test-weight_neighbors</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#cfgdict = dict(codename=&#39;vsone&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># dbname = &#39;GZ_ALL&#39;  # &#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;testdb1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;weight_neighbors&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">locals_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;qaid2_nns&#39;</span><span class="p">,</span> <span class="s">&#39;qaid2_nnvalid0&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span>  <span class="o">=</span> <span class="n">args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_filtweights</span> <span class="o">=</span> <span class="n">weight_neighbors</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_nns</span><span class="p">,</span> <span class="n">qaid2_nnvalid0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey_list</span> <span class="o">=</span> <span class="n">qaid2_filtweights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey_list</span> <span class="o">==</span> <span class="p">[</span><span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">LNBNN</span><span class="p">,</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DUPVOTE</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.precision_recall">
<span id="ibeis-model-hots-precision-recall-module"></span><h2>ibeis.model.hots.precision_recall module<a class="headerlink" href="#module-ibeis.model.hots.precision_recall" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_average_percision_">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_average_percision_</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_average_percision_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_average_percision_" title="Permalink to this definition">¶</a></dt>
<dd><p>gets average percision using the PASCAL definition</p>
<p>FIXME: Use only the groundtruth that could have been matched in the
database. (shouldn&#8217;t be an issue until we start using daid subsets)</p>
<p class="rubric">References</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Information_retrieval">http://en.wikipedia.org/wiki/Information_retrieval</a></p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_interpolated_precision_vs_recall_">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_interpolated_precision_vs_recall_</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_interpolated_precision_vs_recall_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_interpolated_precision_vs_recall_" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_nFalseNegative">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_nFalseNegative</tt><big>(</big><em>TP</em>, <em>atrank</em>, <em>nGroundTruth</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_nFalseNegative"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_nFalseNegative" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of documents we should have retrieved but didn&#8217;t</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_nFalsePositive">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_nFalsePositive</tt><big>(</big><em>TP</em>, <em>atrank</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_nFalsePositive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_nFalsePositive" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of documents we should not have retrieved</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_nTruePositive">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_nTruePositive</tt><big>(</big><em>atrank</em>, <em>was_retrieved</em>, <em>gt_ranks</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_nTruePositive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_nTruePositive" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of documents we got right</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_precision">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_precision</tt><big>(</big><em>TP</em>, <em>FP</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_precision" title="Permalink to this definition">¶</a></dt>
<dd><p>precision positive predictive value</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_precision_recall_curve_">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_precision_recall_curve_</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_precision_recall_curve_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_precision_recall_curve_" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.hots_query_result</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">14</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips4</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt_aids</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atrank</span>  <span class="o">=</span> <span class="mi">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">precision_curve</span><span class="p">,</span> <span class="n">recall_curve</span> <span class="o">=</span> <span class="n">qres</span><span class="o">.</span><span class="n">get_precision_recall_curve</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">,</span> <span class="n">gt_aids</span><span class="o">=</span><span class="n">gt_aids</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">References</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Precision_and_recall">http://en.wikipedia.org/wiki/Precision_and_recall</a></p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.get_recall">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">get_recall</tt><big>(</big><em>TP</em>, <em>FN</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#get_recall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.get_recall" title="Permalink to this definition">¶</a></dt>
<dd><p>recall, true positive rate, sensitivity, hit rate</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.precision_recall.show_precision_recall_curve_">
<tt class="descclassname">ibeis.model.hots.precision_recall.</tt><tt class="descname">show_precision_recall_curve_</tt><big>(</big><em>qres</em>, <em>ibs=None</em>, <em>gt_aids=None</em>, <em>fnum=1</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/precision_recall.html#show_precision_recall_curve_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.precision_recall.show_precision_recall_curve_" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.hots_query_result</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.qt_inc_automatch">
<span id="ibeis-model-hots-qt-inc-automatch-module"></span><h2>ibeis.model.hots.qt_inc_automatch module<a class="headerlink" href="#module-ibeis.model.hots.qt_inc_automatch" title="Permalink to this headline">¶</a></h2>
<p>utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:3 &#8211;num-init 5000 &#8211;stateful-query
utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0</p>
<dl class="docutils">
<dt>TODO:</dt>
<dd><ul class="first last">
<li><p class="first">spatially constrained matching</p>
</li>
<li><p class="first">benchmarks for reconstruction
vs addition.</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>accuracy</dt>
<dd><p class="first last">compares percent of correct
error = (qfx2_idx_reindex != qfx2_idx_append).sum()</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>time</dt>
<dd><dl class="first docutils">
<dt>compares time of</dt>
<dd><ul class="first last simple">
<li>addition</li>
<li>reindex</li>
<li>multindex search</li>
<li>regular search</li>
</ul>
</dd>
</dl>
<p class="last">error = (qfx2_idx_reindex != qfx2_idx_append).sum()</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
<p>#import numpy as np
#import sys
#from ibeis.model.hots import automated_oracle as ao
#from ibeis.model.hots import automated_helpers as ah
#from ibeis.model.hots import special_query   *</p>
<dl class="class">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.qt_inc_automatch.</tt><tt class="descname">IncQueryHarness</tt><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">PyQt4.QtCore.QObject</span></tt></p>
<p>Provides incremental query with a way to work around hitting the recusion
limit. FIXME: currently it doesnt do this.</p>
<p>TODO: maybe abstract this into a interuptable loop harness</p>
<dl class="method">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.begin_incremental_query">
<tt class="descname">begin_incremental_query</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>back=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness.begin_incremental_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.begin_incremental_query" title="Permalink to this definition">¶</a></dt>
<dd><p>runs incremental query in live mode</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.exemplar_decision_signal">
<tt class="descname">exemplar_decision_signal</tt><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.exemplar_decision_signal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.exemplar_decision_slot">
<tt class="descname">exemplar_decision_slot</tt><big>(</big><em>exemplar_decision</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness.exemplar_decision_slot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.exemplar_decision_slot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.name_decision_signal">
<tt class="descname">name_decision_signal</tt><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.name_decision_signal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.name_decision_slot">
<tt class="descname">name_decision_slot</tt><big>(</big><em>chosen_names</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness.name_decision_slot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.name_decision_slot" title="Permalink to this definition">¶</a></dt>
<dd><p>the name decision signal was emited</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.next_query_signal">
<tt class="descname">next_query_signal</tt><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.next_query_signal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.next_query_slot">
<tt class="descname">next_query_slot</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness.next_query_slot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.next_query_slot" title="Permalink to this definition">¶</a></dt>
<dd><p>callback used when all interactions are completed.
Generates the next incremental query and then tries
the automatic interactions</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.setup_back_callbacks">
<tt class="descname">setup_back_callbacks</tt><big>(</big><em>back</em>, <em>incinfo</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness.setup_back_callbacks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.setup_back_callbacks" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.qt_inc_automatch.IncQueryHarness.test_incremental_query">
<tt class="descname">test_incremental_query</tt><big>(</big><em>ibs_gt</em>, <em>ibs</em>, <em>aid_list1</em>, <em>aid1_to_aid2</em>, <em>num_initial=0</em>, <em>interactive_after=None</em>, <em>back=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#IncQueryHarness.test_incremental_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.IncQueryHarness.test_incremental_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds and queries new annotations one at a time with oracle guidance</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.qt_inc_automatch.exec_interactive_incremental_queries">
<tt class="descclassname">ibeis.model.hots.qt_inc_automatch.</tt><tt class="descname">exec_interactive_incremental_queries</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>back=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#exec_interactive_incremental_queries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.exec_interactive_incremental_queries" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.qt_inc_automatch.incremental_test_qt">
<tt class="descclassname">ibeis.model.hots.qt_inc_automatch.</tt><tt class="descname">incremental_test_qt</tt><big>(</big><em>ibs</em>, <em>num_initial=0</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#incremental_test_qt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.incremental_test_qt" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.qt_inc_automatch &#8211;test-incremental_test_qt</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.qt_inc_automatch</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">main_locals</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">main_locals</span><span class="p">[</span><span class="s">&#39;ibs&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">back</span> <span class="o">=</span> <span class="n">main_locals</span><span class="p">[</span><span class="s">&#39;back&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#num_initial = 0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_initial</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">incremental_test_qt</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">num_initial</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">execstr</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">main_loop</span><span class="p">(</span><span class="n">main_locals</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">execstr</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.qt_inc_automatch.test_inc_query">
<tt class="descclassname">ibeis.model.hots.qt_inc_automatch.</tt><tt class="descname">test_inc_query</tt><big>(</big><em>ibs_gt</em>, <em>num_initial=0</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/qt_inc_automatch.html#test_inc_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.qt_inc_automatch.test_inc_query" title="Permalink to this definition">¶</a></dt>
<dd><p>entry point for interactive query tests
test_interactive_incremental_queries</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ibs</strong> (<em>list</em>) &#8211; IBEISController object</li>
<li><strong>qaid_list</strong> (<em>list</em>) &#8211; list of annotation-ids to query</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python dev.py -t inc &#8211;db PZ_MTEST &#8211;qaid 1:30:3 &#8211;cmd
python dev.py &#8211;db PZ_MTEST &#8211;allgt &#8211;cmd
python dev.py &#8211;db PZ_MTEST &#8211;allgt -t inc
python dev.py &#8211;db PZ_MTEST &#8211;allgt -t inc</dd>
<dt>CommandLine:</dt>
<dd><p class="first">python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0  &#8211;interact-after 444440 &#8211;noqcache
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:1  &#8211;interact-after 444440 &#8211;noqcache</p>
<p>python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:1
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:2
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:3</p>
<p>utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:3 &#8211;ninit 5000
utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0</p>
<p># Writes out test script
python -c &#8220;import utool as ut; ut.write_modscript_alias(&#8216;Tinc.sh&#8217;, &#8216;ibeis.model.hots.qt_inc_automatch&#8217;)&#8221;</p>
<p>sh Tinc.sh &#8211;test-test_inc_query:0
sh Tinc.sh &#8211;test-test_inc_query:1
sh Tinc.sh &#8211;test-test_inc_query:2
sh Tinc.sh &#8211;test-test_inc_query:3</p>
<p>utprof.py -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:3 &#8211;num-init 5000</p>
<p>sh Tinc.sh &#8211;test-test_inc_query:0 &#8211;ninit 10
sh Tinc.sh &#8211;test-test_inc_query:0 &#8211;ninit 10 &#8211;verbose-debug &#8211;verbose-helpful</p>
<p>python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0 &#8211;ia 10</p>
<p class="last"># Runs into a merge case
python -m ibeis.model.hots.qt_inc_automatch &#8211;test-test_inc_query:0 &#8211;ia 30</p>
</dd>
<dt>Example0:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs_gt</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_inc_query</span><span class="p">(</span><span class="n">ibs_gt</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs_gt</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_inc_query</span><span class="p">(</span><span class="n">ibs_gt</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs_gt</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;GZ_ALL&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_inc_query</span><span class="p">(</span><span class="n">ibs_gt</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Example3:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs_gt</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_Master0&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_inc_query</span><span class="p">(</span><span class="n">ibs_gt</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.query_helpers">
<span id="ibeis-model-hots-query-helpers-module"></span><h2>ibeis.model.hots.query_helpers module<a class="headerlink" href="#module-ibeis.model.hots.query_helpers" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.query_helpers.check_sift_desc">
<tt class="descclassname">ibeis.model.hots.query_helpers.</tt><tt class="descname">check_sift_desc</tt><big>(</big><em>desc</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_helpers.html#check_sift_desc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_helpers.check_sift_desc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.query_helpers.data_index_integrity">
<tt class="descclassname">ibeis.model.hots.query_helpers.</tt><tt class="descname">data_index_integrity</tt><big>(</big><em>ibs</em>, <em>qreq</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_helpers.html#data_index_integrity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_helpers.data_index_integrity" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.query_helpers.get_query_components">
<tt class="descclassname">ibeis.model.hots.query_helpers.</tt><tt class="descname">get_query_components</tt><big>(</big><em>ibs</em>, <em>qaids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_helpers.html#get_query_components"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_helpers.get_query_components" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">?:</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.query_helpers &#8211;test-get_query_components</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_helpers</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">get_query_components</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.query_request">
<span id="ibeis-model-hots-query-request-module"></span><h2>ibeis.model.hots.query_request module<a class="headerlink" href="#module-ibeis.model.hots.query_request" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ibeis.model.hots.query_request.QueryParams">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.query_request.</tt><tt class="descname">QueryParams</tt><big>(</big><em>qparams</em>, <em>cfg</em>, <em>cfgdict=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<blockquote>
<div><p>Structure to store static query pipeline parameters
parses nested config structure into this flat one</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.query_request &#8211;test-QueryParams</dd>
<dt>Example:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">query_request</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfg</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">query_cfg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#cfg.pipeline_root = &#39;asmk&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pipeline_root&#39;</span><span class="p">:</span> <span class="s">&#39;asmk&#39;</span><span class="p">,</span> <span class="s">&#39;sv_on&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span>           <span class="s">&#39;fg_weight&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;featweight_on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qparams</span> <span class="o">=</span> <span class="n">query_request</span><span class="o">.</span><span class="n">QueryParams</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qparams</span><span class="o">.</span><span class="n">fg_weight</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qparams</span><span class="o">.</span><span class="n">pipeline_root</span> <span class="o">==</span> <span class="s">&#39;smk&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qparams</span><span class="o">.</span><span class="n">featweight_on</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;)_</span>
</pre></div>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>&#8216;.join(result.split(&#8216;)_&#8217;)))</dt>
<dd>_smk_SMK(agg=True,t=0.0,a=3.0,idf)_
VocabAssign(nAssign=10,a=1.2,s=None,eqw=T)_
VocabTrain(nWords=8000,init=akmeans++,nIters=128,taids=all)_
SV(OFF)_
FEATWEIGHT(ON,uselabel,rf)_
FEAT(<a href="#id43"><span class="problematic" id="id44">hesaff+sift_</span></a>)_
CHIP(sz450)</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.query_request.QueryRequest">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.query_request.</tt><tt class="descname">QueryRequest</tt><big>(</big><em>qreq_</em>, <em>qaid_list</em>, <em>daid_list</em>, <em>qparams</em>, <em>qresdir</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.add_internal_daids">
<tt class="descname">add_internal_daids</tt><big>(</big><em>qreq_</em>, <em>new_daids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.add_internal_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.add_internal_daids" title="Permalink to this definition">¶</a></dt>
<dd><p>State Modification: add new daid to query request. Should only be
done between query pipeline runs</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.assert_self">
<tt class="descname">assert_self</tt><big>(</big><em>qreq_</em>, <em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.assert_self"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.assert_self" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.ensure_featweights">
<tt class="descname">ensure_featweights</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.ensure_featweights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.ensure_featweights" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure feature weights are computed</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_cfgstr">
<tt class="descname">get_cfgstr</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd><p>main cfgstring used to identify the &#8216;querytype&#8217;</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_data_hashid">
<tt class="descname">get_data_hashid</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_data_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_data_hashid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_external_daids">
<tt class="descname">get_external_daids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_external_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_external_daids" title="Permalink to this definition">¶</a></dt>
<dd><p>These are the users daids in vsone mode</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_external_duuids">
<tt class="descname">get_external_duuids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_external_duuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_external_duuids" title="Permalink to this definition">¶</a></dt>
<dd><p>These are the users qauuids in vsone mode</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_external_qaids">
<tt class="descname">get_external_qaids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_external_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_external_qaids" title="Permalink to this definition">¶</a></dt>
<dd><p>These are the users qaids in vsone mode</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_external_query_groundtruth">
<tt class="descname">get_external_query_groundtruth</tt><big>(</big><em>qreq_</em>, <em>qaids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_external_query_groundtruth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_external_query_groundtruth" title="Permalink to this definition">¶</a></dt>
<dd><p>gets groundtruth that are accessible via this query</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_external_quuids">
<tt class="descname">get_external_quuids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_external_quuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_external_quuids" title="Permalink to this definition">¶</a></dt>
<dd><p>These are the users qauuids in vsone mode</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_infostr">
<tt class="descname">get_infostr</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_infostr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_infostr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_internal_daids">
<tt class="descname">get_internal_daids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_internal_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_internal_daids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_internal_duuids">
<tt class="descname">get_internal_duuids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_internal_duuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_internal_duuids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_internal_qaids">
<tt class="descname">get_internal_qaids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_internal_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_internal_qaids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_internal_query_groundtruth">
<tt class="descname">get_internal_query_groundtruth</tt><big>(</big><em>qreq_</em>, <em>qaids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_internal_query_groundtruth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_internal_query_groundtruth" title="Permalink to this definition">¶</a></dt>
<dd><p>gets groundtruth that are accessible via this query</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_internal_quuids">
<tt class="descname">get_internal_quuids</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_internal_quuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_internal_quuids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_qresdir">
<tt class="descname">get_qresdir</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_qresdir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_qresdir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_query_cfgstr">
<tt class="descname">get_query_cfgstr</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_query_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_query_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_query_hashid">
<tt class="descname">get_query_hashid</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_query_hashid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_query_hashid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.get_unique_species">
<tt class="descname">get_unique_species</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.get_unique_species"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.get_unique_species" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.lazy_load">
<tt class="descname">lazy_load</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.lazy_load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.lazy_load" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs preloading of all data needed for a batch of queries</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.lazy_preload">
<tt class="descname">lazy_preload</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.lazy_preload"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.lazy_preload" title="Permalink to this definition">¶</a></dt>
<dd><p>feature weights and normalizers should be loaded before vsone queries
are issued. They do not depened only on qparams</p>
<p>Load non-query specific normalizers / weights</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.load_distinctiveness_normalizer">
<tt class="descname">load_distinctiveness_normalizer</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.load_distinctiveness_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.load_distinctiveness_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">distinctiveness_normalizer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.load_indexer">
<tt class="descname">load_indexer</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em>, <em>force=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.load_indexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.load_indexer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.load_score_normalizer">
<tt class="descname">load_score_normalizer</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.load_score_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.load_score_normalizer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.make_empty_query_results">
<tt class="descname">make_empty_query_results</tt><big>(</big><em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.make_empty_query_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.make_empty_query_results" title="Permalink to this definition">¶</a></dt>
<dd><p>returns empty query results for each external qaid</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.remove_internal_daids">
<tt class="descname">remove_internal_daids</tt><big>(</big><em>qreq_</em>, <em>remove_daids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.remove_internal_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.remove_internal_daids" title="Permalink to this definition">¶</a></dt>
<dd><p>State Modification: remove daids from the query request.  Do not call
this function often. It invalidates the indexer, which is very slow to
rebuild.  Should only be done between query pipeline runs.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.query_request &#8211;test-remove_internal_daids</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_request</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">species</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">is_exemplar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">is_exemplar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">remove_daids</span> <span class="o">=</span> <span class="n">daids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">internal_daids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;bad setup data&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">remove_internal_daids</span><span class="p">(</span><span class="n">remove_daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">internal_daids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;did not remove&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_external_daids">
<tt class="descname">set_external_daids</tt><big>(</big><em>qreq_</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_external_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_external_daids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_external_qaid_mask">
<tt class="descname">set_external_qaid_mask</tt><big>(</big><em>qreq_</em>, <em>masked_qaid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_external_qaid_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_external_qaid_mask" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.query_request &#8211;test-set_external_qaid_mask</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_request</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">masked_qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">set_external_qaid_mask</span><span class="p">(</span><span class="n">masked_qaid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[1 3]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_external_qaids">
<tt class="descname">set_external_qaids</tt><big>(</big><em>qreq_</em>, <em>qaid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_external_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_external_qaids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_internal_daids">
<tt class="descname">set_internal_daids</tt><big>(</big><em>qreq_</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_internal_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_internal_daids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_internal_masked_daids">
<tt class="descname">set_internal_masked_daids</tt><big>(</big><em>qreq_</em>, <em>masked_daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_internal_masked_daids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_internal_masked_daids" title="Permalink to this definition">¶</a></dt>
<dd><p>used by the pipeline to execute a subset of the query request
without modifying important state</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_internal_masked_qaids">
<tt class="descname">set_internal_masked_qaids</tt><big>(</big><em>qreq_</em>, <em>masked_qaid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_internal_masked_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_internal_masked_qaids" title="Permalink to this definition">¶</a></dt>
<dd><p>used by the pipeline to execute a subset of the query request
without modifying important state</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">pipeline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">qaid_list</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="o">=</span><span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">qaids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">masked_qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">set_internal_masked_qaids</span><span class="p">(</span><span class="n">masked_qaid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_internal_aids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">new_internal_aids</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_internal_qaids">
<tt class="descname">set_internal_qaids</tt><big>(</big><em>qreq_</em>, <em>qaid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_internal_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_internal_qaids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.set_internal_unmasked_qaids">
<tt class="descname">set_internal_unmasked_qaids</tt><big>(</big><em>qreq_</em>, <em>unmasked_qaid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.set_internal_unmasked_qaids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.set_internal_unmasked_qaids" title="Permalink to this definition">¶</a></dt>
<dd><p>used by the pipeline to execute a subset of the query request
without modifying important state</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">pipeline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone&#39;</span><span class="p">,</span> <span class="n">sv_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">qaid_list</span><span class="o">=</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="o">=</span><span class="n">daid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">qaids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unmasked_qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="o">.</span><span class="n">set_internal_unmasked_qaids</span><span class="p">(</span><span class="n">unmasked_qaid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_internal_aids</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_internal_qaids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ut</span><span class="o">.</span><span class="n">assert_lists_eq</span><span class="p">(</span><span class="n">new_internal_aids</span><span class="p">,</span> <span class="n">unmasked_qaid_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.query_request.QueryRequest.shallowcopy">
<tt class="descname">shallowcopy</tt><big>(</big><em>qreq_</em>, <em>qx=None</em>, <em>dx=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#QueryRequest.shallowcopy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.QueryRequest.shallowcopy" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a copy of qreq with the same qparams object and a subset of the qx
and dx objects.
used to generate chunks of vsone queries</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_request</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">get_test_qreq</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq2_</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">shallowcopy</span><span class="p">(</span><span class="n">qx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_daids</span><span class="p">()</span> <span class="ow">is</span> <span class="n">qreq2_</span><span class="o">.</span><span class="n">get_external_daids</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreq2_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">qreq2_</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.query_request.apply_species_with_detector_hack">
<tt class="descclassname">ibeis.model.hots.query_request.</tt><tt class="descname">apply_species_with_detector_hack</tt><big>(</big><em>ibs</em>, <em>cfgdict</em>, <em>qaids</em>, <em>daids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#apply_species_with_detector_hack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.apply_species_with_detector_hack" title="Permalink to this definition">¶</a></dt>
<dd><p>HACK turns of featweights if they cannot be applied</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.query_request.get_test_qreq">
<tt class="descclassname">ibeis.model.hots.query_request.</tt><tt class="descname">get_test_qreq</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#get_test_qreq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.get_test_qreq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.query_request.new_ibeis_query_request">
<tt class="descclassname">ibeis.model.hots.query_request.</tt><tt class="descname">new_ibeis_query_request</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>daid_list</em>, <em>cfgdict=None</em>, <em>verbose=True</em>, <em>unique_species=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#new_ibeis_query_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.new_ibeis_query_request" title="Permalink to this definition">¶</a></dt>
<dd><p>ibeis entry point to create a new query request object</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.query_request &#8211;test-new_ibeis_query_request</dd>
<dt>Example1:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_request</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;sv_on&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;fg_weight&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;featweight_on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Execute test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Check Results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">fg_weight</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>   <span class="s">&#39;qreq_.qparams.fg_weight = </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">fg_weight</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;qreq_.qparams.sv_on = </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">datahashid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">dbname</span> <span class="o">+</span> <span class="n">datahashid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">PZ_MTEST_DSUUIDS((5)q87ho9a0@9s02imh)</span>
</pre></div>
</div>
</dd>
<dt>Example2:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_request</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;NAUT_test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;sv_on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;fg_weight&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;featweight_on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Execute test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Check Results.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Featweight should be off because there is no Naut detector</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">query_cfgstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">fg_weight</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>   <span class="s">&#39;qreq_.qparams.fg_weight = </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">fg_weight</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;qreq_.qparams.sv_on = </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">sv_on</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">datahashid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_data_hashid</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_dbname</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">dbname</span> <span class="o">+</span> <span class="n">datahashid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">NAUT_test_DSUUIDS((5)4e972cjxcj30a8u1)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.query_request.test_cfg_deepcopy">
<tt class="descclassname">ibeis.model.hots.query_request.</tt><tt class="descname">test_cfg_deepcopy</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/query_request.html#test_cfg_deepcopy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.query_request.test_cfg_deepcopy" title="Permalink to this definition">¶</a></dt>
<dd><p>TESTING FUNCTION</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.query_request</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">test_cfg_deepcopy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.score_normalization">
<span id="ibeis-model-hots-score-normalization-module"></span><h2>ibeis.model.hots.score_normalization module<a class="headerlink" href="#module-ibeis.model.hots.score_normalization" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>GOALS:</dt>
<dd><ol class="first arabic simple">
<li>vsmany
* works resaonable for very few and very many
* stars with small k and then k becomes a percent or log percent
* distinctiveness from different location</li>
<li>1-vs-1
* uses distinctiveness and foreground when available
* start with ratio test and ransac</li>
<li>First N decision are interactive until we learn a good threshold</li>
</ol>
<p>4) Always show numbers between 0 and 1 spatial verification is based on
single best exemplar</p>
<blockquote>
<div>x - build normalizer
x - test normalizer
x - monotonicity (both nondecreasing and strictly increasing)
x - cache normalizer
x - cache maitainance (deleters and listers)
o - Incemental learning
o - Spceies sensitivity</div></blockquote>
<ul class="last simple">
<li>Add ability for user to relearn normalizer from labeled database.</li>
</ul>
</dd>
</dl>
<dl class="class">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">ScoreNormalizer</tt><big>(</big><em>normalizer</em>, <em>cfgstr=None</em>, <em>score_domain=None</em>, <em>p_tp_given_score=None</em>, <em>tp_support=None</em>, <em>tn_support=None</em>, <em>tp_labels=None</em>, <em>tn_labels=None</em>, <em>clip_score=None</em>, <em>timestamp=None</em>, <em>prefix=''</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">utool.util_cache.Cachable</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-ScoreNormalizer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgstr</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_domain</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p_tp_given_score</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_support</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_support</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_labels</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_labels</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">ScoreNormalizer</span><span class="p">(</span><span class="n">cfgstr</span><span class="p">,</span> <span class="n">score_domain</span><span class="p">,</span> <span class="n">p_tp_given_score</span><span class="p">,</span>
<span class="gp">... </span>                             <span class="n">tp_support</span><span class="p">,</span> <span class="n">tn_support</span><span class="p">,</span> <span class="n">tp_labels</span><span class="p">,</span>
<span class="gp">... </span>                             <span class="n">tn_labels</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.add_support">
<tt class="descname">add_support</tt><big>(</big><em>normalizer</em>, <em>tp_scores</em>, <em>tn_scores</em>, <em>tp_labels</em>, <em>tn_labels</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.add_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.add_support" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">110</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># empty normalizer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">ScoreNormalizer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">add_support</span><span class="p">(</span><span class="n">tp_scores</span><span class="p">,</span> <span class="n">tn_scores</span><span class="p">,</span> <span class="n">tp_labels</span><span class="p">,</span> <span class="n">tn_labels</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">retrain</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#--</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">add_support</span><span class="p">(</span><span class="n">tp_scores</span><span class="p">,</span> <span class="n">tn_scores</span><span class="p">,</span> <span class="n">tp_labels</span><span class="p">,</span> <span class="n">tn_labels</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">retrain</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.empty_normalize_score_list_46">
<tt class="descname">empty_normalize_score_list_46</tt><big>(</big><em>normalizer</em>, <em>score_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.empty_normalize_score_list_46"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.empty_normalize_score_list_46" title="Permalink to this definition">¶</a></dt>
<dd><p># HACK
# return scores from .4 to .6 if we have no idea</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.empty_normalize_score_list_None">
<tt class="descname">empty_normalize_score_list_None</tt><big>(</big><em>normalizer</em>, <em>score_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.empty_normalize_score_list_None"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.empty_normalize_score_list_None" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.get_cfgstr">
<tt class="descname">get_cfgstr</tt><big>(</big><em>normalizer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.get_cfgstr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.get_cfgstr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.get_infostr">
<tt class="descname">get_infostr</tt><big>(</big><em>normalizer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.get_infostr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.get_infostr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.get_num_training_pairs">
<tt class="descname">get_num_training_pairs</tt><big>(</big><em>normalizer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.get_num_training_pairs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.get_num_training_pairs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.get_prefix">
<tt class="descname">get_prefix</tt><big>(</big><em>normalizer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.get_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.get_prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.normalize_score_">
<tt class="descname">normalize_score_</tt><big>(</big><em>normalizer</em>, <em>score</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.normalize_score_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.normalize_score_" title="Permalink to this definition">¶</a></dt>
<dd><p>for internal use only</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.normalize_score_list">
<tt class="descname">normalize_score_list</tt><big>(</big><em>normalizer</em>, <em>score_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.normalize_score_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.normalize_score_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.normalizer_score_list2">
<tt class="descname">normalizer_score_list2</tt><big>(</big><em>normalizer</em>, <em>score_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.normalizer_score_list2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.normalizer_score_list2" title="Permalink to this definition">¶</a></dt>
<dd><p>linear combination of probability and original score based on num
support cases</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.prefix2">
<tt class="descname">prefix2</tt><em class="property"> = '_normalizer_'</em><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.prefix2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.retrain">
<tt class="descname">retrain</tt><big>(</big><em>normalizer</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.retrain"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.retrain" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.visualize">
<tt class="descname">visualize</tt><big>(</big><em>normalizer</em>, <em>update=True</em>, <em>verbose=True</em>, <em>fnum=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.visualize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.visualize" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-visualize &#8211;index 0
&#8211;cmd</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#import ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--index&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">load_precomputed_normalizer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">with_global</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">six</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.visualize_probs">
<tt class="descname">visualize_probs</tt><big>(</big><em>normalizer</em>, <em>update=True</em>, <em>fnum=None</em>, <em>pnum=(1</em>, <em>1</em>, <em>1)</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.visualize_probs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.visualize_probs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.score_normalization.ScoreNormalizer.visualize_support">
<tt class="descname">visualize_support</tt><big>(</big><em>normalizer</em>, <em>update=True</em>, <em>fnum=None</em>, <em>pnum=(1</em>, <em>1</em>, <em>1)</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#ScoreNormalizer.visualize_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.ScoreNormalizer.visualize_support" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.cached_ibeis_score_normalizer">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">cached_ibeis_score_normalizer</tt><big>(</big><em>ibs</em>, <em>qres_list</em>, <em>qreq_</em>, <em>use_cache=True</em>, <em>**learnkw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#cached_ibeis_score_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.cached_ibeis_score_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a normalizer trained on query results for a database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qaid2_qres</strong> (<em>int</em>) &#8211; query annotation id</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">cached or freshly trained score normalizer</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">ScoreNormalizer</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-cached_ibeis_score_normalizer</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>   <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibeis</span><span class="o">.</span><span class="n">_init_numpy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;PZ_MTEST&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="n">daid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone_unnorm&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_list</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">query_chips</span><span class="p">(</span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="n">use_cache</span><span class="p">,</span> <span class="n">return_request</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_normalizer</span> <span class="o">=</span> <span class="n">cached_ibeis_score_normalizer</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres_list</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">score_normalizer</span><span class="o">.</span><span class="n">get_fname</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">score_normalizer</span><span class="o">.</span><span class="n">get_cfgstr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">zebra_plains_normalizer_x@!cxcgfncxz97mo.cPkl</span>
<span class="go">_vsone_NN(single,K1+1,last,cks704)_FILT(ratio&lt;0.625;1.0,fg;1.0)_SV(0.01;2;1.57minIn=4,nRR=50,nsum,)_AGG(nsum)_FLANN(8_kdtrees)_FEATWEIGHT(ON,uselabel,rf)_FEAT(hesaff+sift_)_CHIP(sz450)</span>
</pre></div>
</div>
<p>zebra_plains_normalizer_n%w&#64;df%th&#64;i&#64;seel.cPkl
_vsone_NN(single,K1+1,last,cks1024)_FILT(ratio&lt;0.625;1.0,fg;1.0)_SV(0.01;2;1.57minIn=4,nRR=50,nsum,)_AGG(nsum)_FLANN(4_kdtrees)_FEATWEIGHT(ON,uselabel,rf)_FEAT(<a href="#id45"><span class="problematic" id="id46">hesaff+sift_</span></a>)_CHIP(sz450)</p>
<p>normalizer_5cv1%3s&amp;.cPkl
PZ_MTEST_DSUUIDS((9)67j%dr%&amp;bl%4oh4+)_QSUUIDS((9)67j%dr%&amp;bl%4oh4+)zebra_plains_vsone_NN(single,K1+1,last,cks1024)_FILT(ratio&lt;0.625;1.0,fg;1.0)_SV(0.01;2;1.57minIn=4,nRR=50,nsum,)_AGG(nsum)_FLANN(4_kdtrees)_FEATWEIGHT(ON,uselabel,rf)_FEAT(<a href="#id47"><span class="problematic" id="id48">hesaff+sift_</span></a>)_CHIP(sz450)</p>
<p>normalizer_PZ_MTEST_SUUIDS((9)67j%dr%&amp;bl%4oh4+).cPkl</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.delete_all_learned_normalizers">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">delete_all_learned_normalizers</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#delete_all_learned_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.delete_all_learned_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><p>DELETES ALL CACHED NORMALIZERS IN ALL DATABASES</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-delete_all_learned_normalizers
#-y</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DOCTEST_DISABLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">score_normalization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_normalization</span><span class="o">.</span><span class="n">delete_all_learned_normalizers</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.find_score_maxclip">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">find_score_maxclip</tt><big>(</big><em>tp_support</em>, <em>tn_support</em>, <em>clip_factor=2.6180339887499997</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#find_score_maxclip"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.find_score_maxclip" title="Permalink to this definition">¶</a></dt>
<dd><p>returns score to clip true positives past.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">clip_score</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_support</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50000</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_support</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">110</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clip_score</span> <span class="o">=</span> <span class="n">find_score_maxclip</span><span class="p">(</span><span class="n">tp_support</span><span class="p">,</span> <span class="n">tn_support</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">clip_score</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">287.983738762</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.get_ibeis_score_training_data">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">get_ibeis_score_training_data</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>qres_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#get_ibeis_score_training_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.get_ibeis_score_training_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns &#8220;good&#8221; taining examples</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.inspect_pdfs">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">inspect_pdfs</tt><big>(</big><em>tn_support</em>, <em>tp_support</em>, <em>score_domain</em>, <em>p_tp_given_score</em>, <em>p_tn_given_score</em>, <em>p_score_given_tp</em>, <em>p_score_given_tn</em>, <em>p_score</em>, <em>with_scores=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#inspect_pdfs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.inspect_pdfs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.learn_ibeis_score_normalizer">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">learn_ibeis_score_normalizer</tt><big>(</big><em>ibs</em>, <em>qaid_list</em>, <em>qres_list</em>, <em>cfgstr</em>, <em>prefix</em>, <em>**learnkw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#learn_ibeis_score_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.learn_ibeis_score_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the result of queries and trains a score normalizer</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qaid_list</strong> (<em>int</em>) &#8211; query annotation id</li>
<li><strong>qres_list</strong> (<em>list</em>) &#8211; object of feature correspondences and scores</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">freshly trained score normalizer</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ScoreNormalizer</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.learn_score_normalization">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">learn_score_normalization</tt><big>(</big><em>tp_support</em>, <em>tn_support</em>, <em>gridsize=1024</em>, <em>adjust=8</em>, <em>return_all=False</em>, <em>monotonize=True</em>, <em>clip_factor=2.6180339887499997</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#learn_score_normalization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.learn_score_normalization" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes collected data and applys parzen window density estimation and bayes rule.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gridsize</strong> (<em>int</em>) &#8211; default 512</li>
<li><strong>adjust</strong> (<em>int</em>) &#8211; default 8</li>
<li><strong>return_all</strong> (<em>bool</em>) &#8211; default False</li>
<li><strong>monotonize</strong> (<em>bool</em>) &#8211; default True</li>
<li><strong>clip_factor</strong> (<em>float</em>) &#8211; default phi ** 2</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(score_domain, p_tp_given_score, p_tn_given_score, p_score_given_tp, p_score_given_tn, p_score, clip_score)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tp_support</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tn_support</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">score_domain</span><span class="p">,</span> <span class="n">p_tp_given_score</span><span class="p">,</span> <span class="n">clip_score</span><span class="p">)</span> <span class="o">=</span> <span class="n">learn_score_normalization</span><span class="p">(</span><span class="n">tp_support</span><span class="p">,</span> <span class="n">tn_support</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p_tp_given_score</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">92</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.list_available_score_normalizers">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">list_available_score_normalizers</tt><big>(</big><em>with_global=True</em>, <em>with_local=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#list_available_score_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.list_available_score_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-list_available_score_normalizers</dd>
<dt>Ignore::</dt>
<dd>cp /media/raid/work/_INCTEST_arr((666)7xcu21&#64;fcschv2&#64;m)_GZ_ALL/_ibsdb/_ibeis_cache/scorenorm/zebra_grevys/zebra_grevys_normalizer_bi+i4y&amp;3dl8!xb!+.cPkl
mkdir ~/Dropbox/IBEIS
cp &#8216;/media/raid/work/_INCTEST_arr((666)7xcu21&#64;fcschv2&#64;m)_GZ_ALL/_ibsdb/_ibeis_cache/scorenorm/zebra_grevys/zebra_grevys_normalizer_bi+i4y&amp;3dl8!xb!+.cPkl&#8217; ~/Dropbox/IBEIS/normalizer.cPkl
mv ~/Dropbox/IBEIS/normalizer.cPkl ~/Dropbox/IBEIS/_normalizer_gzbase.cPkl</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_normalizers_fpaths</span> <span class="o">=</span> <span class="n">list_available_score_normalizers</span><span class="p">(</span><span class="n">with_global</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">global_normalizers_fpaths</span> <span class="o">=</span> <span class="n">list_available_score_normalizers</span><span class="p">(</span><span class="n">with_local</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># quote them</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># local_normalizers_fpaths = [&#39;&quot;%s&quot;&#39; % fpath for fpath in local_normalizers_fpaths]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># global_normalizers_fpaths = [&#39;&quot;%s&quot;&#39; % fpath for fpath in global_normalizers_fpaths]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;Available LOCAL normalizers: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="n">local_normalizers_fpaths</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;Available GLOBAL normalizers: &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">indentjoin</span><span class="p">(</span><span class="n">global_normalizers_fpaths</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_file_nBytes_str</span><span class="p">,</span> <span class="n">local_normalizers_fpaths</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_file_nBytes_str</span><span class="p">,</span> <span class="n">global_normalizers_fpaths</span><span class="p">)))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.load_precomputed_normalizer">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">load_precomputed_normalizer</tt><big>(</big><em>index</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#load_precomputed_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.load_precomputed_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>python -m ibeis.model.hots.score_normalization &#8211;test-load_precomputed_normalizer</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">load_precomputed_normalizer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">six</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.parse_available_normalizers">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">parse_available_normalizers</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#parse_available_normalizers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.parse_available_normalizers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.plot_postbayes_pdf">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">plot_postbayes_pdf</tt><big>(</big><em>score_domain</em>, <em>p_tn_given_score</em>, <em>p_tp_given_score</em>, <em>cfgstr=''</em>, <em>fnum=None</em>, <em>pnum=(1</em>, <em>1</em>, <em>1)</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#plot_postbayes_pdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.plot_postbayes_pdf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.plot_prebayes_pdf">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">plot_prebayes_pdf</tt><big>(</big><em>score_domain</em>, <em>p_score_given_tn</em>, <em>p_score_given_tp</em>, <em>p_score</em>, <em>cfgstr=''</em>, <em>fnum=None</em>, <em>pnum=(1</em>, <em>1</em>, <em>1)</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#plot_prebayes_pdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.plot_prebayes_pdf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.plot_support">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">plot_support</tt><big>(</big><em>tn_support</em>, <em>tp_support</em>, <em>fnum=None</em>, <em>pnum=(1</em>, <em>1</em>, <em>1)</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#plot_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.plot_support" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.request_ibeis_normalizer">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">request_ibeis_normalizer</tt><big>(</big><em>qreq_</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#request_ibeis_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.request_ibeis_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME: do what is in the docstr</p>
<p>Any loaded normalizer must be configured on the query_cfg of the query
request. This ensures that all of the support data fed to the normalizer is
consistent.</p>
<p>First try to lod the normalizer from the in-memory cache.
If that fails try to load a custom normalizer from the local directory
If that fails try to load a custom normalizer from the global directory
If that fails try to (download and) load the baseline normalizer from the global directory
If that fails return empty score normalizer.
As queries are run the normalizer should be udpated and saved under the
custom normalizer in the local directory.</p>
<p>Tries to load the best possible normalizer for this query request.
If none are found then a it tries to load a downloaded baseline. If
none exists then it starts to compute a custom baseline.</p>
<p>The basline probability for an empty normalizer should be 1/2.
The probability of a baseline normalizer should be regularized to
stay close to 1/2 when there is little support.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">cached or prebuilt score normalizer</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ScoreNormalizer</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">query_request</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone_unnorm&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#cfgdict = dict(codename=&#39;vsone_unnorm&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">query_request</span><span class="o">.</span><span class="n">new_ibeis_query_request</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">request_ibeis_normalizer</span><span class="p">(</span><span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">add_support</span><span class="p">([</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.test">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">test</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.test" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.test_score_normalization">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">test_score_normalization</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#test_score_normalization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.test_score_normalization" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">python ibeis/model/hots/score_normalization.py &#8211;test-test_score_normalization</p>
<p class="last">python dev.py -t custom &#8211;cfg codename:vsone_unnorm &#8211;db PZ_MTEST &#8211;allgt &#8211;vf &#8211;va
python dev.py -t custom &#8211;cfg codename:vsone_unnorm &#8211;db PZ_MTEST &#8211;allgt &#8211;vf &#8211;va &#8211;index 0:8:3 &#8211;dindex 0:10 &#8211;verbose</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#from ibeis.model.hots import score_normalization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#score_normalization.rrr()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>   <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">test_score_normalization</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">execstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">execstr_dict</span><span class="p">(</span><span class="n">locals_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#print(execstr)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">exec</span><span class="p">(</span><span class="n">execstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">exec</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.testload_myscorenorm">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">testload_myscorenorm</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#testload_myscorenorm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.testload_myscorenorm" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-testload_myscorenorm</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">testload_myscorenorm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">six</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.train_baseline_for_all_dbs">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">train_baseline_for_all_dbs</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#train_baseline_for_all_dbs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.train_baseline_for_all_dbs" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs unnormalized queries to compute normalized queries</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-train_baseline_for_all_dbs</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train_baseline_for_all_dbs</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.train_baseline_ibeis_normalizer">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">train_baseline_ibeis_normalizer</tt><big>(</big><em>ibs</em>, <em>use_cache=True</em>, <em>**learnkw</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#train_baseline_ibeis_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.train_baseline_ibeis_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs unnormalized queries to compute normalized queries</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">normalizer</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ScoreNormalizer</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.score_normalization &#8211;test-train_baseline_ibeis_normalizer &#8211;cmd
python -m ibeis.model.hots.score_normalization &#8211;test-train_baseline_ibeis_normalizer &#8211;noshow</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.score_normalization</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots</span> <span class="kn">import</span> <span class="n">score_normalization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#score_normalization.rrr()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;GZ_ALL&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;PZ_MTEST&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">learnkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">score_normalization</span><span class="o">.</span><span class="n">train_baseline_ibeis_normalizer</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">learnkw</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalizer</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">normalizer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">exec</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">present</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.score_normalization.try_download_baseline_ibeis_normalizer">
<tt class="descclassname">ibeis.model.hots.score_normalization.</tt><tt class="descname">try_download_baseline_ibeis_normalizer</tt><big>(</big><em>ibs</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/score_normalization.html#try_download_baseline_ibeis_normalizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.score_normalization.try_download_baseline_ibeis_normalizer" title="Permalink to this definition">¶</a></dt>
<dd><p>tries to download a baseline normalizer for some species.
creates an empty normalizer if it cannot</p>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.special_query">
<span id="ibeis-model-hots-special-query-module"></span><h2>ibeis.model.hots.special_query module<a class="headerlink" href="#module-ibeis.model.hots.special_query" title="Permalink to this headline">¶</a></h2>
<p>handles the &#8220;special&#8221; more complex vs-one re-ranked query</p>
<p># Write some alias for ourselves
python -c &#8220;import utool as ut; ut.write_modscript_alias( &#8216;Tinc.sh&#8217;, &#8216;ibeis.model.hots.qt_inc_automatch&#8217;)&#8221;
python -c &#8220;import utool as ut; ut.write_modscript_alias(&#8216;pTinc.sh&#8217;, &#8216;ibeis.model.hots.qt_inc_automatch&#8217;, &#8216;utprof.py&#8217;)&#8221;</p>
<p># PROFILE PZ_Master0 With lots of preadded data
sh pTinc.sh &#8211;test-test_inc_query:3 &#8211;num-init 7500 &#8211;test-title &#8220;ProfileIncPZMaster0&#8221;</p>
<p>sh pTinc.sh &#8211;test-test_inc_query:3 &#8211;num-init 8690
sh pTinc.sh &#8211;test-test_inc_query:0
sh pTinc.sh &#8211;test-test_inc_query:3 &#8211;num-init 5000 &#8211;devcache &#8211;vsone-errs</p>
<p>sh Tinc.sh &#8211;test-test_inc_query:2 &#8211;num-init 100 &#8211;devcache &#8211;vsone-errs</p>
<p># Interactive GZ Test
sh Tinc.sh &#8211;test-test_inc_query:2 &#8211;num-init 100 &#8211;devcache &#8211;no-normcache &#8211;vsone-errs &#8211;ia 10  &#8211;test-title &#8220;GZ_Inc_Errors&#8221;</p>
<p># Automatic GZ Test
sh Tinc.sh &#8211;test-test_inc_query:2 &#8211;num-init 100 &#8211;devcache &#8211;no-normcache &#8211;vsone-errs  &#8211;test-title &#8220;GZ_Inc_Errors&#8221;</p>
<p># AUTOMATIC PZ_MTEST
sh Tinc.sh &#8211;test-test_inc_query:1 &#8211;num-init 0 &#8211;devcache &#8211;no-normcache &#8211;vsone-errs  &#8211;test-title &#8220;PZ_Inc_Errors&#8221;
# No testing
sh Tinc.sh &#8211;test-test_inc_query:1 &#8211;num-init 0 &#8211;no-normcache &#8211;test-title &#8220;PZ_Inc_Errors&#8221;</p>
<p># Automatic GZ Test Small
sh Tinc.sh &#8211;test-test_inc_query:2 &#8211;num-init 0 &#8211;devcache &#8211;no-normcache &#8211;vsone-errs &#8211;test-title &#8220;GZ_DEV&#8221; &#8211;gzdev &#8211;ninit 34 &#8211;naac &#8211;interupt-case
sh Tinc.sh &#8211;test-test_inc_query:2 &#8211;num-init 0 &#8211;devcache &#8211;no-normcache &#8211;vsone-errs &#8211;test-title &#8220;GZ_DEV&#8221; &#8211;gzdev &#8211;ninit 47 &#8211;naac &#8211;interupt-case</p>
<dl class="class">
<dt id="ibeis.model.hots.special_query.TestTup">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">TestTup</tt><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>TestTup(qaid_t, qaid, vsmany_rank, vsone_rank)</p>
<dl class="method">
<dt id="ibeis.model.hots.special_query.TestTup.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.special_query.TestTup.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.special_query.TestTup.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.special_query.TestTup.qaid">
<tt class="descname">qaid</tt><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.qaid" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.special_query.TestTup.qaid_t">
<tt class="descname">qaid_t</tt><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.qaid_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.special_query.TestTup.vsmany_rank">
<tt class="descname">vsmany_rank</tt><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.vsmany_rank" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.special_query.TestTup.vsone_rank">
<tt class="descname">vsone_rank</tt><a class="headerlink" href="#ibeis.model.hots.special_query.TestTup.vsone_rank" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.apply_new_qres_filter_scores">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">apply_new_qres_filter_scores</tt><big>(</big><em>qreq_vsone_</em>, <em>qres_vsone</em>, <em>newfsv_list</em>, <em>newscore_aids</em>, <em>filtkey</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#apply_new_qres_filter_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.apply_new_qres_filter_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>applies the new filter scores vectors to a query result and updates other
scores</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qres_vsone</strong> (<em>QueryResult</em>) &#8211; object of feature correspondences and scores</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-apply_new_qres_filter_scores</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey</span> <span class="o">=</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DISTINCTIVENESS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsmany_initial</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vsone_query_pairs</span> <span class="o">=</span> <span class="n">build_vsone_shortlist</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres_vsmany</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsone</span><span class="p">,</span> <span class="n">qreq_vsone_</span> <span class="o">=</span> <span class="n">query_vsone_pairs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">vsone_query_pairs</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_vsone_</span><span class="o">.</span><span class="n">load_score_normalizer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_vsone</span> <span class="o">=</span> <span class="n">qaid2_qres_vsone</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_vsmany</span> <span class="o">=</span> <span class="n">qaid2_qres_vsmany</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_aids</span> <span class="o">=</span> <span class="n">vsone_query_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">newfsv_list</span><span class="p">,</span> <span class="n">newscore_aids</span> <span class="o">=</span> <span class="n">get_new_qres_distinctiveness</span><span class="p">(</span><span class="n">qres_vsone</span><span class="p">,</span> <span class="n">qres_vsmany</span><span class="p">,</span> <span class="n">top_aids</span><span class="p">,</span> <span class="n">filtkey</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">apply_new_qres_filter_scores</span><span class="p">(</span><span class="n">qres_vsone</span><span class="p">,</span> <span class="n">newfsv_list</span><span class="p">,</span> <span class="n">newscore_aids</span><span class="p">,</span> <span class="n">filtkey</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><p class="first">qres_vsone.show_top(ibs, name_scoring=True)
print(qres_vsone.get_inspect_str(ibs=ibs, name_scoring=True))</p>
<p class="last">print(qres_vsmany.get_inspect_str(ibs=ibs, name_scoring=True))</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.augment_vsone_with_vsmany">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">augment_vsone_with_vsmany</tt><big>(</big><em>vsone_query_pairs</em>, <em>qaid2_qres_vsone</em>, <em>qaid2_qres_vsmany</em>, <em>qreq_vsone_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#augment_vsone_with_vsmany"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.augment_vsone_with_vsmany" title="Permalink to this definition">¶</a></dt>
<dd><p>AUGMENT VSONE QUERIES (BIG HACKS AFTER THIS POINT)
Apply vsmany distinctiveness scores to vsone</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>qaid2_qres_vsone</strong> (<em>dict</em>) &#8211; dict of query result objects</li>
<li><strong>qaid2_qres_vsmany</strong> (<em>dict</em>) &#8211; dict of query result objects</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-augment_vsone_with_vsmany</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsmany_initial</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">save_qcache</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">qreq_vsmany_</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vsone_query_pairs</span> <span class="o">=</span> <span class="n">build_vsone_shortlist</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres_vsmany</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsone</span><span class="p">,</span> <span class="n">qreq_vsone_</span> <span class="o">=</span> <span class="n">query_vsone_pairs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">vsone_query_pairs</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">qreq_vsone_</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">score_normalization</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">qreq_vsone_</span><span class="o">.</span><span class="n">load_score_normalizer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">augment_vsone_with_vsmany</span><span class="p">(</span><span class="n">vsone_query_pairs</span><span class="p">,</span> <span class="n">qaid2_qres_vsone</span><span class="p">,</span> <span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsone_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres_vsone</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">inbounds</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">aid2_fsv</span><span class="p">[</span><span class="n">daids</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">eq</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">inbounds</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">aid2_score</span><span class="p">[</span><span class="n">daids</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">eq</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.build_vsone_shortlist">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">build_vsone_shortlist</tt><big>(</big><em>ibs</em>, <em>qaid2_qres_vsmany</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#build_vsone_shortlist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.build_vsone_shortlist" title="Permalink to this definition">¶</a></dt>
<dd><p>looks that the top N names in a vsmany query to apply vsone reranking</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>qaid2_qres_vsmany</strong> (<em>dict</em>) &#8211; dict of query result objects</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">vsone_query_pairs</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-build_vsone_shortlist</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsmany_initial</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vsone_query_pairs</span> <span class="o">=</span> <span class="n">build_vsone_shortlist</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres_vsmany</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span><span class="p">,</span> <span class="n">top_aid_list</span> <span class="o">=</span> <span class="n">vsone_query_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">top_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">top_nid_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;name 1 should be rank 1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_nid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;should have 3 names and up to 2 image per name&#39;</span>
</pre></div>
</div>
<p>[(1, [3, 2, 6, 5, 4])]
[(1, [2, 3, 6, 5, 4])]</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.choose_vsmany_K">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">choose_vsmany_K</tt><big>(</big><em>num_names</em>, <em>qaids</em>, <em>daids</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#choose_vsmany_K"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.choose_vsmany_K" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: Should also scale up the number of checks as well</p>
<p>method for choosing K in the initial vsmany queries</p>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Shows plot for K vs number of names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_names_slope</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K_max</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K_min</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">num_names_slope</span> <span class="o">*</span> <span class="n">num_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K_list</span><span class="p">[</span><span class="n">K_list</span> <span class="o">&gt;</span> <span class="n">K_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_max</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K_list</span><span class="p">[</span><span class="n">K_list</span> <span class="o">&lt;</span> <span class="n">K_min</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_min</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clip_index_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">K_list</span> <span class="o">&gt;=</span> <span class="n">K_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clip_index</span> <span class="o">=</span> <span class="n">clip_index_list</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clip_index_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K_list</span> <span class="o">=</span> <span class="n">K_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">clip_index</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">num_names</span> <span class="o">=</span> <span class="n">num_names</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">clip_index</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">plot2</span><span class="p">(</span><span class="n">num_names</span><span class="p">,</span> <span class="n">K_list</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s">&#39;num_names&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s">&#39;K&#39;</span><span class="p">,</span>
<span class="gp">... </span>         <span class="n">equal_aspect</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dark</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.get_extern_distinctiveness">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">get_extern_distinctiveness</tt><big>(</big><em>qreq_</em>, <em>qres</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#get_extern_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.get_extern_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses distinctivness normalizer class (which uses predownloaded models)
to normalize the distinctivness of a keypoint for query points.</p>
<dl class="docutils">
<dt>IDEA:</dt>
<dd>because we have database points as well we can use the distance between
normalizer of the query point and the normalizer of the database point.
They should have a similar normalizer if they are a correct match AND
nondistinctive.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qreq</strong> (<em>QueryRequest</em>) &#8211; query request object with hyper-parameters</li>
<li><strong>qres</strong> (<em>QueryResult</em>) &#8211; object of feature correspondences and scores</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(new_fsv_list, daid_list)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-get_extern_distinctiveness</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_valid_aids</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">ibeis</span><span class="o">.</span><span class="n">const</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">ZEB_PLAIN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">daids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">&#39;vsone_unnorm_dist_ratio_extern_distinctiveness&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">new_query_request</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#qreq_.lazy_load()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">query_chips</span><span class="p">(</span><span class="n">qreq_</span><span class="o">=</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">save_qcache</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">new_fsv_list</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_extern_distinctiveness</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qres</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">fsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">qres</span><span class="o">.</span><span class="n">filtkey_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">fsv</span> <span class="ow">in</span> <span class="n">new_fsv_list</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">fsv</span> <span class="ow">in</span> <span class="n">new_fsv_list</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">fsv</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">fsv</span> <span class="ow">in</span> <span class="n">new_fsv_list</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.get_new_qres_distinctiveness">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">get_new_qres_distinctiveness</tt><big>(</big><em>qres_vsone</em>, <em>qres_vsmany</em>, <em>top_aids</em>, <em>filtkey</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#get_new_qres_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.get_new_qres_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><p>gets the distinctiveness score from vsmany and applies it to vsone</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey</span> <span class="o">=</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DISTINCTIVENESS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsmany_initial</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vsone_query_pairs</span> <span class="o">=</span> <span class="n">build_vsone_shortlist</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres_vsmany</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsone</span><span class="p">,</span> <span class="n">qreq_vsone_</span> <span class="o">=</span> <span class="n">query_vsone_pairs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">vsone_query_pairs</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qreq_vsone_</span><span class="o">.</span><span class="n">load_score_normalizer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_vsone</span> <span class="o">=</span> <span class="n">qaid2_qres_vsone</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_vsmany</span> <span class="o">=</span> <span class="n">qaid2_qres_vsmany</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_aids</span> <span class="o">=</span> <span class="n">vsone_query_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">newfsv_list</span><span class="p">,</span> <span class="n">newscore_aids</span> <span class="o">=</span> <span class="n">get_new_qres_distinctiveness</span><span class="p">(</span><span class="n">qres_vsone</span><span class="p">,</span> <span class="n">qres_vsmany</span><span class="p">,</span> <span class="n">top_aids</span><span class="p">,</span> <span class="n">filtkey</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.new_feature_score_dimension">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">new_feature_score_dimension</tt><big>(</big><em>qres</em>, <em>daid</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#new_feature_score_dimension"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.new_feature_score_dimension" title="Permalink to this definition">¶</a></dt>
<dd><p>returns new fsv vectors but does not apply them</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.product_scoring">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">product_scoring</tt><big>(</big><em>new_fsv_vsone</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#product_scoring"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.product_scoring" title="Permalink to this definition">¶</a></dt>
<dd><p>product of all weights</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.query_vsmany_initial">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">query_vsmany_initial</tt><big>(</big><em>ibs</em>, <em>qaids</em>, <em>daids</em>, <em>use_cache=False</em>, <em>qreq_vsmany_=None</em>, <em>save_qcache=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#query_vsmany_initial"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.query_vsmany_initial" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>qaids</strong> (<em>list</em>) &#8211; query annotation ids</li>
<li><strong>daids</strong> (<em>list</em>) &#8211; database annotation ids</li>
<li><strong>use_cache</strong> (<em>bool</em>) &#8211; turns on disk based caching</li>
<li><strong>qreq_vsmany</strong> (<em>QueryRequest</em>) &#8211; persistant vsmany query request</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(newfsv_list, newscore_aids)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-query_vsmany_initial</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsmany_initial</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_vsmany</span> <span class="o">=</span> <span class="n">qaid2_qres_vsmany</span><span class="p">[</span><span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qres_vsmany</span><span class="o">.</span><span class="n">get_top_aids</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">,</span> <span class="n">name_scoring</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[2, 6, 4]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.query_vsone_pairs">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">query_vsone_pairs</tt><big>(</big><em>ibs</em>, <em>vsone_query_pairs</em>, <em>use_cache=False</em>, <em>save_qcache=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#query_vsone_pairs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.query_vsone_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>does vsone queries to rerank the top few vsmany querys</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">qaid2_qres_vsone, <a href="#id49"><span class="problematic" id="id50">qreq_vsone_</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-query_vsone_pairs</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtkey</span> <span class="o">=</span> <span class="n">hstypes</span><span class="o">.</span><span class="n">FiltKeys</span><span class="o">.</span><span class="n">DISTINCTIVENESS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_qcache</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsmany</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsmany_initial</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vsone_query_pairs</span> <span class="o">=</span> <span class="n">build_vsone_shortlist</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_qres_vsmany</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres_vsone</span><span class="p">,</span> <span class="n">qreq_vsone_</span> <span class="o">=</span> <span class="n">query_vsone_pairs</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">vsone_query_pairs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres_vsone</span> <span class="o">=</span> <span class="n">qaid2_qres_vsone</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_namescore_aids</span> <span class="o">=</span> <span class="n">qres_vsone</span><span class="o">.</span><span class="n">get_top_aids</span><span class="p">(</span><span class="n">ibs</span><span class="o">=</span><span class="n">ibs</span><span class="p">,</span> <span class="n">name_scoring</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_namescore_aids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_namescore_names</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_names</span><span class="p">(</span><span class="n">top_namescore_aids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">top_namescore_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;easy&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.query_vsone_verified">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">query_vsone_verified</tt><big>(</big><em>ibs</em>, <em>qaids</em>, <em>daids</em>, <em>qreq_vsmany__=None</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#query_vsone_verified"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.query_vsone_verified" title="Permalink to this definition">¶</a></dt>
<dd><p>main special query entry point</p>
<p>A hacked in vsone-reranked pipeline
Actually just two calls to the pipeline</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>qaids</strong> (<em>list</em>) &#8211; query annotation ids</li>
<li><strong>daids</strong> (<em>list</em>) &#8211; database annotation ids</li>
<li><strong>qreq_vsmany</strong> (<em>QueryRequest</em>) &#8211; used for persitant QueryRequest objects
if None creates new query request otherwise</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">qaid2_qres, <a href="#id51"><span class="problematic" id="id52">qreq_</span></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.special_query &#8211;test-query_vsone_verified</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.special_query</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">valid_aids</span> <span class="o">=</span> <span class="n">testdata_special_query</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="n">valid_aids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qaids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qreq_vsmany_</span> <span class="o">=</span> <span class="n">query_vsone_verified</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><p class="first">from ibeis.model.hots import score_normalization</p>
<p>qres = qaid2_qres_vsmany[qaid]</p>
<p>ibs.delete_qres_cache()
qres = qaid2_qres[qaid]
qres.show_top(ibs, update=True, name_scoring=True)</p>
<p>qres_vsmany = qaid2_qres_vsmany[qaid]
qres_vsmany.show_top(ibs, update=True, name_scoring=True)</p>
<p class="last">qres_vsone = qaid2_qres_vsone[qaid]
qres_vsone.show_top(ibs, update=True, name_scoring=True)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.test_vsone_errors">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">test_vsone_errors</tt><big>(</big><em>ibs</em>, <em>daids</em>, <em>qaid2_qres_vsmany</em>, <em>qaid2_qres_vsone</em>, <em>incinfo</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#test_vsone_errors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.test_vsone_errors" title="Permalink to this definition">¶</a></dt>
<dd><p>ibs1 = ibs_gt
ibs2 = ibs (the current test database, sorry for the backwardness)
aid1_to_aid2 - maps annots from ibs1 to ibs2</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.test_vsone_verified">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">test_vsone_verified</tt><big>(</big><em>ibs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#test_vsone_verified"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.test_vsone_verified" title="Permalink to this definition">¶</a></dt>
<dd><p>hack in vsone-reranking</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.all_imports</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#reload_all()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_vsone_verified</span><span class="p">(</span><span class="n">ibs</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.testdata_special_query">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">testdata_special_query</tt><big>(</big><em>dbname=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#testdata_special_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.testdata_special_query" title="Permalink to this definition">¶</a></dt>
<dd><p>test data for special query doctests</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.special_query.verbose_report_results">
<tt class="descclassname">ibeis.model.hots.special_query.</tt><tt class="descname">verbose_report_results</tt><big>(</big><em>ibs</em>, <em>qaids</em>, <em>qaid2_qres_vsone</em>, <em>qaid2_qres_vsmany</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/special_query.html#verbose_report_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.special_query.verbose_report_results" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.system_suggestor">
<span id="ibeis-model-hots-system-suggestor-module"></span><h2>ibeis.model.hots.system_suggestor module<a class="headerlink" href="#module-ibeis.model.hots.system_suggestor" title="Permalink to this headline">¶</a></h2>
<p>Reports decisions and confidences about names (identifications) and
exemplars using query results objects.</p>
<dl class="class">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">ChoiceTuple</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>ChoiceTuple(sorted_nids, sorted_nscore, sorted_rawscore, sorted_aids, sorted_ascores)</p>
<dl class="method">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_aids">
<tt class="descname">sorted_aids</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_ascores">
<tt class="descname">sorted_ascores</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_ascores" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_nids">
<tt class="descname">sorted_nids</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_nids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_nscore">
<tt class="descname">sorted_nscore</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_nscore" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_rawscore">
<tt class="descname">sorted_rawscore</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ChoiceTuple.sorted_rawscore" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.system_suggestor.ExemplarDecision">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">ExemplarDecision</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ExemplarDecision" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt></p>
<p>ExemplarDecision(new_exemplar_aids, remove_exemplar_aids)</p>
<dl class="method">
<dt id="ibeis.model.hots.system_suggestor.ExemplarDecision.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ExemplarDecision.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.system_suggestor.ExemplarDecision.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ExemplarDecision.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.system_suggestor.ExemplarDecision.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ExemplarDecision.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ExemplarDecision.new_exemplar_aids">
<tt class="descname">new_exemplar_aids</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ExemplarDecision.new_exemplar_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="ibeis.model.hots.system_suggestor.ExemplarDecision.remove_exemplar_aids">
<tt class="descname">remove_exemplar_aids</tt><a class="headerlink" href="#ibeis.model.hots.system_suggestor.ExemplarDecision.remove_exemplar_aids" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.system_suggestor.exemplar_method1_distinctiveness">
<tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">exemplar_method1_distinctiveness</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>other_exemplars</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/system_suggestor.html#exemplar_method1_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.system_suggestor.exemplar_method1_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><p>choose as exemplar if it is distinctive with respect to other exemplars</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.system_suggestor.exemplar_method2_randomness">
<tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">exemplar_method2_randomness</tt><big>(</big><em>qaid</em>, <em>other_exemplars</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/system_suggestor.html#exemplar_method2_randomness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.system_suggestor.exemplar_method2_randomness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.system_suggestor &#8211;test-exemplar_method2_randomness</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.system_suggestor</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other_exemplars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemplar_decision</span> <span class="o">=</span> <span class="n">exemplar_method2_randomness</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">other_exemplars</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemplar_decision_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">exemplar_method2_randomness</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">other_exemplars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flat_others</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">exemplar_decision_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">flat_others</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[3, 2, 6, 1, 3, 2, 9, 3, 6, 2, 1, 5, 1, 6, 1]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>ibs = ut.search_stack_for_localvar(&#8216;ibs&#8217;)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.system_suggestor.get_qres_name_choices">
<tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">get_qres_name_choices</tt><big>(</big><em>ibs</em>, <em>qres</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/system_suggestor.html#get_qres_name_choices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.system_suggestor.get_qres_name_choices" title="Permalink to this definition">¶</a></dt>
<dd><p>returns all possible decision a user could make</p>
<p>TODO: Return the possiblity of a merge.
TODO: Ensure that the total probability of each possible choice sums to 1.
This will define a probability density function that we can take advantage
of</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>qres</strong> (<em>QueryResult</em>) &#8211; object of feature correspondences and scores</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">choicetup</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ChoiceTuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-get_qres_name_choices</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.system_suggestor</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips4</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">cfgdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">choicetup</span> <span class="o">=</span> <span class="n">get_qres_name_choices</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">choicetup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_repr</span><span class="p">(</span><span class="n">choicetup</span><span class="o">.</span><span class="n">sorted_nids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">array([ 1,  2, -4])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.system_suggestor.get_system_exemplar_suggestion">
<tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">get_system_exemplar_suggestion</tt><big>(</big><em>ibs</em>, <em>qaid</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/system_suggestor.html#get_system_exemplar_suggestion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.system_suggestor.get_system_exemplar_suggestion" title="Permalink to this definition">¶</a></dt>
<dd><p>hotspotter returns an exemplar suggestion</p>
<dl class="docutils">
<dt>TODO:</dt>
<dd>do a vsone query between all of the exemplars to see if this one is good
enough to be added.</dd>
<dt>TODO:</dt>
<dd>build a complete graph of exemplar scores and only add if this one is
lower than any other edge</dd>
<dt>SeeAlso:</dt>
<dd>ibsfuncs.prune_exemplars</dd>
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.system_suggestor &#8211;test-get_system_exemplar_suggestion</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.system_suggestor</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">autoexmplr_msg</span><span class="p">,</span> <span class="n">exemplar_decision</span><span class="p">,</span> <span class="n">exemplar_confidence</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_system_exemplar_suggestion</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">autoexmplr_msg</span><span class="p">,</span> <span class="n">exemplar_decision</span><span class="p">,</span> <span class="n">exemplar_confidence</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.system_suggestor.get_system_name_suggestion">
<tt class="descclassname">ibeis.model.hots.system_suggestor.</tt><tt class="descname">get_system_name_suggestion</tt><big>(</big><em>ibs</em>, <em>choicetup</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/system_suggestor.html#get_system_name_suggestion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.system_suggestor.get_system_name_suggestion" title="Permalink to this definition">¶</a></dt>
<dd><p>Suggests a decision based on the current choices</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation id</li>
<li><strong>qres</strong> (<em>QueryResult</em>) &#8211; object of feature correspondences and scores</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(autoname_msg, autoname_func)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-test_incremental_queries:0
python -m ibeis.model.hots.automated_matcher &#8211;test-test_incremental_queries:1
python -m ibeis.model.hots.automated_matcher &#8211;test-get_system_name_suggestion</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.system_suggestor</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips4</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">cfgdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
<span class="gp">... </span>           <span class="n">return_request</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span> <span class="o">=</span> <span class="n">qaid2_qres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">choicetup</span> <span class="o">=</span> <span class="n">get_qres_name_choices</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">autoname_msg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name_confidence</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_system_name_suggestion</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">choicetup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">autoname_msg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name_confidence</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.user_dialogs">
<span id="ibeis-model-hots-user-dialogs-module"></span><h2>ibeis.model.hots.user_dialogs module<a class="headerlink" href="#module-ibeis.model.hots.user_dialogs" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.user_dialogs.convert_name_suggestion_to_aids">
<tt class="descclassname">ibeis.model.hots.user_dialogs.</tt><tt class="descname">convert_name_suggestion_to_aids</tt><big>(</big><em>ibs</em>, <em>choicetup</em>, <em>name_suggest_tup</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/user_dialogs.html#convert_name_suggestion_to_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.user_dialogs.convert_name_suggestion_to_aids" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.user_dialogs</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comp_aids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">comp_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="s">&#39;sue&#39;</span><span class="p">,</span> <span class="s">&#39;alice&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chosen_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;fred&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">convert_name_suggestion_to_aids</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">choicetup</span><span class="p">,</span> <span class="n">name_suggest_tup</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.user_dialogs.wait_for_user_exemplar_decision">
<tt class="descclassname">ibeis.model.hots.user_dialogs.</tt><tt class="descname">wait_for_user_exemplar_decision</tt><big>(</big><em>autoexemplar_msg</em>, <em>exemplar_decision</em>, <em>exemplar_condience</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/user_dialogs.html#wait_for_user_exemplar_decision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.user_dialogs.wait_for_user_exemplar_decision" title="Permalink to this definition">¶</a></dt>
<dd><p>hooks into to some method of getting user input for exemplars</p>
<p>TODO: really good interface</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">?: True</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.automated_matcher &#8211;test-get_user_exemplar_decision</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.automated_matcher</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">autoexemplar_msg</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemplar_decision</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemplar_condience</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">True</span> <span class="o">=</span> <span class="n">get_user_exemplar_decision</span><span class="p">(</span><span class="n">autoexemplar_msg</span><span class="p">,</span> <span class="n">exemplar_decision</span><span class="p">,</span> <span class="n">exemplar_condience</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.user_dialogs.wait_for_user_name_decision">
<tt class="descclassname">ibeis.model.hots.user_dialogs.</tt><tt class="descname">wait_for_user_name_decision</tt><big>(</big><em>ibs</em>, <em>qres</em>, <em>qreq_</em>, <em>choicetup</em>, <em>name_suggest_tup</em>, <em>incinfo=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/user_dialogs.html#wait_for_user_name_decision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.user_dialogs.wait_for_user_name_decision" title="Permalink to this definition">¶</a></dt>
<dd><p>Prompts the user for input
hooks into to some method of getting user input for names</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qres</strong> (<em>QueryResult</em>) &#8211; object of feature correspondences and scores</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.user_dialogs &#8211;test-wait_for_user_name_decision</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.user_dialogs</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qres</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">_query_chips4</span><span class="p">(</span><span class="n">qaids</span><span class="p">,</span> <span class="n">daids</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">return_request</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">choicetup</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_suggest_tup</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">incinfo</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">wait_for_user_name_decision</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qres</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">choicetup</span><span class="p">,</span> <span class="n">name_suggest_tup</span><span class="p">,</span> <span class="n">incinfo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.voting_rules2">
<span id="ibeis-model-hots-voting-rules2-module"></span><h2>ibeis.model.hots.voting_rules2 module<a class="headerlink" href="#module-ibeis.model.hots.voting_rules2" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.enforce_one_name">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">enforce_one_name</tt><big>(</big><em>ibs</em>, <em>aid2_score</em>, <em>chipmatch=None</em>, <em>aid2_chipscore=None</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#enforce_one_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.enforce_one_name" title="Permalink to this definition">¶</a></dt>
<dd><p>this is a hack to make the same name only show up once in the top ranked
list</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.get_chipmatch_testdata">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">get_chipmatch_testdata</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#get_chipmatch_testdata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.get_chipmatch_testdata" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.get_scores_from_altx2_score">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">get_scores_from_altx2_score</tt><big>(</big><em>ibs</em>, <em>qcx</em>, <em>altx2_prob</em>, <em>altx2_tnx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#get_scores_from_altx2_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.get_scores_from_altx2_score" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.positional_scoring_rule">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">positional_scoring_rule</tt><big>(</big><em>qfx2_utilities</em>, <em>rule</em>, <em>isWeighted</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#positional_scoring_rule"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.positional_scoring_rule" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.score_chipmatch_PL">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">score_chipmatch_PL</tt><big>(</big><em>ibs</em>, <em>qcx</em>, <em>chipmatch</em>, <em>qreq</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#score_chipmatch_PL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.score_chipmatch_PL" title="Permalink to this definition">¶</a></dt>
<dd><p>chipmatch = qcx2_chipmatch[qcx]</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.score_chipmatch_csum">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">score_chipmatch_csum</tt><big>(</big><em>qaid</em>, <em>chipmatch</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#score_chipmatch_csum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.score_chipmatch_csum" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">aid_list, score_list</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.voting_rules2</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span> <span class="o">=</span> <span class="n">get_chipmatch_testdata</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">score_chipmatch_csum</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.score_chipmatch_nsum">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">score_chipmatch_nsum</tt><big>(</big><em>qaid</em>, <em>chipmatch</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#score_chipmatch_nsum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.score_chipmatch_nsum" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nid2_score</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python dev.py -t nsum_nosv &#8211;db GZ_ALL &#8211;allgt &#8211;noqcache
python dev.py -t nsum &#8211;db GZ_ALL &#8211;show &#8211;va -w &#8211;qaid 1032 &#8211;noqcache
python dev.py -t nsum_nosv &#8211;db GZ_ALL &#8211;show &#8211;va -w &#8211;qaid 1032 &#8211;noqcache
qaid=1032_res_gooc+f4msr4ouy9t_quuid=c4f78a6d.npz
qaid=1032_res_5ujbs8h&amp;%vw1olnx_quuid=c4f78a6d.npz</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># ENABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.voting_rules2</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span> <span class="o">=</span> <span class="n">get_chipmatch_testdata</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">aid_list</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span> <span class="o">=</span> <span class="n">score_chipmatch_nsum</span><span class="p">(</span><span class="n">qaid</span><span class="p">,</span> <span class="n">chipmatch</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.score_chipmatch_nunique">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">score_chipmatch_nunique</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>chipmatch</em>, <em>qreq</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#score_chipmatch_nunique"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.score_chipmatch_nunique" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.score_chipmatch_pos">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">score_chipmatch_pos</tt><big>(</big><em>ibs</em>, <em>qcx</em>, <em>chipmatch</em>, <em>qreq</em>, <em>rule='borda'</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#score_chipmatch_pos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.score_chipmatch_pos" title="Permalink to this definition">¶</a></dt>
<dd><p>Positional Scoring Rule</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.voting_rules2.score_chipmatch_true_nsum">
<tt class="descclassname">ibeis.model.hots.voting_rules2.</tt><tt class="descname">score_chipmatch_true_nsum</tt><big>(</big><em>qaid</em>, <em>chipmatch</em>, <em>qreq_</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/voting_rules2.html#score_chipmatch_true_nsum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.voting_rules2.score_chipmatch_true_nsum" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.vsone_pipeline">
<span id="ibeis-model-hots-vsone-pipeline-module"></span><h2>ibeis.model.hots.vsone_pipeline module<a class="headerlink" href="#module-ibeis.model.hots.vsone_pipeline" title="Permalink to this headline">¶</a></h2>
<p>special pipeline for vsone specific functions</p>
<dl class="docutils">
<dt>Current Issues:</dt>
<dd><ul class="first last simple">
<li>getting feature distinctiveness is too slow, we can either try a different
model, or precompute feature distinctiveness.<ul>
<li>we can reduce the size of the vsone shortlist</li>
</ul>
</li>
</ul>
</dd>
<dt>TODOLIST:</dt>
<dd><ul class="first simple">
<li>Precompute distinctivness</li>
<li>Paramatarize</li>
</ul>
<blockquote class="last">
<div><ul class="simple">
<li>grid / image coverage</li>
<li>image cov params</li>
<li>grid cov params</li>
<li>scr-vsone / rat-vsone</li>
<li>scr-params</li>
<li>rat-params</li>
<li>true-pos-score in qres</li>
<li>false-neg-score in qres</li>
<li>false-pos-score in qres</li>
</ul>
</div></blockquote>
</dd>
</dl>
<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.compute_grid_coverage_score">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">compute_grid_coverage_score</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>daid_list</em>, <em>fm_list</em>, <em>fs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#compute_grid_coverage_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.compute_grid_coverage_score" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.vsone_pipeline &#8211;test-compute_grid_coverage_score</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.vsone_pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">fm_list</span><span class="p">,</span> <span class="n">fs_list</span> <span class="o">=</span> <span class="n">testdata_scoring</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_list</span> <span class="o">=</span> <span class="n">compute_grid_coverage_score</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">fm_list</span><span class="p">,</span> <span class="n">fs_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">score_list</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.compute_image_coverage_score">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">compute_image_coverage_score</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>daid_list</em>, <em>fm_list</em>, <em>fs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#compute_image_coverage_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.compute_image_coverage_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a grayscale chip match which represents which pixels
should be matches in order for a candidate to be considered a match.</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.vsone_pipeline &#8211;test-compute_image_coverage_score</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.vsone_pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">fm_list</span><span class="p">,</span> <span class="n">fs_list</span> <span class="o">=</span> <span class="n">testdata_scoring</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">score_list</span> <span class="o">=</span> <span class="n">compute_image_coverage_score</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">fm_list</span><span class="p">,</span> <span class="n">fs_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># verify results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">score_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>import plottool as pt
pt.imshow(weight_mask * 255, update=True, fnum=2)
pt.imshow(weight_mask_m * 255, update=True, fnum=3)
pt.imshow(weight_color * 255, update=True, fnum=3)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.compute_query_constrained_matches">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">compute_query_constrained_matches</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>daid_list</em>, <em>H_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#compute_query_constrained_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.compute_query_constrained_matches" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.compute_query_matches">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">compute_query_matches</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>daid_list</em>, <em>H_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#compute_query_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.compute_query_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>calls specified vsone matching routine for single (qaid, daids) pair</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.execute_vsone_reranking">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">execute_vsone_reranking</tt><big>(</big><em>qreq_</em>, <em>qaid_list</em>, <em>daids_list_</em>, <em>Hs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#execute_vsone_reranking"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.execute_vsone_reranking" title="Permalink to this definition">¶</a></dt>
<dd><p>runs several pairs of (qaid, daids) vsone matches</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.get_kpts_distinctiveness">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">get_kpts_distinctiveness</tt><big>(</big><em>ibs</em>, <em>aid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#get_kpts_distinctiveness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.get_kpts_distinctiveness" title="Permalink to this definition">¶</a></dt>
<dd><p>per-species disinctivness wrapper around ibeis cached function</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.make_vsone_rerank_pairs">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">make_vsone_rerank_pairs</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatch</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#make_vsone_rerank_pairs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.make_vsone_rerank_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes shortlists for vsone reranking</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.vsone_pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">sver_weighting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;chipmatch_to_resdict&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_SVER&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="n">qreq_</span><span class="o">.</span><span class="n">get_external_qaids</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chipmatch</span> <span class="o">=</span> <span class="n">qaid2_chipmatch</span><span class="p">[</span><span class="n">qaid</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid_list</span><span class="p">,</span> <span class="n">top_aids_list</span><span class="p">,</span> <span class="n">top_Hs_list</span> <span class="o">=</span> <span class="n">make_vsone_rerank_pairs</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_aid_list</span> <span class="o">=</span> <span class="n">top_aids_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_nid_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_name_rowids</span><span class="p">(</span><span class="n">top_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">top_nid_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;name 1 should be rank 1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_nid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;should have 3 names and up to 2 image per name&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.show_annot_weights">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">show_annot_weights</tt><big>(</big><em>ibs</em>, <em>aid</em>, <em>mode='dstncvs'</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#show_annot_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.show_annot_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>DEMO FUNC</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>aid</strong> (<em>int</em>) &#8211; annotation id</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd><p class="first">alias show_annot_weights=&#8217;python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show&#8217;
show_annot_weights
show_annot_weights &#8211;db PZ_MTEST &#8211;aid 1 &#8211;mode &#8216;dstncvs&#8217;
show_annot_weights &#8211;db PZ_MTEST &#8211;aid 1 &#8211;mode &#8216;fgweight&#8217;&amp;
show_annot_weights &#8211;db GZ_ALL &#8211;aid 1 &#8211;mode &#8216;dstncvs&#8217;
show_annot_weights &#8211;db GZ_ALL &#8211;aid 1 &#8211;mode &#8216;fgweight&#8217;&amp;</p>
<p>python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show &#8211;db GZ_ALL &#8211;aid 1 &#8211;mode &#8216;dstncvs&#8217;
python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show &#8211;db PZ_MTEST &#8211;aid 1 &#8211;mode &#8216;dstncvs&#8217;
python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show &#8211;db GZ_ALL &#8211;aid 1 &#8211;mode &#8216;fgweight&#8217;
python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show &#8211;db PZ_MTEST &#8211;aid 1 &#8211;mode &#8216;fgweight&#8217;</p>
<p class="last">python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show &#8211;db GZ_ALL &#8211;aid 1 &#8211;mode &#8216;dstncvs*fgweight&#8217;
python -m ibeis.model.hots.vsone_pipeline &#8211;test-show_annot_weights &#8211;show &#8211;db PZ_MTEST &#8211;aid 1 &#8211;mode &#8216;dstncvs*fgweight&#8217;</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.vsone_pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--db&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;testdb1&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aid</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--aid&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mode</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_argval</span><span class="p">(</span><span class="s">&#39;--mode&#39;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;dstncvs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_annot_weights</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.show_top_chipmatches">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">show_top_chipmatches</tt><big>(</big><em>ibs</em>, <em>qaid2_chipmatch</em>, <em>fnum_offset=0</em>, <em>figtitle=''</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#show_top_chipmatches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.show_top_chipmatches" title="Permalink to this definition">¶</a></dt>
<dd><p>helper</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.single_vsone_query">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">single_vsone_query</tt><big>(</big><em>ibs</em>, <em>qaid</em>, <em>daid_list</em>, <em>H_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#single_vsone_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.single_vsone_query" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ibs</strong> (<em>IBEISController</em>) &#8211; ibeis controller object</li>
<li><strong>qaid</strong> (<em>int</em>) &#8211; query annotation id</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.vsone_pipeline &#8211;test-single_vsone_query</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># DISABLE_DOCTEST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.vsone_pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibeis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># build test data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span> <span class="o">=</span> <span class="n">ibeis</span><span class="o">.</span><span class="n">opendb</span><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H_list</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="o">-</span><span class="mf">4.68815126e-01</span><span class="p">,</span>   <span class="mf">7.80306795e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.23674587e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span>  <span class="mf">4.54394231e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">7.67438835e-01</span><span class="p">,</span>   <span class="mf">5.92158624e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span>  <span class="mf">2.12918867e-04</span><span class="p">,</span>  <span class="o">-</span><span class="mf">8.64851418e-05</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.21472492e-01</span><span class="p">]]),</span>
<span class="gp">... </span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">5.11319128e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.69211436e-04</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.18079183e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span> <span class="o">-</span><span class="mf">5.97449121e-02</span><span class="p">,</span>   <span class="mf">4.67044573e-01</span><span class="p">,</span>   <span class="mf">5.27655556e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span>  <span class="mf">1.06650025e-04</span><span class="p">,</span>   <span class="mf">8.70310639e-05</span><span class="p">,</span>   <span class="mf">5.28664052e-01</span><span class="p">]]),</span>
<span class="gp">... </span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">4.47902439e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.79874835e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.88314836e-01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span> <span class="o">-</span><span class="mf">2.61825221e-02</span><span class="p">,</span>   <span class="mf">3.59390616e-01</span><span class="p">,</span>   <span class="mf">6.47754036e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span> <span class="o">-</span><span class="mf">1.02783595e-04</span><span class="p">,</span>  <span class="o">-</span><span class="mf">5.74416869e-04</span><span class="p">,</span>   <span class="mf">6.88664085e-01</span><span class="p">]]),</span>
<span class="gp">... </span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">4.94544421e-01</span><span class="p">,</span>   <span class="mf">2.05268712e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">5.35167763e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span> <span class="o">-</span><span class="mf">1.99183336e-01</span><span class="p">,</span>   <span class="mf">7.97940559e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.45807386e+01</span><span class="p">],</span>
<span class="gp">... </span>           <span class="p">[</span> <span class="o">-</span><span class="mf">4.60593287e-04</span><span class="p">,</span>   <span class="mf">1.36874405e-03</span><span class="p">,</span>   <span class="mf">3.83659263e-01</span><span class="p">]])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#species = ibeis.const.Species.ZEB_PLAIN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#dstncvs_normer = distinctiveness_normalizer.request_species_distinctiveness_normalizer(species)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># execute function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_fm_fs_score_tup</span> <span class="o">=</span> <span class="n">single_vsone_query</span><span class="p">(</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid</span><span class="p">,</span> <span class="n">daid_list</span><span class="p">,</span> <span class="n">H_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daid_list</span><span class="p">,</span> <span class="n">fm_list</span><span class="p">,</span> <span class="n">fs_list</span><span class="p">,</span> <span class="n">score_list</span> <span class="o">=</span> <span class="n">daid_fm_fs_score_tup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">score_list</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd><p class="first">from ibeis.viz import viz_sver
import plottool as pt</p>
<p>next_pnum = pt.make_pnum_nextgen(<a href="#id1"><span class="problematic" id="id2">*</span></a>pt.get_square_row_cols(len(daid_list)))
for fm, daid, H in zip(fm_SCR_list, daid_list, H_list):</p>
<blockquote>
<div>viz_sver.show_constrained_match(ibs, qaid, daid, H, fm, pnum=next_pnum())</div></blockquote>
<p class="last">pt.update()</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.spatially_constrained_match">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">spatially_constrained_match</tt><big>(</big><em>flann</em>, <em>dvecs</em>, <em>qkpts</em>, <em>dkpts</em>, <em>H</em>, <em>dlen_sqrd</em>, <em>match_xy_thresh</em>, <em>ratio_thresh2</em>, <em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#spatially_constrained_match"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.spatially_constrained_match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.testdata_scoring">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">testdata_scoring</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#testdata_scoring"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.testdata_scoring" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.vsone_pipeline.vsone_reranking">
<tt class="descclassname">ibeis.model.hots.vsone_pipeline.</tt><tt class="descname">vsone_reranking</tt><big>(</big><em>qreq_</em>, <em>qaid2_chipmatch</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/vsone_pipeline.html#vsone_reranking"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.vsone_pipeline.vsone_reranking" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver function for vsone reranking</p>
<dl class="docutils">
<dt>CommandLine:</dt>
<dd>python -m ibeis.model.hots.vsone_pipeline &#8211;test-vsone_reranking
utprof.py -m ibeis.model.hots.vsone_pipeline &#8211;test-vsone_reranking
python -m ibeis.model.hots.vsone_pipeline &#8211;test-vsone_reranking &#8211;show</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.vsone_pipeline</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cfgdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dupvote_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">prescore_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s">&#39;nsum&#39;</span><span class="p">,</span> <span class="n">sver_weighting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibs</span><span class="p">,</span> <span class="n">qreq_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">get_pipeline_testdata</span><span class="p">(</span><span class="s">&#39;PZ_MTEST&#39;</span><span class="p">,</span> <span class="n">cfgdict</span><span class="o">=</span><span class="n">cfgdict</span><span class="p">,</span> <span class="n">qaid_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locals_</span> <span class="o">=</span> <span class="n">plh</span><span class="o">.</span><span class="n">testrun_pipeline_upto</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="s">&#39;chipmatch_to_resdict&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch</span> <span class="o">=</span> <span class="n">locals_</span><span class="p">[</span><span class="s">&#39;qaid2_chipmatch_SVER&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qaid2_chipmatch_VSONE</span> <span class="o">=</span> <span class="n">vsone_reranking</span><span class="p">(</span><span class="n">qreq_</span><span class="p">,</span> <span class="n">qaid2_chipmatch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">show_was_requested</span><span class="p">():</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">show_top_chipmatches</span><span class="p">(</span><span class="n">qreq_</span><span class="o">.</span><span class="n">ibs</span><span class="p">,</span> <span class="n">qaid2_chipmatch_VSONE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">pt</span><span class="o">.</span><span class="n">show_if_requested</span><span class="p">()</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Ignore:</dt>
<dd>max_depth = None
max_depth2 = 1
print(ut.depth_profile(Hs_list, 0))
print(ut.depth_profile(scores_list, max_depth))
print(ut.depth_profile(daid_list, max_depth))
print(ut.depth_profile(fms_list, max_depth2))
print(ut.depth_profile(fsvs_list, max_depth))</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots.word_index">
<span id="ibeis-model-hots-word-index-module"></span><h2>ibeis.model.hots.word_index module<a class="headerlink" href="#module-ibeis.model.hots.word_index" title="Permalink to this headline">¶</a></h2>
<p>python -c &#8220;import doctest, ibeis; print(doctest.testmod(ibeis.model.hots.word_index))&#8221;
python -m doctest -v ibeis/model/hots/word_index.py
python -m doctest ibeis/model/hots/word_index.py</p>
<dl class="class">
<dt id="ibeis.model.hots.word_index.NeighborAssignment">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">NeighborAssignment</tt><big>(</big><em>asgn</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#NeighborAssignment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.NeighborAssignment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ibeis.model.hots.word_index.WordIndex">
<em class="property">class </em><tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">WordIndex</tt><big>(</big><em>windex</em>, <em>ax2_aid</em>, <em>idx2_vec</em>, <em>idx2_ax</em>, <em>idx2_fx</em>, <em>flann</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>Abstract wrapper around flann</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.word_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">windex</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_windex</span><span class="p">()</span>  
</pre></div>
</div>
<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.add_points">
<tt class="descname">add_points</tt><big>(</big><em>windex</em>, <em>new_aid_list</em>, <em>new_vecs_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.add_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.add_points" title="Permalink to this definition">¶</a></dt>
<dd><p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.word_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">windex</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_windex</span><span class="p">()</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_aid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_vecs_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">new_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">checks</span> <span class="o">=</span> <span class="mi">1028</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx1</span><span class="p">,</span> <span class="n">qfx2_dist1</span><span class="p">)</span> <span class="o">=</span> <span class="n">windex</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">checks</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">windex</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">new_aid_list</span><span class="p">,</span> <span class="n">new_vecs_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx2</span><span class="p">,</span> <span class="n">qfx2_dist2</span><span class="p">)</span> <span class="o">=</span> <span class="n">windex</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">checks</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">qfx2_idx2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">qfx2_idx1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.empty_words">
<tt class="descname">empty_words</tt><big>(</big><em>K</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.empty_words"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.empty_words" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.get_nn_aids">
<tt class="descname">get_nn_aids</tt><big>(</big><em>windex</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.get_nn_aids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.get_nn_aids" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> (<em>ndarray</em>) &#8211; (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">qfx2_aid - (N x K) qfx2_fx[n][k] is the annotation id index
of the kth approximate nearest data vector</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.get_nn_axs">
<tt class="descname">get_nn_axs</tt><big>(</big><em>windex</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.get_nn_axs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.get_nn_axs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.get_nn_featxs">
<tt class="descname">get_nn_featxs</tt><big>(</big><em>windex</em>, <em>qfx2_nnidx</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.get_nn_featxs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.get_nn_featxs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>qfx2_nnidx</strong> (<em>ndarray</em>) &#8211; (N x K) qfx2_idx[n][k] is the index of the kth
approximate nearest data vector</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">qfx2_fx - (N x K) qfx2_fx[n][k] is the feature index (w.r.t
the source annotation) of the kth approximate nearest data vector</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.knn">
<tt class="descname">knn</tt><big>(</big><em>windex</em>, <em>qfx2_vec</em>, <em>K</em>, <em>checks=1028</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.knn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.knn" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>qfx2_vec</strong> (<em>ndarray</em>) &#8211; (N x D) array of N, D-dimensional query vectors</li>
<li><strong>K</strong> (<em>int</em>) &#8211; number of approximate nearest words to find</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>tuple of (qfx2_idx, qfx2_dist)</p>
<dl class="docutils">
<dt>qfx2_idx (ndarray):  (N x K) qfx2_idx[n][k] is the index of the kth</dt>
<dd><p class="first last">approximate nearest data vector w.r.t qfx2_vec[n]</p>
</dd>
<dt>qfx2_dist (ndarray): (N x K) qfx2_dist[n][k] is the distance to the kth</dt>
<dd><p class="first last">approximate nearest data vector w.r.t. qfx2_vec[n]</p>
</dd>
</dl>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.word_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">windex</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_windex</span><span class="p">()</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_aid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qfx2_vec</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_vecs_list</span> <span class="o">=</span> <span class="n">ibs</span><span class="o">.</span><span class="n">get_annot_vecs</span><span class="p">(</span><span class="n">new_aid_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">checks</span> <span class="o">=</span> <span class="mi">1028</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">qfx2_idx</span><span class="p">,</span> <span class="n">qfx2_dist</span><span class="p">)</span> <span class="o">=</span> <span class="n">windex</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">qfx2_vec</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">checks</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.num_indexed_annots">
<tt class="descname">num_indexed_annots</tt><big>(</big><em>windex</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.num_indexed_annots"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.num_indexed_annots" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.num_indexed_vecs">
<tt class="descname">num_indexed_vecs</tt><big>(</big><em>windex</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#WordIndex.num_indexed_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.num_indexed_vecs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ibeis.model.hots.word_index.WordIndex.rrr">
<tt class="descname">rrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.word_index.WordIndex.rrr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.word_index.invert_index">
<tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">invert_index</tt><big>(</big><em>vecs_list</em>, <em>ax_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#invert_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.invert_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregates descriptors of input annotations and returns inverted information</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.word_index.new_ibeis_windex">
<tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">new_ibeis_windex</tt><big>(</big><em>ibs</em>, <em>daid_list</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#new_ibeis_windex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.new_ibeis_windex" title="Permalink to this definition">¶</a></dt>
<dd><p>IBEIS interface into word_index</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibeis.model.hots.word_index</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">windex</span><span class="p">,</span> <span class="n">qreq_</span><span class="p">,</span> <span class="n">ibs</span> <span class="o">=</span> <span class="n">test_windex</span><span class="p">()</span> 
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.word_index.new_word_index">
<tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">new_word_index</tt><big>(</big><em>aid_list=[]</em>, <em>vecs_list=[]</em>, <em>flann_params={}</em>, <em>flann_cachedir=None</em>, <em>indexer_cfgstr=''</em>, <em>hash_rowids=True</em>, <em>use_cache=True</em>, <em>use_params_hash=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#new_word_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.new_word_index" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.word_index.test_windex">
<tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">test_windex</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#test_windex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.test_windex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.word_index.vlad">
<tt class="descclassname">ibeis.model.hots.word_index.</tt><tt class="descname">vlad</tt><big>(</big><em>qfx2_vec</em>, <em>qfx2_cvec</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots/word_index.html#vlad"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.word_index.vlad" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ibeis.model.hots">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ibeis.model.hots" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ibeis.model.hots.reload_subs">
<tt class="descclassname">ibeis.model.hots.</tt><tt class="descname">reload_subs</tt><big>(</big><em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/ibeis/model/hots.html#reload_subs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibeis.model.hots.reload_subs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads ibeis.model.hots and submodules</p>
</dd></dl>

<dl class="function">
<dt id="ibeis.model.hots.rrrr">
<tt class="descclassname">ibeis.model.hots.</tt><tt class="descname">rrrr</tt><big>(</big><em>verbose=True</em><big>)</big><a class="headerlink" href="#ibeis.model.hots.rrrr" title="Permalink to this definition">¶</a></dt>
<dd><p>Reloads ibeis.model.hots and submodules</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ibeis.model.hots package</a><ul>
<li><a class="reference internal" href="#subpackages">Subpackages</a></li>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots._neighbor_experiment">ibeis.model.hots._neighbor_experiment module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots._pipeline_helpers">ibeis.model.hots._pipeline_helpers module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.automated_helpers">ibeis.model.hots.automated_helpers module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.automated_matcher">ibeis.model.hots.automated_matcher module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.automated_oracle">ibeis.model.hots.automated_oracle module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.devcases">ibeis.model.hots.devcases module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.distinctiveness_normalizer">ibeis.model.hots.distinctiveness_normalizer module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.exceptions">ibeis.model.hots.exceptions module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.hots_query_result">ibeis.model.hots.hots_query_result module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.hstypes">ibeis.model.hots.hstypes module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.match_chips4">ibeis.model.hots.match_chips4 module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.multi_index">ibeis.model.hots.multi_index module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.name_scoring">ibeis.model.hots.name_scoring module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.neighbor_index">ibeis.model.hots.neighbor_index module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.nn_weights">ibeis.model.hots.nn_weights module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.pipeline">ibeis.model.hots.pipeline module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.precision_recall">ibeis.model.hots.precision_recall module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.qt_inc_automatch">ibeis.model.hots.qt_inc_automatch module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.query_helpers">ibeis.model.hots.query_helpers module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.query_request">ibeis.model.hots.query_request module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.score_normalization">ibeis.model.hots.score_normalization module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.special_query">ibeis.model.hots.special_query module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.system_suggestor">ibeis.model.hots.system_suggestor module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.user_dialogs">ibeis.model.hots.user_dialogs module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.voting_rules2">ibeis.model.hots.voting_rules2 module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.vsone_pipeline">ibeis.model.hots.vsone_pipeline module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots.word_index">ibeis.model.hots.word_index module</a></li>
<li><a class="reference internal" href="#module-ibeis.model.hots">Module contents</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ibeis.model.detect.html"
                        title="previous chapter">ibeis.model.detect package</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ibeis.model.hots.smk.html"
                        title="next chapter">ibeis.model.hots.smk package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ibeis.model.hots.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ibeis.model.hots.smk.html" title="ibeis.model.hots.smk package"
             >next</a> |</li>
        <li class="right" >
          <a href="ibeis.model.detect.html" title="ibeis.model.detect package"
             >previous</a> |</li>
        <li><a href="index.html">ibeis 0.1.0.dev1 documentation</a> &raquo;</li>
          <li><a href="ibeis.html" >ibeis package</a> &raquo;</li>
          <li><a href="ibeis.model.html" >ibeis.model package</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Jon Crall.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>