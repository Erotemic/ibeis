"""
AUTOGENERATED ON 11:35:43 2015/03/20
AutogenCommandLine:
    python -m ibeis.control.DBCACHE_SCHEMA --test-autogen_dbcache_schema --force-incremental-db-update --write
    python -m ibeis.control.DBCACHE_SCHEMA --test-autogen_dbcache_schema --force-incremental-db-update
"""
from __future__ import absolute_import, division, print_function
from ibeis import constants as const


# =======================
# Schema Version Current
# =======================


VERSION_CURRENT = '1.0.4'


def update_current(db, ibs=None):
    db.add_table(const.CHIP_TABLE, [
        ('chip_rowid',                   'INTEGER PRIMARY KEY'),
        ('annot_rowid',                  'INTEGER NOT NULL'),
        ('config_rowid',                 'INTEGER DEFAULT 0'),
        ('chip_uri',                     'TEXT'),
        ('chip_width',                   'INTEGER NOT NULL'),
        ('chip_height',                  'INTEGER NOT NULL'),
    ],
        docstr='''
        Used to store *processed* annots as chips
        ''',
        superkeys=[('annot_rowid', 'config_rowid')],
        dependson='annotations',
    )

    db.add_table(const.FEATURE_WEIGHT_TABLE, [
        ('featweight_rowid',             'INTEGER PRIMARY KEY'),
        ('feature_rowid',                'INTEGER NOT NULL'),
        ('config_rowid',                 'INTEGER DEFAULT 0'),
        ('featweight_forground_weight',  'NUMPY'),
    ],
        docstr='''
        Stores weightings of features based on the forground... etc
        ''',
        superkeys=[('feature_rowid', 'config_rowid')],
        dependson='features',
        shortname='featweight',
    )

    db.add_table(const.FEATURE_TABLE, [
        ('feature_rowid',                'INTEGER PRIMARY KEY'),
        ('chip_rowid',                   'INTEGER NOT NULL'),
        ('config_rowid',                 'INTEGER DEFAULT 0'),
        ('feature_num_feats',            'INTEGER NOT NULL'),
        ('feature_keypoints',            'NUMPY'),
        ('feature_vecs',                 'NUMPY'),
    ],
        docstr='''
        Used to store individual chip features (ellipses)
        ''',
        superkeys=[('chip_rowid, config_rowid',)],
        dependson='chips',
    )

    db.add_table(const.METADATA_TABLE, [
        ('metadata_rowid',               'INTEGER PRIMARY KEY'),
        ('metadata_key',                 'TEXT'),
        ('metadata_value',               'TEXT'),
    ],
        docstr='''
        The table that stores permanently all of the metadata about the
        database (tables, etc)
        ''',
        superkeys=[('metadata_key',)],
    )

    db.add_table(const.RESIDUAL_TABLE, [
        ('residual_rowid',               'INTEGER PRIMARY KEY'),
        ('feature_rowid',                'INTEGER NOT NULL'),
        ('config_rowid',                 'INTEGER DEFAULT 0'),
        ('residual_vector',              'NUMPY'),
    ],
        docstr='''
        Used to store individual SMK/ASMK residual vectors for features
        ''',
        superkeys=[('feature_rowid', 'config_rowid')],
    )
